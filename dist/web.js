function t(t){return Object.keys(t).reduce(((e,s)=>{var r=t[s];return e[s]=Object.assign({},r),!i(r.value)||function(t){return"[object Function]"===Object.prototype.toString.call(t)}(r.value)||Array.isArray(r.value)||(e[s].value=Object.assign({},r.value)),Array.isArray(r.value)&&(e[s].value=r.value.slice(0)),e}),{})}function e(t){if(t)try{return JSON.parse(t)}catch(e){return t}}function s(t,e,s){if(null==s||!1===s)return t.removeAttribute(e);let i=JSON.stringify(s);t.__updating[e]=!0,"true"===i&&(i=""),t.setAttribute(e,i),Promise.resolve().then((()=>delete t.__updating[e]))}function i(t){return null!=t&&("object"==typeof t||"function"==typeof t)}let r;function a(i,a){const n=Object.keys(a);return class extends i{static get observedAttributes(){return n.map((t=>a[t].attribute))}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(!this.__initialized){this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=function(i,r){const a=t(r);return Object.keys(r).forEach((t=>{const r=a[t],n=i.getAttribute(r.attribute),o=i[t];n&&(r.value=r.parse?e(n):n),null!=o&&(r.value=Array.isArray(o)?o.slice(0):o),r.reflect&&s(i,r.attribute,r.value),Object.defineProperty(i,t,{get:()=>r.value,set(e){var i=r.value;r.value=e,r.reflect&&s(this,r.attribute,r.value);for(let s=0,r=this.__propertyChangedCallbacks.length;s<r;s++)this.__propertyChangedCallbacks[s](t,e,i)},enumerable:!0,configurable:!0})})),a}(this,a);var i=function(t){return Object.keys(t).reduce(((e,s)=>(e[s]=t[s].value,e)),{})}(this.props),n=this.Component,o=r;try{(r=this).__initialized=!0,function(t){return"function"==typeof t&&0===t.toString().indexOf("class")}(n)?new n(i,{element:this}):n(i,{element:this})}finally{r=o}}}async disconnectedCallback(){if(await Promise.resolve(),!this.isConnected){this.__propertyChangedCallbacks.length=0;for(var t=null;t=this.__releaseCallbacks.pop();)t(this);delete this.__initialized,this.__released=!0}}attributeChangedCallback(t,s,i){!this.__initialized||this.__updating[t]||(t=this.lookupProp(t))in a&&(null==i&&!this[t]||(this[t]=a[t].parse?e(i):i))}lookupProp(t){if(a)return n.find((e=>t===e||t===a[e].attribute))}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(t){this.__releaseCallbacks.push(t)}addPropertyChangedCallback(t){this.__propertyChangedCallbacks.push(t)}}}function n(t,e={},s={}){const{BaseElement:r=HTMLElement,extension:n}=s;return s=>{if(!t)throw new Error("tag is required to register a Component");let o=customElements.get(t);return o?o.prototype.Component=s:((o=a(r,function(t){return t?Object.keys(t).reduce(((e,s)=>{var r=t[s];return e[s]=i(r)&&"value"in r?r:{value:r},e[s].attribute||(e[s].attribute=function(t){return t.replace(/\.?([A-Z]+)/g,((t,e)=>"-"+e.toLowerCase())).replace("_","-").replace(/^-/,"")}(s)),e[s].parse="parse"in e[s]?e[s].parse:"string"!=typeof e[s].value,e}),{}):{}}(e))).prototype.Component=s,o.prototype.registeredTag=t,customElements.define(t,o,n)),o}}const o=Symbol("solid-proxy"),l=Symbol("solid-track"),h={equals:(t,e)=>t===e};let d=D;const c=1,u=2,p={owned:null,cleanups:null,context:null,owner:null};var g=null;let f=null,m=null,v=null,b=null,y=0;function w(t,e){const s=m,i=g,r=0===t.length,a=r?p:{owned:null,cleanups:null,context:null,owner:void 0===e?i:e},n=r?t:()=>t((()=>k((()=>B(a)))));g=a,m=null;try{return I(n,!0)}finally{m=s,g=i}}function x(t,e){const s={value:t,observers:null,observerSlots:null,comparator:(e=e?Object.assign({},h,e):h).equals||void 0};return[T.bind(s),t=>("function"==typeof t&&(t=t(s.value)),M(s,t))]}function A(t,e,s){P(L(t,e,!1,c))}function _(t,e,s){d=F,(t=L(t,e,!1,c)).user=!0,b?b.push(t):P(t)}function C(t,e,s){return s=s?Object.assign({},h,s):h,(t=L(t,e,!0,0)).observers=null,t.observerSlots=null,t.comparator=s.equals||void 0,P(t),T.bind(t)}function k(t){if(null===m)return t();var e=m;m=null;try{return t()}finally{m=e}}function E(t){_((()=>k(t)))}function S(t){return null!==g&&(null===g.cleanups?g.cleanups=[t]:g.cleanups.push(t)),t}function T(){var t;return this.sources&&this.state&&(this.state===c?P(this):(t=v,v=null,I((()=>O(this)),!1),v=t)),m&&(t=this.observers?this.observers.length:0,m.sources?(m.sources.push(this),m.sourceSlots.push(t)):(m.sources=[this],m.sourceSlots=[t]),this.observers?(this.observers.push(m),this.observerSlots.push(m.sources.length-1)):(this.observers=[m],this.observerSlots=[m.sources.length-1])),this.value}function M(t,e,s){var i=t.value;return t.comparator&&t.comparator(i,e)||(t.value=e,t.observers&&t.observers.length&&I((()=>{for(let i=0;i<t.observers.length;i+=1){var e=t.observers[i],s=f&&f.running;s&&f.disposed.has(e),(s?e.tState:e.state)||((e.pure?v:b).push(e),e.observers&&N(e)),s||(e.state=c)}if(1e6<v.length)throw v=[],new Error}),!1)),e}function P(t){var e,s,i;t.fn&&(B(t),e=g,s=m,i=y,function(t,e,s){let i;try{i=t.fn(e)}catch(e){return t.pure&&(t.state=c,t.owned&&t.owned.forEach(B),t.owned=null),t.updatedAt=s+1,z(e)}(!t.updatedAt||t.updatedAt<=s)&&(null!=t.updatedAt&&"observers"in t?M(t,i):t.value=i,t.updatedAt=s)}(m=g=t,t.value,i),m=s,g=e)}function L(t,e,s,i=c,r){return t={fn:t,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:g,context:null,pure:s},null!==g&&g!==p&&(g.owned?g.owned.push(t):g.owned=[t]),t}function R(t){if(0!==t.state){if(t.state===u)return O(t);if(t.suspense&&k(t.suspense.inFallback))return t.suspense.effects.push(t);const s=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<y);)t.state&&s.push(t);for(let i=s.length-1;0<=i;i--){var e;(t=s[i]).state===c?P(t):t.state===u&&(e=v,v=null,I((()=>O(t,s[0])),!1),v=e)}}}function I(t,e){if(v)return t();let s=!1;e||(v=[]),b?s=!0:b=[],y++;try{var i=t();return function(t){if(v&&(D(v),v=null),!t){const t=b;b=null,t.length&&I((()=>d(t)),!1)}}(s),i}catch(t){s||(b=null),v=null,z(t)}}function D(t){for(let e=0;e<t.length;e++)R(t[e])}function F(t){let e,s=0;for(e=0;e<t.length;e++){var i=t[e];i.user?t[s++]=i:R(i)}for(e=0;e<s;e++)R(t[e])}function O(t,e){for(let r=t.state=0;r<t.sources.length;r+=1){var s,i=t.sources[r];i.sources&&((s=i.state)===c?i!==e&&(!i.updatedAt||i.updatedAt<y)&&R(i):s===u&&O(i,e))}}function N(t){for(let s=0;s<t.observers.length;s+=1){var e=t.observers[s];e.state||(e.state=u,(e.pure?v:b).push(e),e.observers&&N(e))}}function B(t){let e;if(t.sources)for(;t.sources.length;){var s,i,r=t.sources.pop(),a=t.sourceSlots.pop(),n=r.observers;n&&n.length&&(s=n.pop(),i=r.observerSlots.pop(),a<n.length)&&(n[s.sourceSlots[i]=a]=s,r.observerSlots[a]=i)}if(t.owned){for(e=t.owned.length-1;0<=e;e--)B(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;0<=e;e--)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function z(t){throw t}const H=Symbol("fallback");function j(t){for(let e=0;e<t.length;e++)t[e]()}function $(t,e){return k((()=>t(e||{})))}function U(){return!0}const q={get:(t,e,s)=>e===o?s:t.get(e),has:(t,e)=>e===o||t.has(e),set:U,deleteProperty:U,getOwnPropertyDescriptor:(t,e)=>({configurable:!0,enumerable:!0,get:()=>t.get(e),set:U,deleteProperty:U}),ownKeys:t=>t.keys()};function V(t){return(t="function"==typeof t?t():t)||{}}function G(...t){let e=!1;for(let i=0;i<t.length;i++){var s=t[i];e=e||!!s&&o in s,t[i]="function"==typeof s?(e=!0,C(s)):s}if(e)return new Proxy({get(e){for(let i=t.length-1;0<=i;i--){var s=V(t[i])[e];if(void 0!==s)return s}},has(e){for(let s=t.length-1;0<=s;s--)if(e in V(t[s]))return!0;return!1},keys(){var e=[];for(let s=0;s<t.length;s++)e.push(...Object.keys(V(t[s])));return[...new Set(e)]}},q);var i={};for(let e=t.length-1;0<=e;e--)if(t[e])for(const s in Object.getOwnPropertyDescriptors(t[e]))s in i||Object.defineProperty(i,s,{enumerable:!0,get(){for(let i=t.length-1;0<=i;i--){var e=(t[i]||{})[s];if(void 0!==e)return e}}});return i}function W(t,...e){const s=new Set(e.flat());var i;if(o in t)return(i=e.map((e=>new Proxy({get:s=>e.includes(s)?t[s]:void 0,has:s=>e.includes(s)&&s in t,keys:()=>e.filter((e=>e in t))},q)))).push(new Proxy({get:e=>s.has(e)?void 0:t[e],has:e=>!s.has(e)&&e in t,keys:()=>Object.keys(t).filter((t=>!s.has(t)))},q)),i;const r=Object.getOwnPropertyDescriptors(t);return e.push(Object.keys(r).filter((t=>!s.has(t)))),e.map((e=>{var s={};for(let i=0;i<e.length;i++){const a=e[i];a in t&&Object.defineProperty(s,a,r[a]||{get:()=>t[a],set:()=>!0,enumerable:!0})}return s}))}function X(t){var e="fallback"in t&&{fallback:()=>t.fallback};return C(function(t,e,s={}){let i=[],r=[],a=[],n=0,o=1<e.length?[]:null;return S((()=>j(a))),()=>{let h,d,c=t()||[];return c[l],k((()=>{let t,e,l,p,g,f,m,v,b,y=c.length;if(0===y)0!==n&&(j(a),a=[],i=[],r=[],n=0,o=o&&[]),s.fallback&&(i=[H],r[0]=w((t=>(a[0]=t,s.fallback()))),n=1);else if(0===n){for(r=new Array(y),d=0;d<y;d++)i[d]=c[d],r[d]=w(u);n=y}else{for(l=new Array(y),p=new Array(y),o&&(g=new Array(y)),f=0,m=Math.min(n,y);f<m&&i[f]===c[f];f++);for(m=n-1,v=y-1;m>=f&&v>=f&&i[m]===c[v];m--,v--)l[v]=r[m],p[v]=a[m],o&&(g[v]=o[m]);for(t=new Map,e=new Array(v+1),d=v;d>=f;d--)b=c[d],h=t.get(b),e[d]=void 0===h?-1:h,t.set(b,d);for(h=f;h<=m;h++)b=i[h],void 0!==(d=t.get(b))&&-1!==d?(l[d]=r[h],p[d]=a[h],o&&(g[d]=o[h]),d=e[d],t.set(b,d)):a[h]();for(d=f;d<y;d++)d in l?(r[d]=l[d],a[d]=p[d],o&&(o[d]=g[d],o[d](d))):r[d]=w(u);r=r.slice(0,n=y),i=c.slice(0)}return r}));function u(t){var s;return a[d]=t,o?([t,s]=x(d),o[d]=s,e(c[d],t)):e(c[d])}}}((()=>t.each),t.children,e||void 0))}function K(t){const e=t.keyed,s=C((()=>t.when),void 0,{equals:(t,s)=>e?t===s:!t==!s});return C((()=>{const i=s();if(i){const r=t.children;return"function"==typeof r&&0<r.length?k((()=>r(e?i:()=>{if(k(s))return t.when;throw(t=>`Stale read from <${t}>.`)("Show")}))):r}return t.fallback}),void 0,void 0)}const Y=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline","allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"]),Q=new Set(["innerHTML","textContent","innerText","children"]),J=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Z=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});const tt=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),et={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};const st="_$DX_DELEGATE";function it(t,e,s){let i;const r=()=>{var e=document.createElement("template");return e.innerHTML=t,(s?e.content.firstChild:e.content).firstChild};return(e=e?()=>(i=i||r()).cloneNode(!0):()=>k((()=>document.importNode(i=i||r(),!0)))).cloneNode=e}function rt(t,e=window.document){var s=e[st]||(e[st]=new Set);for(let r=0,a=t.length;r<a;r++){var i=t[r];s.has(i)||(s.add(i),e.addEventListener(i,ut))}}function at(t,e,s){null==s?t.removeAttribute(e):t.setAttribute(e,s)}function nt(t,e){null==e?t.removeAttribute("class"):t.className=e}function ot(t,e={},s,i){const r={};return i||A((()=>r.children=pt(t,e.children,r.children))),A((()=>e.ref&&e.ref(t))),A((()=>function(t,e,s,i,r={},a=!1){e=e||{};for(const i in r)i in e||"children"!==i&&(r[i]=ct(t,i,null,r[i],s,a));for(const o in e){var n;"children"===o?i||pt(t,e.children):(n=e[o],r[o]=ct(t,o,n,r[o],s,a))}}(t,e,s,!0,r,!0))),r}function lt(t,e,s){return k((()=>t(e,s)))}function ht(t,e,s,i){if(void 0!==s&&(i=i||[]),"function"!=typeof e)return pt(t,e,i,s);A((i=>pt(t,e(),i,s)),i)}function dt(t,e,s){var i=e.trim().split(/\s+/);for(let e=0,r=i.length;e<r;e++)t.classList.toggle(i[e],s)}function ct(t,e,s,i,r,a){let n,o,l,h,d;var c;return"style"===e?function(t,e,s){if(!e)return s?at(t,"style"):e;var i=t.style;if("string"==typeof e)return i.cssText=e;let r,a;for(a in"string"==typeof s&&(i.cssText=s=void 0),e=e||{},s=s||{})null==e[a]&&i.removeProperty(a),delete s[a];for(a in e)(r=e[a])!==s[a]&&(i.setProperty(a,r),s[a]=r);return s}(t,s,i):"classList"===e?function(t,e,s={}){var i=Object.keys(e||{}),r=Object.keys(s);let a,n;for(a=0,n=r.length;a<n;a++){var o=r[a];o&&"undefined"!==o&&!e[o]&&(dt(t,o,!1),delete s[o])}for(a=0,n=i.length;a<n;a++){var l=i[a],h=!!e[l];l&&"undefined"!==l&&s[l]!==h&&h&&(dt(t,l,!0),s[l]=h)}return s}(t,s,i):s===i?i:("ref"===e?a||s(t):"on:"===e.slice(0,3)?(a=e.slice(3),i&&t.removeEventListener(a,i),s&&t.addEventListener(a,s)):"oncapture:"===e.slice(0,10)?(a=e.slice(10),i&&t.removeEventListener(a,i,!0),s&&t.addEventListener(a,s,!0)):"on"===e.slice(0,2)?(a=e.slice(2).toLowerCase(),!(c=tt.has(a))&&i&&(i=Array.isArray(i)?i[0]:i,t.removeEventListener(a,i)),(c||s)&&(function(t,e,s,i){if(i)Array.isArray(s)?(t["$$"+e]=s[0],t[`$$${e}Data`]=s[1]):t["$$"+e]=s;else if(Array.isArray(s)){const i=s[0];t.addEventListener(e,s[0]=e=>i.call(t,s[1],e))}else t.addEventListener(e,s)}(t,a,s,c),c)&&rt([a])):"attr:"===e.slice(0,5)?at(t,e.slice(5),s):(d="prop:"===e.slice(0,5))||(l=Q.has(e))||!r&&((h=function(t,e){return"object"==typeof(t=Z[t])?t[e]?t.$:void 0:t}(e,t.tagName))||(o=Y.has(e)))||(n=t.nodeName.includes("-"))?(d&&(e=e.slice(5),o=!0),"class"===e||"className"===e?nt(t,s):!n||o||l?t[h||e]=s:t[function(t){return t.toLowerCase().replace(/-([a-z])/g,((t,e)=>e.toUpperCase()))}(e)]=s):(i=r&&-1<e.indexOf(":")&&et[e.split(":")[0]])?function(t,e,s,i){null==i?t.removeAttributeNS(e,s):t.setAttributeNS(e,s,i)}(t,i,e,s):at(t,J[e]||e,s),s)}function ut(t){var e="$$"+t.type;let s=t.composedPath&&t.composedPath()[0]||t.target;for(t.target!==s&&Object.defineProperty(t,"target",{configurable:!0,value:s}),Object.defineProperty(t,"currentTarget",{configurable:!0,get:()=>s||document});s;){var i=s[e];if(i&&!s.disabled){var r=s[e+"Data"];if(void 0!==r?i.call(s,r,t):i.call(s,t),t.cancelBubble)return}s=s._$host||s.parentNode||s.host}}function pt(t,e,s,i,r){for(;"function"==typeof s;)s=s();if(e!==s){var a=typeof e,n=void 0!==i;if(t=n&&s[0]&&s[0].parentNode||t,"string"==a||"number"==a)if("number"==a&&(e=e.toString()),n){let r=s[0];r&&3===r.nodeType?r.data=e:r=document.createTextNode(e),s=mt(t,s,i,r)}else s=""!==s&&"string"==typeof s?t.firstChild.data=e:t.textContent=e;else if(null==e||"boolean"==a)s=mt(t,s,i);else{if("function"==a)return A((()=>{let r=e();for(;"function"==typeof r;)r=r();s=pt(t,r,s,i)})),()=>s;if(Array.isArray(e)){const o=[];if(a=s&&Array.isArray(s),gt(o,e,s,r))return A((()=>s=pt(t,o,s,i,!0))),()=>s;if(0===o.length){if(s=mt(t,s,i),n)return s}else a?0===s.length?ft(t,o,i):function(t,e,s){let i=s.length,r=e.length,a=i,n=0,o=0,l=e[r-1].nextSibling,h=null;for(;n<r||o<a;)if(e[n]===s[o])n++,o++;else{for(;e[r-1]===s[a-1];)r--,a--;if(r===n)for(var d=a<i?o?s[o-1].nextSibling:s[a-o]:l;o<a;)t.insertBefore(s[o++],d);else if(a===o)for(;n<r;)h&&h.has(e[n])||e[n].remove(),n++;else if(e[n]===s[a-1]&&s[o]===e[r-1]){var c=e[--r].nextSibling;t.insertBefore(s[o++],e[n++].nextSibling),t.insertBefore(s[--a],c),e[r]=s[a]}else{if(!h){h=new Map;let t=o;for(;t<a;)h.set(s[t],t++)}var u=h.get(e[n]);if(null!=u)if(o<u&&u<a){let i,l=n,d=1;for(;++l<r&&l<a&&null!=(i=h.get(e[l]))&&i===u+d;)d++;if(d>u-o)for(var p=e[n];o<u;)t.insertBefore(s[o++],p);else t.replaceChild(s[o++],e[n++])}else n++;else e[n++].remove()}}}(t,s,o):(s&&mt(t),ft(t,o));s=o}else if(e instanceof Node){if(Array.isArray(s)){if(n)return s=mt(t,s,i,e);mt(t,s,null,e)}else null!=s&&""!==s&&t.firstChild?t.replaceChild(e,t.firstChild):t.appendChild(e);s=e}else console.warn("Unrecognized value. Skipped inserting",e)}}return s}function gt(t,e,s,i){let r=!1;for(let n=0,o=e.length;n<o;n++){let o=e[n],l=s&&s[n];if(o instanceof Node)t.push(o);else if(null!=o&&!0!==o&&!1!==o)if(Array.isArray(o))r=gt(t,o,l)||r;else if("function"==typeof o)if(i){for(;"function"==typeof o;)o=o();r=gt(t,Array.isArray(o)?o:[o],Array.isArray(l)?l:[l])||r}else t.push(o),r=!0;else{var a=String(o);l&&3===l.nodeType?(l.data=a,t.push(l)):t.push(document.createTextNode(a))}}return r}function ft(t,e,s=null){for(let i=0,r=e.length;i<r;i++)t.insertBefore(e[i],s)}function mt(t,e,s,i){if(void 0===s)return t.textContent="";var r=i||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;0<=o;o--){var a,n=e[o];r!==n?(a=n.parentNode===t,i||o?a&&n.remove():a?t.replaceChild(r,n):t.insertBefore(r,s)):i=!0}}else t.insertBefore(r,s);return[r]}function vt(t){return(e,s)=>{const i=s.element;return w((r=>{const a=function(t){var e=Object.keys(t),s={};for(let i=0;i<e.length;i++){const[r,a]=x(t[e[i]]);Object.defineProperty(s,e[i],{get:r,set(t){a((()=>t))}})}return s}(e);i.addPropertyChangedCallback(((t,e)=>a[t]=e)),i.addReleaseCallback((()=>{i.renderRoot.textContent="",r()}));var n=t(a,s);return ht(i.renderRoot,n)}),function(t){if(t.assignedSlot&&t.assignedSlot._$owner)return t.assignedSlot._$owner;let e=t.parentNode;for(;e&&!e._$owner&&(!e.assignedSlot||!e.assignedSlot._$owner);)e=e.parentNode;return(e&&e.assignedSlot?e.assignedSlot:t)._$owner}(i))}}function bt(t,e,s){return 2===arguments.length&&(s=e,e={}),n(t,e)(vt(s))}const yt={chatflowid:"",apiHost:void 0,chatflowConfig:void 0,theme:void 0,observersConfig:void 0};var wt='/*! tailwindcss v3.3.1 | MIT License | https://tailwindcss.com*/*,:after,:before{border:0 solid #e5e7eb;box-sizing:border-box}:after,:before{--tw-content:""}html{-webkit-text-size-adjust:100%;font-feature-settings:normal;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-variation-settings:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{line-height:inherit;margin:0}hr{border-top-width:1px;color:inherit;height:0}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-collapse:collapse;border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{color:inherit;font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;margin:0;padding:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }.prose{color:var(--tw-prose-body);max-width:65ch}.prose :where(p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where([class~=lead]):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-lead);font-size:1.25em;line-height:1.6;margin-bottom:1.2em;margin-top:1.2em}.prose :where(a):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-links);font-weight:500;text-decoration:underline}.prose :where(strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-bold);font-weight:600}.prose :where(a strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(ol):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol[type=A]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=A s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-alpha}.prose :where(ol[type=a s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-alpha}.prose :where(ol[type=I]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type=I s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:upper-roman}.prose :where(ol[type=i s]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:lower-roman}.prose :where(ol[type="1"]):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:decimal}.prose :where(ul):not(:where([class~=not-prose],[class~=not-prose] *)){list-style-type:disc;margin-bottom:1.25em;margin-top:1.25em;padding-left:1.625em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-counters);font-weight:400}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *))::marker{color:var(--tw-prose-bullets)}.prose :where(dt):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;margin-top:1.25em}.prose :where(hr):not(:where([class~=not-prose],[class~=not-prose] *)){border-color:var(--tw-prose-hr);border-top-width:1px;margin-bottom:3em;margin-top:3em}.prose :where(blockquote):not(:where([class~=not-prose],[class~=not-prose] *)){border-left-color:var(--tw-prose-quote-borders);border-left-width:.25rem;color:var(--tw-prose-quotes);font-style:italic;font-weight:500;margin-bottom:1.6em;margin-top:1.6em;padding-left:1em;quotes:"\\201C""\\201D""\\2018""\\2019"}.prose :where(blockquote p:first-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:open-quote}.prose :where(blockquote p:last-of-type):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:close-quote}.prose :where(h1):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:2.25em;font-weight:800;line-height:1.1111111;margin-bottom:.8888889em;margin-top:0}.prose :where(h1 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:900}.prose :where(h2):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.5em;font-weight:700;line-height:1.3333333;margin-bottom:1em;margin-top:2em}.prose :where(h2 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:800}.prose :where(h3):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-size:1.25em;font-weight:600;line-height:1.6;margin-bottom:.6em;margin-top:1.6em}.prose :where(h3 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(h4):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;line-height:1.5;margin-bottom:.5em;margin-top:1.5em}.prose :where(h4 strong):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-weight:700}.prose :where(img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(picture):not(:where([class~=not-prose],[class~=not-prose] *)){display:block;margin-bottom:2em;margin-top:2em}.prose :where(kbd):not(:where([class~=not-prose],[class~=not-prose] *)){border-radius:.3125rem;box-shadow:0 0 0 1px rgb(var(--tw-prose-kbd-shadows)/10%),0 3px 0 rgb(var(--tw-prose-kbd-shadows)/10%);color:var(--tw-prose-kbd);font-family:inherit;font-size:.875em;font-weight:500;padding:.1875em .375em}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-code);font-size:.875em;font-weight:600}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:"`"}.prose :where(code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:"`"}.prose :where(a code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h1 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(h2 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.875em}.prose :where(h3 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit;font-size:.9em}.prose :where(h4 code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(blockquote code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(thead th code):not(:where([class~=not-prose],[class~=not-prose] *)){color:inherit}.prose :where(pre):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:var(--tw-prose-pre-bg);border-radius:.375rem;color:var(--tw-prose-pre-code);font-size:.875em;font-weight:400;line-height:1.7142857;margin-bottom:1.7142857em;margin-top:1.7142857em;overflow-x:auto;padding:.8571429em 1.1428571em}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)){background-color:transparent;border-radius:0;border-width:0;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:inherit;padding:0}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):before{content:none}.prose :where(pre code):not(:where([class~=not-prose],[class~=not-prose] *)):after{content:none}.prose :where(table):not(:where([class~=not-prose],[class~=not-prose] *)){font-size:.875em;line-height:1.7142857;margin-bottom:2em;margin-top:2em;table-layout:auto;text-align:left;width:100%}.prose :where(thead):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-th-borders);border-bottom-width:1px}.prose :where(thead th):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-headings);font-weight:600;padding-bottom:.5714286em;padding-left:.5714286em;padding-right:.5714286em;vertical-align:bottom}.prose :where(tbody tr):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-color:var(--tw-prose-td-borders);border-bottom-width:1px}.prose :where(tbody tr:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){border-bottom-width:0}.prose :where(tbody td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:baseline}.prose :where(tfoot):not(:where([class~=not-prose],[class~=not-prose] *)){border-top-color:var(--tw-prose-th-borders);border-top-width:1px}.prose :where(tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){vertical-align:top}.prose :where(figure>*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(figcaption):not(:where([class~=not-prose],[class~=not-prose] *)){color:var(--tw-prose-captions);font-size:.875em;line-height:1.4285714;margin-top:.8571429em}.prose{--tw-prose-body:#374151;--tw-prose-headings:#111827;--tw-prose-lead:#4b5563;--tw-prose-links:#111827;--tw-prose-bold:#111827;--tw-prose-counters:#6b7280;--tw-prose-bullets:#d1d5db;--tw-prose-hr:#e5e7eb;--tw-prose-quotes:#111827;--tw-prose-quote-borders:#e5e7eb;--tw-prose-captions:#6b7280;--tw-prose-kbd:#111827;--tw-prose-kbd-shadows:17 24 39;--tw-prose-code:#111827;--tw-prose-pre-code:#e5e7eb;--tw-prose-pre-bg:#1f2937;--tw-prose-th-borders:#d1d5db;--tw-prose-td-borders:#e5e7eb;--tw-prose-invert-body:#d1d5db;--tw-prose-invert-headings:#fff;--tw-prose-invert-lead:#9ca3af;--tw-prose-invert-links:#fff;--tw-prose-invert-bold:#fff;--tw-prose-invert-counters:#9ca3af;--tw-prose-invert-bullets:#4b5563;--tw-prose-invert-hr:#374151;--tw-prose-invert-quotes:#f3f4f6;--tw-prose-invert-quote-borders:#374151;--tw-prose-invert-captions:#9ca3af;--tw-prose-invert-kbd:#fff;--tw-prose-invert-kbd-shadows:255 255 255;--tw-prose-invert-code:#fff;--tw-prose-invert-pre-code:#d1d5db;--tw-prose-invert-pre-bg:rgba(0,0,0,.5);--tw-prose-invert-th-borders:#4b5563;--tw-prose-invert-td-borders:#374151;font-size:1rem;line-height:1.75}.prose :where(picture>img):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0;margin-top:0}.prose :where(video):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(li):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.5em;margin-top:.5em}.prose :where(ol>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-left:.375em}.prose :where(ul>li):not(:where([class~=not-prose],[class~=not-prose] *)){padding-left:.375em}.prose :where(.prose>ul>li p):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(.prose>ul>li>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ul>li>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(.prose>ol>li>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:1.25em}.prose :where(.prose>ol>li>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em}.prose :where(ul ul,ul ol,ol ul,ol ol):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:.75em;margin-top:.75em}.prose :where(dl):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:1.25em;margin-top:1.25em}.prose :where(dd):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:.5em;padding-left:1.625em}.prose :where(hr+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h2+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h3+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(h4+*):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(thead th:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-left:0}.prose :where(thead th:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-right:0}.prose :where(tbody td,tfoot td):not(:where([class~=not-prose],[class~=not-prose] *)){padding:.5714286em}.prose :where(tbody td:first-child,tfoot td:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-left:0}.prose :where(tbody td:last-child,tfoot td:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){padding-right:0}.prose :where(figure):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:2em;margin-top:2em}.prose :where(.prose>:first-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-top:0}.prose :where(.prose>:last-child):not(:where([class~=not-prose],[class~=not-prose] *)){margin-bottom:0}.pointer-events-none{pointer-events:none}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0}.bottom-20{bottom:80px}.bottom-24{bottom:96px}.left-0{left:0}.top-0{top:0}.z-10{z-index:10}.z-\\[1001\\]{z-index:1001}.z-\\[1002\\]{z-index:1002}.float-right{float:right}.m-auto{margin:auto}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:8px;margin-top:8px}.my-6{margin-bottom:24px;margin-top:24px}.-ml-1{margin-left:-4px}.mb-1{margin-bottom:4px}.mb-2{margin-bottom:8px}.ml-1{margin-left:4px}.ml-2{margin-left:8px}.ml-auto{margin-left:auto}.mr-1{margin-right:4px}.mr-2{margin-right:8px}.mr-3{margin-right:12px}.mt-4{margin-top:16px}.block{display:block}.flex{display:flex}.\\!hidden{display:none!important}.hidden{display:none}.h-10{height:40px}.h-12{height:48px}.h-16{height:64px}.h-2{height:8px}.h-32{height:128px}.h-4{height:16px}.h-5{height:20px}.h-6{height:24px}.h-7{height:28px}.h-9{height:36px}.h-\\[calc\\(100vh-117px\\)\\]{height:calc(100vh - 117px)}.h-full{height:100%}.max-h-\\[704px\\]{max-height:704px}.min-h-\\[calc\\(100vh-117px\\)\\]{min-height:calc(100vh - 117px)}.min-h-full{min-height:100%}.w-10{width:40px}.w-12{width:48px}.w-16{width:64px}.w-2{width:8px}.w-4{width:16px}.w-5{width:20px}.w-6{width:24px}.w-7{width:28px}.w-9{width:36px}.w-full{width:100%}.min-w-full{min-width:100%}.max-w-3xl{max-width:768px}.max-w-full{max-width:100%}.flex-1{flex:1 1 0%}.flex-auto{flex:1 1 auto}.flex-shrink-0{flex-shrink:0}.-rotate-180{--tw-rotate:-180deg}.-rotate-180,.rotate-0{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-0{--tw-rotate:0deg}.scale-0{--tw-scale-x:0;--tw-scale-y:0}.scale-0,.scale-100{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-100{--tw-scale-x:1;--tw-scale-y:1}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes fade-in{0%{opacity:0}to{opacity:1}}.animate-fade-in{animation:fade-in .3s ease-out}@keyframes spin{to{transform:rotate(1turn)}}.animate-spin{animation:spin 1s linear infinite}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:8px}.gap-3{gap:12px}.gap-6{gap:24px}.gap-8{gap:32px}.overflow-hidden{overflow:hidden}.overflow-y-auto{overflow-y:auto}.overflow-x-hidden{overflow-x:hidden}.overflow-y-scroll{overflow-y:scroll}.scroll-smooth{scroll-behavior:smooth}.whitespace-pre-wrap{white-space:pre-wrap}.rounded{border-radius:4px}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:8px}.rounded-b{border-bottom-left-radius:4px;border-bottom-right-radius:4px}.rounded-t{border-top-left-radius:4px;border-top-right-radius:4px}.border{border-width:1px}.border-0{border-width:0}.border-b{border-bottom-width:1px}.border-t{border-top-width:1px}.border-solid{border-style:solid}.bg-black{--tw-bg-opacity:1;background-color:rgb(0 0 0/var(--tw-bg-opacity))}.bg-emerald-500{--tw-bg-opacity:1;background-color:rgb(16 185 129/var(--tw-bg-opacity))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity))}.bg-opacity-50{--tw-bg-opacity:0.5}.bg-cover{background-size:cover}.bg-center{background-position:50%}.fill-transparent{fill:transparent}.stroke-2{stroke-width:2}.object-cover{-o-object-fit:cover;object-fit:cover}.p-1{padding:4px}.p-2{padding:8px}.p-2\\.5{padding:10px}.p-4{padding:16px}.p-5{padding:20px}.p-6{padding:24px}.px-2{padding-left:8px;padding-right:8px}.px-3{padding-left:12px;padding-right:12px}.px-4{padding-left:16px;padding-right:16px}.px-\\[10px\\]{padding-left:10px;padding-right:10px}.py-1{padding-bottom:4px;padding-top:4px}.py-2{padding-bottom:8px;padding-top:8px}.py-4{padding-bottom:16px;padding-top:16px}.pb-\\[10px\\]{padding-bottom:10px}.pt-20{padding-top:80px}.pt-\\[6px\\]{padding-top:6px}.text-left{text-align:left}.text-center{text-align:center}.text-2xl{font-size:24px;line-height:32px}.text-\\[13px\\]{font-size:13px}.text-base{font-size:16px;line-height:24px}.text-sm{font-size:14px;line-height:20px}.text-xl{font-size:20px;line-height:28px}.font-bold{font-weight:700}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.leading-none{line-height:1}.text-black{--tw-text-opacity:1;color:rgb(0 0 0/var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity))}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-25{opacity:.25}.opacity-75{opacity:.75}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-lg{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.shadow-md,.shadow-xl{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgba(0,0,0,.1),0 8px 10px -6px rgba(0,0,0,.1);--tw-shadow-colored:0 20px 25px -5px var(--tw-shadow-color),0 8px 10px -6px var(--tw-shadow-color)}.outline-none{outline:2px solid transparent;outline-offset:2px}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-duration:.15s;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-opacity{transition-duration:.15s;transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-150,.transition-transform{transition-duration:.15s}.duration-200{transition-duration:.2s}.ease-linear{transition-timing-function:linear}.ease-out{transition-timing-function:cubic-bezier(0,0,.2,1)}:host{--chatbot-container-bg-image:none;--chatbot-container-bg-color:transparent;--chatbot-container-font-family:"Open Sans";--chatbot-button-bg-color:#0042da;--chatbot-button-color:#fff;--chatbot-host-bubble-bg-color:#f7f8ff;--chatbot-host-bubble-color:#303235;--chatbot-guest-bubble-bg-color:#3b81f6;--chatbot-guest-bubble-color:#fff;--chatbot-input-bg-color:#fff;--chatbot-input-color:#303235;--chatbot-input-placeholder-color:#9095a0;--chatbot-header-bg-color:#fff;--chatbot-header-color:#303235;--chatbot-border-radius:6px;--PhoneInputCountryFlag-borderColor:transparent;--PhoneInput-color--focus:transparent}a{color:#16bed7;font-weight:500}a:hover{text-decoration:underline}pre{word-wrap:break-word;font-size:13px;margin:5px;overflow:auto;padding:5px;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;width:auto}.string{color:green}.number{color:#ff8c00}.boolean{color:blue}.null{color:#f0f}.key{color:#002b36}.scrollable-container::-webkit-scrollbar{display:none}.scrollable-container{-ms-overflow-style:none;scrollbar-width:none}.text-fade-in{transition:opacity .4s ease-in .2s}.bubble-typing{transition:width .4s ease-out,height .4s ease-out}.bubble1,.bubble2,.bubble3{background-color:var(--chatbot-host-bubble-color);opacity:.5}.bubble1,.bubble2{animation:chatBubbles 1s ease-in-out infinite}.bubble2{animation-delay:.3s}.bubble3{animation:chatBubbles 1s ease-in-out infinite;animation-delay:.5s}@keyframes chatBubbles{0%{transform:translateY(0)}50%{transform:translateY(-5px)}to{transform:translateY(0)}}button,input,textarea{font-weight:300}.slate-a{text-decoration:underline}.slate-html-container>div{min-height:24px}.slate-bold{font-weight:700}.slate-italic{font-style:oblique}.slate-underline{text-decoration:underline}.text-input::-moz-placeholder{color:#9095a0!important;opacity:1!important}.text-input::placeholder{color:#9095a0!important;opacity:1!important}.chatbot-container{background-color:var(--chatbot-container-bg-color);background-image:var(--chatbot-container-bg-image);font-family:Open Sans,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.file-annotation-button{background-color:#02a0a0c2;border:1px solid #02a0a0c2;border-radius:var(--chatbot-border-radius);color:var(--chatbot-button-color)}.chatbot-button{background-color:#0042da;border:1px solid #0042da;border-radius:var(--chatbot-border-radius);color:var(--chatbot-button-color)}.chatbot-button.selectable{border:1px solid #0042da}.chatbot-button.selectable,.chatbot-host-bubble{background-color:#f7f8ff;color:var(--chatbot-host-bubble-color)}.chatbot-host-bubble>.bubble-typing{background-color:#f7f8ff;border:var(--chatbot-host-bubble-border);border-radius:6px}.chatbot-host-bubble iframe,.chatbot-host-bubble img,.chatbot-host-bubble video{border-radius:var(--chatbot-border-radius)}.chatbot-guest-bubble{background-color:#3b81f6;border-radius:6px;color:var(--chatbot-guest-bubble-color)}.chatbot-input,.feedback-input{background-color:#fff;border:1px solid #d3d3d3;border-radius:var(--chatbot-border-radius);color:#303235;filter:drop-shadow(0 4px 4px rgba(42,118,126,.05))}.chatbot-input-error-message{color:#303235}.chatbot-button>.send-icon{fill:var(--chatbot-button-color);stroke:var(--chatbot-button-color)}.chatbot-chat-view{max-width:800px}.ping span{background-color:#0042da}.rating-icon-container svg{stroke:#0042da;fill:#f7f8ff;height:42px;transition:fill .1s ease-out;width:42px}.rating-icon-container.selected svg{fill:#0042da}.rating-icon-container:hover svg{filter:brightness(.9)}.rating-icon-container:active svg{filter:brightness(.75)}.upload-progress-bar{background-color:#0042da;border-radius:var(--chatbot-border-radius)}.total-files-indicator{background-color:#0042da;color:var(--chatbot-button-color);font-size:10px}.chatbot-upload-input{transition:border-color .1s ease-out}.chatbot-upload-input.dragging-over{border-color:#0042da}.secondary-button{background-color:#f7f8ff;border-radius:var(--chatbot-border-radius);color:var(--chatbot-host-bubble-color)}.chatbot-country-select{color:#303235}.chatbot-country-select,.chatbot-date-input{background-color:#fff;border-radius:var(--chatbot-border-radius)}.chatbot-date-input{color:#303235;color-scheme:light}.chatbot-popup-blocked-toast{border-radius:var(--chatbot-border-radius)}.messagelist{border-radius:.5rem;height:100%;overflow-y:scroll;width:100%}.messagelistloading{display:flex;justify-content:center;margin-top:1rem;width:100%}.usermessage{padding:1rem 1.5rem}.usermessagewaiting-light{background:linear-gradient(270deg,#ede7f6,#e3f2fd,#ede7f6);background-position:-100% 0;background-size:200% 200%}.usermessagewaiting-dark,.usermessagewaiting-light{animation:loading-gradient 2s ease-in-out infinite;animation-direction:alternate;animation-name:loading-gradient;padding:1rem 1.5rem}.usermessagewaiting-dark{background:linear-gradient(270deg,#2e2352,#1d3d60,#2e2352);background-position:-100% 0;background-size:200% 200%;color:#ececf1}@keyframes loading-gradient{0%{background-position:-100% 0}to{background-position:100% 0}}.apimessage{animation:fadein .5s;padding:1rem 1.5rem}@keyframes fadein{0%{opacity:0}to{opacity:1}}.apimessage,.usermessage,.usermessagewaiting{display:flex}.markdownanswer{line-height:1.75}.markdownanswer a:hover{opacity:.8}.markdownanswer a{color:#16bed7;font-weight:500}.markdownanswer code{color:#15cb19;font-weight:500;white-space:pre-wrap!important}.markdownanswer ol,.markdownanswer ul{margin:1rem}.boticon,.usericon{border-radius:1rem;margin-right:1rem}.markdownanswer h1,.markdownanswer h2,.markdownanswer h3{font-size:inherit}.center{flex-direction:column;padding:10px;position:relative}.center,.cloud{align-items:center;display:flex;justify-content:center}.cloud{border-radius:.5rem;height:calc(100% - 50px);width:400px}input{background-color:transparent;border:none;font-family:Poppins,sans-serif;padding:10px}.header-button{align-items:center;background:#2a767e;border:1px solid #fafafa;border-radius:4px;color:#fff;display:flex;flex-shrink:0;font-family:Inter;font-size:12px;font-style:normal;font-weight:700;gap:10px;height:34px;justify-content:center;line-height:18px;padding:9px 14px;position:fixed;right:7px;text-transform:uppercase;top:16px;width:174px;z-index:10}.dropzone{background:#f8f8ff;border:.787px dashed rgba(42,118,126,.3);border-radius:5px;flex-shrink:0;height:216.939px;width:100%}.dropzone h3{color:#3c3c3b;padding:4px;text-align:center}.dropzone h3,.dropzone h3>a{font-family:Inter;font-size:12.59px;font-style:normal;font-weight:600;line-height:18.885px}.dropzone h3>a{cursor:pointer;text-decoration-line:underline}.dropzone p{color:#676767;font-family:IBM Plex Sans;font-size:9.443px;font-style:normal;font-weight:400;line-height:14.164px;padding:4px;text-align:center}.upload-message{color:#3c3c3b;font-family:Inter;font-size:14px;font-style:normal;font-weight:600;line-height:normal}.upload-file-item{background:#fff;border:1px solid #11af22;border-radius:4px;flex-shrink:0;height:36px;max-width:300px;min-width:300px;padding:0 10px}.upload-file-item p{color:#3c3c3b;font-family:IBM Plex Sans;font-size:12px;font-style:normal;font-weight:400;line-height:18px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.hover\\:scale-110:hover{--tw-scale-x:1.1;--tw-scale-y:1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\\:shadow-lg:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -4px rgba(0,0,0,.1);--tw-shadow-colored:0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.hover\\:brightness-90:hover{--tw-brightness:brightness(.9);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.focus\\:border-blue-500:focus{--tw-border-opacity:1;border-color:rgb(59 130 246/var(--tw-border-opacity))}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-blue-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(59 130 246/var(--tw-ring-opacity))}.active\\:scale-95:active{--tw-scale-x:.95;--tw-scale-y:.95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.active\\:bg-emerald-600:active{--tw-bg-opacity:1;background-color:rgb(5 150 105/var(--tw-bg-opacity))}.active\\:brightness-75:active{--tw-brightness:brightness(.75);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}.disabled\\:brightness-100:disabled{--tw-brightness:brightness(1);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}@media (min-width:640px){.sm\\:right-5{right:20px}.sm\\:my-8{margin-bottom:32px;margin-top:32px}.sm\\:w-\\[400px\\]{width:400px}.sm\\:w-full{width:100%}.sm\\:max-w-lg{max-width:512px}.sm\\:p-0{padding:0}}';const xt=t=>null==t,At=t=>null!=t,_t=async t=>{try{var e="string"==typeof t?t:t.url,s=await fetch(e,{method:"string"==typeof t?"GET":t.method,mode:"cors",headers:"string"!=typeof t&&At(t.body)?{"Content-Type":"application/json"}:void 0,body:"string"!=typeof t&&At(t.body)?JSON.stringify(t.body):void 0});let r;var i=s.headers.get("Content-Type");if(r=i&&i.includes("application/json")?await s.json():"string"!=typeof t&&"blob"===t.type?await s.blob():await s.text(),s.ok)return{data:r};{let t;throw t="object"==typeof r&&"error"in r?r.error:r||s.statusText}}catch(t){return console.error(t),{error:t}}},Ct=it('<svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">'),kt=it('<img alt="Bubble button icon">'),Et=it('<button part="button"><svg viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z">'),St=t=>{{const e=Et(),s=e.firstChild;return e.$$click=()=>t.toggleBot(),e.style.setProperty("z-index","42424242"),ht(e,$(K,{get when(){return xt(t.customIconSrc)},keyed:!0,get children(){const e=Ct();return A((s=>{var i=t.iconColor??"white",r="stroke-2 fill-transparent absolute duration-200 transition "+(t.isBotOpened?"scale-0 opacity-0":"scale-100 opacity-100")+("large"===t.size?" w-9":" w-7");return i!==s._v$&&(null!=(s._v$=i)?e.style.setProperty("stroke",i):e.style.removeProperty("stroke")),r!==s._v$2&&at(e,"class",s._v$2=r),s}),{_v$:void 0,_v$2:void 0}),e}}),s),ht(e,$(K,{get when(){return t.customIconSrc},get children(){const e=kt();return A((s=>{var i=t.customIconSrc,r="rounded-full object-cover"+(t.isBotOpened?"scale-0 opacity-0":"scale-100 opacity-100")+("large"===t.size?" w-9 h-9":" w-7 h-7");return i!==s._v$3&&at(e,"src",s._v$3=i),r!==s._v$4&&nt(e,s._v$4=r),s}),{_v$3:void 0,_v$4:void 0}),e}}),s),A((i=>{var r="fixed shadow-md rounded-full hover:scale-110 active:scale-95 transition-transform duration-200 flex justify-center items-center animate-fade-in"+("large"===t.size?" w-16 h-16":" w-12 h-12"),a=t.backgroundColor??"#3B81F6",n=t.right?t.right.toString()+"px":"20px",o=t.bottom?t.bottom.toString()+"px":"20px",l=t.iconColor??"white",h="absolute duration-200 transition "+(t.isBotOpened?"scale-100 rotate-0 opacity-100":"scale-0 -rotate-180 opacity-0")+("large"===t.size?" w-9":" w-7");return r!==i._v$5&&nt(e,i._v$5=r),a!==i._v$6&&(null!=(i._v$6=a)?e.style.setProperty("background-color",a):e.style.removeProperty("background-color")),n!==i._v$7&&(null!=(i._v$7=n)?e.style.setProperty("right",n):e.style.removeProperty("right")),o!==i._v$8&&(null!=(i._v$8=o)?e.style.setProperty("bottom",o):e.style.removeProperty("bottom")),l!==i._v$9&&(null!=(i._v$9=l)?s.style.setProperty("fill",l):s.style.removeProperty("fill")),h!==i._v$10&&at(s,"class",i._v$10=h),i}),{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0}),e}},Tt=(rt(["click"]),({chatflowid:t,apiHost:e="http://localhost:3000",body:s})=>_t({method:"POST",url:e+"/api/v1/prediction/"+t,body:s})),Mt=({apiHost:t="http://localhost:3000",body:e})=>_t({method:"POST",url:t+"/api/v1/openai-assistants-file",body:e,type:"blob"});let Pt;const Lt=new Uint8Array(16);function Rt(){if(Pt=Pt||"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto))return Pt(Lt);throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}const It=[];for(let t=0;t<256;++t)It.push((t+256).toString(16).slice(1));var Dt,Ft,Ot={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Nt(t,e,s){if(Ot.randomUUID&&!e&&!t)return Ot.randomUUID();var i=(t=t||{}).random||(t.rng||Rt)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){s=s||0;for(let t=0;t<16;++t)e[s+t]=i[t];return e}return function(t,e=0){return It[t[e+0]]+It[t[e+1]]+It[t[e+2]]+It[t[e+3]]+"-"+It[t[e+4]]+It[t[e+5]]+"-"+It[t[e+6]]+It[t[e+7]]+"-"+It[t[e+8]]+It[t[e+9]]+"-"+It[t[e+10]]+It[t[e+11]]+It[t[e+12]]+It[t[e+13]]+It[t[e+14]]+It[t[e+15]]}(i)}const Bt=it('<input class="focus:outline-none bg-transparent px-4 py-4 flex-1 w-full text-input disabled:opacity-50 disabled:cursor-not-allowed disabled:brightness-100" type="text">'),zt=t=>{const[e,s]=W(t,["ref","onInput"]);return(i=Bt()).$$input=t=>e.onInput(t.currentTarget.value),"function"==typeof(r=t.ref)?lt(r,i):t.ref=i,ot(i,G({get disabled(){return t.disabled},get style(){return{"font-size":t.fontSize?t.fontSize+"px":"16px"}}},s),!1,!1),i;var i,r},[Ht,jt]=(rt(["input"]),x()),$t=it('<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"></path><path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4">'),Ut=t=>{{const e=$t();return A((()=>at(e,"stroke",t.color??"#3B81F6"))),e}},qt=it('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="19px"><path d="M476.59 227.05l-.16-.07L49.35 49.84A23.56 23.56 0 0027.14 52 24.65 24.65 0 0016 72.59v113.29a24 24 0 0019.52 23.57l232.93 43.07a4 4 0 010 7.86L35.53 303.45A24 24 0 0016 327v113.31A23.57 23.57 0 0026.59 460a23.94 23.94 0 0013.22 4 24.55 24.55 0 009.52-1.93L476.4 285.94l.19-.09a32 32 0 000-58.8z">'),Vt=t=>{return ot(e=qt(),G({get style(){return{fill:t.color??"#3B81F6"}}},t),!0,!0),e;var e},Gt=it('<button type="submit">'),Wt=it('<svg><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">'),Xt=t=>{return ot(e=Gt(),G({get disabled(){return t.isDisabled||t.isLoading}},t,{get class(){return"py-2 px-4 justify-center font-semibold text-white focus:outline-none flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:brightness-100 transition-all filter hover:brightness-90 active:brightness-75 chatbot-button "+t.class},style:{background:"transparent",border:"none"}}),!1,!0),ht(e,$(K,{get when(){return!t.isLoading},get fallback(){return $(Yt,{class:"text-white"})},get children(){return $(Vt,{get color(){return t.sendButtonColor},get class(){return"send-icon flex "+(t.disableIcon?"hidden":"")}})}})),e;var e},Kt=t=>{return ot(e=Gt(),G({get disabled(){return t.isDisabled||t.isLoading}},t,{get class(){return"py-2 px-4 justify-center font-semibold text-white focus:outline-none flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:brightness-100 transition-all filter hover:brightness-90 active:brightness-75 chatbot-button "+t.class},style:{background:"transparent",border:"none"},title:"New Chat"}),!1,!0),ht(e,$(K,{get when(){return!t.isLoading},get fallback(){return $(Yt,{class:"text-white"})},get children(){return $(Ut,{get color(){return t.sendButtonColor},get class(){return"send-icon flex "+(t.disableIcon?"hidden":"")}})}})),e;var e},Yt=t=>{return ot(e=Wt(),G(t,{get class(){return"animate-spin -ml-1 mr-3 h-5 w-5 "+t.class},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","data-testid":"loading-spinner"}),!0,!0),e;var e},Qt=it("<span>Send"),Jt=it('<div class="flex items-end justify-between chatbot-input" data-testid="input">'),Zt=t=>{const[e,s]=x(t.defaultValue??"");let i;const r=t=>s(t),a=()=>{""!==e()&&i?.reportValidity()&&t.onSubmit(e()),s("")},n=t=>{var e=t.isComposing||229===t.keyCode;"Enter"!==t.key||e||a()};_((()=>{t.disabled||Ht()||!i||i.focus()})),E((()=>{!Ht()&&i&&i.focus()}));{const s=Jt();return s.$$keydown=n,s.style.setProperty("border-top","1px solid #eeeeee"),s.style.setProperty("position","absolute"),s.style.setProperty("left","20px"),s.style.setProperty("right","20px"),s.style.setProperty("bottom","62px"),s.style.setProperty("margin","auto"),s.style.setProperty("z-index","1000"),ht(s,$(zt,{ref(t){"function"==typeof i?i(t):i=t},onInput:r,get value(){return e()},get fontSize(){return t.fontSize},get disabled(){return t.disabled},get placeholder(){return t.placeholder??"Type your question"}}),null),ht(s,$(Xt,{get sendButtonColor(){return t.sendButtonColor},type:"button",get isDisabled(){return t.disabled||""===e()},class:"my-2 ml-2","on:click":a,get children(){var t=Qt();return t.style.setProperty("font-family","Poppins, sans-serif"),t}}),null),A((e=>{var i=t.backgroundColor??"#ffffff",r=t.textColor??"#303235";return i!==e._v$&&(null!=(e._v$=i)?s.style.setProperty("background-color",i):s.style.removeProperty("background-color")),r!==e._v$2&&(null!=(e._v$2=r)?s.style.setProperty("color",r):s.style.removeProperty("color")),e}),{_v$:void 0,_v$2:void 0}),s}},te=(rt(["keydown"]),it('<figure data-testid="default-avatar"><svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0" x="0" y="0" mask-type="alpha"><circle cx="37.5" cy="37.5" r="37.5" fill="#0042DA"></circle></mask><g mask="url(#mask0)"><rect x="-30" y="-43" width="131" height="154" fill="#0042DA"></rect><rect x="2.50413" y="120.333" width="81.5597" height="86.4577" rx="2.5" transform="rotate(-52.6423 2.50413 120.333)" stroke="#FED23D" stroke-width="5"></rect><circle cx="76.5" cy="-1.5" r="29" stroke="#FF8E20" stroke-width="5"></circle><path d="M-49.8224 22L-15.5 -40.7879L18.8224 22H-49.8224Z" stroke="#F7F8FF" stroke-width="5">')),ee=()=>{{const t=te(),e=t.firstChild;return A((s=>{var i="flex justify-center items-center rounded-full text-white relative "+(Ht()?"w-6 h-6 text-sm":"w-10 h-10 text-xl"),r="absolute top-0 left-0 "+(Ht()?" w-6 h-6 text-sm":"w-full h-full text-xl");return i!==s._v$&&nt(t,s._v$=i),r!==s._v$2&&at(e,"class",s._v$2=r),s}),{_v$:void 0,_v$2:void 0}),t}},se=it('<figure><img alt="Bot avatar" class="rounded-full object-cover w-full h-full">'),ie=t=>{const[e,s]=x(t.initialAvatarSrc);return _((()=>{e()?.startsWith("{{")&&t.initialAvatarSrc?.startsWith("http")&&s(t.initialAvatarSrc)})),$(K,{get when(){return(t=>null!=t&&""!==t)(e())},keyed:!0,get fallback(){return $(ee,{})},get children(){const t=se(),s=t.firstChild;return A((i=>{var r="flex justify-center items-center rounded-full text-white relative flex-shrink-0 "+(Ht()?"w-6 h-6 text-sm":"w-10 h-10 text-xl"),a=e();return r!==i._v$&&nt(t,i._v$=r),a!==i._v$2&&at(s,"src",i._v$2=a),i}),{_v$:void 0,_v$2:void 0}),t}})};class re{source;flags;constructor(t,e=""){this.source=t.source,this.flags=e}setGroup(t,e){let s="string"==typeof e?e:e.source;return s=s.replace(/(^|[^\[])\^/g,"$1"),this.source=this.source.replace(t,s),this}getRegexp(){return new RegExp(this.source,this.flags)}}const ae=/[&<>"']/,ne=/[&<>"']/g,oe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},le=/[<>"']|&(?!#?\w+;)/,he=/[<>"']|&(?!#?\w+;)/g;function de(t,e){if(e){if(ae.test(t))return t.replace(ne,(t=>oe[t]))}else if(le.test(t))return t.replace(he,(t=>oe[t]));return t}function ce(t){return t.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,(function(t,e){return"colon"===(e=e.toLowerCase())?":":"#"===e.charAt(0)?"x"===e.charAt(1)?String.fromCharCode(parseInt(e.substring(2),16)):String.fromCharCode(+e.substring(1)):""}))}var ue;(ue=Dt=Dt||{})[ue.space=1]="space",ue[ue.text=2]="text",ue[ue.paragraph=3]="paragraph",ue[ue.heading=4]="heading",ue[ue.listStart=5]="listStart",ue[ue.listEnd=6]="listEnd",ue[ue.looseItemStart=7]="looseItemStart",ue[ue.looseItemEnd=8]="looseItemEnd",ue[ue.listItemStart=9]="listItemStart",ue[ue.listItemEnd=10]="listItemEnd",ue[ue.blockquoteStart=11]="blockquoteStart",ue[ue.blockquoteEnd=12]="blockquoteEnd",ue[ue.code=13]="code",ue[ue.table=14]="table",ue[ue.html=15]="html",ue[ue.hr=16]="hr";class pe{gfm=!0;tables=!0;breaks=!1;pedantic=!1;sanitize=!1;sanitizer;mangle=!0;smartLists=!1;silent=!1;highlight;langPrefix="lang-";smartypants=!1;headerPrefix="";renderer;xhtml=!1;escape=de;unescape=ce;isNoP}class ge{options;constructor(t){this.options=t||ve.options}code(t,e,s,i){this.options.highlight&&null!=(r=this.options.highlight(t,e))&&r!==t&&(s=!0,t=r);var r=s?t:this.options.escape(t,!0);return e?`\n<pre><code class="${this.options.langPrefix+this.options.escape(e,!0)}">${r}\n</code></pre>\n`:`\n<pre><code>${r}\n</code></pre>\n`}blockquote(t){return`<blockquote>\n${t}</blockquote>\n`}html(t){return t}heading(t,e,s){return`<h${e} id="${this.options.headerPrefix+s.toLowerCase().replace(/[^\w]+/g,"-")}">${t}</h${e}>\n`}hr(){return this.options.xhtml?"<hr/>\n":"<hr>\n"}list(t,e){return`\n<${e=e?"ol":"ul"}>\n${t}</${e}>\n`}listitem(t){return"<li>"+t+"</li>\n"}paragraph(t){return"<p>"+t+"</p>\n"}table(t,e){return`\n<table>\n<thead>\n${t}</thead>\n<tbody>\n${e}</tbody>\n</table>\n`}tablerow(t){return"<tr>\n"+t+"</tr>\n"}tablecell(t,e){var s=e.header?"th":"td";return(e.align?"<"+s+' style="text-align:'+e.align+'">':"<"+s+">")+t+"</"+s+">\n"}strong(t){return"<strong>"+t+"</strong>"}em(t){return"<em>"+t+"</em>"}codespan(t){return"<code>"+t+"</code>"}br(){return this.options.xhtml?"<br/>":"<br>"}del(t){return"<del>"+t+"</del>"}link(t,e,s){if(this.options.sanitize){let i;try{i=decodeURIComponent(this.options.unescape(t)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return s}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return s}let i='<a href="'+t+'"';return e&&(i+=' title="'+e+'"'),i+">"+s+"</a>"}image(t,e,s){let i='<img src="'+t+'" alt="'+s+'"';return e&&(i+=' title="'+e+'"'),i+(this.options.xhtml?"/>":">")}text(t){return t}}class fe{staticThis;links;options;static rulesBase=null;static rulesPedantic=null;static rulesGfm=null;static rulesBreaks=null;rules;renderer;inLink;hasRulesGfm;ruleCallbacks;constructor(t,e,s=ve.options,i){if(this.staticThis=t,this.links=e,this.options=s,this.renderer=i||this.options.renderer||new ge(this.options),!this.links)throw new Error("InlineLexer requires 'links' parameter.");this.setRules()}static output(t,e,s){return new this(this,e,s).output(t)}static getRulesBase(){var t;return this.rulesBase||((t={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ <>]+(@|:\/)[^ <>]+)>/,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^<'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,_inside:/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,_href:/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/}).link=new re(t.link).setGroup("inside",t._inside).setGroup("href",t._href).getRegexp(),t.reflink=new re(t.reflink).setGroup("inside",t._inside).getRegexp(),this.rulesBase=t)}static getRulesPedantic(){return this.rulesPedantic||(this.rulesPedantic={...this.getRulesBase(),strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/})}static getRulesGfm(){var t,e,s;return this.rulesGfm||(t=this.getRulesBase(),e=new re(t.escape).setGroup("])","~|])").getRegexp(),s=new re(t.text).setGroup("]|","~]|").setGroup("|","|https?://|").getRegexp(),this.rulesGfm={...t,escape:e,url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:s})}static getRulesBreaks(){var t,e;return this.rulesBreaks||(t=this.getRulesGfm(),e=this.getRulesGfm(),this.rulesBreaks={...e,br:new re(t.br).setGroup("{2,}","*").getRegexp(),text:new re(e.text).setGroup("{2,}","*").getRegexp()})}setRules(){this.options.gfm?this.options.breaks?this.rules=this.staticThis.getRulesBreaks():this.rules=this.staticThis.getRulesGfm():this.options.pedantic?this.rules=this.staticThis.getRulesPedantic():this.rules=this.staticThis.getRulesBase(),this.hasRulesGfm=void 0!==this.rules.url}output(t){let e,s="";for(;t;)if(e=this.rules.escape.exec(t))t=t.substring(e[0].length),s+=e[1];else if(e=this.rules.autolink.exec(t)){let i,r;t=t.substring(e[0].length),r="@"===e[2]?(i=this.options.escape(":"===e[1].charAt(6)?this.mangle(e[1].substring(7)):this.mangle(e[1])),this.mangle("mailto:")+i):i=this.options.escape(e[1]),s+=this.renderer.link(r,null,i)}else if(!this.inLink&&this.hasRulesGfm&&(e=this.rules.url.exec(t))){t=t.substring(e[0].length);var i=this.options.escape(e[1]);s+=this.renderer.link(i,null,i)}else if(e=this.rules.tag.exec(t))!this.inLink&&/^<a /i.test(e[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(e[0])&&(this.inLink=!1),t=t.substring(e[0].length),s+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(e[0]):this.options.escape(e[0]):e[0];else if(e=this.rules.link.exec(t))t=t.substring(e[0].length),this.inLink=!0,s+=this.outputLink(e,{href:e[2],title:e[3]}),this.inLink=!1;else if(e=(e=this.rules.reflink.exec(t))||this.rules.nolink.exec(t)){t=t.substring(e[0].length);i=(e[2]||e[1]).replace(/\s+/g," ");var r=this.links[i.toLowerCase()];r&&r.href?(this.inLink=!0,s+=this.outputLink(e,r),this.inLink=!1):(s+=e[0].charAt(0),t=e[0].substring(1)+t)}else if(e=this.rules.strong.exec(t))t=t.substring(e[0].length),s+=this.renderer.strong(this.output(e[2]||e[1]));else if(e=this.rules.em.exec(t))t=t.substring(e[0].length),s+=this.renderer.em(this.output(e[2]||e[1]));else if(e=this.rules.code.exec(t))t=t.substring(e[0].length),s+=this.renderer.codespan(this.options.escape(e[2].trim(),!0));else if(e=this.rules.br.exec(t))t=t.substring(e[0].length),s+=this.renderer.br();else if(this.hasRulesGfm&&(e=this.rules.del.exec(t)))t=t.substring(e[0].length),s+=this.renderer.del(this.output(e[1]));else if(e=this.rules.text.exec(t))t=t.substring(e[0].length),s+=this.renderer.text(this.options.escape(this.smartypants(e[0])));else if(t)throw new Error("Infinite loop on byte: "+t.charCodeAt(0));return s}outputLink(t,e){var s=this.options.escape(e.href);e=e.title?this.options.escape(e.title):null;return"!"!==t[0].charAt(0)?this.renderer.link(s,e,this.output(t[1])):this.renderer.image(s,e,this.options.escape(t[1]))}smartypants(t){return this.options.smartypants?t.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/([{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/([{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):t}mangle(t){if(!this.options.mangle)return t;let e="";var s=t.length;for(let i=0;i<s;i++){let s;.5<Math.random()&&(s="x"+t.charCodeAt(i).toString(16)),e+="&#"+s+";"}return e}}class me{simpleRenderers=[];tokens;token;inlineLexer;options;renderer;line=0;constructor(t){this.tokens=[],this.token=null,this.options=t||ve.options,this.renderer=this.options.renderer||new ge(this.options)}static parse(t,e,s){return new this(s).parse(e,t)}parse(t,e){this.inlineLexer=new fe(fe,t,this.options,this.renderer),this.tokens=e.reverse();let s="";for(;this.next();)s+=this.tok();return s}debug(t,e){this.inlineLexer=new fe(fe,t,this.options,this.renderer),this.tokens=e.reverse();let s="";for(;this.next();){var i=this.tok();this.token.line=this.line+=i.split("\n").length-1,s+=i}return s}next(){return this.token=this.tokens.pop()}getNextElement(){return this.tokens[this.tokens.length-1]}parseText(){let t=this.token.text;for(var e;(e=this.getNextElement())&&e.type==Dt.text;)t+="\n"+this.next().text;return this.inlineLexer.output(t)}tok(){switch(this.token.type){case Dt.space:return"";case Dt.paragraph:return this.renderer.paragraph(this.inlineLexer.output(this.token.text));case Dt.text:return this.options.isNoP?this.parseText():this.renderer.paragraph(this.parseText());case Dt.heading:return this.renderer.heading(this.inlineLexer.output(this.token.text),this.token.depth,this.token.text);case Dt.listStart:{let e="";for(var t=this.token.ordered;this.next().type!=Dt.listEnd;)e+=this.tok();return this.renderer.list(e,t)}case Dt.listItemStart:{let t="";for(;this.next().type!=Dt.listItemEnd;)t+=this.token.type==Dt.text?this.parseText():this.tok();return this.renderer.listitem(t)}case Dt.looseItemStart:{let t="";for(;this.next().type!=Dt.listItemEnd;)t+=this.tok();return this.renderer.listitem(t)}case Dt.code:return this.renderer.code(this.token.text,this.token.lang,this.token.escaped,this.token.meta);case Dt.table:{t="";let i,r="";i="";for(let t=0;t<this.token.header.length;t++){var e={header:!0,align:this.token.align[t]},s=this.inlineLexer.output(this.token.header[t]);i+=this.renderer.tablecell(s,e)}t+=this.renderer.tablerow(i);for(const t of this.token.cells){i="";for(let e=0;e<t.length;e++)i+=this.renderer.tablecell(this.inlineLexer.output(t[e]),{header:!1,align:this.token.align[e]});r+=this.renderer.tablerow(i)}return this.renderer.table(t,r)}case Dt.blockquoteStart:{let t="";for(;this.next().type!=Dt.blockquoteEnd;)t+=this.tok();return this.renderer.blockquote(t)}case Dt.hr:return this.renderer.hr();case Dt.html:return t=this.token.pre||this.options.pedantic?this.token.text:this.inlineLexer.output(this.token.text),this.renderer.html(t);default:if(this.simpleRenderers.length)for(let t=0;t<this.simpleRenderers.length;t++)if(this.token.type=="simpleRule"+(t+1))return this.simpleRenderers[t].call(this.renderer,this.token.execArr);if(t=`Token with "${this.token.type}" type was not found.`,!this.options.silent)throw new Error(t);console.log(t)}}}class ve{static options=new pe;static simpleRenderers=[];static setOptions(t){return Object.assign(this.options,t),this}static setBlockRule(t,e=(()=>"")){return be.simpleRules.push(t),this.simpleRenderers.push(e),this}static parse(t,e){try{e={...this.options,...e};var{tokens:s,links:i}=this.callBlockLexer(t,e);return this.callParser(s,i,e)}catch(t){return this.callMe(t)}}static debug(t,e=this.options){var{tokens:t,links:s}=this.callBlockLexer(t,e);let i=t.slice();return(e=new me(e)).simpleRenderers=this.simpleRenderers,e=e.debug(s,t),{tokens:i=i.map((t=>{t.type=Dt[t.type]||t.type;var e=t.line;return delete t.line,e?{line:e,...t}:t})),links:s,result:e}}static callBlockLexer(t="",e){if("string"!=typeof t)throw new Error(`Expected that the 'src' parameter would have a 'string' type, got '${typeof t}'`);return t=t.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n").replace(/^ +$/gm,""),be.lex(t,e,!0)}static callParser(t,e,s){var i;return this.simpleRenderers.length?((i=new me(s)).simpleRenderers=this.simpleRenderers,i.parse(e,t)):me.parse(t,e,s)}static callMe(t){if(t.message+="\nPlease report this to https://github.com/ts-stack/markdown",this.options.silent)return"<p>An error occured:</p><pre>"+this.options.escape(t.message+"",!0)+"</pre>";throw t}}class be{staticThis;static simpleRules=[];static rulesBase=null;static rulesGfm=null;static rulesTables=null;rules;options;links={};tokens=[];hasRulesGfm;hasRulesTables;constructor(t,e){this.staticThis=t,this.options=e||ve.options,this.setRules()}static lex(t,e,s,i){return new this(this,e).getTokens(t,s,i)}static getRulesBase(){var t,e;return this.rulesBase||((t={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/,bullet:/(?:[*+-]|\d+\.)/,item:/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/}).item=new re(t.item,"gm").setGroup(/bull/g,t.bullet).getRegexp(),t.list=new re(t.list).setGroup(/bull/g,t.bullet).setGroup("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))").setGroup("def","\\n+(?="+t.def.source+")").getRegexp(),e="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",t.html=new re(t.html).setGroup("comment",/<!--[\s\S]*?-->/).setGroup("closed",/<(tag)[\s\S]+?<\/\1>/).setGroup("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/).setGroup(/tag/g,e).getRegexp(),t.paragraph=new re(t.paragraph).setGroup("hr",t.hr).setGroup("heading",t.heading).setGroup("lheading",t.lheading).setGroup("blockquote",t.blockquote).setGroup("tag","<"+e).setGroup("def",t.def).getRegexp(),this.rulesBase=t)}static getRulesGfm(){var t,e,s,i;return this.rulesGfm||(s=(e={...t=this.getRulesBase(),fences:/^ *(`{3,}|~{3,})[ \.]*((\S+)? *[^\n]*)\n([\s\S]*?)\s*\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}).fences.source.replace("\\1","\\2"),i=t.list.source.replace("\\1","\\3"),e.paragraph=new re(t.paragraph).setGroup("(?!",`(?!${s}|${i}|`).getRegexp(),this.rulesGfm=e)}static getRulesTable(){return this.rulesTables||(this.rulesTables={...this.getRulesGfm(),nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/})}setRules(){this.options.gfm?this.options.tables?this.rules=this.staticThis.getRulesTable():this.rules=this.staticThis.getRulesGfm():this.rules=this.staticThis.getRulesBase(),this.hasRulesGfm=void 0!==this.rules.fences,this.hasRulesTables=void 0!==this.rules.table}getTokens(t,e,s){let i,r=t;t:for(;r;)if((i=this.rules.newline.exec(r))&&(r=r.substring(i[0].length),1<i[0].length)&&this.tokens.push({type:Dt.space}),i=this.rules.code.exec(r)){r=r.substring(i[0].length);var a=i[0].replace(/^ {4}/gm,"");this.tokens.push({type:Dt.code,text:this.options.pedantic?a:a.replace(/\n+$/,"")})}else if(this.hasRulesGfm&&(i=this.rules.fences.exec(r)))r=r.substring(i[0].length),this.tokens.push({type:Dt.code,meta:i[2],lang:i[3],text:i[4]||""});else if(i=this.rules.heading.exec(r))r=r.substring(i[0].length),this.tokens.push({type:Dt.heading,depth:i[1].length,text:i[2]});else if(e&&this.hasRulesTables&&(i=this.rules.nptable.exec(r))){r=r.substring(i[0].length);var n={type:Dt.table,header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:[]};for(let t=0;t<n.align.length;t++)/^ *-+: *$/.test(n.align[t])?n.align[t]="right":/^ *:-+: *$/.test(n.align[t])?n.align[t]="center":/^ *:-+ *$/.test(n.align[t])?n.align[t]="left":n.align[t]=null;var o=i[3].replace(/\n$/,"").split("\n");for(let t=0;t<o.length;t++)n.cells[t]=o[t].split(/ *\| */);this.tokens.push(n)}else if(i=this.rules.lheading.exec(r))r=r.substring(i[0].length),this.tokens.push({type:Dt.heading,depth:"="===i[2]?1:2,text:i[1]});else if(i=this.rules.hr.exec(r))r=r.substring(i[0].length),this.tokens.push({type:Dt.hr});else if(i=this.rules.blockquote.exec(r))r=r.substring(i[0].length),this.tokens.push({type:Dt.blockquoteStart}),a=i[0].replace(/^ *> ?/gm,""),this.getTokens(a),this.tokens.push({type:Dt.blockquoteEnd});else if(i=this.rules.list.exec(r)){r=r.substring(i[0].length);var l,h=i[2],d=(this.tokens.push({type:Dt.listStart,ordered:1<h.length}),i[0].match(this.rules.item)),c=d.length;let t,e=!1;for(let i=0;i<c;i++){let a=d[i];l=a.length,-1!==(a=a.replace(/^ *([*+-]|\d+\.) +/,"")).indexOf("\n ")&&(l-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+l+"}","gm"),"")),!this.options.smartLists||i===c-1||h===(l=this.staticThis.getRulesBase().bullet.exec(d[i+1])[0])||1<h.length&&1<l.length||(r=d.slice(i+1).join("\n")+r,i=c-1),t=e||/\n\n(?!\s*$)/.test(a),i!==c-1&&(e="\n"===a.charAt(a.length-1),t=t||e),this.tokens.push({type:t?Dt.looseItemStart:Dt.listItemStart}),this.getTokens(a,!1,s),this.tokens.push({type:Dt.listItemEnd})}this.tokens.push({type:Dt.listEnd})}else if(i=this.rules.html.exec(r)){r=r.substring(i[0].length);var u=i[1];this.tokens.push({type:this.options.sanitize?Dt.paragraph:Dt.html,pre:!this.options.sanitizer&&("pre"===u||"script"===u||"style"===u),text:i[0]})}else if(e&&(i=this.rules.def.exec(r)))r=r.substring(i[0].length),this.links[i[1].toLowerCase()]={href:i[2],title:i[3]};else if(e&&this.hasRulesTables&&(i=this.rules.table.exec(r))){r=r.substring(i[0].length);var p={type:Dt.table,header:i[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:i[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:[]};for(let t=0;t<p.align.length;t++)/^ *-+: *$/.test(p.align[t])?p.align[t]="right":/^ *:-+: *$/.test(p.align[t])?p.align[t]="center":/^ *:-+ *$/.test(p.align[t])?p.align[t]="left":p.align[t]=null;var g=i[3].replace(/(?: *\| *)?\n$/,"").split("\n");for(let t=0;t<g.length;t++)p.cells[t]=g[t].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(p)}else{if(this.staticThis.simpleRules.length){var f=this.staticThis.simpleRules;for(let t=0;t<f.length;t++)if(i=f[t].exec(r)){r=r.substring(i[0].length);var m="simpleRule"+(t+1);this.tokens.push({type:m,execArr:i});continue t}}if(e&&(i=this.rules.paragraph.exec(r)))r=r.substring(i[0].length),"\n"===i[1].slice(-1)?this.tokens.push({type:Dt.paragraph,text:i[1].slice(0,-1)}):this.tokens.push({type:0<this.tokens.length?Dt.paragraph:Dt.text,text:i[1]});else if(i=this.rules.text.exec(r))r=r.substring(i[0].length),this.tokens.push({type:Dt.text,text:i[0]});else if(r)throw new Error("Infinite loop on byte: "+r.charCodeAt(0)+`, near text '${r.slice(0,30)}...'`)}return{tokens:this.tokens,links:this.links}}}const ye=it('<div class="flex justify-end mb-2 items-end guest-container"><span class="px-4 py-2 mr-2 whitespace-pre-wrap max-w-full chatbot-guest-bubble" data-testid="guest-bubble">'),we=(ve.setOptions({isNoP:!0}),t=>{let e;E((()=>{e&&(e.innerHTML=ve.parse(t.message))}));{const s=ye(),i=s.firstChild;s.style.setProperty("margin-left","50px");return"function"==typeof e?lt(e,i):e=i,i.style.setProperty("border-radius","6px"),ht(s,$(K,{get when(){return t.showAvatar},get children(){return $(ie,{get initialAvatarSrc(){return t.avatarSrc}})}}),null),A((e=>{var s=t.backgroundColor??"#3B81F6",r=t.textColor??"#ffffff";return s!==e._v$&&(null!=(e._v$=s)?i.style.setProperty("background-color",s):i.style.removeProperty("background-color")),r!==e._v$2&&(null!=(e._v$2=r)?i.style.setProperty("color",r):i.style.removeProperty("color")),e}),{_v$:void 0,_v$2:void 0}),s}}),xe=it('<svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.243 16.8139L6 12.5699L7.414 11.1559L10.243 13.9839L15.899 8.3269L17.314 9.7419L10.243 16.8139Z" fill="white"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1 12.5C1 6.425 5.925 1.5 12 1.5C18.075 1.5 23 6.425 23 12.5C23 18.575 18.075 23.5 12 23.5C5.925 23.5 1 18.575 1 12.5ZM12 21.5C10.8181 21.5 9.64778 21.2672 8.55585 20.8149C7.46392 20.3626 6.47177 19.6997 5.63604 18.864C4.80031 18.0282 4.13738 17.0361 3.68508 15.9442C3.23279 14.8522 3 13.6819 3 12.5C3 11.3181 3.23279 10.1478 3.68508 9.05585C4.13738 7.96392 4.80031 6.97177 5.63604 6.13604C6.47177 5.30031 7.46392 4.63738 8.55585 4.18508C9.64778 3.73279 10.8181 3.5 12 3.5C14.3869 3.5 16.6761 4.44821 18.364 6.13604C20.0518 7.82387 21 10.1131 21 12.5C21 14.8869 20.0518 17.1761 18.364 18.864C16.6761 20.5518 14.3869 21.5 12 21.5Z" fill="white">'),Ae=()=>xe(),_e=it('<button class="actionButton py-2 px-4 mt-4 mb-2 justify-center rounded gap-3 w-full font-semibold text-white focus:outline-none flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:brightness-100 transition-all filter hover:brightness-90 active:brightness-75">'),Ce=it('<div class="flex justify-start mb-2 items-start host-container"><span class="px-4 py-2 ml-2 max-w-full chatbot-host-bubble prose" data-testid="host-bubble"><span>'),ke=(ve.setOptions({isNoP:!0}),t=>{let e;const s=()=>{t.onButtonClick&&t.onButtonClick()};E((()=>{if(e&&(e.innerHTML=ve.parse(t.message),t.fileAnnotations)&&t.fileAnnotations.length)for(const r of t.fileAnnotations){var s=document.createElement("button"),i=(s.textContent=r.fileName,s.className="py-2 px-4 mb-2 justify-center font-semibold text-white focus:outline-none flex items-center disabled:opacity-50 disabled:cursor-not-allowed disabled:brightness-100 transition-all filter hover:brightness-90 active:brightness-75 file-annotation-button",s.addEventListener("click",(function(){(async e=>{try{var s=await Mt({apiHost:t.apiHost,body:{question:"",history:[],fileName:e.fileName}}),i=new Blob([s.data]),r=window.URL.createObjectURL(i),a=document.createElement("a");a.href=r,a.download=e.fileName,document.body.appendChild(a),a.click(),a.remove()}catch(e){console.error("Download failed:",e)}})(r)})),document.createElement("div"));i.className="ml-2",i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-download" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2" /><path d="M7 11l5 5l5 -5" /><path d="M12 4l0 12" /></svg>',s.appendChild(i),e.appendChild(s)}}));{const i=Ce(),r=i.firstChild,a=r.firstChild;i.style.setProperty("margin-right","50px"),ht(i,$(K,{get when(){return t.showAvatar},get children(){return $(ie,{get initialAvatarSrc(){return t.avatarSrc}})}}),r),r.style.setProperty("border-radius","6px");return"function"==typeof e?lt(e,a):e=a,ht(r,$(K,{get when(){return t.button},get children(){const e=_e();return e.$$click=s,ht(e,$(K,{get when(){return t.button?.clicked},get children(){return $(Ae,{})}}),null),ht(e,(()=>t.button?.clicked?t.button.clickedText:t.button?.text),null),A((s=>{var i=t.buttonTheme?.backgroundColor,r=t.buttonTheme?.textColor,a=t.button?.clicked;return i!==s._v$&&(null!=(s._v$=i)?e.style.setProperty("background-color",i):e.style.removeProperty("background-color")),r!==s._v$2&&(null!=(s._v$2=r)?e.style.setProperty("color",r):e.style.removeProperty("color")),a!==s._v$3&&(e.disabled=s._v$3=a),s}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e}}),null),A((e=>{var s=t.backgroundColor??"#f7f8ff",i=t.textColor??"#303235";return s!==e._v$4&&(null!=(e._v$4=s)?r.style.setProperty("background-color",s):r.style.removeProperty("background-color")),i!==e._v$5&&(null!=(e._v$5=i)?r.style.setProperty("color",i):r.style.removeProperty("color")),e}),{_v$4:void 0,_v$5:void 0}),i}}),Ee=(rt(["click"]),it('<div class="flex items-center"><div class="w-2 h-2 mr-1 rounded-full bubble1"></div><div class="w-2 h-2 mr-1 rounded-full bubble2"></div><div class="w-2 h-2 rounded-full bubble3">')),Se=()=>Ee(),Te=it('<div class="flex justify-start mb-2 items-start animate-fade-in host-container"><span class="px-4 py-4 ml-2 whitespace-pre-wrap max-w-full chatbot-host-bubble" data-testid="host-bubble">'),Me=()=>{return ht((t=Te()).firstChild,$(Se,{})),t;var t},Pe=it('<div data-modal-target="defaultModal" data-modal-toggle="defaultModal" class="flex justify-start mb-2 items-start animate-fade-in host-container hover:brightness-90 active:brightness-75"><span class="px-2 py-1 ml-1 whitespace-pre-wrap max-w-full chatbot-host-bubble" data-testid="host-bubble">'),Le=t=>{return s=(e=Pe()).firstChild,e.$$click=()=>t.onSourceClick?.(),s.style.setProperty("width","max-content"),s.style.setProperty("max-width","80px"),s.style.setProperty("font-size","13px"),s.style.setProperty("border-radius","15px"),s.style.setProperty("cursor","pointer"),s.style.setProperty("text-overflow","ellipsis"),s.style.setProperty("overflow","hidden"),s.style.setProperty("white-space","nowrap"),ht(s,(()=>t.pageContent)),e;var e,s},Re=(rt(["click"]),it('<svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49989 3.26L9.87989 6.05L10.1099 6.55L10.6099 6.625L13.6899 7.07L11.4999 9.22L11.1249 9.585L11.2149 10.085L11.7399 13.15L8.98489 11.705L8.49989 11.5L8.03489 11.745L5.27989 13.17L5.77989 10.105L5.86989 9.605L5.49989 9.22L3.28989 7.045L6.36989 6.6L6.86989 6.525L7.09989 6.025L8.49989 3.26ZM8.49989 1L6.22489 5.61L1.13989 6.345L4.81989 9.935L3.94989 15L8.49989 12.61L13.0499 15L12.1799 9.935L15.8599 6.35L10.7749 5.61L8.49989 1Z" fill="#3C3C3B">')),Ie=()=>Re(),De=it('<span class="w-full text-center px-[10px] pt-[6px] pb-[10px] m-auto text-[13px]"><span>Powered by<a href="https://www.startse.com/" target="_blank" rel="noopener noreferrer" class="lite-badge" id="lite-badge"><span>StartSe'),Fe=it("<button><span>"),Oe="#303235",Ne=t=>{let e;const s=t=>{t.forEach((t=>{t.removedNodes.forEach((t=>{}))}))};E((()=>{document&&t.botContainer&&(e=new MutationObserver(s)).observe(t.botContainer,{subtree:!1,childList:!0})})),S((()=>{e&&e.disconnect()}));{const e=De(),s=e.firstChild,i=s.firstChild.nextSibling;return e.style.setProperty("position","absolute"),e.style.setProperty("font-size","13px"),e.style.setProperty("bottom","8px"),e.style.setProperty("padding","10px 12px"),e.style.setProperty("margin","auto"),e.style.setProperty("margin-bottom","8px"),e.style.setProperty("width","100%"),e.style.setProperty("text-align","center"),e.style.setProperty("display","flex"),s.style.setProperty("display","flex"),s.style.setProperty("align-items","center"),i.style.setProperty("font-weight","bold"),i.style.setProperty("margin-left","3px"),ht(e,(()=>{const e=C((()=>!!t.showButton));return()=>e()&&(()=>{const e=Fe(),s=e.firstChild;return e.$$click=()=>{window.open(t.buttonLink,"_blank")},e.style.setProperty("border-radius","5px"),e.style.setProperty("padding","12.5px"),e.style.setProperty("cursor","pointer"),ht(e,$(Ie,{}),s),s.style.setProperty("margin-left","5px"),ht(s,(()=>t.buttonText)),A((i=>{var r="2px solid "+(t.buttonColor||"#303235"),a=t.buttonColor||"#303235";return r!==i._v$5&&(null!=(i._v$5=r)?e.style.setProperty("border",r):e.style.removeProperty("border")),a!==i._v$6&&(null!=(i._v$6=a)?s.style.setProperty("color",a):s.style.removeProperty("color")),i}),{_v$5:void 0,_v$6:void 0}),e})()})(),null),A((s=>{var r=t.poweredByTextColor??Oe,a=t.badgeBackgroundColor??"#ffffff",n=t.showButton?"space-between":"center",o=t.poweredByTextColor??Oe;return r!==s._v$&&(null!=(s._v$=r)?e.style.setProperty("color",r):e.style.removeProperty("color")),a!==s._v$2&&(null!=(s._v$2=a)?e.style.setProperty("background-color",a):e.style.removeProperty("background-color")),n!==s._v$3&&(null!=(s._v$3=n)?e.style.setProperty("justify-content",n):e.style.removeProperty("justify-content")),o!==s._v$4&&(null!=(s._v$4=o)?i.style.setProperty("color",o):i.style.removeProperty("color")),s}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),e}},Be=(rt(["click"]),Object.create(null)),ze=(Be.open="0",Be.close="1",Be.ping="2",Be.pong="3",Be.message="4",Be.upgrade="5",Be.noop="6",Object.create(null)),He=(Object.keys(Be).forEach((t=>{ze[Be[t]]=t})),{type:"error",data:"parser error"}),je="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),$e="function"==typeof ArrayBuffer,Ue=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,qe=({type:t,data:e},s,i)=>je&&e instanceof Blob?s?i(e):Ve(e,i):$e&&(e instanceof ArrayBuffer||Ue(e))?s?i(e):Ve(new Blob([e]),i):i(Be[t]+(e||"")),Ve=(t,e)=>{const s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];e("b"+(t||""))},s.readAsDataURL(t)};function Ge(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let We;const Xe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ke="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<64;t++)Ke[Xe.charCodeAt(t)]=t;const Ye="function"==typeof ArrayBuffer,Qe=(t,e)=>{var s;return"string"!=typeof t?{type:"message",data:Ze(t,e)}:"b"===(s=t.charAt(0))?{type:"message",data:Je(t.substring(1),e)}:ze[s]?1<t.length?{type:ze[s],data:t.substring(1)}:{type:ze[s]}:He},Je=(t,e)=>{var s;return Ye?(s=(t=>{let e,s,i,r,a,n=.75*t.length,o=t.length,l=0;"="===t[t.length-1]&&(n--,"="===t[t.length-2])&&n--;var h=new ArrayBuffer(n),d=new Uint8Array(h);for(e=0;e<o;e+=4)s=Ke[t.charCodeAt(e)],i=Ke[t.charCodeAt(e+1)],r=Ke[t.charCodeAt(e+2)],a=Ke[t.charCodeAt(e+3)],d[l++]=s<<2|i>>4,d[l++]=(15&i)<<4|r>>2,d[l++]=(3&r)<<6|63&a;return h})(t),Ze(s,e)):{base64:!0,data:t}},Ze=(t,e)=>"blob"!==e?t instanceof ArrayBuffer?t:t.buffer:t instanceof Blob?t:new Blob([t]),ts=String.fromCharCode(30);function es(){return new TransformStream({transform(t,e){!function(t,e){je&&t.data instanceof Blob?t.data.arrayBuffer().then(Ge).then(e):$e&&(t.data instanceof ArrayBuffer||Ue(t.data))?e(Ge(t.data)):qe(t,!1,(t=>{We=We||new TextEncoder,e(We.encode(t))}))}(t,(s=>{var i,r=s.length;let a;r<126?(a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,r)):r<65536?(a=new Uint8Array(3),(i=new DataView(a.buffer)).setUint8(0,126),i.setUint16(1,r)):(a=new Uint8Array(9),(i=new DataView(a.buffer)).setUint8(0,127),i.setBigUint64(1,BigInt(r))),t.data&&"string"!=typeof t.data&&(a[0]|=128),e.enqueue(a),e.enqueue(s)}))}})}let ss;function is(t){return t.reduce(((t,e)=>t+e.length),0)}function rs(t,e){if(t[0].length===e)return t.shift();var s=new Uint8Array(e);let i=0;for(let r=0;r<e;r++)s[r]=t[0][i++],i===t[0].length&&(t.shift(),i=0);return t.length&&i<t[0].length&&(t[0]=t[0].slice(i)),s}function as(t){if(t)return function(t){for(var e in as.prototype)t[e]=as.prototype[e];return t}(t)}as.prototype.on=as.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},as.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},as.prototype.off=as.prototype.removeListener=as.prototype.removeAllListeners=as.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)this._callbacks={};else{var s=this._callbacks["$"+t];if(s)if(1==arguments.length)delete this._callbacks["$"+t];else{for(var i,r=0;r<s.length;r++)if((i=s[r])===e||i.fn===e){s.splice(r,1);break}0===s.length&&delete this._callbacks["$"+t]}}return this},as.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){i=0;for(var r=(s=s.slice(0)).length;i<r;++i)s[i].apply(this,e)}return this},as.prototype.emitReserved=as.prototype.emit,as.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},as.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ns="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function os(t,...e){return e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})}const ls=ns.setTimeout,hs=ns.clearTimeout;function ds(t,e){e.useNativeTimers?(t.setTimeoutFn=ls.bind(ns),t.clearTimeoutFn=hs.bind(ns)):(t.setTimeoutFn=ns.setTimeout.bind(ns),t.clearTimeoutFn=ns.clearTimeout.bind(ns))}function cs(t){return"string"==typeof t?function(t){let e,s=0;for(let i=0,r=t.length;i<r;i++)(e=t.charCodeAt(i))<128?s+=1:e<2048?s+=2:e<55296||57344<=e?s+=3:(i++,s+=4);return s}(t):Math.ceil(1.33*(t.byteLength||t.size))}class us extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class ps extends as{constructor(t){super(),this.writable=!1,ds(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new us(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){t=Qe(t,this.socket.binaryType),this.onPacket(t)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){var t=this.opts.hostname;return-1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){return t=function(t){let e="";for(var s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}(t),t.length?"?"+t:""}}const gs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),fs=64,ms={};let vs,bs=0,ys=0;function ws(t){let e="";for(;e=gs[t%fs]+e,0<(t=Math.floor(t/fs)););return e}function xs(){var t=ws(+new Date);return t!==vs?(bs=0,vs=t):t+"."+ws(bs++)}for(;ys<fs;ys++)ms[gs[ys]]=ys;let As=!1;try{As="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(ue){}const _s=As;function Cs(t){t=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||_s))return new XMLHttpRequest}catch(t){}if(!t)try{return new(ns[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}function ks(){}const Es=null!=new Cs({xdomain:!1}).responseType;class Ss extends as{constructor(t,e){super(),ds(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=void 0!==e.data?e.data:null,this.create()}create(){var t,e=os(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;const s=this.xhr=new Cs(e);try{s.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(var i in s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this.opts.extraHeaders[i])}catch(t){}if("POST"===this.method)try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{s.setRequestHeader("Accept","*/*")}catch(t){}null!=(t=this.opts.cookieJar)&&t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(s.timeout=this.opts.requestTimeout),s.onreadystatechange=()=>{var t;3===s.readyState&&null!=(t=this.opts.cookieJar)&&t.parseCookies(s),4===s.readyState&&(200===s.status||1223===s.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"==typeof s.status?s.status:0)}),0))},s.send(this.data)}catch(t){return void this.setTimeoutFn((()=>{this.onError(t)}),0)}"undefined"!=typeof document&&(this.index=Ss.requestsCount++,Ss.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=ks,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete Ss.requests[this.index],this.xhr=null}}onLoad(){var t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Ss.requestsCount=0,Ss.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",Ts);else if("function"==typeof addEventListener){addEventListener("onpagehide"in ns?"pagehide":"unload",Ts,!1)}function Ts(){for(var t in Ss.requests)Ss.requests.hasOwnProperty(t)&&Ss.requests[t].abort()}const Ms="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),Ps=ns.WebSocket||ns.MozWebSocket,Ls="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();const Rs={websocket:class extends ps{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(this.check()){var t=this.uri(),e=this.opts.protocols,s=Ls?{}:os(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=Ls?new Ps(t,e,s):e?new Ps(t,e):new Ps(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let s=0;s<t.length;s++){var e=t[s];const i=s===t.length-1;qe(e,this.supportsBinary,(t=>{try{this.ws.send(t)}catch(t){}i&&Ms((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){var t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=xs()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!Ps}},webtransport:class extends ps{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)})),this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{var e=function(t,e){ss=ss||new TextDecoder;const s=[];let i=0,r=-1,a=!1;return new TransformStream({transform(n,o){for(s.push(n);;){if(0===i){if(is(s)<1)break;var l=rs(s,1);a=128==(128&l[0]),r=127&l[0],i=r<126?3:126===r?1:2}else if(1===i){if(is(s)<2)break;l=rs(s,2),r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),i=3}else if(2===i){if(is(s)<8)break;var h=rs(s,8),d=(h=new DataView(h.buffer,h.byteOffset,h.length)).getUint32(0);if(d>Math.pow(2,21)-1){o.enqueue(He);break}r=d*Math.pow(2,32)+h.getUint32(4),i=3}else{if(is(s)<r)break;d=rs(s,r),o.enqueue(Qe(a?d:ss.decode(d),e)),i=0}if(0===r||r>t){o.enqueue(He);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType);const s=t.readable.pipeThrough(e).getReader();(e=es()).readable.pipeTo(t.writable),this.writer=e.writable.getWriter();const i=()=>{s.read().then((({done:t,value:e})=>{t||(this.onPacket(e),i())})).catch((t=>{}))};i(),t={type:"open"},this.query.sid&&(t.data=`{"sid":"${this.query.sid}"}`),this.writer.write(t).then((()=>this.onOpen()))}))})))}write(t){this.writable=!1;for(let s=0;s<t.length;s++){var e=t[s];const i=s===t.length-1;this.writer.write(e).then((()=>{i&&Ms((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){var t;null!=(t=this.transport)&&t.close()}},polling:class extends ps{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){var e="https:"===location.protocol;let s=location.port;s=s||(e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||s!==t.port}e=t&&t.forceBase64,this.supportsBinary=Es&&!e,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){((t,e)=>{var s=t.split(ts),i=[];for(let t=0;t<s.length;t++){var r=Qe(s[t],e);if(i.push(r),"error"===r.type)break}return i})(t,this.socket.binaryType).forEach((t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState)&&this.poll()}doClose(){var t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((t,e)=>{const s=t.length,i=new Array(s);let r=0;t.forEach(((t,a)=>{qe(t,!1,(t=>{i[a]=t,++r===s&&e(i.join(ts))}))}))})(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){var t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=xs()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Ss(this.uri(),t)}doWrite(t,e){(t=this.request({method:"POST",data:t})).on("success",e),t.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){var t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}},Is=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ds=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Fs(t){var e=t,s=t.indexOf("["),i=t.indexOf("]");-1!=s&&-1!=i&&(t=t.substring(0,s)+t.substring(s,i).replace(/:/g,";")+t.substring(i,t.length));let r=Is.exec(t||""),a={},n=14;for(;n--;)a[Ds[n]]=r[n]||"";return-1!=s&&-1!=i&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(t,e){var s=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||s.splice(0,1),"/"==e.slice(-1)&&s.splice(s.length-1,1),s}(0,a.path),a.queryKey=function(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(s[e]=i)})),s}(0,a.query),a}let Os=class t extends as{constructor(t,e={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=Fs(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Fs(e.host).host),ds(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){var e={},s=t.split("&");for(let t=0,r=s.length;t<r;t++){var i=s[t].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname)&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1)),this.open()}createTransport(t){var e=((e=Object.assign({},this.opts.query)).EIO=4,e.transport=t,this.id&&(e.sid=this.id),Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]));return new Rs[t](e)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),(this.transport=t).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(e){let s=this.createTransport(e),i=!1;t.priorWebsocketSuccess=!1;const r=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",(e=>{i||("pong"===e.type&&"probe"===e.data?(this.upgrading=!0,this.emitReserved("upgrading",s),s&&(t.priorWebsocketSuccess="websocket"===s.name,this.transport.pause((()=>{i||"closed"!==this.readyState&&(d(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})))):((e=new Error("probe error")).transport=s.name,this.emitReserved("upgradeError",e)))})))};function a(){i||(i=!0,d(),s.close(),s=null)}const n=t=>{(t=new Error("probe error: "+t)).transport=s.name,a(),this.emitReserved("upgradeError",t)};function o(){n("transport closed")}function l(){n("socket closed")}function h(t){s&&t.name!==s.name&&a()}const d=()=>{s.removeListener("open",r),s.removeListener("error",n),s.removeListener("close",o),this.off("close",l),this.off("upgrading",h)};s.once("open",r),s.once("error",n),s.once("close",o),this.once("close",l),this.once("upgrading",h),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn((()=>{i||s.open()}),200):s.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;for(var e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){var t;"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(t=this.getWritablePackets(),this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush"))}getWritablePackets(){if(this.maxPayload&&"polling"===this.transport.name&&1<this.writeBuffer.length){let e=1;for(let s=0;s<this.writeBuffer.length;s++){var t=this.writeBuffer[s].data;if(t&&(e+=cs(t)),0<s&&e>this.maxPayload)return this.writeBuffer.slice(0,s);e+=2}}return this.writeBuffer}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,i){"function"==typeof e&&(i=e,e=void 0),"function"==typeof s&&(i=s,s=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((s=s||{}).compress=!1!==s.compress,this.emitReserved("packetCreate",t={type:t,data:e,options:s}),this.writeBuffer.push(t),i&&this.once("flush",i),this.flush())}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{(this.upgrading?s:t)()})):(this.upgrading?s:t)()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){var e=[];let s=0;for(var i=t.length;s<i;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}};Os.protocol=4;const Ns="function"==typeof ArrayBuffer,Bs=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,zs=Object.prototype.toString,Hs="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===zs.call(Blob),js="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===zs.call(File);function $s(t){return Ns&&(t instanceof ArrayBuffer||Bs(t))||Hs&&t instanceof Blob||js&&t instanceof File}function Us(t,e){if(t&&"object"==typeof t)if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(Us(t[e]))return!0}else{if($s(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Us(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&Us(t[e]))return!0}return!1}function qs(t){var e=[],s=t.data;return t.data=Vs(s,e),t.attachments=e.length,{packet:t,buffers:e}}function Vs(t,e){if(!t)return t;var s;if($s(t))return s={_placeholder:!0,num:e.length},e.push(t),s;if(Array.isArray(t)){var i=new Array(t.length);for(let s=0;s<t.length;s++)i[s]=Vs(t[s],e);return i}if("object"!=typeof t||t instanceof Date)return t;var r={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=Vs(t[s],e));return r}function Gs(t,e){return t.data=Ws(t.data,e),delete t.attachments,t}function Ws(t,e){if(t){if(t&&!0===t._placeholder){if("number"==typeof t.num&&0<=t.num&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=Ws(t[s],e);else if("object"==typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=Ws(t[s],e))}return t}const Xs=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Ft=Ft||{});function Ks(t){return"[object Object]"===Object.prototype.toString.call(t)}class Ys extends as{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");var s=(e=this.decodeString(t)).type===Ft.BINARY_EVENT;(!s&&e.type!==Ft.BINARY_ACK||(e.type=s?Ft.EVENT:Ft.ACK,this.reconstructor=new Qs(e),0===e.attachments))&&super.emitReserved("decoded",e)}else{if(!$s(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;var s={type:Number(t.charAt(0))};if(void 0===Ft[s.type])throw new Error("unknown packet type "+s.type);if(s.type===Ft.BINARY_EVENT||s.type===Ft.BINARY_ACK){for(var i=e+1;"-"!==t.charAt(++e)&&e!=t.length;);if((i=t.substring(i,e))!=Number(i)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(i)}if("/"===t.charAt(e+1)){for(i=e+1;++e&&","!==t.charAt(e)&&e!==t.length;);s.nsp=t.substring(i,e)}else s.nsp="/";if(""!==(i=t.charAt(e+1))&&Number(i)==i){for(i=e+1;++e;){var r=t.charAt(e);if(null==r||Number(r)!=r){--e;break}if(e===t.length)break}s.id=Number(t.substring(i,e+1))}if(t.charAt(++e)){if(i=this.tryParse(t.substr(e)),!Ys.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case Ft.CONNECT:return Ks(e);case Ft.DISCONNECT:return void 0===e;case Ft.CONNECT_ERROR:return"string"==typeof e||Ks(e);case Ft.EVENT:case Ft.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===Xs.indexOf(e[0]));case Ft.ACK:case Ft.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Qs{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){return this.buffers.push(t),this.buffers.length===this.reconPack.attachments?(t=Gs(this.reconPack,this.buffers),this.finishedReconstruction(),t):null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}var Js=Object.freeze({__proto__:null,Decoder:Ys,Encoder:class{constructor(t){this.replacer=t}encode(t){return t.type!==Ft.EVENT&&t.type!==Ft.ACK||!Us(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===Ft.EVENT?Ft.BINARY_EVENT:Ft.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==Ft.BINARY_EVENT&&t.type!==Ft.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){t=qs(t);var e=this.encodeAsString(t.packet);return(t=t.buffers).unshift(e),t}},get PacketType(){return Ft},protocol:5});function Zs(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const ti=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ei extends as{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){var t;this.subs||(t=this.io,this.subs=[Zs(t,"open",this.onopen.bind(this)),Zs(t,"packet",this.onpacket.bind(this)),Zs(t,"error",this.onerror.bind(this)),Zs(t,"close",this.onclose.bind(this))])}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(ti.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');var s,i;return e.unshift(t),!this._opts.retries||this.flags.fromQueue||this.flags.volatile?((t={type:Ft.EVENT,data:e,options:{}}).options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(s=this.ids++,i=e.pop(),this._registerAckCallback(s,i),t.id=s),i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,(!this.flags.volatile||i&&this.connected)&&(this.connected?(this.notifyOutgoingListeners(t),this.packet(t)):this.sendBuffer.push(t)),this.flags={}):this._addToQueue(e),this}_registerAckCallback(t,e){var s=null!=(s=this.flags.timeout)?s:this._opts.ackTimeout;if(void 0===s)this.acks[t]=e;else{const i=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),s);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(i),e.apply(this,[null,...t])}}}emitWithAck(t,...e){const s=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((i,r)=>{e.push(((t,e)=>s?t?r(t):i(e):i(t))),this.emit(t,...e)}))}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...i)=>{if(s===this._queue[0])return null!==t?s.tryCount>this._opts.retries&&(this._queue.shift(),e)&&e(t):(this._queue.shift(),e&&e(null,...i)),s.pending=!1,this._drainQueue()})),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){var e;!this.connected||0===this._queue.length||(e=this._queue[0]).pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:Ft.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case Ft.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ft.EVENT:case Ft.BINARY_EVENT:this.onevent(t);break;case Ft.ACK:case Ft.BINARY_ACK:this.onack(t);break;case Ft.DISCONNECT:this.ondisconnect();break;case Ft.CONNECT_ERROR:this.destroy();var e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){var e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length)for(const e of this._anyListeners.slice())e.apply(this,t);super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:Ft.ACK,id:t,data:i}))}}onack(t){var e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ft.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(this._anyListeners)if(t){var e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(this._anyOutgoingListeners)if(t){var e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(const e of this._anyOutgoingListeners.slice())e.apply(this,t.data)}}function si(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=0<t.jitter&&t.jitter<=1?t.jitter:0,this.attempts=0}si.prototype.duration=function(){var t,e,s=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(t=Math.random(),e=Math.floor(t*this.jitter*s),s=0==(1&Math.floor(10*t))?s-e:s+e),0|Math.min(s,this.max)},si.prototype.reset=function(){this.attempts=0},si.prototype.setMin=function(t){this.ms=t},si.prototype.setMax=function(t){this.max=t},si.prototype.setJitter=function(t){this.jitter=t};class ii extends as{constructor(t,e){super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,ds(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!=(s=e.randomizationFactor)?s:.5),this.backoff=new si({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;var s=e.parser||Js;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null!=(e=this.backoff)&&e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null!=(e=this.backoff)&&e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null!=(e=this.backoff)&&e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(!~this._readyState.indexOf("open")){this.engine=new Os(this.uri,this.opts);const i=this.engine,r=this,a=(this._readyState="opening",this.skipReconnect=!1,Zs(i,"open",(function(){r.onopen(),t&&t()}))),n=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()};var e=Zs(i,"error",n);if(!1!==this._timeout){var s=this._timeout;const t=this.setTimeoutFn((()=>{a(),n(new Error("timeout")),i.close()}),s);this.opts.autoUnref&&t.unref(),this.subs.push((()=>{this.clearTimeoutFn(t)}))}this.subs.push(a),this.subs.push(e)}return this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");var t=this.engine;this.subs.push(Zs(t,"ping",this.onping.bind(this)),Zs(t,"data",this.ondata.bind(this)),Zs(t,"error",this.onerror.bind(this)),Zs(t,"close",this.onclose.bind(this)),Zs(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){Ms((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new ei(this,t,e),this.nsps[t]=s),s}_destroy(t){for(const t of Object.keys(this.nsps)){if(this.nsps[t].active)return}this._close()}_packet(t){var e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{var e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect)||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()}))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((()=>{this.clearTimeoutFn(s)}))}}onreconnect(){var t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ri={};function ai(t,e){"object"==typeof t&&(e=t,t=void 0);t=function(t,e="",s){let i=t;return s=s||"undefined"!=typeof location&&location,"string"==typeof(t=null==t?s.protocol+"//"+s.host:t)&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==s?s.protocol+"//"+t:"https://"+t),i=Fs(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/",t=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host,i.id=i.protocol+"://"+t+":"+i.port+e,i.href=i.protocol+"://"+t+(s&&s.port===i.port?"":":"+i.port),i}(t,(e=e||{}).path||"/socket.io");var s=t.source,i=t.id,r=t.path;r=ri[i]&&r in ri[i].nsps;let a;return a=(r=e.forceNew||e["force new connection"]||!1===e.multiplex||r)?new ii(s,e):(ri[i]||(ri[i]=new ii(s,e)),ri[i]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(ai,{Manager:ii,Socket:ei,io:ai,connect:ai});const ni=it("<style>"),oi=it('<div class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true"><style></style><div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity animate-fade-in"></div><div class="fixed inset-0 z-10 overflow-y-auto"><div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0"><div class="relative transform overflow-hidden rounded-lg text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">'),li=it("<div><pre>");const hi=t=>{let e;const[s]=W(t,["onOpen","onClose","isOpen","value"]),[i,r]=(E((()=>{e&&(e.innerHTML=function(t){return(t=(t="string"!=typeof t?JSON.stringify(t,void 0,2):t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,(function(t){let e="number";return/^"/.test(t)?e=/:$/.test(t)?"key":"string":/true|false/.test(t)?e="boolean":/null/.test(t)&&(e="null"),'<span class="'+e+'">'+t+"</span>"}))}(JSON.stringify(t?.value,void 0,2)))})),x(s.isOpen??!1)),a=(_((()=>{xt(t.isOpen)||t.isOpen===i()||o()})),t=>{t.stopPropagation()}),n=()=>{r(!1),s.onClose?.(),document.body.style.overflow="auto"},o=()=>{i()?n():(r(!0),s.onOpen?.(),document.body.style.overflow="hidden")};return $(K,{get when(){return i()},get children(){return[(ht(r=ni(),wt),r),(r=oi(),s=r.firstChild,i=s.nextSibling.nextSibling.firstChild.firstChild,r.style.setProperty("z-index","1100"),r.addEventListener("click",n),ht(s,wt),i.style.setProperty("background-color","transparent"),i.style.setProperty("margin-left","20px"),i.style.setProperty("margin-right","20px"),i.addEventListener("click",a),i.addEventListener("pointerdown",a),ht(i,(()=>{const s=C((()=>!!t.value));return()=>{return s()&&(i=(t=li()).firstChild,t.style.setProperty("background","white"),t.style.setProperty("margin","auto"),t.style.setProperty("padding","7px"),"function"==typeof(r=e)?lt(r,i):e=i,t);var t,i,r}})()),r)];var s,i,r}})},di=it('<button class="flex justify-center items-center upload-file-button">'),ci=t=>{{const e=di();return e.$$click=e=>t.onSubmit(e),e.style.setProperty("width","100%"),e.style.setProperty("left","20px"),e.style.setProperty("right","20px"),e.style.setProperty("bottom","75px"),e.style.setProperty("margin","auto"),e.style.setProperty("z-index","1000"),ht(e,(()=>t.children)),A((s=>{var i=t.backgroundColor??"#ffffff",r=t.textColor??"#303235",a=t.disabled;return i!==s._v$&&(null!=(s._v$=i)?e.style.setProperty("background-color",i):e.style.removeProperty("background-color")),r!==s._v$2&&(null!=(s._v$2=r)?e.style.setProperty("color",r):e.style.removeProperty("color")),a!==s._v$3&&(e.disabled=s._v$3=a),s}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e}},ui=(rt(["click"]),it('<div class="modal-backdrop"><div class="fixed modal">')),pi=t=>{let e;const s=s=>{e.contains(s.target)||t.onClose()};return C((()=>{const i=C((()=>!!t.isOpen));return()=>{return i()?(a=(r=ui()).firstChild,r.$$click=s,"function"==typeof(n=e)?lt(n,a):e=a,ht(a,(()=>t.children)),r):[];var r,a,n}})())};function gi(t){var e=[];if(t)for(const i in t){var s=+i;isNaN(s)||(s=t[s])&&(s={source:URL.createObjectURL(s),name:s.name,size:s.size,file:s},e.push(s))}return e}function fi(t){const[e,s]=x([]);let i=()=>{};const r=async t=>{t.preventDefault(),t.stopPropagation();let e=[];(t=t.currentTarget).files&&(e=gi(t.files)),t.removeEventListener("change",r),t.remove(),s(e);try{await i(e)}catch(t){console.error(t)}};return{files:e,selectFiles:e=>{e&&(i=e),e=function({multiple:t=!1,accept:e=""}){var s=document.createElement("input");return s.type="file",s.accept=e,s.multiple=t,s}(t||{}),e.addEventListener("change",r),e.click()},removeFile:t=>{s((e=>e.filter((e=>e.name!==t))))},clearFiles:()=>{s([])}}}rt(["click"]);const mi=it('<svg width="49" height="43" viewBox="0 0 49 43" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Upload icon"><path id="Vector" d="M25.6402 10.6774L25.5755 10.6581C25.2503 10.5611 25.0648 10.2191 25.1619 9.89358L25.6402 10.6774ZM25.6402 10.6774L25.643 10.6741M25.6402 10.6774L25.643 10.6741M25.643 10.6741C25.948 10.7292 26.2505 10.5465 26.3401 10.244C27.157 7.49922 29.7306 5.58174 32.5978 5.58174C32.9373 5.58174 33.2126 5.30642 33.2126 4.96697C33.2126 4.62751 32.9373 4.3522 32.5978 4.3522C29.074 4.3522 26.1127 6.69839 25.1619 9.89351L25.643 10.6741Z" fill="#2A767E" stroke="#F9FFF9" stroke-width="0.209167"></path><path id="Vector_2" d="M39.74 29.966H36.6789C36.3972 29.966 36.1688 29.7375 36.1688 29.4558C36.1688 29.1741 36.3972 28.9456 36.6789 28.9456H39.74C43.9595 28.9456 47.3927 25.5125 47.3927 21.2929C47.3927 17.0734 43.9595 13.6403 39.74 13.6403H39.6664C39.5184 13.6403 39.3777 13.5761 39.2808 13.4642C39.1839 13.3524 39.1402 13.2041 39.1613 13.0576C39.2068 12.7398 39.2298 12.4206 39.2298 12.1097C39.2298 8.45285 36.2543 5.47736 32.5974 5.47736C31.1748 5.47736 29.818 5.92194 28.6737 6.76336C28.4223 6.94812 28.0652 6.86613 27.9198 6.58954C24.6791 0.418577 16.2146 -0.41012 11.8263 4.95808C9.97764 7.21962 9.25128 10.1615 9.83332 13.0288C9.89746 13.3455 9.65512 13.6406 9.33334 13.6406H9.12891C4.90939 13.6406 1.47622 17.0738 1.47622 21.2933C1.47622 25.5129 4.90939 28.946 9.12891 28.946H12.1899C12.4716 28.946 12.7001 29.1745 12.7001 29.4562C12.7001 29.7379 12.4716 29.9664 12.1899 29.9664H9.12891C4.34666 29.9664 0.455811 26.0755 0.455811 21.2933C0.455811 16.6452 4.13126 12.8393 8.72841 12.6293C8.29658 9.6546 9.12235 6.65402 11.0362 4.31234C15.7346 -1.43555 24.7387 -0.791285 28.5449 5.61803C29.7592 4.85676 31.1486 4.45741 32.5973 4.45741C37.0278 4.45741 40.5386 8.22838 40.2314 12.6341C44.7862 12.8896 48.4128 16.6754 48.4128 21.2929C48.4128 26.0755 44.522 29.966 39.7397 29.966L39.74 29.966Z" fill="#2A767E"></path><path id="Vector_3" d="M11.5067 29.1677C11.5067 36.2584 17.2753 42.0269 24.366 42.0269C31.4567 42.0269 37.2252 36.2583 37.2252 29.1677C37.2252 22.077 31.4567 16.3085 24.366 16.3085C17.2752 16.3085 11.5067 22.0771 11.5067 29.1677ZM12.7365 29.1677C12.7365 22.7554 17.9536 17.5383 24.366 17.5383C30.7783 17.5383 35.9954 22.7553 35.9954 29.1677C35.9954 35.58 30.7783 40.7972 24.366 40.7972C17.9537 40.7972 12.7365 35.5801 12.7365 29.1677Z" fill="#2A767E" stroke="#F9FFF9" stroke-width="0.209167"></path><g id="arrow"><path id="Vector_4" d="M24.1212 34.3021C24.1212 34.5661 24.3354 34.7802 24.5993 34.7802C24.8633 34.7802 25.0774 34.5664 25.0774 34.3021V24.5908C25.0774 24.3268 24.8633 24.1127 24.5993 24.1127C24.3353 24.1127 24.1212 24.3268 24.1212 24.5908V34.3021Z" fill="#2A767E" stroke="#2A767E" stroke-width="0.209167"></path><path id="Vector_5" d="M24.5992 25.268L21.9493 27.9179L21.9492 27.918L24.5992 25.268ZM24.5992 25.268L27.2492 27.918C27.3424 28.0112 27.4651 28.058 27.5872 28.058L24.5992 25.268ZM24.9372 24.2538C24.7505 24.067 24.4477 24.0669 24.2611 24.2538L27.5872 28.058C27.7091 28.058 27.832 28.0116 27.9254 27.9179C28.1121 27.7311 28.112 27.4286 27.9253 27.2418L24.9372 24.2538Z" fill="#2A767E" stroke="#2A767E" stroke-width="0.209167">'),vi=()=>mi(),bi=it('<div class="flex items-center justify-between upload-file-item"><p></p><div>'),yi=t=>{return i=(s=(e=bi()).firstChild).nextSibling,ht(s,(()=>t.file.name)),i.$$click=()=>t.onDelete(),i.style.setProperty("cursor","pointer"),ht(i,$(Ut,{})),e;var e,s,i},wi=(rt(["click"]),it('<form class="flex flex-col justify-center items-center gap-8"><div class="flex flex-col justify-center items-center gap-6"><h2 class="modal-title">Faça o upload do seu arquivo</h2><div class="dropzone flex justify-center items-center"><div class="flex flex-col justify-center items-center gap-2"><div><h3>Arraste & solte arquivos ou <a>Escolha</a></h3><p>Formatos suportados: PDF, DOCX, TXT</p></div></div></div><div class="flex flex-col gap-2">')),xi=it('<h4 class="upload-message">Fazendo upload do documento'),Ai=t=>{const[e,s]=x([]),{selectFiles:i,clearFiles:r}=fi({accept:t.formats.join(",")}),{setRef:a,clearFiles:n}=function(t){const[e,s]=x([]),[i,r]=x(!1);let a;const n=e=>{r(!0),Promise.resolve(t?.onDragStart?.(gi(e.dataTransfer?.files||null)))},o=e=>{r(!1),Promise.resolve(t?.onDragEnd?.(gi(e.dataTransfer?.files||null)))},l=e=>{Promise.resolve(t?.onDragEnter?.(gi(e.dataTransfer?.files||null)))},h=e=>{Promise.resolve(t?.onDragLeave?.(gi(e.dataTransfer?.files||null)))},d=e=>{e.preventDefault(),Promise.resolve(t?.onDragOver?.(gi(e.dataTransfer?.files||null)))},c=e=>{Promise.resolve(t?.onDrag?.(gi(e.dataTransfer?.files||null)))},u=e=>{e.preventDefault(),e=gi(e.dataTransfer?.files||null),s(e),Promise.resolve(t?.onDrop?.(e))};return E((()=>{a&&(a.addEventListener("dragstart",n),a.addEventListener("dragenter",l),a.addEventListener("dragend",o),a.addEventListener("dragleave",h),a.addEventListener("dragover",d),a.addEventListener("drag",c),a.addEventListener("drop",u),S((()=>{a?.removeEventListener("dragstart",n),a?.removeEventListener("dragenter",l),a?.removeEventListener("dragend",o),a?.removeEventListener("dragleave",h),a?.removeEventListener("dragover",d),a?.removeEventListener("drag",c),a?.removeEventListener("drop",u)})))})),{setRef:t=>{a=t},files:e,isDragging:i,removeFile:t=>{s((e=>e.filter((e=>e.name!==t))))},clearFiles:()=>{s([])}}}({onDrop:t=>{s(t)}}),o=()=>{r(),n(),s([])},l=s=>{s.preventDefault(),t.onSubmit(e())};{const r=wi(),n=r.firstChild.firstChild.nextSibling,h=n.firstChild,d=h.firstChild,c=d.firstChild.firstChild.nextSibling,u=n.nextSibling;return lt(a,n),ht(h,$(vi,{}),d),c.$$click=t=>{t.preventDefault(),i((t=>{s(t)}))},ht(u,(()=>{const t=C((()=>0<e().length));return()=>t()&&xi()})(),null),ht(u,$(X,{get each(){return e()},children:t=>$(yi,{file:t,onDelete:o})}),null),ht(r,$(ci,{onSubmit:l,get backgroundColor(){return t.buttonInput?.backgroundColor},get textColor(){return t.buttonInput?.textColor},get disabled(){return 0===e()?.length},children:"Enviar Arquivos"}),null),A((()=>null!=t.buttonInput?.backgroundColor?c.style.setProperty("color",t.buttonInput?.backgroundColor):c.style.removeProperty("color"))),r}},_i=(rt(["click"]),it('<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.06686 13.8666H5.2002V12.1333H6.06686C6.29672 12.1333 6.51716 12.2246 6.67969 12.3871C6.84222 12.5497 6.93353 12.7701 6.93353 13C6.93353 13.2298 6.84222 13.4503 6.67969 13.6128C6.51716 13.7753 6.29672 13.8666 6.06686 13.8666ZM12.1335 17.3333V12.1333H13.0002C13.2301 12.1333 13.4505 12.2246 13.613 12.3871C13.7756 12.5497 13.8669 12.7701 13.8669 13V16.4666C13.8669 16.6965 13.7756 16.9169 13.613 17.0795C13.4505 17.242 13.2301 17.3333 13.0002 17.3333H12.1335Z" fill="#F34646"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.7334 2.6C1.7334 1.91044 2.00733 1.24912 2.49492 0.761522C2.98252 0.273928 3.64384 0 4.3334 0L18.5589 0L24.2667 5.70787V23.4C24.2667 24.0896 23.9928 24.7509 23.5052 25.2385C23.0176 25.7261 22.3563 26 21.6667 26H4.3334C3.64384 26 2.98252 25.7261 2.49492 25.2385C2.00733 24.7509 1.7334 24.0896 1.7334 23.4V2.6ZM6.06673 10.4H3.46673V19.0667H5.20007V15.6H6.06673C6.75629 15.6 7.41762 15.3261 7.90521 14.8385C8.3928 14.3509 8.66673 13.6896 8.66673 13C8.66673 12.3104 8.3928 11.6491 7.90521 11.1615C7.41762 10.6739 6.75629 10.4 6.06673 10.4ZM13.0001 10.4H10.4001V19.0667H13.0001C13.6896 19.0667 14.3509 18.7927 14.8385 18.3051C15.3261 17.8176 15.6001 17.1562 15.6001 16.4667V13C15.6001 12.3104 15.3261 11.6491 14.8385 11.1615C14.3509 10.6739 13.6896 10.4 13.0001 10.4ZM17.3334 19.0667V10.4H22.5334V12.1333H19.0667V13.8667H20.8001V15.6H19.0667V19.0667H17.3334Z" fill="#F34646"></path><rect x="2" y="8" width="21" height="13" fill="#F34646"></rect><path d="M4.6456 18V11.4545H7.10014C7.60298 11.4545 8.02486 11.5483 8.36577 11.7358C8.70881 11.9233 8.96768 12.1811 9.1424 12.5092C9.31925 12.8352 9.40767 13.206 9.40767 13.6214C9.40767 14.0412 9.31925 14.4141 9.1424 14.7401C8.96555 15.0661 8.70455 15.3228 8.35938 15.5103C8.0142 15.6957 7.58913 15.7884 7.08416 15.7884H5.45739V14.8136H6.92436C7.21839 14.8136 7.45916 14.7624 7.64666 14.6602C7.83416 14.5579 7.97266 14.4173 8.06214 14.2383C8.15376 14.0593 8.19957 13.8537 8.19957 13.6214C8.19957 13.3892 8.15376 13.1847 8.06214 13.0078C7.97266 12.831 7.8331 12.6935 7.64347 12.5955C7.45597 12.4954 7.21413 12.4453 6.91797 12.4453H5.83132V18H4.6456ZM12.6556 18H10.4376V11.4545H12.7004C13.3502 11.4545 13.9085 11.5856 14.3751 11.8477C14.8438 12.1076 15.2039 12.4815 15.4553 12.9695C15.7068 13.4574 15.8325 14.0412 15.8325 14.7209C15.8325 15.4027 15.7057 15.9886 15.4521 16.4787C15.2007 16.9687 14.8374 17.3448 14.3623 17.6069C13.8893 17.869 13.3204 18 12.6556 18ZM11.6233 16.9741H12.5981C13.0541 16.9741 13.4344 16.891 13.7391 16.7248C14.0438 16.5565 14.2728 16.3061 14.4262 15.9737C14.5796 15.6392 14.6563 15.2216 14.6563 14.7209C14.6563 14.2202 14.5796 13.8047 14.4262 13.4744C14.2728 13.142 14.0459 12.8938 13.7455 12.7298C13.4472 12.5636 13.0764 12.4805 12.6333 12.4805H11.6233V16.9741ZM16.9591 18V11.4545H21.1523V12.4485H18.1448V14.2255H20.8646V15.2195H18.1448V18H16.9591Z" fill="white">')),Ci=()=>_i();var ki={d:(t,e)=>{for(var s in e)ki.o(e,s)&&!ki.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},Ei=globalThis.pdfjsLib={};ki.d(Ei,{AbortException:()=>Br,AnnotationEditorLayer:()=>Nl,AnnotationEditorParamsType:()=>ji,AnnotationEditorType:()=>Hi,AnnotationEditorUIManager:()=>za,AnnotationLayer:()=>kl,AnnotationMode:()=>zi,CMapCompressionType:()=>wr,ColorPicker:()=>Il,DOMSVGFactory:()=>ga,DrawLayer:()=>Bl,FeatureTest:()=>$r,GlobalWorkerOptions:()=>Ln,ImageKind:()=>Ki,InvalidPDFException:()=>Dr,MissingPDFException:()=>Fr,OPS:()=>xr,PDFDataRangeTransport:()=>Ro,PDFDateString:()=>ka,PDFWorker:()=>No,PasswordResponses:()=>Ar,PermissionFlag:()=>$i,PixelsPerInch:()=>da,RenderingCancelledException:()=>ma,TextLayer:()=>Ao,UnexpectedResponseException:()=>Or,Util:()=>qr,VerbosityLevel:()=>yr,XfaLayer:()=>Xo,build:()=>qo,createValidAbsoluteUrl:()=>Mr,fetchData:()=>ca,getDocument:()=>Mo,getFilenameFromUrl:()=>ya,getPdfFilenameFromUrl:()=>wa,getXfaPageViewport:()=>Ea,isDataScheme:()=>va,isPdfFile:()=>ba,noContextMenu:()=>_a,normalizeUnicode:()=>Wr,setLayerDimensions:()=>Pa,shadow:()=>Pr,version:()=>Uo});const Si=!("object"!=typeof process||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),Ti=[1,0,0,1,0,0],Mi=[.001,0,0,.001,0,0],Pi=1.35,Li=1,Ri=2,Ii=4,Di=16,Fi=32,Oi=64,Ni=128,Bi=256,zi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Hi={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},ji={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},$i={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ui=0,qi=1,Vi=2,Gi=3,Wi=3,Xi=4,Ki={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Yi=1,Qi=2,Ji=3,Zi=4,tr=5,er=6,sr=7,ir=8,rr=9,ar=10,nr=11,or=12,lr=13,hr=14,dr=15,cr=16,ur=17,pr=20,gr=1,fr=2,mr=3,vr=4,br=5,yr={ERRORS:0,WARNINGS:1,INFOS:5},wr={NONE:0,BINARY:1},xr={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},Ar={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let _r=yr.WARNINGS;function Cr(){return _r}function kr(t){_r>=yr.INFOS&&console.log("Info: "+t)}function Er(t){_r>=yr.WARNINGS&&console.log("Warning: "+t)}function Sr(t){throw new Error(t)}function Tr(t,e){t||Sr(e)}function Mr(t,e=null,s=null){if(t)try{if(s&&"string"==typeof t&&(s.addDefaultProtocol&&t.startsWith("www.")&&2<=t.match(/\./g)?.length&&(t="http://"+t),s.tryConvertEncoding))try{t=function(t){return decodeURIComponent(escape(t))}(t)}catch{}var i=e?new URL(t,e):new URL(t);if(function(t){switch(t?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(i))return i}catch{}return null}function Pr(t,e,s,i=!1){return Object.defineProperty(t,e,{value:s,enumerable:!i,configurable:!0,writable:!1}),s}const Lr=function(){function t(e,s){this.constructor===t&&Sr("Cannot initialize BaseException."),this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t}();class Rr extends Lr{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Ir extends Lr{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Dr extends Lr{constructor(t){super(t,"InvalidPDFException")}}class Fr extends Lr{constructor(t){super(t,"MissingPDFException")}}class Or extends Lr{constructor(t,e){super(t,"UnexpectedResponseException"),this.status=e}}class Nr extends Lr{constructor(t){super(t,"FormatError")}}class Br extends Lr{constructor(t){super(t,"AbortException")}}function zr(t){"object"==typeof t&&void 0!==t?.length||Sr("Invalid argument for bytesToString");var e=t.length;if(e<8192)return String.fromCharCode.apply(null,t);var s=[];for(let r=0;r<e;r+=8192){var i=Math.min(r+8192,e);i=t.subarray(r,i);s.push(String.fromCharCode.apply(null,i))}return s.join("")}function Hr(t){"string"!=typeof t&&Sr("Invalid argument for stringToBytes");var e=t.length,s=new Uint8Array(e);for(let i=0;i<e;++i)s[i]=255&t.charCodeAt(i);return s}function jr(t){var e,s,i=Object.create(null);for([e,s]of t)i[e]=s;return i}class $r{static get isLittleEndian(){return Pr(this,"isLittleEndian",function(){var t;return 1===((t=new Uint8Array(4))[0]=1,t=new Uint32Array(t.buffer,0,1))[0]}())}static get isEvalSupported(){return Pr(this,"isEvalSupported",function(){try{return new Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return Pr(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?Pr(this,"platform",{isMac:navigator.platform.includes("Mac")}):Pr(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return Pr(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Ur=Array.from(Array(256).keys(),(t=>t.toString(16).padStart(2,"0")));class qr{static makeHexColor(t,e,s){return"#"+Ur[t]+Ur[e]+Ur[s]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}static applyInverseTransform(t,e){var s=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/s,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/s]}static getAxialAlignedBoundingBox(t,e){var s=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),r=this.applyTransform([t[0],t[3]],e);t=this.applyTransform([t[2],t[1]],e);return[Math.min(s[0],i[0],r[0],t[0]),Math.min(s[1],i[1],r[1],t[1]),Math.max(s[0],i[0],r[0],t[0]),Math.max(s[1],i[1],r[1],t[1])]}static inverseTransform(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t){var e=[t[0],t[2],t[1],t[3]],s=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],r=t[2]*e[0]+t[3]*e[2];t=(e=(s+(t=t[2]*e[1]+t[3]*e[3]))/2)-(s=Math.sqrt((s+t)**2-4*(s*t-r*i))/2)||1;return[Math.sqrt(e+s||1),Math.sqrt(t)]}static normalizeRect(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){var s,i=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),r=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));return r<i||(s=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),(t=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3])))<s)?null:[i,s,r,t]}static#t(t,e,s,i,r,a,n,o,l,h){var d;l<=0||1<=l||(s=(d=1-l)*(d*(d*t+3*l*e)+3*(t=l*l)*s)+(e=t*l)*i,i=d*(d*(d*r+3*l*a)+3*t*n)+e*o,h[0]=Math.min(h[0],s),h[1]=Math.min(h[1],i),h[2]=Math.max(h[2],s),h[3]=Math.max(h[3],i))}static#e(t,e,s,i,r,a,n,o,l,h,d,c){Math.abs(l)<1e-12?1e-12<=Math.abs(h)&&this.#t(t,e,s,i,r,a,n,o,-d/h,c):(d=h**2-4*d*l)<0||(d=Math.sqrt(d),this.#t(t,e,s,i,r,a,n,o,(-h+d)/(l*=2),c),this.#t(t,e,s,i,r,a,n,o,(-h-d)/l,c))}static bezierBoundingBox(t,e,s,i,r,a,n,o,l){return l?(l[0]=Math.min(l[0],t,n),l[1]=Math.min(l[1],e,o),l[2]=Math.max(l[2],t,n),l[3]=Math.max(l[3],e,o)):l=[Math.min(t,n),Math.min(e,o),Math.max(t,n),Math.max(e,o)],this.#e(t,s,r,n,e,i,a,o,3*(3*(s-r)-t+n),6*(t-2*s+r),3*(s-t),l),this.#e(t,s,r,n,e,i,a,o,3*(3*(i-a)-e+o),6*(e-2*i+a),3*(i-e),l),l}}let Vr=null,Gr=null;function Wr(t){return Vr||(Vr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Gr=new Map([["ﬅ","ſt"]])),t.replaceAll(Vr,((t,e,s)=>e?e.normalize("NFKC"):Gr.get(s)))}const Xr="pdfjs_internal_id_",Kr=0,Yr=1,Qr=2,Jr=3,Zr=4,ta=5,ea=6,sa=7,ia=8;class ra{constructor(){this.constructor===ra&&Sr("Cannot initialize BaseFilterFactory.")}addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,r){return"none"}destroy(t=0){}}class aa{#s=!1;constructor({enableHWA:t=!1}={}){this.constructor===aa&&Sr("Cannot initialize BaseCanvasFactory."),this.#s=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");return{canvas:t=this._createCanvas(t,e),context:t.getContext("2d",{willReadFrequently:!this.#s})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Sr("Abstract method `_createCanvas` called.")}}class na{constructor({baseUrl:t=null,isCompressed:e=!0}){this.constructor===na&&Sr("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return t=this.isCompressed?wr.BINARY:wr.NONE,this._fetchData(e,t).catch((t=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: `+e)}))}_fetchData(t,e){Sr("Abstract method `_fetchData` called.")}}class oa{constructor({baseUrl:t=null}){this.constructor===oa&&Sr("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const e=""+this.baseUrl+t;return this._fetchData(e).catch((t=>{throw new Error("Unable to load font data at: "+e)}))}_fetchData(t){Sr("Abstract method `_fetchData` called.")}}class la{constructor(){this.constructor===la&&Sr("Cannot initialize BaseSVGFactory.")}create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");var i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",t+"px"),i.setAttribute("height",e+"px")),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} `+e),i}createElement(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Sr("Abstract method `_createSVG` called.")}}const ha="http://www.w3.org/2000/svg";class da{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function ca(t,e="text"){if(Aa(t,document.baseURI)){var s=await fetch(t);if(!s.ok)throw new Error(s.statusText);switch(e){case"arraybuffer":return s.arrayBuffer();case"blob":return s.blob();case"json":return s.json()}return s.text()}return new Promise(((s,i)=>{const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE)if(200===r.status||0===r.status){switch(e){case"arraybuffer":case"blob":case"json":return void s(r.response)}s(r.responseText)}else i(new Error(r.statusText))},r.send(null)}))}class ua extends na{_fetchData(t,e){return ca(t,this.isCompressed?"arraybuffer":"text").then((t=>({cMapData:t instanceof ArrayBuffer?new Uint8Array(t):Hr(t),compressionType:e})))}}class pa extends oa{_fetchData(t){return ca(t,"arraybuffer").then((t=>new Uint8Array(t)))}}class ga extends la{_createSVG(t){return document.createElementNS(ha,t)}}class fa{constructor({viewBox:t,scale:e,rotation:s,offsetX:i=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.scale=e,this.rotation=s,this.offsetX=i,this.offsetY=r;var n=(t[2]+t[0])/2,o=(t[3]+t[1])/2;let l,h,d,c,u,p,g,f;switch((s%=360)<0&&(s+=360),s){case 180:l=-1,h=0,d=0,c=1;break;case 90:l=0,h=1,d=1,c=0;break;case 270:l=0,h=-1,d=-1,c=0;break;case 0:l=1,h=0,d=0,c=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(d=-d,c=-c),f=0===l?(u=Math.abs(o-t[1])*e+i,p=Math.abs(n-t[0])*e+r,g=(t[3]-t[1])*e,(t[2]-t[0])*e):(u=Math.abs(n-t[0])*e+i,p=Math.abs(o-t[1])*e+r,g=(t[2]-t[0])*e,(t[3]-t[1])*e),this.transform=[l*e,h*e,d*e,c*e,u-l*e*n-d*e*o,p-h*e*n-c*e*o],this.width=g,this.height=f}get rawDims(){var t=this.viewBox;return Pr(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new fa({viewBox:this.viewBox.slice(),scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(t,e){return qr.applyTransform([t,e],this.transform)}convertToViewportRectangle(t){var e=qr.applyTransform([t[0],t[1]],this.transform);t=qr.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],t[0],t[1]]}convertToPdfPoint(t,e){return qr.applyInverseTransform([t,e],this.transform)}}class ma extends Lr{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function va(t){var e=t.length;let s=0;for(;s<e&&""===t[s].trim();)s++;return"data:"===t.substring(s,s+5).toLowerCase()}function ba(t){return"string"==typeof t&&/\.pdf$/i.test(t)}function ya(t){return[t]=t.split(/[#?]/,1),t.substring(t.lastIndexOf("/")+1)}function wa(t,e="document.pdf"){if("string"!=typeof t)return e;if(va(t))return Er('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;var s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i;t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t);let i=s.exec(t[1])||s.exec(t[2])||s.exec(t[3]);if(i&&(i=i[0]).includes("%"))try{i=s.exec(decodeURIComponent(i))[0]}catch{}return i||e}class xa{started=Object.create(null);times=[];time(t){t in this.started&&Er("Timer is already running for "+t),this.started[t]=Date.now()}timeEnd(t){t in this.started||Er("Timer has not been started for "+t),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){var t,e,s,i,r=[];let a=0;for({name:t}of this.times)a=Math.max(t.length,a);for({name:e,start:s,end:i}of this.times)r.push(`${e.padEnd(a)} ${i-s}ms\n`);return r.join("")}}function Aa(t,e){try{var s=(e?new URL(t,e):new URL(t)).protocol;return"http:"===s||"https:"===s}catch{return!1}}function _a(t){t.preventDefault()}let Ca;class ka{static toDateObject(t){if(!t||"string"!=typeof t)return null;if(!(t=(Ca||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?")).exec(t)))return null;var e=parseInt(t[1],10),s=1<=(s=parseInt(t[2],10))&&s<=12?s-1:0,i=1<=(i=parseInt(t[3],10))&&i<=31?i:1;let r=parseInt(t[4],10),a=(r=0<=r&&r<=23?r:0,parseInt(t[5],10));a=0<=a&&a<=59?a:0;var n=0<=(n=parseInt(t[6],10))&&n<=59?n:0,o=t[7]||"Z",l=0<=(l=parseInt(t[8],10))&&l<=23?l:0;t=0<=(t=parseInt(t[9],10)||0)&&t<=59?t:0;return"-"===o?(r+=l,a+=t):"+"===o&&(r-=l,a-=t),new Date(Date.UTC(e,s,i,r,a,n))}}function Ea(t,{scale:e=1,rotation:s=0}){var{width:t,height:i}=t.attributes.style;t=[0,0,parseInt(t),parseInt(i)];return new fa({viewBox:t,scale:e,rotation:s})}function Sa(t){var e;return t.startsWith("#")?[(16711680&(e=parseInt(t.slice(1),16)))>>16,(65280&e)>>8,255&e]:t.startsWith("rgb(")?t.slice(4,-1).split(",").map((t=>parseInt(t))):t.startsWith("rgba(")?t.slice(5,-1).split(",").map((t=>parseInt(t))).slice(0,3):(Er(`Not a valid color format: "${t}"`),[0,0,0])}function Ta(t){var{a:t,b:e,c:s,d:i,e:r,f:a}=t.getTransform();return[t,e,s,i,r,a]}function Ma(t){var{a:t,b:e,c:s,d:i,e:r,f:a}=t.getTransform().invertSelf();return[t,e,s,i,r,a]}function Pa(t,e,s=!1,i=!0){var r,a,n,o;e instanceof fa&&(({pageWidth:n,pageHeight:a}=e.rawDims),r=t.style,n=`var(--scale-factor) * ${n}px`,a=`var(--scale-factor) * ${a}px`,n=(o=$r.isCSSRoundSupported)?`round(${n}, 1px)`:`calc(${n})`,o=o?`round(${a}, 1px)`:`calc(${a})`,s&&e.rotation%180!=0?(r.width=o,r.height=n):(r.width=n,r.height=o)),i&&t.setAttribute("data-main-rotation",e.rotation)}class La{#i=null;#r=null;#a;#n=null;constructor(t){this.#a=t}render(){var t,e,s=this.#i=document.createElement("div"),i=(s.className="editToolbar",s.setAttribute("role","toolbar"),this.#a._uiManager._signal);return(i=((i=(s.addEventListener("contextmenu",_a,{signal:i}),s.addEventListener("pointerdown",La.#o,{signal:i}),this.#n=document.createElement("div"))).className="buttons",s.append(i),this.#a.toolbarPosition))&&(t=s.style,e="ltr"===this.#a._uiManager.direction?1-i[0]:i[0],t.insetInlineEnd=100*e+"%",t.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`),this.#l(),s}static#o(t){t.stopPropagation()}#h(t){this.#a._focusEventsAllowed=!1,t.preventDefault(),t.stopPropagation()}#d(t){this.#a._focusEventsAllowed=!0,t.preventDefault(),t.stopPropagation()}#c(t){var e=this.#a._uiManager._signal;t.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",_a,{signal:e})}hide(){this.#i.classList.add("hidden"),this.#r?.hideDropdown()}show(){this.#i.classList.remove("hidden")}#l(){var t=document.createElement("button");t.className="delete",t.tabIndex=0,t.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#a.editorType}-button`),this.#c(t),t.addEventListener("click",(t=>{this.#a._uiManager.delete()}),{signal:this.#a._uiManager._signal}),this.#n.append(t)}get#u(){var t=document.createElement("div");return t.className="divider",t}addAltTextButton(t){this.#c(t),this.#n.prepend(t,this.#u)}addColorPicker(t){t=(this.#r=t).renderButton(),this.#c(t),this.#n.prepend(t,this.#u)}remove(){this.#i.remove(),this.#r?.destroy(),this.#r=null}}class Ra{#n=null;#i=null;#p;constructor(t){this.#p=t}#g(){var t=this.#i=document.createElement("div"),e=(t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",_a,{signal:this.#p._signal}),this.#n=document.createElement("div"));return e.className="buttons",t.append(e),this.#f(),t}#m(t,e){let s=0,i=0;for(const n of t){var r,a=n.y+n.height;a<s||(r=n.x+(e?n.width:0),a>s?(i=r,s=a):e?r>i&&(i=r):r<i&&(i=r))}return[e?1-i:i,s]}show(t,e,s){var[e,s]=this.#m(e,s),i=(this.#i||=this.#g()).style;t.append(this.#i),i.insetInlineEnd=100*e+"%",i.top=`calc(${100*s}% + var(--editor-toolbar-vert-offset))`}hide(){this.#i.remove()}#f(){var t=document.createElement("button"),e=(t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1"),document.createElement("span"));t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label"),e=this.#p._signal;t.addEventListener("contextmenu",_a,{signal:e}),t.addEventListener("click",(()=>{this.#p.highlightSelection("floating_button")}),{signal:e}),this.#n.append(t)}}function Ia(t,e,s){for(const i of s)e.addEventListener(i,t[i].bind(t))}class Da{#v=0;get id(){return"pdfjs_internal_editor_"+this.#v++}}class Fa{#b=function(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();var t=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(t);else for(let e=0;e<32;e++)t[e]=Math.floor(255*Math.random());return zr(t)}();#v=0;#y=null;static get _isSVGFittingCanvas(){const t=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',Pr(this,"_isSVGFittingCanvas",e.decode().then((()=>(t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]))))}async#w(t,e){this.#y||=new Map;let s=this.#y.get(t);if(null===s)return null;if(s?.bitmap)s.refCounter+=1;else{try{let t;if(s||={bitmap:null,id:`image_${this.#b}_`+this.#v++,refCounter:0,isSvg:!1},"image/svg+xml"===(t="string"==typeof e?await ca(s.url=e,"blob"):s.file=e).type){const e=Fa._isSVGFittingCanvas,r=new FileReader,a=new Image;var i=new Promise(((t,i)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,t()},r.onload=async()=>{var t=s.svgUrl=r.result;a.src=await e?t+"#svgView(preserveAspectRatio(none))":t},a.onerror=r.onerror=i}));r.readAsDataURL(t),await i}else s.bitmap=await createImageBitmap(t);s.refCounter=1}catch(t){console.error(t),s=null}this.#y.set(t,s),s&&this.#y.set(s.id,s)}return s}async getFromFile(t){var{lastModified:e,name:s,size:i,type:r}=t;return this.#w(e+`_${s}_${i}_`+r,t)}async getFromUrl(t){return this.#w(t,t)}async getFromId(t){return this.#y||=new Map,(t=this.#y.get(t))?t.bitmap?(t.refCounter+=1,t):t.file?this.getFromFile(t.file):this.getFromUrl(t.url):null}getSvgUrl(t){return t=this.#y.get(t),t?.isSvg?t.svgUrl:null}deleteId(t){this.#y||=new Map,(t=this.#y.get(t))&&(--t.refCounter,0===t.refCounter)&&(t.bitmap=null)}isValidId(t){return t.startsWith(`image_${this.#b}_`)}}class Oa{#x=[];#A=!1;#_;#C=-1;constructor(t=128){this.#_=t}add({cmd:t,undo:e,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:n=!1}){i&&t(),this.#A||(i={cmd:t,undo:e,post:s,type:r},-1===this.#C?(0<this.#x.length&&(this.#x.length=0),this.#C=0,this.#x.push(i)):a&&this.#x[this.#C].type===r?(n&&(i.undo=this.#x[this.#C].undo),this.#x[this.#C]=i):((t=this.#C+1)===this.#_?this.#x.splice(0,1):(this.#C=t)<this.#x.length&&this.#x.splice(t),this.#x.push(i)))}undo(){var t,e;-1!==this.#C&&(this.#A=!0,({undo:t,post:e}=this.#x[this.#C]),t(),e?.(),this.#A=!1,--this.#C)}redo(){var t,e;this.#C<this.#x.length-1&&(this.#C+=1,this.#A=!0,({cmd:t,post:e}=this.#x[this.#C]),t(),e?.(),this.#A=!1)}hasSomethingToUndo(){return-1!==this.#C}hasSomethingToRedo(){return this.#C<this.#x.length-1}destroy(){this.#x=null}}class Na{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var e,s,i,r=$r.platform.isMac;for([e,s,i={}]of t)for(const t of e){var a=t.startsWith("mac+");r&&a?(this.callbacks.set(t.slice(4),{callback:s,options:i}),this.allKeys.add(t.split("+").at(-1))):r||a||(this.callbacks.set(t,{callback:s,options:i}),this.allKeys.add(t.split("+").at(-1)))}}#k(t){return t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key),t=this.buffer.join("+"),this.buffer.length=0,t}exec(t,e){var s,i,r,a;this.allKeys.has(e.key)&&(s=this.callbacks.get(this.#k(e)))&&(({callback:s,options:{bubbles:i=!1,args:r=[],checker:a=null}}=s),a&&!a(t,e)||(s.bind(t,...r,e)(),i)||(e.stopPropagation(),e.preventDefault()))}}class Ba{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){var t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){var e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const i of t.keys()){e.style.color=i;var s=window.getComputedStyle(e).color;t.set(i,Sa(s))}e.remove()}(t),Pr(this,"_colors",t)}convert(t){const e=Sa(t);if(window.matchMedia("(forced-colors: active)").matches)for(var[s,i]of this._colors)if(i.every(((t,s)=>t===e[s])))return Ba._colorsMapping.get(s);return e}getHexCode(t){var e=this._colors.get(t);return e?qr.makeHexColor(...e):t}}class za{#E=new AbortController;#S=null;#T=new Map;#M=new Map;#P=null;#L=null;#R=null;#I=new Oa;#D=0;#F=new Set;#O=null;#N=null;#B=new Set;#z=!1;#H=!1;#j=null;#$=null;#U=null;#q=!1;#V=null;#G=new Da;#W=!1;#X=!1;#K=null;#Y=null;#Q=null;#J=Hi.NONE;#Z=new Set;#tt=null;#et=null;#st=null;#it=this.blur.bind(this);#rt=this.focus.bind(this);#at=this.copy.bind(this);#nt=this.cut.bind(this);#ot=this.paste.bind(this);#lt=this.keydown.bind(this);#ht=this.keyup.bind(this);#dt=this.onEditingAction.bind(this);#ct=this.onPageChanging.bind(this);#ut=this.onScaleChanging.bind(this);#pt=this.onRotationChanging.bind(this);#gt={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#ft=[0,0];#mt=null;#vt=null;#bt=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){var t=za.prototype,e=t=>t.#vt.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl(),s=(t,{target:e})=>!(e instanceof HTMLInputElement)||"text"!==(e=e.type)&&"number"!==e,i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return Pr(this,"_keyboardManager",new Na([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#vt.contains(e)&&!t.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(t,{target:e})=>!(e instanceof HTMLButtonElement)&&t.#vt.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-r,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[r,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-r],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,r],checker:e}]]))}constructor(t,e,s,i,r,a,n,o,l,h){this._signal=this.#E.signal,this.#vt=t,this.#bt=e,this.#P=s,this._eventBus=i,this._eventBus._on("editingaction",this.#dt),this._eventBus._on("pagechanging",this.#ct),this._eventBus._on("scalechanging",this.#ut),this._eventBus._on("rotationchanging",this.#pt),this.#yt(),this.#wt(),this.#xt(),this.#L=r.annotationStorage,this.#j=r.filterFactory,this.#et=a,this.#U=n||null,this.#z=o,this.#H=l,this.#Q=h||null,this.viewParameters={realScale:da.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}destroy(){this.#E?.abort(),this.#E=null,this._signal=null,this._eventBus._off("editingaction",this.#dt),this._eventBus._off("pagechanging",this.#ct),this._eventBus._off("scalechanging",this.#ut),this._eventBus._off("rotationchanging",this.#pt);for(const t of this.#M.values())t.destroy();this.#M.clear(),this.#T.clear(),this.#B.clear(),this.#S=null,this.#Z.clear(),this.#I.destroy(),this.#P?.destroy(),this.#V?.hide(),this.#V=null,this.#$&&(clearTimeout(this.#$),this.#$=null),this.#mt&&(clearTimeout(this.#mt),this.#mt=null)}async mlGuess(t){return this.#Q?.guess(t)||null}async isMLEnabledFor(t){return!!await(this.#Q?.isEnabledFor(t))}get useNewAltTextFlow(){return this.#H}get hcmFilter(){return Pr(this,"hcmFilter",this.#et?this.#j.addHCMFilter(this.#et.foreground,this.#et.background):"none")}get direction(){return Pr(this,"direction",getComputedStyle(this.#vt).direction)}get highlightColors(){return Pr(this,"highlightColors",this.#U?new Map(this.#U.split(",").map((t=>t.split("=").map((t=>t.trim()))))):null)}get highlightColorNames(){return Pr(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(t=>t.reverse()))):null)}setMainHighlightColorPicker(t){this.#Y=t}editAltText(t){this.#P?.editAltText(this,t)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onPageChanging({pageNumber:t}){this.#D=t-1}focusMainContainer(){this.#vt.focus()}findParent(t,e){for(const n of this.#M.values()){var{x:s,y:i,width:r,height:a}=n.div.getBoundingClientRect();if(s<=t&&t<=s+r&&i<=e&&e<=i+a)return n}return null}disableUserSelect(t=!1){this.#bt.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#B.add(t)}removeShouldRescale(t){this.#B.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*da.PDF_TO_CSS_UNITS;for(const t of this.#B)t.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#At({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#_t(t){var e=this.currentLayer;if(e.hasTextLayer(t))return e;for(const e of this.#M.values())if(e.hasTextLayer(t))return e;return null}highlightSelection(t=""){var e=document.getSelection();if(e&&!e.isCollapsed){const{anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:n}=e,o=e.toString();var s=this.#At(e).closest(".textLayer");const l=this.getSelectionBoxes(s);if(l){e.empty();const h=this.#_t(s),d=this.#J===Hi.NONE;e=()=>{h?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:l,anchorNode:i,anchorOffset:r,focusNode:a,focusOffset:n,text:o}),d&&this.showAllEditors("highlight",!0,!0)},d?this.switchToMode(Hi.HIGHLIGHT,e):e()}}}#Ct(){var t,e=document.getSelection();e&&!e.isCollapsed&&(e=this.#At(e).closest(".textLayer"),t=this.getSelectionBoxes(e))&&(this.#V||=new Ra(this),this.#V.show(e,t,"ltr"===this.direction))}addToAnnotationStorage(t){t.isEmpty()||!this.#L||this.#L.has(t.id)||this.#L.setValue(t.id,t)}#kt(){var t=document.getSelection();if(!t||t.isCollapsed)this.#tt&&(this.#V?.hide(),this.#tt=null,this.#Et({hasSelectedText:!1}));else{var e=t.anchorNode;if(e!==this.#tt)if(t=this.#At(t).closest(".textLayer")){if(this.#V?.hide(),this.#tt=e,this.#Et({hasSelectedText:!0}),(this.#J===Hi.HIGHLIGHT||this.#J===Hi.NONE)&&(this.#J===Hi.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#q=this.isShiftKeyDown,!this.isShiftKeyDown)){const s=this.#J===Hi.HIGHLIGHT?this.#_t(t):null;s?.toggleDrawing(),e=this._signal;const i=t=>{"pointerup"===t.type&&0!==t.button||(s?.toggleDrawing(!0),window.removeEventListener("pointerup",i),window.removeEventListener("blur",i),"pointerup"===t.type&&this.#St("main_toolbar"))};window.addEventListener("pointerup",i,{signal:e}),window.addEventListener("blur",i,{signal:e})}}else this.#tt&&(this.#V?.hide(),this.#tt=null,this.#Et({hasSelectedText:!1}))}}#St(t=""){this.#J===Hi.HIGHLIGHT?this.highlightSelection(t):this.#z&&this.#Ct()}#yt(){document.addEventListener("selectionchange",this.#kt.bind(this),{signal:this._signal})}#Tt(){var t=this._signal;window.addEventListener("focus",this.#rt,{signal:t}),window.addEventListener("blur",this.#it,{signal:t})}#Mt(){window.removeEventListener("focus",this.#rt),window.removeEventListener("blur",this.#it)}blur(){if(this.isShiftKeyDown=!1,this.#q&&(this.#q=!1,this.#St("main_toolbar")),this.hasSelection){var t=document.activeElement;for(const e of this.#Z)if(e.div.contains(t)){this.#K=[e,t],e._focusEventsAllowed=!1;break}}}focus(){if(this.#K){const[t,e]=this.#K;this.#K=null,e.addEventListener("focusin",(()=>{t._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),e.focus()}}#xt(){var t=this._signal;window.addEventListener("keydown",this.#lt,{signal:t}),window.addEventListener("keyup",this.#ht,{signal:t})}#Pt(){window.removeEventListener("keydown",this.#lt),window.removeEventListener("keyup",this.#ht)}#Lt(){var t=this._signal;document.addEventListener("copy",this.#at,{signal:t}),document.addEventListener("cut",this.#nt,{signal:t}),document.addEventListener("paste",this.#ot,{signal:t})}#Rt(){document.removeEventListener("copy",this.#at),document.removeEventListener("cut",this.#nt),document.removeEventListener("paste",this.#ot)}#wt(){var t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#xt(),this.#Lt()}removeEditListeners(){this.#Pt(),this.#Rt()}dragOver(t){for(var{type:e}of t.dataTransfer.items)for(const s of this.#N)if(s.isHandlingMimeForPasting(e))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#N)if(s.isHandlingMimeForPasting(e.type))return s.paste(e,this.currentLayer),void t.preventDefault()}copy(t){if(t.preventDefault(),this.#S?.commitOrRemove(),this.hasSelection){var e=[];for(const t of this.#Z){var s=t.serialize(!0);s&&e.push(s)}0!==e.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}}cut(t){this.copy(t),this.delete()}paste(t){t.preventDefault(),t=t.clipboardData;for(const e of t.items)for(const t of this.#N)if(t.isHandlingMimeForPasting(e.type))return void t.paste(e,this.currentLayer);let e=t.getData("application/pdfjs");if(e){try{e=JSON.parse(e)}catch(t){return void Er(`paste: "${t.message}".`)}if(Array.isArray(e)){this.unselectAll();var s=this.currentLayer;try{const t=[];for(const r of e){var i=s.deserialize(r);if(!i)return;t.push(i)}this.addCommands({cmd:()=>{for(const e of t)this.#It(e);this.#Dt(t)},undo:()=>{for(const e of t)e.remove()},mustExec:!0})}catch(t){Er(`paste: "${t.message}".`)}}}}keydown(t){this.isShiftKeyDown||"Shift"!==t.key||(this.isShiftKeyDown=!0),this.#J===Hi.NONE||this.isEditorHandlingKeyboard||za._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,this.#q)&&(this.#q=!1,this.#St("main_toolbar"))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu")}}#Et(t){Object.entries(t).some((([t,e])=>this.#gt[t]!==e))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#gt,t)}),this.#J===Hi.HIGHLIGHT)&&!1===t.hasSelectedEditor&&this.#Ft([[ji.HIGHLIGHT_FREE,!0]])}#Ft(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#Tt(),this.#Lt(),this.#Et({isEditing:this.#J!==Hi.NONE,isEmpty:this.#Ot(),hasSomethingToUndo:this.#I.hasSomethingToUndo(),hasSomethingToRedo:this.#I.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#Mt(),this.#Rt(),this.#Et({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#N){this.#N=t;for(const t of this.#N)this.#Ft(t.defaultPropertiesToUpdate)}}getId(){return this.#G.id}get currentLayer(){return this.#M.get(this.#D)}getLayer(t){return this.#M.get(t)}get currentPageIndex(){return this.#D}addLayer(t){this.#M.set(t.pageIndex,t),this.#W?t.enable():t.disable()}removeLayer(t){this.#M.delete(t.pageIndex)}updateMode(t,e=null,s=!1){if(this.#J!==t)if((this.#J=t)===Hi.NONE)this.setEditingState(!1),this.#Nt();else{this.setEditingState(!0),this.#Bt(),this.unselectAll();for(const e of this.#M.values())e.updateMode(t);if(!e&&s)this.addNewEditorFromKeyboard();else if(e)for(const t of this.#T.values())if(t.annotationElementId===e){this.setSelected(t),t.enterInEditMode();break}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t!==this.#J&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}updateParams(t,e){if(this.#N){switch(t){case ji.CREATE:return void this.currentLayer.addNewEditor();case ji.HIGHLIGHT_DEFAULT_COLOR:this.#Y?.updateColor(e);break;case ji.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#st||=new Map).set(t,e),this.showAllEditors("highlight",e)}for(const s of this.#Z)s.updateParams(t,e);for(const s of this.#N)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=0){for(const s of this.#T.values())s.editorType===t&&s.show(e);(this.#st?.get(ji.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#Ft([[ji.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#X!==t){this.#X=t;for(const e of this.#M.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}#Bt(){if(!this.#W){this.#W=!0;for(const t of this.#M.values())t.enable();for(const t of this.#T.values())t.enable()}}#Nt(){if(this.unselectAll(),this.#W){this.#W=!1;for(const t of this.#M.values())t.disable();for(const t of this.#T.values())t.disable()}}getEditors(t){var e=[];for(const s of this.#T.values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return this.#T.get(t)}addEditor(t){this.#T.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#$&&clearTimeout(this.#$),this.#$=setTimeout((()=>{this.focusMainContainer(),this.#$=null}),0)),this.#T.delete(t.id),this.unselect(t),t.annotationElementId&&this.#F.has(t.annotationElementId)||this.#L?.remove(t.id)}addDeletedAnnotationElement(t){this.#F.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#F.has(t)}removeDeletedAnnotationElement(t){this.#F.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#It(t){var e=this.#M.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#S!==t&&(this.#S=t)&&this.#Ft(t.propertiesToUpdate)}get#zt(){let t=null;for(t of this.#Z);return t}updateUI(t){this.#zt===t&&this.#Ft(t.propertiesToUpdate)}toggleSelected(t){this.#Z.has(t)?(this.#Z.delete(t),t.unselect(),this.#Et({hasSelectedEditor:this.hasSelection})):(this.#Z.add(t),t.select(),this.#Ft(t.propertiesToUpdate),this.#Et({hasSelectedEditor:!0}))}setSelected(t){for(const e of this.#Z)e!==t&&e.unselect();this.#Z.clear(),this.#Z.add(t),t.select(),this.#Ft(t.propertiesToUpdate),this.#Et({hasSelectedEditor:!0})}isSelected(t){return this.#Z.has(t)}get firstSelectedEditor(){return this.#Z.values().next().value}unselect(t){t.unselect(),this.#Z.delete(t),this.#Et({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#Z.size}get isEnterHandled(){return 1===this.#Z.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#I.undo(),this.#Et({hasSomethingToUndo:this.#I.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#Ot()})}redo(){this.#I.redo(),this.#Et({hasSomethingToUndo:!0,hasSomethingToRedo:this.#I.hasSomethingToRedo(),isEmpty:this.#Ot()})}addCommands(t){this.#I.add(t),this.#Et({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#Ot()})}#Ot(){if(0===this.#T.size)return!0;if(1===this.#T.size)for(const t of this.#T.values())return t.isEmpty();return!1}delete(){if(this.commitOrRemove(),this.hasSelection){const t=[...this.#Z];this.addCommands({cmd:()=>{for(const e of t)e.remove()},undo:()=>{for(const e of t)this.#It(e)},mustExec:!0})}}commitOrRemove(){this.#S?.commitOrRemove()}hasSomethingToControl(){return this.#S||this.hasSelection}#Dt(t){for(const t of this.#Z)t.unselect();this.#Z.clear();for(const e of t)e.isEmpty()||(this.#Z.add(e),e.select());this.#Et({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#Z)t.commit();this.#Dt(this.#T.values())}unselectAll(){if((!this.#S||(this.#S.commitOrRemove(),this.#J===Hi.NONE))&&this.hasSelection){for(const t of this.#Z)t.unselect();this.#Z.clear(),this.#Et({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),this.hasSelection){this.#ft[0]+=t,this.#ft[1]+=e;const[s,i]=this.#ft,r=[...this.#Z];this.#mt&&clearTimeout(this.#mt),this.#mt=setTimeout((()=>{this.#mt=null,this.#ft[0]=this.#ft[1]=0,this.addCommands({cmd:()=>{for(const t of r)this.#T.has(t.id)&&t.translateInPage(s,i)},undo:()=>{for(const t of r)this.#T.has(t.id)&&t.translateInPage(-s,-i)},mustExec:!1})}),1e3);for(const s of r)s.translateInPage(t,e)}}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#O=new Map;for(const t of this.#Z)this.#O.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#O)return!1;this.disableUserSelect(!1);const t=this.#O;this.#O=null;let e=!1;for(var[{x:s,y:i,pageIndex:r},a]of t)a.newX=s,a.newY=i,a.newPageIndex=r,e||=s!==a.savedX||i!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const n=(t,e,s,i)=>{var r;this.#T.has(t.id)&&((r=this.#M.get(i))?t._setParentAndPosition(r,e,s):(t.pageIndex=i,t.x=e,t.y=s))};return this.addCommands({cmd:()=>{for(var[e,{newX:s,newY:i,newPageIndex:r}]of t)n(e,s,i,r)},undo:()=>{for(var[e,{savedX:s,savedY:i,savedPageIndex:r}]of t)n(e,s,i,r)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#O)for(const s of this.#O.keys())s.drag(t,e)}rebuild(t){var e;null===t.parent?(e=this.getLayer(t.pageIndex))?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild()):t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#Z.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#S===t}getActive(){return this.#S}getMode(){return this.#J}get imageManager(){return Pr(this,"imageManager",new Fa)}getSelectionBoxes(t){if(!t)return null;var e=document.getSelection();for(let s=0,i=e.rangeCount;s<i;s++)if(!t.contains(e.getRangeAt(s).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:a}=t.getBoundingClientRect();let n;switch(t.getAttribute("data-main-rotation")){case"90":n=(t,e,n,o)=>({x:(e-i)/a,y:1-(t+n-s)/r,width:o/a,height:n/r});break;case"180":n=(t,e,n,o)=>({x:1-(t+n-s)/r,y:1-(e+o-i)/a,width:n/r,height:o/a});break;case"270":n=(t,e,n,o)=>({x:1-(e+o-i)/a,y:(t-s)/r,width:o/a,height:n/r});break;default:n=(t,e,n,o)=>({x:(t-s)/r,y:(e-i)/a,width:n/r,height:o/a})}var o=[];for(let t=0,s=e.rangeCount;t<s;t++){var l=e.getRangeAt(t);if(!l.collapsed)for(var{x:h,y:d,width:c,height:u}of l.getClientRects())0!==c&&0!==u&&o.push(n(h,d,c,u))}return 0===o.length?null:o}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#R||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#R?.delete(t)}renderAnnotationElement(t){var e=this.#R?.get(t.data.id);(e=e&&this.#L.getRawValue(e))&&(this.#J!==Hi.NONE||e.hasBeenModified)&&e.renderAnnotationElement(t)}}class Ha{#Ht="";#jt=!1;#$t=null;#Ut=null;#qt=null;#Vt=!1;#a=null;static _l10nPromise=null;constructor(t){this.#a=t}static initialize(t){Ha._l10nPromise||=t}async render(){const t=this.#$t=document.createElement("button");t.className="altText";var e=await Ha._l10nPromise.get("pdfjs-editor-alt-text-button-label");t.textContent=e,t.setAttribute("aria-label",e),t.tabIndex="0",e=this.#a._uiManager._signal;t.addEventListener("contextmenu",_a,{signal:e}),t.addEventListener("pointerdown",(t=>t.stopPropagation()),{signal:e});const s=t=>{t.preventDefault(),this.#a._uiManager.editAltText(this.#a)};return t.addEventListener("click",s,{capture:!0,signal:e}),t.addEventListener("keydown",(e=>{e.target===t&&"Enter"===e.key&&(this.#Vt=!0,s(e))}),{signal:e}),await this.#Gt(),t}finish(){this.#$t&&(this.#$t.focus({focusVisible:this.#Vt}),this.#Vt=!1)}isEmpty(){return!this.#Ht&&!this.#jt}get data(){return{altText:this.#Ht,decorative:this.#jt}}set data({altText:t,decorative:e}){this.#Ht===t&&this.#jt===e||(this.#Ht=t,this.#jt=e,this.#Gt())}toggle(t=!1){this.#$t&&(!t&&this.#qt&&(clearTimeout(this.#qt),this.#qt=null),this.#$t.disabled=!t)}destroy(){this.#$t?.remove(),this.#$t=null,this.#Ut=null}async#Gt(){const t=this.#$t;if(t)if(this.#Ht||this.#jt){t.classList.add("done"),Ha._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then((e=>{t.setAttribute("aria-label",e)}));let s=this.#Ut;if(!s){this.#Ut=s=document.createElement("span"),s.className="tooltip",s.setAttribute("role","tooltip");var e=s.id="alt-text-tooltip-"+this.#a.id;t.setAttribute("aria-describedby",e),(e=this.#a._uiManager._signal).addEventListener("abort",(()=>{clearTimeout(this.#qt),this.#qt=null}),{once:!0}),t.addEventListener("mouseenter",(()=>{this.#qt=setTimeout((()=>{this.#qt=null,this.#Ut.classList.add("show"),this.#a._reportTelemetry({action:"alt_text_tooltip"})}),100)}),{signal:e}),t.addEventListener("mouseleave",(()=>{this.#qt&&(clearTimeout(this.#qt),this.#qt=null),this.#Ut?.classList.remove("show")}),{signal:e})}s.innerText=this.#jt?await Ha._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#Ht,s.parentNode||t.append(s),this.#a.getImageForAltText()?.setAttribute("aria-describedby",s.id)}else t.classList.remove("done"),this.#Ut?.remove()}}class ja{#Wt=null;#Xt=null;#Ht=null;#Kt=!1;#Yt=!1;#Qt=null;#Jt=null;#Zt=this.focusin.bind(this);#te=this.focusout.bind(this);#ee=null;#se="";#ie=!1;#re=null;#ae=!1;#ne=!1;#oe=!1;#le=null;#he=0;#de=0;#ce=null;_initialOptions=Object.create(null);_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#ue=!1;#pe=ja._zIndex++;static _borderLineWidth=-1;static _colorManager=new Ba;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){var t=ja.prototype._resizeWithKeyboard,e=za.TRANSLATE_SMALL,s=za.TRANSLATE_BIG;return Pr(this,"_resizerKeyboardManager",new Na([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],ja.prototype._stopResizingWithKeyboard]]))}constructor(t){this.constructor===ja&&Sr("Cannot initialize AnnotationEditor."),this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null;var{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:a}}=this.parent.viewport,[e,s]=(this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,a],this.parentDimensions);this.x=t.x/e,this.y=t.y/s,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return Pr(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){var e=new $a({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e,s){if(ja._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map((e=>[e,t.get(e.replaceAll(/([A-Z])/g,(t=>"-"+t.toLowerCase())))]))),s?.strings)for(const e of s.strings)ja._l10nPromise.set(e,t.get(e));-1===ja._borderLineWidth&&(s=getComputedStyle(document.documentElement),ja._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0)}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Sr("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#ue}set _isDraggable(t){this.#ue=t,this.div?.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){var[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(2*t),this.y+=this.width*t/(2*e);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(2*t),this.y-=this.width*t/(2*e);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#pe}setParent(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):this.#ge(),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#ie?this.#ie=!1:this.parent.setSelected(this))}focusout(t){this._focusEventsAllowed&&this.isAttachedToDOM&&!t.relatedTarget?.closest("#"+this.id)&&(t.preventDefault(),!this.parent?.isMultipleSelection)&&this.commitOrRemove()}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){var[r,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/r,this.y=(e+i)/a,this.fixAndSetPosition()}#fe([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this.fixAndSetPosition()}translate(t,e){this.#fe(this.parentDimensions,t,e)}translateInPage(t,e){this.#re||=[this.x,this.y],this.#fe(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}drag(t,e){this.#re||=[this.x,this.y];var[s,i]=this.parentDimensions;if(this.x+=t/s,this.y+=e/i,this.parent&&(this.x<0||1<this.x||this.y<0||1<this.y)){const{x:t,y:e}=this.div.getBoundingClientRect();this.parent.findNewParent(this,t,e)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;var[t,s]=this.getBaseTranslation();r+=t,a+=s,this.div.style.left=(100*r).toFixed(2)+"%",this.div.style.top=(100*a).toFixed(2)+"%",this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!this.#re&&(this.#re[0]!==this.x||this.#re[1]!==this.y)}getBaseTranslation(){var[t,e]=this.parentDimensions,s=ja._borderLineWidth,i=s/t,r=s/e;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){var[e,s]=this.pageDimensions;let{x:i,y:r,width:a,height:n}=this;if(a*=e,n*=s,i*=e,r*=s,this._mustFixPosition)switch(t){case 0:i=Math.max(0,Math.min(e-a,i)),r=Math.max(0,Math.min(s-n,r));break;case 90:i=Math.max(0,Math.min(e-n,i)),r=Math.min(s,Math.max(a,r));break;case 180:i=Math.min(e,Math.max(a,i)),r=Math.min(s,Math.max(n,r));break;case 270:i=Math.min(e,Math.max(n,i)),r=Math.max(0,Math.min(s-a,r))}this.x=i/=e,this.y=r/=s;var[t,o]=this.getBaseTranslation();(t=(i+=t,r+=o,this.div).style).left=(100*i).toFixed(2)+"%",t.top=(100*r).toFixed(2)+"%",this.moveInDOM()}static#me(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return ja.#me(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return ja.#me(t,e,360-this.parentRotation)}#ve(t){switch(t){case 90:var[e,s]=this.pageDimensions;return[0,-e/s,s/e,0];case 180:return[-1,0,0,-1];case 270:var[s,e]=this.pageDimensions;return[0,s/e,-e/s,0];default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){var{parentScale:t,pageDimensions:[e,s]}=this,e=e*t,s=s*t;return $r.isCSSRoundSupported?[Math.round(e),Math.round(s)]:[e,s]}setDims(t,e){var[s,i]=this.parentDimensions;this.div.style.width=(100*t/s).toFixed(2)+"%",this.#Yt||(this.div.style.height=(100*e/i).toFixed(2)+"%")}fixDims(){var t,e,s=this.div.style,{height:i,width:r}=s,a=r.endsWith("%"),n=!this.#Yt&&i.endsWith("%");a&&n||([t,e]=this.parentDimensions,a||(s.width=(100*parseFloat(r)/t).toFixed(2)+"%"),this.#Yt)||n||(s.height=(100*parseFloat(i)/e).toFixed(2)+"%")}getInitialTranslation(){return[0,0]}#be(){if(!this.#Qt){this.#Qt=document.createElement("div"),this.#Qt.classList.add("resizers");var t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const i of t){var s=document.createElement("div");this.#Qt.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#ye.bind(this,i),{signal:e}),s.addEventListener("contextmenu",_a,{signal:e}),s.tabIndex=-1}this.div.prepend(this.#Qt)}}#ye(t,e){e.preventDefault();var s=$r.platform.isMac;if(!(0!==e.button||e.ctrlKey&&s)){this.#Ht?.toggle(!1);const i=this.#we.bind(this,t),r=this._isDraggable;this._isDraggable=!1;const a={passive:!0,capture:!0,signal:s=this._uiManager._signal},n=(this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",i,a),window.addEventListener("contextmenu",_a,{signal:s}),this.x),o=this.y,l=this.width,h=this.height,d=this.parent.div.style.cursor,c=this.div.style.cursor,u=(this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor,()=>{this.parent.togglePointerEvents(!0),this.#Ht?.toggle(!0),this._isDraggable=r,window.removeEventListener("pointerup",u),window.removeEventListener("blur",u),window.removeEventListener("pointermove",i,a),window.removeEventListener("contextmenu",_a),this.parent.div.style.cursor=d,this.div.style.cursor=c,this.#xe(n,o,l,h)});window.addEventListener("pointerup",u,{signal:s}),window.addEventListener("blur",u,{signal:s})}}#xe(t,e,s,i){const r=this.x,a=this.y,n=this.width,o=this.height;r===t&&a===e&&n===s&&o===i||this.addCommands({cmd:()=>{this.width=n,this.height=o,this.x=r,this.y=a;var[t,e]=this.parentDimensions;this.setDims(t*n,e*o),this.fixAndSetPosition()},undo:()=>{this.width=s,this.height=i,this.x=t,this.y=e;var[r,a]=this.parentDimensions;this.setDims(r*s,a*i),this.fixAndSetPosition()},mustExec:!0})}#we(t,e){var[s,i]=this.parentDimensions,r=this.x,a=this.y,n=this.width,o=this.height,l=ja.MIN_SIZE/s,h=ja.MIN_SIZE/i,d=t=>Math.round(1e4*t)/1e4;const c=this.#ve(this.rotation);var u=(t,e)=>[c[0]*t+c[2]*e,c[1]*t+c[3]*e];const p=this.#ve(360-this.rotation);let g,f,m=!1,v=!1;switch(t){case"topLeft":m=!0,g=(t,e)=>[0,0],f=(t,e)=>[t,e];break;case"topMiddle":g=(t,e)=>[t/2,0],f=(t,e)=>[t/2,e];break;case"topRight":m=!0,g=(t,e)=>[t,0],f=(t,e)=>[0,e];break;case"middleRight":v=!0,g=(t,e)=>[t,e/2],f=(t,e)=>[0,e/2];break;case"bottomRight":m=!0,g=(t,e)=>[t,e],f=(t,e)=>[0,0];break;case"bottomMiddle":g=(t,e)=>[t/2,e],f=(t,e)=>[t/2,0];break;case"bottomLeft":m=!0,g=(t,e)=>[0,e],f=(t,e)=>[t,0];break;case"middleLeft":v=!0,g=(t,e)=>[0,e/2],f=(t,e)=>[t,e/2]}t=g(n,o);var b=f(n,o),y=u(...b);r=d(r+y[0]),a=d(a+y[1]);let w=1,x=1;var[e,A]=this.screenToPageTranslation(e.movementX,e.movementY),_=([e,A]=(C=e/s,_=A/i,[p[0]*C+p[2]*_,p[1]*C+p[3]*_]),m?(C=Math.hypot(n,o),w=x=Math.max(Math.min(Math.hypot(b[0]-t[0]-e,b[1]-t[1]-A)/C,1/n,1/o),l/n,h/o)):v?w=Math.max(l,Math.min(1,Math.abs(b[0]-t[0]-e)))/n:x=Math.max(h,Math.min(1,Math.abs(b[1]-t[1]-A)))/o,d(n*w)),C=d(o*x);l=r-(y=u(...f(_,C)))[0],e=a-y[1];this.width=_,this.height=C,this.x=l,this.y=e,this.setDims(s*_,i*C),this.fixAndSetPosition()}altTextFinish(){this.#Ht?.finish()}async addEditToolbar(){return this.#ee||this.#ne||(this.#ee=new La(this),this.div.append(this.#ee.render()),this.#Ht&&this.#ee.addAltTextButton(await this.#Ht.render())),this.#ee}removeEditToolbar(){this.#ee&&(this.#ee.remove(),this.#ee=null,this.#Ht?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#Ht||(Ha.initialize(ja._l10nPromise),this.#Ht=new Ha(this),this.#Wt&&(this.#Ht.data=this.#Wt,this.#Wt=null),await this.addEditToolbar())}get altTextData(){return this.#Ht?.data}set altTextData(t){this.#Ht&&(this.#Ht.data=t)}hasAltText(){return!this.#Ht?.isEmpty()}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=this.#Kt?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground();var t=this._uiManager._signal,[t,e]=(this.div.addEventListener("focusin",this.#Zt,{signal:t}),this.div.addEventListener("focusout",this.#te,{signal:t}),this.parentDimensions),[t,e]=(this.parentRotation%180!=0&&(this.div.style.maxWidth=(100*e/t).toFixed(2)+"%",this.div.style.maxHeight=(100*t/e).toFixed(2)+"%"),this.getInitialTranslation());return this.translate(t,e),Ia(this,this.div,["pointerdown"]),this.div}pointerdown(t){var e=$r.platform.isMac;0!==t.button||t.ctrlKey&&e?t.preventDefault():(this.#ie=!0,this._isDraggable?this.#Ae(t):this.#_e(t))}#_e(t){var e=$r.platform.isMac;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#Ae(t){const e=this._uiManager.isSelected(this);let s,i;this._uiManager.setUpDragSession();var r=this._uiManager._signal;e&&(this.div.classList.add("moving"),s={passive:!0,capture:!0,signal:r},this.#he=t.clientX,this.#de=t.clientY,i=t=>{var{clientX:t,clientY:e}=t,[s,i]=this.screenToPageTranslation(t-this.#he,e-this.#de);this.#he=t,this.#de=e,this._uiManager.dragSelectedEditors(s,i)},window.addEventListener("pointermove",i,s));const a=()=>{window.removeEventListener("pointerup",a),window.removeEventListener("blur",a),e&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",i,s)),this.#ie=!1,this._uiManager.endDragSession()||this.#_e(t)};window.addEventListener("pointerup",a,{signal:r}),window.addEventListener("blur",a,{signal:r})}moveInDOM(){this.#le&&clearTimeout(this.#le),this.#le=setTimeout((()=>{this.#le=null,this.parent?.moveEditorInDOM(this)}),0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition()}getRect(t,e,s=this.rotation){var i=this.parentScale,[r,a]=this.pageDimensions,[n,o]=this.pageTranslation,l=t/i,h=e/i,d=this.x*r,c=this.y*a,u=this.width*r,p=this.height*a;switch(s){case 0:return[d+l+n,a-c-h-p+o,d+l+u+n,a-c-h+o];case 90:return[d+h+n,a-c+l+o,d+h+p+n,a-c+l+u+o];case 180:return[d-l-u+n,a-c+h+o,d-l+n,a-c+h+p+o];case 270:return[d-h-p+n,a-c-l-u+o,d-h+n,a-c-l+o];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){var[s,i,r,a]=t,n=r-s,o=a-i;switch(this.rotation){case 0:return[s,e-a,n,o];case 90:return[s,e-i,o,n];case 180:return[r,e-i,n,o];case 270:return[r,e-a,o,n];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#ne=!0}disableEditMode(){this.#ne=!1}isInEditMode(){return this.#ne}shouldGetKeyboardEvents(){return this.#oe}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var t=this._uiManager._signal;this.div?.addEventListener("focusin",this.#Zt,{signal:t}),this.div?.addEventListener("focusout",this.#te,{signal:t})}rotate(t){}serialize(t=0,e){Sr("An editor must be serializable")}static deserialize(t,e,s){e=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s});var[s,i]=(e.rotation=t.rotation,e.#Wt=t.accessibilityData,e.pageDimensions),[t,r,a,n]=e.getRectInCurrentCoords(t.rect,i);return e.x=t/s,e.y=r/i,e.width=a/s,e.height=n/i,e}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}remove(){if(this.div.removeEventListener("focusin",this.#Zt),this.div.removeEventListener("focusout",this.#te),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#le&&(clearTimeout(this.#le),this.#le=null),this.#ge(),this.removeEditToolbar(),this.#ce){for(const t of this.#ce.values())clearTimeout(t);this.#ce=null}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#be(),this.#Qt.classList.remove("hidden"),Ia(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(t){if(this.isResizable&&t.target===this.div&&"Enter"===t.key){this._uiManager.setSelected(this),this.#Jt={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};var e=this.#Qt.children;if(!this.#Xt){this.#Xt=Array.from(e);var s=this.#Ce.bind(this),i=this.#ke.bind(this),r=this._uiManager._signal;for(const t of this.#Xt){var a=t.getAttribute("data-resizer-name");t.setAttribute("role","spinbutton"),t.addEventListener("keydown",s,{signal:r}),t.addEventListener("blur",i,{signal:r}),t.addEventListener("focus",this.#Ee.bind(this,a),{signal:r}),ja._l10nPromise.get("pdfjs-editor-resizer-label-"+a).then((e=>t.setAttribute("aria-label",e)))}}var n=this.#Xt[0];let h=0;for(const t of e){if(t===n)break;h++}var o=(360-this.rotation+this.parentRotation)%360/90*(this.#Xt.length/4);if(o!==h){if(o<h)for(let t=0;t<h-o;t++)this.#Qt.append(this.#Qt.firstChild);else if(o>h)for(let t=0;t<o-h;t++)this.#Qt.firstChild.before(this.#Qt.lastChild);let t=0;for(const s of e){var l=this.#Xt[t++].getAttribute("data-resizer-name");ja._l10nPromise.get("pdfjs-editor-resizer-label-"+l).then((t=>s.setAttribute("aria-label",t)))}}this.#Se(0),this.#oe=!0,this.#Qt.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}}#Ce(t){ja._resizerKeyboardManager.exec(this,t)}#ke(t){this.#oe&&t.relatedTarget?.parentNode!==this.#Qt&&this.#ge()}#Ee(t){this.#se=this.#oe?t:""}#Se(t){if(this.#Xt)for(const e of this.#Xt)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#oe&&this.#we(this.#se,{movementX:t,movementY:e})}#ge(){var t,e,s,i;this.#oe=!1,this.#Se(-1),this.#Jt&&(({savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#Jt),this.#xe(t,e,s,i),this.#Jt=null)}_stopResizingWithKeyboard(){this.#ge(),this.div.focus()}select(){this.makeResizable(),this.div?.classList.add("selectedEditor"),this.#ee?this.#ee?.show():this.addEditToolbar().then((()=>{this.div?.classList.contains("selectedEditor")&&this.#ee?.show()}))}unselect(){this.#Qt?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this.#ee?.hide()}updateParams(t,e){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#ae}set isEditing(t){this.#ae=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){this.#Yt=!0;var s=this.div.style;s.aspectRatio=t/e,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#ce||=new Map;const s=t.action;(e=this.#ce.get(s))&&clearTimeout(e),e=setTimeout((()=>{this._reportTelemetry(t),this.#ce.delete(s),0===this.#ce.size&&(this.#ce=null)}),ja._telemetryTimeout),this.#ce.set(s,e)}else t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#Kt=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#Kt=!0}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");var s;return e?"CANVAS"===e.nodeName&&(s=e,(e=document.createElement("div")).classList.add("annotationContent",this.editorType),s.before(e)):((e=document.createElement("div")).classList.add("annotationContent",this.editorType),t.container.prepend(e)),e}resetAnnotationElement(t){"DIV"===(t=t.container.firstChild).nodeName&&t.classList.contains("annotationContent")&&t.remove()}}class $a extends ja{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}const Ua=3285377520,qa=4294901760,Va=65535;class Ga{constructor(t){this.h1=t?4294967295&t:Ua,this.h2=t?4294967295&t:Ua}update(t){let e,s;if("string"==typeof t){e=new Uint8Array(2*t.length);for(let r=s=0,a=t.length;r<a;r++){var i=t.charCodeAt(r);i<=255?e[s++]=i:(e[s++]=i>>>8,e[s++]=255&i)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");e=t.slice(),s=e.byteLength}var r=s>>2,a=s-4*r,n=new Uint32Array(e.buffer,0,r);let o,l=0,h=this.h1,d=this.h2;var c=3432918353,u=461845907,p=11601,g=13715;for(let t=0;t<r;t++)1&t?(l=(l=(l=(l=n[t])*c&qa|l*p&Va)<<15|l>>>17)*u&qa|l*g&Va,h=5*(h=(h^=l)<<13|h>>>19)+3864292196):(o=(o=(o=(o=n[t])*c&qa|o*p&Va)<<15|o>>>17)*u&qa|o*g&Va,d=5*(d=(d^=o)<<13|d>>>19)+3864292196);switch(l=0,a){case 3:l^=e[4*r+2]<<16;case 2:l^=e[4*r+1]<<8;case 1:l=(l=(l=(l^=e[4*r])*c&qa|l*p&Va)<<15|l>>>17)*u&qa|l*g&Va,1&r?h^=l:d^=l}this.h1=h,this.h2=d}hexdigest(){var t=this.h1,e=this.h2;t=3981806797*(t^=e>>>1)&qa|36045*t&Va;return t=444984403*(t^=(e=4283543511*e&qa|(2950163797*(e<<16|t>>>16)&qa)>>>16)>>>1)&qa|60499*t&Va,((t^=(e=3301882366*e&qa|(3120437893*(e<<16|t>>>16)&qa)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const Wa=Object.freeze({map:null,hash:"",transfer:void 0});class Xa{#Te=!1;#Me=null;#Pe=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){return void 0===(t=this.#Pe.get(t))?e:Object.assign(e,t)}getRawValue(t){return this.#Pe.get(t)}remove(t){if(this.#Pe.delete(t),0===this.#Pe.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(const t of this.#Pe.values())if(t instanceof ja)return;this.onAnnotationEditor(null)}}setValue(t,e){var s=this.#Pe.get(t);let i=!1;if(void 0!==s)for(var[r,a]of Object.entries(e))s[r]!==a&&(i=!0,s[r]=a);else i=!0,this.#Pe.set(t,e);i&&this.#Le(),e instanceof ja&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}has(t){return this.#Pe.has(t)}getAll(){return 0<this.#Pe.size?jr(this.#Pe):null}setAll(t){for(var[e,s]of Object.entries(t))this.setValue(e,s)}get size(){return this.#Pe.size}#Le(){this.#Te||(this.#Te=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#Te&&(this.#Te=!1,"function"==typeof this.onResetModified)&&this.onResetModified()}get print(){return new Ka(this)}get serializable(){if(0===this.#Pe.size)return Wa;var t,e,s=new Map,i=new Ga,r=[],a=Object.create(null);let n=!1;for([t,e]of this.#Pe){var o=e instanceof ja?e.serialize(!1,a):e;o&&(s.set(t,o),i.update(t+":"+JSON.stringify(o)),n||=!!o.bitmap)}if(n)for(const t of s.values())t.bitmap&&r.push(t.bitmap);return 0<s.size?{map:s,hash:i.hexdigest(),transfer:r}:Wa}get editorStats(){let t=null;var e,s,i=new Map;for(const e of this.#Pe.values())if(e instanceof ja){var r=e.telemetryFinalData;if(r){var a,n,o=r.type,l=(i.has(o)||i.set(o,Object.getPrototypeOf(e).constructor),(t||=Object.create(null))[o]||=new Map);for([a,n]of Object.entries(r))if("type"!==a){let t=l.get(a);t||(t=new Map,l.set(a,t));var h=t.get(n)??0;t.set(n,h+1)}}}for([e,s]of i)t[e]=s.computeTelemetryFinalData(t[e]);return t}resetModifiedIds(){this.#Me=null}get modifiedIds(){if(this.#Me)return this.#Me;var t=[];for(const e of this.#Pe.values())e instanceof ja&&e.annotationElementId&&e.serialize()&&t.push(e.annotationElementId);return this.#Me={ids:new Set(t),hash:t.join(",")}}}class Ka extends Xa{#Re;constructor(t){super();var{map:t,hash:e,transfer:s}=t.serializable;t=structuredClone(t,s?{transfer:s}:null);this.#Re={map:t,hash:e,transfer:s}}get print(){Sr("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#Re}get modifiedIds(){return Pr(this,"modifiedIds",{ids:new Set,hash:""})}}class Ya{#Ie=new Set;constructor({ownerDocument:t=globalThis.document}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#Ie.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,_inspectFont:e}){if(t&&!this.#Ie.has(t.loadedName))if(Tr(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){var{loadedName:s,src:i,style:r}=t,i=new FontFace(s,i,r);this.addNativeFontFace(i);try{await i.load(),this.#Ie.add(s),e?.(t)}catch{Er(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(i)}}else Sr("Not implemented: loadSystemFont without the Font Loading API.")}async bind(t){if(!(t.attached||t.missingFile&&!t.systemFontInfo))if(t.attached=!0,t.systemFontInfo)await this.loadSystemFont(t);else if(this.isFontLoadingAPISupported){var e=t.createNativeFontFace();if(e){this.addNativeFontFace(e);try{await e.loaded}catch(s){throw Er(`Failed to load font '${e.family}': '${s}'.`),t.disableFontFace=!0,s}}}else(e=t.createFontFaceRule())&&(this.insertRule(e),this.isSyncFontLoadingSupported||await new Promise((e=>{e=this._queueLoadingCallback(e),this._prepareFontLoadEvent(t,e)})))}get isFontLoadingAPISupported(){return Pr(this,"isFontLoadingAPISupported",!!this._document?.fonts)}get isSyncFontLoadingSupported(){let t=!1;return Pr(this,"isSyncFontLoadingSupported",t=!!(Si||"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))||t)}_queueLoadingCallback(t){const e=this.loadingRequests,s={done:!1,complete:function(){for(Tr(!s.done,"completeRequest() cannot be called twice."),s.done=!0;0<e.length&&e[0].done;){var t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(s),s}get _loadTestFont(){return Pr(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}_prepareFontLoadEvent(t,e){function s(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function i(t,e,s,i){return t.substring(0,e)+i+t.substring(e+s)}let r,a;var n=this._document.createElement("canvas");n.width=1,n.height=1;const o=n.getContext("2d");let l=0;var h="lt"+Date.now()+this.loadTestFontId++,d=1482184792;let c=s(n=i(this._loadTestFont,976,h.length,h),16);for(r=0,a=h.length-3;r<a;r+=4)c=c-d+s(h,r)|0;n=i(n,16,4,function(t){return String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t)}(c=r<h.length?c-d+s(h+"XXX",r)|0:c)),n=`url(data:font/opentype;base64,${btoa(n)});`,this.insertRule(`@font-face {font-family:"${h}";src:${n}}`);const u=this._document.createElement("div");u.style.visibility="hidden",u.style.width=u.style.height="10px",u.style.position="absolute",u.style.top=u.style.left="0px";for(const e of[t.loadedName,h]){var p=this._document.createElement("span");p.textContent="Hi",p.style.fontFamily=e,u.append(p)}this._document.body.append(u),function t(e,s){30<++l?(Er("Load test font never loaded."),s()):(o.font="30px "+e,o.fillText(".",0,20),0<o.getImageData(0,0,1,1).data[3]?s():setTimeout(t.bind(null,e,s)))}(h,(()=>{u.remove(),e.complete()}))}}class Qa{constructor(t,{disableFontFace:e=!1,inspectFont:s=null}){this.compiledGlyphs=Object.create(null);for(const e in t)this[e]=t[e];this.disableFontFace=!0===e,this._inspectFont=s}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;var e;return t=this.cssFontInfo?(e={weight:this.cssFontInfo.fontWeight},this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),new FontFace(this.cssFontInfo.fontFamily,this.data,e)):new FontFace(this.loadedName,this.data,{}),this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;var t=zr(this.data);t=`url(data:${this.mimetype};base64,${btoa(t)});`;let e;if(this.cssFontInfo){let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}else e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];let s;try{s=t.get(this.loadedName+"_path_"+e)}catch(t){Er(`getPathGenerator - ignoring character: "${t}".`)}if(!Array.isArray(s)||0===s.length)return this.compiledGlyphs[e]=function(t,e){};const i=[];for(let t=0,e=s.length;t<e;)switch(s[t++]){case Kr:{const[e,r,a,n,o,l]=s.slice(t,t+6);i.push((t=>t.bezierCurveTo(e,r,a,n,o,l))),t+=6}break;case Yr:{const[e,r]=s.slice(t,t+2);i.push((t=>t.moveTo(e,r))),t+=2}break;case Qr:{const[e,r]=s.slice(t,t+2);i.push((t=>t.lineTo(e,r))),t+=2}break;case Jr:{const[e,r,a,n]=s.slice(t,t+4);i.push((t=>t.quadraticCurveTo(e,r,a,n))),t+=4}break;case Zr:i.push((t=>t.restore()));break;case ta:i.push((t=>t.save()));break;case ea:Tr(2===i.length,"Scale command is only valid at the third position.");break;case sa:{const[e,r,a,n,o,l]=s.slice(t,t+6);i.push((t=>t.transform(e,r,a,n,o,l))),t+=6}break;case ia:{const[e,r]=s.slice(t,t+2);i.push((t=>t.translate(e,r))),t+=2}}return this.compiledGlyphs[e]=function(t,e){i[0](t),i[1](t),t.scale(e,-e);for(let e=2,s=i.length;e<s;e++)i[e](t)}}}if(Si){var Ja=Promise.withResolvers(),Za=null;const t=async()=>{var t=await Promise.resolve().then((function(){return yh})),e=await Promise.resolve().then((function(){return yh})),s=await Promise.resolve().then((function(){return yh})),i=await Promise.resolve().then((function(){return yh}));return new Map(Object.entries({fs:t,http:e,https:s,url:i,canvas:void 0,path2d:void 0}))};t().then((t=>{Za=t,Ja.resolve()}),(t=>{Er("loadPackages: "+t),Za=new Map,Ja.resolve()}))}class tn{static get promise(){return Ja.promise}static get(t){return Za?.get(t)}}const en=function(t){return tn.get("fs").promises.readFile(t).then((t=>new Uint8Array(t)))};const sn="Fill",rn="Stroke",an="Shading";function nn(t,e){var s,i,r;e&&(s=e[2]-e[0],i=e[3]-e[1],(r=new Path2D).rect(e[0],e[1],s,i),t.clip(r))}class on{constructor(){this.constructor===on&&Sr("Cannot initialize BaseShadingPattern.")}getPattern(){Sr("Abstract method `getPattern` called.")}}class ln extends on{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const t of this._colorStops)e.addColorStop(t[0],t[1]);return e}getPattern(t,e,s,i){let r;var a,n;return i===rn||i===sn?(i=e.current.getClippedPathBoundingBox(i,Ta(t))||[0,0,0,0],a=Math.ceil(i[2]-i[0])||1,n=Math.ceil(i[3]-i[1])||1,(n=(a=e.cachedCanvases.getCanvas("pattern",a,n,!0)).context).clearRect(0,0,n.canvas.width,n.canvas.height),n.beginPath(),n.rect(0,0,n.canvas.width,n.canvas.height),n.translate(-i[0],-i[1]),s=qr.transform(s,[1,0,0,1,i[0],i[1]]),n.transform(...e.baseTransform),this.matrix&&n.transform(...this.matrix),nn(n,this._bbox),n.fillStyle=this._createGradient(n),n.fill(),r=t.createPattern(a.canvas,"no-repeat"),i=new DOMMatrix(s),r.setTransform(i)):(nn(t,this._bbox),r=this._createGradient(t)),r}}function hn(t,e,s,i,r,a,n,o){var l=e.coords,h=e.colors,d=t.data,c=4*t.width;let u;l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=a,a=n,n=u),l[i+1]>l[r+1]&&(u=i,i=r,r=u,u=n,n=o,o=u),l[s+1]>l[i+1]&&(u=s,s=i,i=u,u=a,a=n,n=u);var p=(l[s]+e.offsetX)*e.scaleX,g=(l[s+1]+e.offsetY)*e.scaleY,f=(l[i]+e.offsetX)*e.scaleX,m=(l[i+1]+e.offsetY)*e.scaleY,v=(l[r]+e.offsetX)*e.scaleX,b=(l[r+1]+e.offsetY)*e.scaleY;if(!(b<=g)){var y=h[a],w=h[a+1],x=h[a+2],A=h[n],_=h[n+1],C=h[n+2],k=h[o],E=h[o+1],S=h[o+2],T=(t=Math.round(g),Math.round(b));let e,s,i,r;for(let a=t;a<=T;a++){if(a<m){e=p-(p-f)*(I=a<g?0:(g-a)/(g-m)),s=y-(y-A)*I,i=w-(w-_)*I,r=x-(x-C)*I}else{let t;t=a>b?1:m==b?0:(m-a)/(m-b),e=f-(f-v)*t,s=A-(A-k)*t,i=_-(_-E)*t,r=C-(C-S)*t}let t;var M=p-(p-v)*(t=a<g?0:a>b?1:(g-a)/(g-b)),P=y-(y-k)*t,L=w-(w-E)*t,R=x-(x-S)*t,I=Math.round(Math.min(e,M)),D=Math.round(Math.max(e,M));let n=c*a+4*I;for(let a=I;a<=D;a++)(t=(e-a)/(e-M))<0?t=0:1<t&&(t=1),d[n++]=s-(s-P)*t|0,d[n++]=i-(i-L)*t|0,d[n++]=r-(r-R)*t|0,d[n++]=255}}}function dn(t,e,s){var i=e.coords,r=e.colors;let a,n;switch(e.type){case"lattice":var o=e.verticesPerRow,l=Math.floor(i.length/o)-1,h=o-1;for(a=0;a<l;a++){let e=a*o;for(let a=0;a<h;a++,e++)hn(t,s,i[e],i[e+1],i[e+o],r[e],r[e+1],r[e+o]),hn(t,s,i[e+o+1],i[e+1],i[e+o],r[e+o+1],r[e+1],r[e+o])}break;case"triangles":for(a=0,n=i.length;a<n;a+=3)hn(t,s,i[a],i[a+1],i[a+2],r[a],r[a+1],r[a+2]);break;default:throw new Error("illegal figure")}}class cn extends on{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[7],this._background=t[8],this.matrix=null}_createMeshCanvas(t,e,s){var i=Math.floor(this._bounds[0]),r=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-i,n=Math.ceil(this._bounds[3])-r,o=Math.min(Math.ceil(Math.abs(a*t[0]*1.1)),3e3),l=(a=a/o,n=n/(t=Math.min(Math.ceil(Math.abs(n*t[1]*1.1)),3e3)),{coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-r,scaleX:1/a,scaleY:1/n}),h=(s=s.getCanvas("mesh",o+4,t+4,!1)).context,d=h.createImageData(o,t);if(e){var c=d.data;for(let t=0,s=c.length;t<s;t+=4)c[t]=e[0],c[t+1]=e[1],c[t+2]=e[2],c[t+3]=255}for(const t of this._figures)dn(d,t,l);return h.putImageData(d,2,2),{canvas:s.canvas,offsetX:i-2*a,offsetY:r-2*n,scaleX:a,scaleY:n}}getPattern(t,e,s,i){let r;nn(t,this._bbox),i===an?r=qr.singularValueDecompose2dScale(Ta(t)):(r=qr.singularValueDecompose2dScale(e.baseTransform),this.matrix&&(a=qr.singularValueDecompose2dScale(this.matrix),r=[r[0]*a[0],r[1]*a[1]]));var a=this._createMeshCanvas(r,i===an?null:this._background,e.cachedCanvases);return i!==an&&(t.setTransform(...e.baseTransform),this.matrix)&&t.transform(...this.matrix),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class un extends on{getPattern(){return"hotpink"}}const pn=1,gn=2;class fn{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i,r){this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.color=e,this.ctx=s,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(t){var e=this.operatorList,s=this.bbox,i=this.xstep,r=this.ystep,a=this.paintType,n=this.tilingType,o=this.color,l=this.canvasGraphicsFactory,h=(n=(kr("TilingType: "+n),s[0]),s[1]),d=s[2],c=(s=s[3],qr.singularValueDecompose2dScale(this.matrix)),u=qr.singularValueDecompose2dScale(this.baseTransform);c=[c[0]*u[0],c[1]*u[1]],u=this.getSizeAndScale(i,this.ctx.canvas.width,c[0]),i=this.getSizeAndScale(r,this.ctx.canvas.height,c[1]),c=(r=t.cachedCanvases.getCanvas("pattern",u.size,i.size,!0)).context;(l=l.createCanvasGraphics(c)).groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(l,a,o);let p=n,g=h,f=d,m=s;return n<0&&(p=0,f+=Math.abs(n)),h<0&&(g=0,m+=Math.abs(h)),c.translate(-u.scale*p,-i.scale*g),l.transform(u.scale,0,0,i.scale,0,0),c.save(),this.clipBbox(l,p,g,f,m),l.baseTransform=Ta(l.ctx),l.executeOperatorList(e),l.endDrawing(),{canvas:r.canvas,scaleX:u.scale,scaleY:i.scale,offsetX:p,offsetY:g}}getSizeAndScale(t,e,s){t=Math.abs(t),e=Math.max(fn.MAX_PATTERN_SIZE,e);let i=Math.ceil(t*s);return i>=e?i=e:s=i/t,{scale:s,size:i}}clipBbox(t,e,s,i,r){t.ctx.rect(e,s,i-e,r-s),t.current.updateRectMinMax(Ta(t.ctx),[e,s,i,r]),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){var i=t.ctx,r=t.current;switch(e){case pn:var a=this.ctx;i.fillStyle=a.fillStyle,i.strokeStyle=a.strokeStyle,r.fillColor=a.fillStyle,r.strokeColor=a.strokeStyle;break;case gn:a=qr.makeHexColor(s[0],s[1],s[2]),i.fillStyle=a,i.strokeStyle=a,r.fillColor=a,r.strokeColor=a;break;default:throw new Nr("Unsupported paint type: "+e)}}getPattern(t,e,s,i){let r=s;i!==an&&(r=qr.transform(r,e.baseTransform),this.matrix)&&(r=qr.transform(r,this.matrix)),s=this.createPatternCanvas(e);let a=new DOMMatrix(r);return a=(a=a.translate(s.offsetX,s.offsetY)).scale(1/s.scaleX,1/s.scaleY),(i=t.createPattern(s.canvas,"repeat")).setTransform(a),i}}function mn({src:t,srcPos:e=0,dest:s,width:i,height:r,nonBlackColor:a=4294967295,inverseDecode:n=!1}){var o=$r.isLittleEndian?4278190080:255,[l,h]=n?[a,o]:[o,a],d=i>>3,c=7&i,u=t.length;s=new Uint32Array(s.buffer);let p=0;for(let i=0;i<r;i++){for(var g=e+d;e<g;e++){var f=e<u?t[e]:255;s[p++]=128&f?h:l,s[p++]=64&f?h:l,s[p++]=32&f?h:l,s[p++]=16&f?h:l,s[p++]=8&f?h:l,s[p++]=4&f?h:l,s[p++]=2&f?h:l,s[p++]=1&f?h:l}if(0!=c){var m=e<u?t[e++]:255;for(let t=0;t<c;t++)s[p++]=m&1<<7-t?h:l}}return{srcPos:e,destPos:p}}const vn=16;class bn{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return void 0!==this.cache[t]?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const e in this.cache){var t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function yn(t,e,s,i,r,a,n,o,l,h){var d,c,u,p,[g,f,m,v,b,y]=Ta(t);return 0===f&&0===m?(d=Math.round(n*g+b),c=Math.round(o*v+y),u=Math.abs(Math.round((n+l)*g+b)-d)||1,p=Math.abs(Math.round((o+h)*v+y)-c)||1,t.setTransform(Math.sign(g),0,0,Math.sign(v),d,c),t.drawImage(e,s,i,r,a,0,0,u,p),t.setTransform(g,f,m,v,b,y),[u,p]):0===g&&0===v?(d=Math.round(o*m+b),c=Math.round(n*f+y),u=Math.abs(Math.round((o+h)*m+b)-d)||1,p=Math.abs(Math.round((n+l)*f+y)-c)||1,t.setTransform(0,Math.sign(f),Math.sign(m),0,d,c),t.drawImage(e,s,i,r,a,0,0,p,u),t.setTransform(g,f,m,v,b,y),[p,u]):(t.drawImage(e,s,i,r,a,n,o,l,h),[Math.hypot(g,f)*l,Math.hypot(m,v)*h])}class wn{constructor(t,e){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=Ti,this.textMatrixScale=1,this.fontMatrix=Mi,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ui,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,t,e])}clone(){var t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}setCurrentPoint(t,e){this.x=t,this.y=e}updatePathMinMax(t,e,s){[e,s]=qr.applyTransform([e,s],t),this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(t,e){var s=qr.applyTransform(e,t),i=qr.applyTransform(e.slice(2),t),r=qr.applyTransform([e[0],e[3]],t);e=qr.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,s[0],i[0],r[0],e[0]),this.minY=Math.min(this.minY,s[1],i[1],r[1],e[1]),this.maxX=Math.max(this.maxX,s[0],i[0],r[0],e[0]),this.maxY=Math.max(this.maxY,s[1],i[1],r[1],e[1])}updateScalingPathMinMax(t,e){qr.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}updateCurvePathMinMax(t,e,s,i,r,a,n,o,l,h){e=qr.bezierBoundingBox(e,s,i,r,a,n,o,l,h),h||this.updateRectMinMax(t,e)}getPathBoundingBox(t=sn,e=null){var s=[this.minX,this.minY,this.maxX,this.maxY];return t===rn&&(e||Sr("Stroke bounding box must include transform."),e=(t=qr.singularValueDecompose2dScale(e))[0]*this.lineWidth/2,t=t[1]*this.lineWidth/2,s[0]-=e,s[1]-=t,s[2]+=e,s[3]+=t),s}updateClipFromPath(){var t=qr.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(t=sn,e=null){return qr.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function xn(t,e){if("undefined"!=typeof ImageData&&e instanceof ImageData)t.putImageData(e,0,0);else{var s=e.height,i=e.width,r=s%vn,a=(s-r)/vn,n=0==r?a:1+a,o=t.createImageData(i,vn);let y,w=0;var l=e.data,h=o.data;let x,A,_,C;if(e.kind===Ki.GRAYSCALE_1BPP){var d=l.byteLength,c=new Uint32Array(h.buffer,0,h.byteLength>>2),u=c.length,p=i+7>>3,g=4294967295,f=$r.isLittleEndian?4278190080:255;for(x=0;x<n;x++){for(_=x<a?vn:r,y=0,A=0;A<_;A++){var m=d-w;let t=0;var v=p<m?i:8*m-7,b=-8&v;let e=0,s=0;for(;t<b;t+=8)s=l[w++],c[y++]=128&s?g:f,c[y++]=64&s?g:f,c[y++]=32&s?g:f,c[y++]=16&s?g:f,c[y++]=8&s?g:f,c[y++]=4&s?g:f,c[y++]=2&s?g:f,c[y++]=1&s?g:f;for(;t<v;t++)0===e&&(s=l[w++],e=128),c[y++]=s&e?g:f,e>>=1}for(;y<u;)c[y++]=0;t.putImageData(o,0,x*vn)}}else if(e.kind===Ki.RGBA_32BPP){for(A=0,C=i*vn*4,x=0;x<a;x++)h.set(l.subarray(w,w+C)),w+=C,t.putImageData(o,0,A),A+=vn;x<n&&(C=i*r*4,h.set(l.subarray(w,w+C)),t.putImageData(o,0,A))}else{if(e.kind!==Ki.RGB_24BPP)throw new Error("bad image kind: "+e.kind);for(_=vn,C=i*_,x=0;x<n;x++){for(x>=a&&(_=r,C=i*_),y=0,A=C;A--;)h[y++]=l[w++],h[y++]=l[w++],h[y++]=l[w++],h[y++]=255;t.putImageData(o,0,x*vn)}}}}function An(t,e){if(e.bitmap)t.drawImage(e.bitmap,0,0);else{var s=e.height,i=e.width,r=s%vn,a=(s-r)/vn,n=0==r?a:1+a,o=t.createImageData(i,vn);let c=0;var l=e.data,h=o.data;for(let e=0;e<n;e++){var d=e<a?vn:r;({srcPos:c}=mn({src:l,srcPos:c,dest:h,width:i,height:d,nonBlackColor:0})),t.putImageData(o,0,e*vn)}}}function _n(t,e){for(const s of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==t[s]&&(e[s]=t[s]);void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function Cn(t){var e;t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0),Si||"none"!==(e=t.filter)&&""!==e&&(t.filter="none")}function kn(t,e){return!!e||((e=qr.singularValueDecompose2dScale(t))[0]=Math.fround(e[0]),e[1]=Math.fround(e[1]),t=Math.fround((globalThis.devicePixelRatio||1)*da.PDF_TO_CSS_UNITS),e[0]<=t&&e[1]<=t)}const En=["butt","round","square"],Sn=["miter","round","bevel"],Tn={},Mn={};class Pn{constructor(t,e,s,i,r,{optionalContentConfig:a,markedContentStack:n=null},o,l){this.ctx=t,this.current=new wn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=n||[],this.optionalContentConfig=a,this.cachedCanvases=new bn(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return"string"==typeof t?(t.startsWith("g_")?this.commonObjs:this.objs).get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){var r=this.ctx.canvas.width,a=this.ctx.canvas.height,n=this.ctx.fillStyle;this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,a),this.ctx.fillStyle=n,s&&(i=this.cachedCanvases.getCanvas("transparent",r,a),this.compositeCtx=this.ctx,this.transparentCanvas=i.canvas,this.ctx=i.context,this.ctx.save(),this.ctx.transform(...Ta(this.compositeCtx))),this.ctx.save(),Cn(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=Ta(this.ctx)}executeOperatorList(t,e,s,i){var r=t.argsArray,a=t.fnArray;let n=e||0;var o=r.length;if(o===n)return n;var l=o-n>10&&"function"==typeof s,h=l?Date.now()+15:0;let d=0;for(var c,u=this.commonObjs,p=this.objs;;){if(void 0!==i&&n===i.nextBreakPoint)return i.breakIt(n,s),n;if((c=a[n])!==xr.dependency)this[c].apply(this,r[n]);else for(const t of r[n]){var g=t.startsWith("g_")?u:p;if(!g.has(t))return g.get(t,s),n}if(++n===o)return n;if(l&&++d>10){if(Date.now()>h)return s(),n;d=0}}}#De(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#De(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#Fe()}#Fe(){var t,e;this.pageColors&&"none"!==(t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background))&&(e=this.ctx.filter,this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e)}_scaleImage(t,e){var s,i,r=t.width,a=t.height;let n=Math.max(Math.hypot(e[0],e[1]),1),o=Math.max(Math.hypot(e[2],e[3]),1),l=r,h=a,d="prescale1";for(;2<n&&1<l||2<o&&1<h;){let e=l,r=h;2<n&&1<l&&(e=16384<=l?Math.floor(l/2)-1||1:Math.ceil(l/2),n/=l/e),2<o&&1<h&&(r=16384<=h?Math.floor(h/2)-1||1:Math.ceil(h)/2,o/=h/r),(i=(s=this.cachedCanvases.getCanvas(d,e,r)).context).clearRect(0,0,e,r),i.drawImage(t,0,0,l,h,0,0,e,r),t=s.canvas,l=e,h=r,d="prescale1"===d?"prescale2":"prescale1"}return{img:t,paintWidth:l,paintHeight:h}}_createMaskCanvas(t){var e=this.ctx,{width:s,height:i}=t,r=this.current.fillColor,a=this.current.patternFill,n=Ta(e);let o,l,h,d;if((t.bitmap||t.data)&&1<t.count){var c=t.bitmap||t.data.buffer;if((c=(l=JSON.stringify(a?n:[n.slice(0,4),r]),(o=this._cachedBitmapsMap.get(c))||(o=new Map,this._cachedBitmapsMap.set(c,o)),o.get(l)))&&!a){return{canvas:c,offsetX:Math.round(Math.min(n[0],n[2])+n[4]),offsetY:Math.round(Math.min(n[1],n[3])+n[5])}}h=c}h||An((d=this.cachedCanvases.getCanvas("maskCanvas",s,i)).context,t);c=qr.transform(n,[1/s,0,0,-1/i,0,0]),c=qr.transform(c,[1,0,0,1,0,-i]);var u,p,[n,g,u,p]=qr.getAxialAlignedBoundingBox([0,0,s,i],c);u=Math.round(u-n)||1,p=Math.round(p-g)||1;const f=n,m=g;return(p=(u=this.cachedCanvases.getCanvas("fillCanvas",u,p)).context).translate(-f,-m),p.transform(...c),h||(h=(h=this._scaleImage(d.canvas,Ma(p))).img,o&&a&&o.set(l,h)),p.imageSmoothingEnabled=kn(Ta(p),t.interpolate),yn(p,h,0,0,h.width,h.height,0,0,s,i),p.globalCompositeOperation="source-in",n=qr.transform(Ma(p),[1,0,0,1,-f,-m]),p.fillStyle=a?r.getPattern(e,this,n,sn):r,p.fillRect(0,0,s,i),o&&!a&&(this.cachedCanvases.delete("fillCanvas"),o.set(l,u.canvas)),{canvas:u.canvas,offsetX:Math.round(f),offsetY:Math.round(m)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=En[t]}setLineJoin(t){this.ctx.lineJoin=Sn[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){var s=this.ctx;void 0!==s.setLineDash&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(var[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){var t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel;s=this.cachedCanvases.getCanvas(s,t,e);(t=(this.suspendedCtx=this.ctx,this.ctx=s.context,this.ctx)).setTransform(...Ta(this.suspendedCtx)),_n(this.suspendedCtx,t),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=()=>{t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},t.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},t.transform=function(t,s,i,r,a,n){e.transform(t,s,i,r,a,n),this.__originalTransform(t,s,i,r,a,n)},t.setTransform=function(t,s,i,r,a,n){e.setTransform(t,s,i,r,a,n),this.__originalSetTransform(t,s,i,r,a,n)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},t.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},t.bezierCurveTo=function(t,s,i,r,a,n){e.bezierCurveTo(t,s,i,r,a,n),this.__originalBezierCurveTo(t,s,i,r,a,n)},t.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(t,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),_n(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){var e,s;this.current.activeSMask&&(t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height],e=this.current.activeSMask,s=this.suspendedCtx,this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore())}composeSMask(t,e,s,i){var r=i[0],a=i[1],n=i[2]-r;i=i[3]-a;0!=n&&0!=i&&(this.genericComposeSMask(e.context,s,n,i,e.subtype,e.backdrop,e.transferMap,r,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,r,a,n,o,l,h,d){let c=t.canvas,u=o-h,p=l-d;if(a)if(u<0||p<0||u+s>c.width||p+i>c.height)(d=(h=this.cachedCanvases.getCanvas("maskExtension",s,i)).context).drawImage(c,-u,-p),a.some((t=>0!==t))&&(d.globalCompositeOperation="destination-atop",d.fillStyle=qr.makeHexColor(...a),d.fillRect(0,0,s,i),d.globalCompositeOperation="source-over"),c=h.canvas,u=p=0;else if(a.some((t=>0!==t))){t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const e=new Path2D;e.rect(u,p,s,i),t.clip(e),t.globalCompositeOperation="destination-atop",t.fillStyle=qr.makeHexColor(...a),t.fillRect(u,p,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===r&&n?e.filter=this.filterFactory.addAlphaFilter(n):"Luminosity"===r&&(e.filter=this.filterFactory.addLuminosityFilter(n));const g=new Path2D;g.rect(o,l,s,i),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(c,u,p,s,i,o,l,s,i),e.restore()}save(){(this.inSMaskMode?(_n(this.ctx,this.suspendedCtx),this.suspendedCtx):this.ctx).save();var t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),_n(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(t,e,s,i,r,a){this.ctx.transform(t,e,s,i,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){var i=this.ctx,r=this.current;let a,n,o=r.x,l=r.y;var h=Ta(i),d=0===h[0]&&0===h[3]||0===h[1]&&0===h[2],c=d?s.slice(0):null;for(let s=0,m=0,v=t.length;s<v;s++)switch(0|t[s]){case xr.rectangle:o=e[m++],l=e[m++];var u=e[m++],p=e[m++],g=o+u,f=l+p;i.moveTo(o,l),0===u||0===p?i.lineTo(g,f):(i.lineTo(g,l),i.lineTo(g,f),i.lineTo(o,f)),d||r.updateRectMinMax(h,[o,l,g,f]),i.closePath();break;case xr.moveTo:o=e[m++],l=e[m++],i.moveTo(o,l),d||r.updatePathMinMax(h,o,l);break;case xr.lineTo:o=e[m++],l=e[m++],i.lineTo(o,l),d||r.updatePathMinMax(h,o,l);break;case xr.curveTo:a=o,n=l,o=e[m+4],l=e[m+5],i.bezierCurveTo(e[m],e[m+1],e[m+2],e[m+3],o,l),r.updateCurvePathMinMax(h,a,n,e[m],e[m+1],e[m+2],e[m+3],o,l,c),m+=6;break;case xr.curveTo2:a=o,n=l,i.bezierCurveTo(o,l,e[m],e[m+1],e[m+2],e[m+3]),r.updateCurvePathMinMax(h,a,n,o,l,e[m],e[m+1],e[m+2],e[m+3],c),o=e[m+2],l=e[m+3],m+=4;break;case xr.curveTo3:a=o,n=l,o=e[m+2],l=e[m+3],i.bezierCurveTo(e[m],e[m+1],o,l,o,l),r.updateCurvePathMinMax(h,a,n,e[m],e[m+1],o,l,o,l,c),m+=4;break;case xr.closePath:i.closePath()}d&&r.updateScalingPathMinMax(h,c),r.setCurrentPoint(o,l)}closePath(){this.ctx.closePath()}stroke(t=!0){var e=this.ctx,s=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof s&&s?.getPattern?(e.save(),e.strokeStyle=s.getPattern(e,this,Ma(e),rn),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(t=!0){var e=this.ctx,s=this.current.fillColor;let i=!1;this.current.patternFill&&(e.save(),e.fillStyle=s.getPattern(e,this,Ma(e),sn),i=!0),s=this.current.getClippedPathBoundingBox(),this.contentVisible&&null!==s&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),i&&e.restore(),t&&this.consumePath(s)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Tn}eoClip(){this.pendingClip=Mn}beginText(){this.current.textMatrix=Ti,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){var t=this.pendingTextPaths,e=this.ctx;if(void 0===t)e.beginPath();else{e.save(),e.beginPath();for(const s of t)e.setTransform(...s.transform),e.translate(s.x,s.y),s.addToPath(e,s.fontSize);e.restore(),e.clip(),e.beginPath(),delete this.pendingTextPaths}}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var s=this.commonObjs.get(t),i=this.current;if(!s)throw new Error("Can't find font for "+t);if(i.fontMatrix=s.fontMatrix||Mi,0!==i.fontMatrix[0]&&0!==i.fontMatrix[3]||Er("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=e,!s.isType3Font){t=s.loadedName||"sans-serif",i=s.systemFontInfo?.css||`"${t}", `+s.fallbackName;let r="normal";s.black?r="900":s.bold&&(r="bold"),t=s.italic?"italic":"normal";let a=e;e<16?a=16:e>100&&(a=100),this.current.fontSizeScale=e/a,this.ctx.font=t+` ${r} ${a}px `+i}}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t,e,s,i,r,a){this.current.textMatrix=[t,e,s,i,r,a],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,i){var r=this.ctx,a=(h=this.current).font,n=h.textRenderingMode,o=h.fontSize/h.fontSizeScale,l=n&Wi,h=(n=!!(n&Xi),h.patternFill&&!a.missingFile);let d;(a.disableFontFace||n||h)&&(d=a.getPathGenerator(this.commonObjs,t)),a.disableFontFace||h?(r.save(),r.translate(e,s),r.beginPath(),d(r,o),i&&r.setTransform(...i),l!==Ui&&l!==Vi||r.fill(),l!==qi&&l!==Vi||r.stroke(),r.restore()):(l!==Ui&&l!==Vi||r.fillText(t,e,s),l!==qi&&l!==Vi||r.strokeText(t,e,s)),n&&(this.pendingTextPaths||=[]).push({transform:Ta(r),x:e,y:s,fontSize:o,addToPath:d})}get isFontSubpixelAAEnabled(){var t=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10).context,e=(t.scale(1.5,1),t.fillText("I",0,10),t.getImageData(0,0,10,10).data);let s=!1;for(let t=3;t<e.length;t+=4)if(0<e[t]&&e[t]<255){s=!0;break}return Pr(this,"isFontSubpixelAAEnabled",s)}showText(t){var e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);var i=e.fontSize;if(0!==i){var r=this.ctx,a=e.fontSizeScale,n=e.charSpacing,o=e.wordSpacing,l=e.fontDirection,h=e.textHScale*l,d=t.length,c=s.vertical,u=c?1:-1,p=s.defaultVMetrics,g=i*e.fontMatrix[0],f=e.textRenderingMode===Ui&&!s.disableFontFace&&!e.patternFill;r.save(),r.transform(...e.textMatrix),r.translate(e.x,e.y+e.textRise),0<l?r.scale(h,-1):r.scale(h,1);let E,S=(e.patternFill&&(r.save(),v=e.fillColor.getPattern(r,this,Ma(r),sn),E=Ta(r),r.restore(),r.fillStyle=v),e.lineWidth);var m,v=e.textMatrixScale;if(0===v||0===S?(m=e.textRenderingMode&Wi)!==qi&&m!==Vi||(S=this.getSinglePixelWidth()):S/=v,1!==a&&(r.scale(a,a),S/=a),r.lineWidth=S,s.isInvalidPDFjsFont){var b=[];let s=0;for(const e of t)b.push(e.unicode),s+=e.width;r.fillText(b.join(""),0,0),e.x+=s*g*h,r.restore(),this.compose()}else{let m,v=0;for(m=0;m<d;++m){var y=t[m];if("number"==typeof y)v+=u*y*i/1e3;else{let t=!1;var w,x,A,_=(y.isSpace?o:0)+n,C=y.fontChar,k=y.accent;let e,h,d=y.width;h=c?(w=y.vmetric||p,x=-(y.vmetric?w[1]:.5*d)*g,A=w[2]*g,d=w?-w[0]:d,e=x/a,(v+A)/a):(e=v/a,0),s.remeasure&&0<d&&(d<(w=1e3*r.measureText(C).width/i*a)&&this.isFontSubpixelAAEnabled?(x=d/w,t=!0,r.save(),r.scale(x,1),e/=x):d!==w&&(e+=(d-w)/2e3*i/a)),this.contentVisible&&(y.isInFont||s.missingFile)&&(f&&!k?r.fillText(C,e,h):(this.paintChar(C,e,h,E),k&&(A=e+i*k.offset.x/a,y=h-i*k.offset.y/a,this.paintChar(k.fontChar,A,y,E)))),v+=C=c?d*g-_*l:d*g+_*l,t&&r.restore()}}c?e.y-=v:e.x+=v*h,r.restore(),this.compose()}}}showType3Text(t){var e,s,i=this.ctx,r=this.current,a=r.font,n=r.fontSize,o=r.fontDirection,l=a.vertical?1:-1,h=r.charSpacing,d=r.wordSpacing,c=r.textHScale*o,u=r.fontMatrix||Mi,p=t.length;let g,f,m,v;if(!(r.textRenderingMode===Gi)&&0!==n){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),i.transform(...r.textMatrix),i.translate(r.x,r.y),i.scale(c,o),g=0;g<p;++g)"number"==typeof(f=t[g])?(this.ctx.translate(v=l*f*n/1e3,0),r.x+=v*c):(e=(f.isSpace?d:0)+h,(s=a.charProcOperatorList[f.operatorListId])?(this.contentVisible&&(this.processingType3=f,this.save(),i.scale(n,n),i.transform(...u),this.executeOperatorList(s),this.restore()),m=qr.applyTransform([f.width,0],u)[0]*n+e,i.translate(m,0),r.x+=m*c):Er(`Type3 character "${f.operatorListId}" is not available.`));i.restore(),this.processingType3=null}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,r,a){this.ctx.rect(s,i,r-s,a-i),this.ctx.clip(),this.endPath()}getColorN_Pattern(t){var e,s,i;return"TilingPattern"===t[0]?(e=t[1],s=this.baseTransform||Ta(this.ctx),i={createCanvasGraphics:t=>new Pn(t,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})},new fn(t,e,this.ctx,i,s)):this._getPattern(t[1],t[2])}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t,e,s){this.ctx.strokeStyle=this.current.strokeColor=qr.makeHexColor(t,e,s)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(t,e,s){this.ctx.fillStyle=this.current.fillColor=qr.makeHexColor(t,e,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=function(t){switch(t[0]){case"RadialAxial":return new ln(t);case"Mesh":return new cn(t);case"Dummy":return new un}throw new Error("Unknown IR type: "+t[0])}(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){var e,s,i;this.contentVisible&&(e=this.ctx,this.save(),t=this._getPattern(t),e.fillStyle=t.getPattern(e,this,Ma(e),an),(t=Ma(e))?(({width:e,height:s}=e.canvas),[e,s,t,i]=qr.getAxialAlignedBoundingBox([0,0,e,s],t),this.ctx.fillRect(e,s,t-e,i-s)):this.ctx.fillRect(-1e10,-1e10,2e10,2e10),this.compose(this.current.getClippedPathBoundingBox()),this.restore())}beginInlineImage(){Sr("Should not call beginInlineImage")}beginImageData(){Sr("Should not call beginImageData")}paintFormXObjectBegin(t,e){var s;this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=Ta(this.ctx),e)&&(t=e[2]-e[0],s=e[3]-e[1],this.ctx.rect(e[0],e[1],t,s),this.current.updateRectMinMax(Ta(this.ctx),e),this.clip(),this.endPath())}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var e=this.ctx,s=(t.isolated||kr("TODO: Support non-isolated groups."),t.knockout&&Er("Knockout groups not supported."),Ta(e));if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");var i=qr.getAxialAlignedBoundingBox(t.bbox,Ta(e)),r=[0,0,e.canvas.width,e.canvas.height],a=(i=qr.intersect(i,r)||[0,0,0,0],r=Math.floor(i[0]),Math.floor(i[1])),n=Math.max(Math.ceil(i[2])-r,1);i=Math.max(Math.ceil(i[3])-a,1);this.current.startNewPathAndClipBox([0,0,n,i]);let o="groupAt"+this.groupLevel;t.smask&&(o+="_smask_"+this.smaskCounter++%2),(i=(n=this.cachedCanvases.getCanvas(o,n,i)).context).translate(-r,-a),i.transform(...s),t.smask?this.smaskStack.push({canvas:n.canvas,context:i,offsetX:r,offsetY:a,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,a),e.save()),_n(e,i),this.ctx=i,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}}endGroup(t){var e,s;this.contentVisible&&(this.groupLevel--,e=this.ctx,s=this.groupStack.pop(),this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask?(this.tempSMask=this.smaskStack.pop(),this.restore()):(this.ctx.restore(),s=Ta(this.ctx),this.restore(),this.ctx.save(),this.ctx.setTransform(...s),t=qr.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],s),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(t)))}beginAnnotation(t,e,s,i,r){var a,n,o,l,h;this.#De(),Cn(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e&&(a=e[2]-e[0],n=e[3]-e[1],r&&this.annotationCanvasMap?((s=s.slice())[4]-=e[0],s[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=a,e[3]=n,[r,o]=qr.singularValueDecompose2dScale(Ta(this.ctx)),h=this.viewportScale,l=Math.ceil(a*this.outputScaleX*h),h=Math.ceil(n*this.outputScaleY*h),({canvas:l,context:h}=(this.annotationCanvas=this.canvasFactory.create(l,h),this.annotationCanvas)),this.annotationCanvasMap.set(t,l),this.annotationCanvas.savedCtx=this.ctx,this.ctx=h,this.ctx.save(),this.ctx.setTransform(r,0,0,-o,0,n*o),Cn(this.ctx)):(Cn(this.ctx),this.ctx.rect(e[0],e[1],a,n),this.ctx.clip(),this.endPath())),this.current=new wn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#Fe(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){var e,s;this.contentVisible&&(e=t.count,(t=this.getObject(t.data,t)).count=e,e=this.ctx,(s=this.processingType3)&&(void 0===s.compiled&&(s.compiled=function(t){const{width:e,height:s}=t;if(e>1e3||s>1e3)return null;var i=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=e+1;let a,n,o,l=new Uint8Array(r*(s+1));var h=e+7&-8;let d=new Uint8Array(h*s),c=0;for(const e of t.data){let t=128;for(;0<t;)d[c++]=e&t?0:255,t>>=1}let u=0;for((c=0)!==d[c]&&(l[0]=1,++u),n=1;n<e;n++)d[c]!==d[c+1]&&(l[n]=d[c]?2:1,++u),c++;for(0!==d[c]&&(l[n]=2,++u),a=1;a<s;a++){c=a*h,o=a*r,d[c-h]!==d[c]&&(l[o]=d[c]?1:8,++u);let t=(d[c]?4:0)+(d[c-h]?8:0);for(n=1;n<e;n++)i[t=(t>>2)+(d[c+1]?4:0)+(d[c-h+1]?8:0)]&&(l[o+n]=i[t],++u),c++;if(d[c-h]!==d[c]&&(l[o+n]=d[c]?2:4,++u),1e3<u)return null}for(c=h*(s-1),o=a*r,0!==d[c]&&(l[o]=8,++u),n=1;n<e;n++)d[c]!==d[c+1]&&(l[o+n]=d[c]?4:8,++u),c++;if(0!==d[c]&&(l[o+n]=4,++u),1e3<u)return null;var p=new Int32Array([0,r,-1,0,-r,0,0,0,1]);const g=new Path2D;for(a=0;u&&a<=s;a++){let t=a*r;for(var f=t+e;t<f&&!l[t];)t++;if(t!==f){g.moveTo(t%r,a);var m=t;let e=l[t];do{for(var v=p[e];t+=v,!l[t];);var b=l[t];5!==b&&10!==b?(e=b,l[t]=0):(e=b&51*e>>4,l[t]&=e>>2|e<<2),g.lineTo(t%r,t/r|0),l[t]||--u}while(m!==t);--a}}return d=null,l=null,function(t){t.save(),t.scale(1/e,-1/s),t.translate(0,-s),t.fill(g),t.beginPath(),t.restore()}}(t)),s.compiled)?s.compiled(e):(t=(s=this._createMaskCanvas(t)).canvas,e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(t,s.offsetX,s.offsetY),e.restore(),this.compose()))}paintImageMaskXObjectRepeat(t,e,s=0,i=0,r,a){if(this.contentVisible){t=this.getObject(t.data,t);var n=this.ctx,o=(n.save(),Ta(n)),l=(n.transform(e,s,i,r,0,0),this._createMaskCanvas(t));n.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(let t=0,c=a.length;t<c;t+=2){var h=qr.transform(o,[e,s,i,r,a[t],a[t+1]]),[h,d]=qr.applyTransform([0,0],h);n.drawImage(l.canvas,h,d)}n.restore(),this.compose()}}paintImageMaskXObjectGroup(t){if(this.contentVisible){var e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const d of t){var{data:r,width:a,height:n,transform:o}=d,l=this.cachedCanvases.getCanvas("maskCanvas",a,n),h=l.context,r=(h.save(),this.getObject(r,d));An(h,r),h.globalCompositeOperation="source-in",h.fillStyle=i?s.getPattern(h,this,Ma(e),sn):s,h.fillRect(0,0,a,n),h.restore(),e.save(),e.transform(...o),e.scale(1,-1),yn(e,l.canvas,0,0,a,n,0,-1,1,1),e.restore()}this.compose()}}paintImageXObject(t){this.contentVisible&&((t=this.getObject(t))?this.paintInlineImageXObject(t):Er("Dependent image isn't ready yet"))}paintImageXObjectRepeat(t,e,s,i){if(this.contentVisible)if(t=this.getObject(t)){var r=t.width,a=t.height,n=[];for(let t=0,o=i.length;t<o;t+=2)n.push({transform:[e,0,0,s,i[t],i[t+1]],x:0,y:0,w:r,h:a});this.paintInlineImageXObjectGroup(t,n)}else Er("Dependent image isn't ready yet")}applyTransferMapsToCanvas(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){var e,s;return"none"===this.current.transferMaps?t.bitmap:(({bitmap:t,width:e,height:s}=t),(s=(e=this.cachedCanvases.getCanvas("inlineImage",e,s)).context).filter=this.current.transferMaps,s.drawImage(t,0,0),s.filter="none",e.canvas)}paintInlineImageXObject(t){if(this.contentVisible){var e=t.width,s=t.height,i=this.ctx;let a;this.save(),Si||"none"!==(r=i.filter)&&""!==r&&(i.filter="none"),i.scale(1/e,-1/s),a=t.bitmap?this.applyTransferMapsToBitmap(t):"function"==typeof HTMLElement&&t instanceof HTMLElement||!t.data?t:(xn(r=this.cachedCanvases.getCanvas("inlineImage",e,s).context,t),this.applyTransferMapsToCanvas(r));var r=this._scaleImage(a,Ma(i));i.imageSmoothingEnabled=kn(Ta(i),t.interpolate),yn(i,r.img,0,0,r.paintWidth,r.paintHeight,0,-s,e,s),this.compose(),this.restore()}}paintInlineImageXObjectGroup(t,e){if(this.contentVisible){var s,i,r=this.ctx;let a;a=t.bitmap||(i=t.width,s=t.height,xn(i=this.cachedCanvases.getCanvas("inlineImage",i,s).context,t),this.applyTransferMapsToCanvas(i));for(const t of e)r.save(),r.transform(...t.transform),r.scale(1,-1),yn(r,a,t.x,t.y,t.w,t.h,0,-1,1,1),r.restore();this.compose()}}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t){var e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t),t=this.ctx;this.pendingClip&&(e||(this.pendingClip===Mn?t.clip("evenodd"):t.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),t.beginPath()}getSinglePixelWidth(){var t,e,s;return this._cachedGetSinglePixelWidth||(0===(s=Ta(this.ctx))[1]&&0===s[2]?this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(s[0]),Math.abs(s[3])):(t=Math.abs(s[0]*s[3]-s[2]*s[1]),e=Math.hypot(s[0],s[2]),s=Math.hypot(s[1],s[3]),this._cachedGetSinglePixelWidth=Math.max(e,s)/t)),this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){var t,e,s,i=this.current.lineWidth,{a:r,b:a,c:n,d:o}=this.ctx.getTransform();let l,h;0===a&&0===n?(s=Math.abs(r))===(t=Math.abs(o))?l=h=0===i?1/s:(e=s*i)<1?1/e:1:h=0===i?(l=1/s,1/t):(l=(e=s*i)<1?1/e:1,(s=t*i)<1?1/s:1):(t=Math.abs(r*o-a*n),e=Math.hypot(r,a),s=Math.hypot(n,o),h=0===i?(l=s/t,e/t):(l=(r=i*t)<s?s/r:1,r<e?e/r:1)),this._cachedScaleForStroking[0]=l,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t){var e=this.ctx,s=this.current.lineWidth,[i,r]=this.getScaleForStroking();if(e.lineWidth=s||1,1===i&&1===r)e.stroke();else{if(s=e.getLineDash(),t&&e.save(),e.scale(i,r),0<s.length){const t=Math.max(i,r);e.setLineDash(s.map((e=>e/t))),e.lineDashOffset/=t}e.stroke(),t&&e.restore()}}isContentVisible(){for(let t=this.markedContentStack.length-1;0<=t;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const t in xr)void 0!==Pn.prototype[t]&&(Pn.prototype[xr[t]]=Pn.prototype[t]);class Ln{static#Oe=null;static#Ne="";static get workerPort(){return this.#Oe}static set workerPort(t){if(!("undefined"!=typeof Worker&&t instanceof Worker)&&null!==t)throw new Error("Invalid `workerPort` type.");this.#Oe=t}static get workerSrc(){return this.#Ne}static set workerSrc(t){if("string"!=typeof t)throw new Error("Invalid `workerSrc` type.");this.#Ne=t}}const Rn=1,In=2,Dn=1,Fn=2,On=3,Nn=4,Bn=5,zn=6,Hn=7,jn=8;function $n(t){switch(t instanceof Error||"object"==typeof t&&null!==t||Sr('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new Br(t.message);case"MissingPDFException":return new Fr(t.message);case"PasswordException":return new Rr(t.message,t.code);case"UnexpectedResponseException":return new Or(t.message,t.status);case"UnknownErrorException":return new Ir(t.message,t.details);default:return new Ir(t.message,t.toString())}}class Un{constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=t=>{const e=t.data;if(e.targetName===this.sourceName)if(e.stream)this.#Be(e);else if(e.callback){t=e.callbackId;var i=this.callbackCapabilities[t];if(!i)throw new Error("Cannot resolve callback "+t);if(delete this.callbackCapabilities[t],e.callback===Rn)i.resolve(e.data);else{if(e.callback!==In)throw new Error("Unexpected callback case");i.reject($n(e.reason))}}else{const t=this.actionHandler[e.action];if(!t)throw new Error("Unknown action from worker: "+e.action);if(e.callbackId){const i=this.sourceName,r=e.sourceName;new Promise((function(s){s(t(e.data))})).then((function(t){s.postMessage({sourceName:i,targetName:r,callback:Rn,callbackId:e.callbackId,data:t})}),(function(t){s.postMessage({sourceName:i,targetName:r,callback:In,callbackId:e.callbackId,reason:$n(t)})}))}else e.streamId?this.#ze(e):t(e.data)}},s.addEventListener("message",this._onComObjOnMessage)}on(t,e){var s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){var i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(t){r.reject(t)}return r.promise}sendWithStream(t,e,s,i){const r=this.streamId++,a=this.sourceName,n=this.targetName,o=this.comObj;return new ReadableStream({start:s=>{var l=Promise.withResolvers();return this.streamControllers[r]={controller:s,startCall:l,pullCall:null,cancelCall:null,isClosed:!1},o.postMessage({sourceName:a,targetName:n,action:t,streamId:r,data:e,desiredSize:s.desiredSize},i),l.promise},pull:t=>{var e=Promise.withResolvers();return this.streamControllers[r].pullCall=e,o.postMessage({sourceName:a,targetName:n,stream:zn,streamId:r,desiredSize:t.desiredSize}),e.promise},cancel:t=>{Tr(t instanceof Error,"cancel must have a valid reason");var e=Promise.withResolvers();return this.streamControllers[r].cancelCall=e,this.streamControllers[r].isClosed=!0,o.postMessage({sourceName:a,targetName:n,stream:Dn,streamId:r,reason:$n(t)}),e.promise}},s)}#ze(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,a=this,n=this.actionHandler[t.action],o={enqueue(t,a=1,n){var o;this.isCancelled||(o=this.desiredSize,this.desiredSize-=a,0<o&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:Nn,streamId:e,chunk:t},n))},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:On,streamId:e}),delete a.streamSinks[e])},error(t){Tr(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:Bn,streamId:e,reason:$n(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,new Promise((function(e){e(n(t.data,o))})).then((function(){r.postMessage({sourceName:s,targetName:i,stream:jn,streamId:e,success:!0})}),(function(t){r.postMessage({sourceName:s,targetName:i,stream:jn,streamId:e,reason:$n(t)})}))}#Be(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,r=this.comObj,a=this.streamControllers[e],n=this.streamSinks[e];switch(t.stream){case jn:t.success?a.startCall.resolve():a.startCall.reject($n(t.reason));break;case Hn:t.success?a.pullCall.resolve():a.pullCall.reject($n(t.reason));break;case zn:n?(n.desiredSize<=0&&0<t.desiredSize&&n.sinkCapability.resolve(),n.desiredSize=t.desiredSize,new Promise((function(t){t(n.onPull?.())})).then((function(){r.postMessage({sourceName:s,targetName:i,stream:Hn,streamId:e,success:!0})}),(function(t){r.postMessage({sourceName:s,targetName:i,stream:Hn,streamId:e,reason:$n(t)})}))):r.postMessage({sourceName:s,targetName:i,stream:Hn,streamId:e,success:!0});break;case Nn:Tr(a,"enqueue should have stream controller"),a.isClosed||a.controller.enqueue(t.chunk);break;case On:Tr(a,"close should have stream controller"),a.isClosed||(a.isClosed=!0,a.controller.close(),this.#He(a,e));break;case Bn:Tr(a,"error should have stream controller"),a.controller.error($n(t.reason)),this.#He(a,e);break;case Fn:t.success?a.cancelCall.resolve():a.cancelCall.reject($n(t.reason)),this.#He(a,e);break;case Dn:n&&(new Promise((function(e){e(n.onCancel?.($n(t.reason)))})).then((function(){r.postMessage({sourceName:s,targetName:i,stream:Fn,streamId:e,success:!0})}),(function(t){r.postMessage({sourceName:s,targetName:i,stream:Fn,streamId:e,reason:$n(t)})})),n.sinkCapability.reject($n(t.reason)),n.isCancelled=!0,delete this.streamSinks[e]);break;default:throw new Error("Unexpected stream case")}}async#He(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}class qn{#je;#$e;constructor({parsedData:t,rawData:e}){this.#je=t,this.#$e=e}getRaw(){return this.#$e}get(t){return this.#je.get(t)??null}getAll(){return jr(this.#je)}has(t){return this.#je.has(t)}}const Vn=Symbol("INTERNAL");class Gn{#Ue=!1;#qe=!1;#Ve=!1;#Ge=!0;constructor(t,{name:e,intent:s,usage:i}){this.#Ue=!!(t&Ri),this.#qe=!!(t&Ii),this.name=e,this.intent=s,this.usage=i}get visible(){var t,e;return this.#Ve?this.#Ge:!!this.#Ge&&(({print:t,view:e}=this.usage),this.#Ue?"OFF"!==e?.viewState:!this.#qe||"OFF"!==t?.printState)}_setVisible(t,e,s=!1){t!==Vn&&Sr("Internal method `_setVisible` called."),this.#Ve=s,this.#Ge=e}}class Wn{#We=null;#Xe=new Map;#Ke=null;#Ye=null;constructor(t,e=Ri){if(this.renderingIntent=e,this.name=null,(this.creator=null)!==t){this.name=t.name,this.creator=t.creator,this.#Ye=t.order;for(const s of t.groups)this.#Xe.set(s.id,new Gn(e,s));if("OFF"===t.baseState)for(const t of this.#Xe.values())t._setVisible(Vn,!1);for(const e of t.on)this.#Xe.get(e)._setVisible(Vn,!0);for(const e of t.off)this.#Xe.get(e)._setVisible(Vn,!1);this.#Ke=this.getHash()}}#Qe(t){var e=t.length;if(e<2)return!0;var s=t[0];for(let r=1;r<e;r++){var i=t[r];let e;if(Array.isArray(i))e=this.#Qe(i);else{if(!this.#Xe.has(i))return Er("Optional content group not found: "+i),!0;e=this.#Xe.get(i).visible}switch(s){case"And":if(e)break;return!1;case"Or":if(e)return!0;break;case"Not":return!e;default:return!0}}return"And"===s}isVisible(t){if(0!==this.#Xe.size)if(t){if("OCG"===t.type)return this.#Xe.has(t.id)?this.#Xe.get(t.id).visible:(Er("Optional content group not found: "+t.id),!0);if("OCMD"===t.type){if(t.expression)return this.#Qe(t.expression);if(!t.policy||"AnyOn"===t.policy){for(const e of t.ids){if(!this.#Xe.has(e))return Er("Optional content group not found: "+e),!0;if(this.#Xe.get(e).visible)return!0}return!1}if("AllOn"===t.policy)for(const e of t.ids){if(!this.#Xe.has(e))return Er("Optional content group not found: "+e),!0;if(!this.#Xe.get(e).visible)return!1}else{if("AnyOff"===t.policy){for(const e of t.ids){if(!this.#Xe.has(e))return Er("Optional content group not found: "+e),!0;if(!this.#Xe.get(e).visible)return!0}return!1}if("AllOff"===t.policy)for(const e of t.ids){if(!this.#Xe.has(e))return Er("Optional content group not found: "+e),!0;if(this.#Xe.get(e).visible)return!1}else Er(`Unknown optional content policy ${t.policy}.`)}}else Er(`Unknown group type ${t.type}.`)}else kr("Optional content group not defined.");return!0}setVisibility(t,e=!0){var s=this.#Xe.get(t);s?(s._setVisible(Vn,!!e,!0),this.#We=null):Er("Optional content group not found: "+t)}setOCGState({state:t}){let e;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":e=i;continue}var s=this.#Xe.get(i);if(s)switch(e){case"ON":s._setVisible(Vn,!0);break;case"OFF":s._setVisible(Vn,!1);break;case"Toggle":s._setVisible(Vn,!s.visible)}}this.#We=null}get hasInitialVisibility(){return null===this.#Ke||this.getHash()===this.#Ke}getOrder(){return this.#Xe.size?this.#Ye?this.#Ye.slice():[...this.#Xe.keys()]:null}getGroups(){return 0<this.#Xe.size?jr(this.#Xe):null}getGroup(t){return this.#Xe.get(t)||null}getHash(){if(null!==this.#We)return this.#We;var t,e,s=new Ga;for([t,e]of this.#Xe)s.update(t+":"+e.visible);return this.#We=s.hexdigest()}}class Xn{constructor(t,{disableRange:e=!1,disableStream:s=!1}){Tr(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var{length:i,initialData:r,progressiveDone:a,contentDispositionFilename:n}=t;this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=n,0<r?.length&&(a=(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r:new Uint8Array(r)).buffer,this._queuedChunks.push(a)),this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener(((t,e)=>{this._onReceiveData({begin:t,chunk:e})})),t.addProgressListener(((t,e)=>{this._onProgress({loaded:t,total:e})})),t.addProgressiveReadListener((t=>{this._onReceiveData({chunk:t})})),t.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e:new Uint8Array(e)).buffer;void 0===t?this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s):Tr(this._rangeReaders.some((function(e){return e._begin===t&&(e._enqueue(s),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){void 0===t.total?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){0<=(t=this._rangeReaders.indexOf(t))&&this._rangeReaders.splice(t,1)}getFullReader(){Tr(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var t=this._queuedChunks;return this._queuedChunks=null,new Kn(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){var s;return e<=this._progressiveDataLength?null:(s=new Yn(this,t,e),this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class Kn{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=ba(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const t of this._queuedChunks)this._loaded+=t.byteLength;this._requests=[],this._headersReady=Promise.resolve(),(t._fullRequestReader=this).onProgress=null}_enqueue(t){this._done||(0<this._requests.length?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){var t;return 0<this._queuedChunks.length?{value:this._queuedChunks.shift(),done:!1}:this._done?{value:void 0,done:!0}:(t=Promise.withResolvers(),this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Yn{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){var t;return this._queuedChunk?(t=this._queuedChunk,this._queuedChunk=null,{value:t,done:!1}):this._done?{value:void 0,done:!0}:(t=Promise.withResolvers(),this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Qn({getResponseHeader:t,isHttp:e,rangeChunkSize:s,disableRange:i}){var r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(t("Content-Length"),10);return!Number.isInteger(a)||(r.suggestedLength=a)<=2*s||!i&&e&&"bytes"===t("Accept-Ranges")&&"identity"===(t("Content-Encoding")||"identity")&&(r.allowRangeRequests=!0),r}function Jn(t){if(t=t("Content-Disposition")){let e=function(t){let e=!0,s=r("filename\\*","i").exec(t);var i;return s?(i=o(s=s[1]),n(i=h(i=l(i=unescape(i))))):(s=function(t){for(var e=[],s=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");null!==(i=s.exec(t));){var[,i,a,n]=i;if((i=parseInt(i,10))in e){if(0===i)break}else e[i]=[a,n]}var h=[];for(let t=0;t<e.length&&t in e;++t){let[s,i]=e[t];i=o(i),s&&(i=unescape(i),0===t)&&(i=l(i)),h.push(i)}return h.join("")}(t))?n(h(s)):(s=r("filename","i").exec(t))?n(h(o(s=s[1]))):"";function r(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function a(t,s){if(t){if(!/^[\x00-\xFF]+$/.test(s))return s;try{var i=new TextDecoder(t,{fatal:!0}),r=Hr(s);s=i.decode(r),e=!1}catch{}}return s}function n(t){return e&&/[\x80-\xff]/.test(t)&&(t=a("utf-8",t),e)?a("iso-8859-1",t):t}function o(t){if(t.startsWith('"')){var e=t.slice(1).split('\\"');for(let t=0;t<e.length;++t){var s=e[t].indexOf('"');-1!==s&&(e[t]=e[t].slice(0,s),e.length=t+1),e[t]=e[t].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function l(t){var e=t.indexOf("'");return-1===e?t:a(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function h(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,e,s,i){if("q"===s||"Q"===s)return a(e,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt(e,16))})));try{i=atob(i)}catch{}return a(e,i)}))}}(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(ba(e))return e}return null}function Zn(t,e){return 404===t||0===t&&e.startsWith("file:")?new Fr('Missing PDF "'+e+'".'):new Or(`Unexpected server response (${t}) while retrieving PDF "${e}".`,t)}function to(t){return 200===t||206===t}function eo(t,e,s){return{method:"GET",headers:t,signal:s.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function so(t){var e=new Headers;for(const i in t){var s=t[i];void 0!==s&&e.append(i,s)}return e}function io(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(Er("getArrayBuffer - unexpected data format: "+t),new Uint8Array(t).buffer)}class ro{constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Tr(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new ao(this),this._fullRequestReader}getRangeReader(t,e){return e<=this._progressiveDataLength?null:(t=new no(this,t,e),this._rangeRequestReaders.push(t),t)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class ao{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null,t=t.source,this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=so(this._stream.httpHeaders);const e=t.url;fetch(e,eo(this._headers,this._withCredentials,this._abortController)).then((t=>{if(!to(t.status))throw Zn(t.status,e);this._reader=t.body.getReader(),this._headersCapability.resolve();var s=e=>t.headers.get(e),{allowRangeRequests:i,suggestedLength:r}=Qn({getResponseHeader:s,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=r||this._contentLength,this._filename=Jn(s),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Br("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;var{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:io(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class no{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0,t=t.source,this._withCredentials=t.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!t.disableStream,this._abortController=new AbortController,this._headers=so(this._stream.httpHeaders),this._headers.append("Range",`bytes=${e}-`+(s-1));const i=t.url;fetch(i,eo(this._headers,this._withCredentials,this._abortController)).then((t=>{if(!to(t.status))throw Zn(t.status,i);this._readCapability.resolve(),this._reader=t.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;var{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:io(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class oo{constructor(t,e={}){this.url=t,this.isHttp=/^https?:/i.test(t),this.httpHeaders=this.isHttp&&e.httpHeaders||Object.create(null),this.withCredentials=e.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(t,e,s){var i={begin:t,end:e};for(const t in s)i[t]=s[t];return this.request(i)}requestFull(t){return this.request(t)}request(t){const e=new XMLHttpRequest;var s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const t in this.httpHeaders){var r=this.httpHeaders[t];void 0!==r&&e.setRequestHeader(t,r)}return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-`+(t.end-1)),i.expectedStatus=206):i.expectedStatus=200,e.responseType="arraybuffer",t.onError&&(e.onerror=function(s){t.onError(e.status)}),e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){(t=this.pendingRequests[t])&&t.onProgress?.(e)}onStateChange(t,e){var s,i,r=this.pendingRequests[t];r&&(2<=(s=r.xhr).readyState&&r.onHeadersReceived&&(r.onHeadersReceived(),delete r.onHeadersReceived),4===s.readyState)&&t in this.pendingRequests&&(delete this.pendingRequests[t],0===s.status&&this.isHttp||(200!==(t=s.status||200)||206!==r.expectedStatus)&&t!==r.expectedStatus?r.onError?.(s.status):(i=function(t){return"string"!=typeof(t=t.response)?t:Hr(t).buffer}(s),206===t?(t=s.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(t),r.onDone({begin:parseInt(t[1],10),chunk:i})):i?r.onDone({begin:0,chunk:i}):r.onError?.(s.status)))}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){var e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class lo{constructor(t){this._source=t,this._manager=new oo(t.url,{httpHeaders:t.httpHeaders,withCredentials:t.withCredentials}),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){0<=(t=this._rangeRequestReaders.indexOf(t))&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Tr(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ho(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){return(t=new co(this._manager,t,e)).onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(t),t}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class ho{constructor(t,e){this._manager=t;var s={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._fullRequestId=t.requestFull(s),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){var t=this._fullRequestId;const e=this._manager.getRequestXhr(t);var s=t=>e.getResponseHeader(t),{allowRangeRequests:i,suggestedLength:r}=Qn({getResponseHeader:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=Jn(s),this._isRangeSupported&&this._manager.abortRequest(t),this._headersReceivedCapability.resolve()}_onDone(t){if(t&&(0<this._requests.length?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(0<this._cachedChunks.length)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=Zn(t,this._url),this._headersReceivedCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;var t;return 0<this._cachedChunks.length?{value:this._cachedChunks.shift(),done:!1}:this._done?{value:void 0,done:!0}:(t=Promise.withResolvers(),this._requests.push(t),t.promise)}cancel(t){this._done=!0,this._headersReceivedCapability.reject(t);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class co{constructor(t,e,s){this._manager=t;var i={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._requestId=t.requestRange(e,s,i),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(t){t=t.chunk,0<this._requests.length?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError=Zn(t,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;var t;return null!==this._queuedChunk?(t=this._queuedChunk,this._queuedChunk=null,{value:t,done:!1}):this._done?{value:void 0,done:!0}:(t=Promise.withResolvers(),this._requests.push(t),t.promise)}cancel(t){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const uo=/^file:\/\/\/[a-zA-Z]:\//;class po{constructor(t){this.source=t,this.url=function(t){var e=tn.get("url"),s=e.parse(t);if("file:"!==s.protocol&&!s.host){if(/^[a-z]:[/\\]/i.test(t))return e.parse("file:///"+t);s.host||(s.protocol="file:")}return s}(t.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&t.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Tr(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new(this.isFsUrl?yo:vo)(this),this._fullRequestReader}getRangeReader(t,e){return e<=this._progressiveDataLength?null:(t=new(this.isFsUrl?wo:bo)(this,t,e),this._rangeRequestReaders.push(t),t)}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class go{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,t=t.source,this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;var t=this._readableStream.read();return null===t?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){(this._readableStream=t).on("readable",(()=>{this._readCapability.resolve()})),t.on("end",(()=>{t.destroy(),this._done=!0,this._readCapability.resolve()})),t.on("error",(t=>{this._error(t)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Br("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class fo{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers(),t=t.source,this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;var t=this._readableStream.read();return null===t?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){(this._readableStream=t).on("readable",(()=>{this._readCapability.resolve()})),t.on("end",(()=>{t.destroy(),this._done=!0,this._readCapability.resolve()})),t.on("error",(t=>{this._error(t)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function mo(t,e){return{protocol:t.protocol,auth:t.auth,host:t.hostname,port:t.port,path:t.path,method:"GET",headers:e}}class vo extends go{constructor(t){super(t);var e,s=e=>{var s,i;404===e.statusCode?(s=new Fr(`Missing PDF "${this._url}".`),this._storedError=s,this._headersCapability.reject(s)):(this._headersCapability.resolve(),this._setReadableStream(e),({allowRangeRequests:e,suggestedLength:i}=Qn({getResponseHeader:s=t=>this._readableStream.headers[t.toLowerCase()],isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange})),this._isRangeSupported=e,this._contentLength=i||this._contentLength,this._filename=Jn(s))};this._request=null,"http:"===this._url.protocol?(e=tn.get("http"),this._request=e.request(mo(this._url,t.httpHeaders),s)):(e=tn.get("https"),this._request=e.request(mo(this._url,t.httpHeaders),s)),this._request.on("error",(t=>{this._storedError=t,this._headersCapability.reject(t)})),this._request.end()}}class bo extends fo{constructor(t,e,s){super(t),this._httpHeaders={};for(const e in t.httpHeaders){var i=t.httpHeaders[e];void 0!==i&&(this._httpHeaders[e]=i)}this._httpHeaders.Range=`bytes=${e}-`+(s-1),e=t=>{var e;404===t.statusCode?(e=new Fr(`Missing PDF "${this._url}".`),this._storedError=e):this._setReadableStream(t)},this._request=null,"http:"===this._url.protocol?(s=tn.get("http"),this._request=s.request(mo(this._url,this._httpHeaders),e)):(s=tn.get("https"),this._request=s.request(mo(this._url,this._httpHeaders),e)),this._request.on("error",(t=>{this._storedError=t})),this._request.end()}}class yo extends go{constructor(t){super(t);let e=decodeURIComponent(this._url.path);uo.test(this._url.href)&&(e=e.replace(/^\//,""));const s=tn.get("fs");s.promises.lstat(e).then((t=>{this._contentLength=t.size,this._setReadableStream(s.createReadStream(e)),this._headersCapability.resolve()}),(t=>{"ENOENT"===t.code&&(t=new Fr(`Missing PDF "${e}".`)),this._storedError=t,this._headersCapability.reject(t)}))}}class wo extends fo{constructor(t,e,s){super(t);let i=decodeURIComponent(this._url.path);uo.test(this._url.href)&&(i=i.replace(/^\//,"")),t=tn.get("fs"),this._setReadableStream(t.createReadStream(i,{start:e,end:s-1}))}}const xo=30;class Ao{#Je=Promise.withResolvers();#vt=null;#Ze=!1;#ts=!!globalThis.FontInspector?.enabled;#es=null;#ss=null;#is=0;#rs=0;#as=null;#ns=null;#os=0;#ls=0;#hs=Object.create(null);#ds=[];#cs=null;#us=[];#ps=new WeakMap;#gs=null;static#fs=new Map;static#ms=new Map;static#vs=null;static#bs=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#cs=t;else{if("object"!=typeof t)throw new Error('No "textContentSource" parameter specified.');this.#cs=new ReadableStream({start(e){e.enqueue(t),e.close()}})}this.#vt=this.#ns=e,this.#ls=s.scale*(globalThis.devicePixelRatio||1),this.#os=s.rotation,this.#ss={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null};var{pageWidth:i,pageHeight:r,pageX:a,pageY:n}=s.rawDims;this.#gs=[1,0,0,-1,-a,n+r],this.#rs=i,this.#is=r,Ao.#ys(),Pa(e,s),this.#Je.promise.catch((()=>{})).then((()=>{Ao.#bs.delete(this),this.#ss=null,this.#hs=null}))}render(){const t=()=>{this.#as.read().then((({value:e,done:s})=>{s?this.#Je.resolve():(this.#es??=e.lang,Object.assign(this.#hs,e.styles),this.#ws(e.items),t())}),this.#Je.reject)};return this.#as=this.#cs.getReader(),Ao.#bs.add(this),t(),this.#Je.promise}update({viewport:t,onBefore:e=null}){var s=t.scale*(globalThis.devicePixelRatio||1);if((t=t.rotation)!==this.#os&&(e?.(),this.#os=t,Pa(this.#ns,{rotation:t})),s!==this.#ls){e?.(),this.#ls=s;var i={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:Ao.#xs(this.#es)};for(const t of this.#us)i.properties=this.#ps.get(t),i.div=t,this.#As(i)}}cancel(){var t=new Br("TextLayer task cancelled.");this.#as?.cancel(t).catch((()=>{})),this.#as=null,this.#Je.reject(t)}get textDivs(){return this.#us}get textContentItemsStr(){return this.#ds}#ws(t){if(!this.#Ze){this.#ss.ctx??=Ao.#xs(this.#es);var e,s=this.#us,i=this.#ds;for(const r of t){if(s.length>1e5)return Er("Ignoring additional textDivs for performance reasons."),void(this.#Ze=!0);void 0===r.str?"beginMarkedContentProps"===r.type||"beginMarkedContent"===r.type?(e=this.#vt,this.#vt=document.createElement("span"),this.#vt.classList.add("markedContent"),null!==r.id&&this.#vt.setAttribute("id",""+r.id),e.append(this.#vt)):"endMarkedContent"===r.type&&(this.#vt=this.#vt.parentNode):(i.push(r.str),this.#_s(r))}}}#_s(t){var e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0},i=(this.#us.push(e),qr.transform(this.#gs,t.transform));let r=Math.atan2(i[1],i[0]);var a=this.#hs[t.fontName],n=(a.vertical&&(r+=Math.PI/2),this.#ts&&a.fontSubstitution||a.fontFamily),o=Math.hypot(i[2],i[3]),l=o*Ao.#Cs(n,this.#es);let h,d;d=0===r?(h=i[4],i[5]-l):(h=i[4]+l*Math.sin(r),i[5]-l*Math.cos(r));i="calc(var(--scale-factor)*",l=e.style;this.#vt===this.#ns?(l.left=(100*h/this.#rs).toFixed(2)+"%",l.top=(100*d/this.#is).toFixed(2)+"%"):(l.left=i+h.toFixed(2)+"px)",l.top=i+d.toFixed(2)+"px)"),l.fontSize=i+(Ao.#vs*o).toFixed(2)+"px)",l.fontFamily=n,s.fontSize=o,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#ts&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),0!==r&&(s.angle=r*(180/Math.PI));let c=!1;(c=1<t.str.length||" "!==t.str&&t.transform[0]!==t.transform[3]&&(i=Math.abs(t.transform[0]))!==(l=Math.abs(t.transform[3]))&&1.5<Math.max(i,l)/Math.min(i,l)||c)&&(s.canvasWidth=a.vertical?t.height:t.width),this.#ps.set(e,s),this.#ss.div=e,this.#ss.properties=s,this.#As(this.#ss),s.hasText&&this.#vt.append(e),s.hasEOL&&((n=document.createElement("br")).setAttribute("role","presentation"),this.#vt.append(n))}#As(t){var e,s,i,{div:r,properties:a,ctx:n,prevFontSize:o,prevFontFamily:l}=t,h=r.style;let d="";1<Ao.#vs&&(d=`scale(${1/Ao.#vs})`),0!==a.canvasWidth&&a.hasText&&(e=h.fontFamily,({canvasWidth:s,fontSize:i}=a),0<(o=(o===i&&l===e||(n.font=i*this.#ls+"px "+e,t.prevFontSize=i,t.prevFontFamily=e),n.measureText(r.textContent)).width))&&(d=`scaleX(${s*this.#ls/o}) `+d),0<(d=0!==a.angle?`rotate(${a.angle}deg) `+d:d).length&&(h.transform=d)}static cleanup(){if(!(0<this.#bs.size)){for(var{canvas:t}of(this.#fs.clear(),this.#ms.values()))t.remove();this.#ms.clear()}}static#xs(t=null){let e=this.#ms.get(t||="");var s;return e||((s=document.createElement("canvas")).className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#ms.set(t,e)),e}static#ys(){var t;null===this.#vs&&((t=document.createElement("div")).style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#vs=t.getBoundingClientRect().height,t.remove())}static#Cs(t,e){if(s=this.#fs.get(t))return s;e=(s=this.#xs(e)).font;var s,i=(s.canvas.width=s.canvas.height=xo,s.font="30px "+t,s.measureText(""));let r=i.fontBoundingBoxAscent,a=Math.abs(i.fontBoundingBoxDescent);if(r){const i=r/(r+a);return this.#fs.set(t,i),s.canvas.width=s.canvas.height=0,s.font=e,i}s.strokeStyle="red",s.clearRect(0,0,xo,xo),s.strokeText("g",0,0);let n=s.getImageData(0,0,xo,xo).data;a=0;for(let t=n.length-1-3;0<=t;t-=4)if(0<n[t]){a=Math.ceil(t/4/xo);break}s.clearRect(0,0,xo,xo),s.strokeText("A",0,xo),n=s.getImageData(0,0,xo,xo).data;for(let t=r=0,e=n.length;t<e;t+=4)if(0<n[t]){r=xo-Math.floor(t/4/xo);break}s.canvas.width=s.canvas.height=0,s.font=e;const o=r?r/(r+a):.8;return this.#fs.set(t,o),o}}class _o{static textContent(t){const e=[];var s={items:e,styles:Object.create(null)};return function t(s){if(s){let r=null;var i=s.name;if("#text"===i)r=s.value;else{if(!_o.shouldBuildText(i))return;s?.attributes?.textContent?r=s.attributes.textContent:s.value&&(r=s.value)}if(null!==r&&e.push({str:r}),s.children)for(const e of s.children)t(e)}}(t),s}static shouldBuildText(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}const Co=65536,ko=Si?class extends aa{_createCanvas(t,e){return tn.get("canvas").createCanvas(t,e)}}:class extends aa{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}={}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){var s=this._document.createElement("canvas");return s.width=t,s.height=e,s}},Eo=Si?class extends na{_fetchData(t,e){return en(t).then((t=>({cMapData:t,compressionType:e})))}}:ua,So=Si?class extends ra{}:class extends ra{#ks;#Es;#Ss;#Ts;#Ms;#Ps;#v=0;constructor({docId:t,ownerDocument:e=globalThis.document}={}){super(),this.#Ts=t,this.#Ms=e}get#y(){return this.#Es||=new Map}get#Ls(){return this.#Ps||=new Map}get#Rs(){var t,e;return this.#Ss||((e=(t=this.#Ms.createElement("div")).style).visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1,(e=this.#Ms.createElementNS(ha,"svg")).setAttribute("width",0),e.setAttribute("height",0),this.#Ss=this.#Ms.createElementNS(ha,"defs"),t.append(e),e.append(this.#Ss),this.#Ms.body.append(t)),this.#Ss}#Is(t){if(1===t.length){const i=t[0];var e=new Array(256);for(let t=0;t<256;t++)e[t]=i[t]/255;var s=e.join(",");return[s,s,s]}const[i,r,a]=t;var n=new Array(256),o=new Array(256),l=new Array(256);for(let t=0;t<256;t++)n[t]=i[t]/255,o[t]=r[t]/255,l[t]=a[t]/255;return[n.join(","),o.join(","),l.join(",")]}#Ds(t){var e;return void 0===this.#ks&&(this.#ks="",(e=this.#Ms.URL)!==this.#Ms.baseURI)&&(va(e)?Er('#createUrl: ignore "data:"-URL for performance reasons.'):this.#ks=e.split("#",1)[0]),`url(${this.#ks}#${t})`}addFilter(t){var e,s,i,r,a,n;return t?(a=this.#y.get(t))||([e,s,i]=this.#Is(t),r=1===t.length?e:""+e+s+i,(a=this.#y.get(r))?(this.#y.set(t,a),a):(a=`g_${this.#Ts}_transfer_map_`+this.#v++,n=this.#Ds(a),this.#y.set(t,n),this.#y.set(r,n),t=this.#Fs(a),this.#Os(e,s,i,t),n)):"none"}addHCMFilter(t,e){var s=t+"-"+e;let i=this.#Ls.get("base");if(i?.key!==s&&(i?(i.filter?.remove(),i.key=s,i.url="none",i.filter=null):(i={key:s,url:"none",filter:null},this.#Ls.set("base",i)),t)&&e){const n=this.#Ns(t),o=(t=qr.makeHexColor(...n),this.#Ns(e));if(e=qr.makeHexColor(...o),this.#Rs.style.color="",("#000000"!==t||"#ffffff"!==e)&&t!==e){var r=new Array(256);for(let t=0;t<=255;t++){var a=t/255;r[t]=a<=.03928?a/12.92:((.055+a)/1.055)**2.4}s=r.join(","),t=`g_${this.#Ts}_hcm_filter`,e=i.filter=this.#Fs(t),this.#Os(s,s,s,e),this.#Bs(e),s=(t,e)=>{var s=n[t]/255,i=o[t]/255,r=new Array(e+1);for(let t=0;t<=e;t++)r[t]=s+t/e*(i-s);return r.join(",")},this.#Os(s(0,5),s(1,5),s(2,5),e),i.url=this.#Ds(t)}}return i.url}addAlphaFilter(t){var e,s,i,r=this.#y.get(t);return r||([e]=this.#Is([t]),(r=this.#y.get(s="alpha_"+e))?(this.#y.set(t,r),r):(r=`g_${this.#Ts}_alpha_map_`+this.#v++,i=this.#Ds(r),this.#y.set(t,i),this.#y.set(s,i),t=this.#Fs(r),this.#zs(e,t),i))}addLuminosityFilter(t){var e,s=this.#y.get(t||"luminosity");if(s)return s;let i,r;return r=t?([i]=this.#Is([t]),"luminosity_"+i):"luminosity",(s=this.#y.get(r))?(this.#y.set(t,s),s):(s=`g_${this.#Ts}_luminosity_map_`+this.#v++,e=this.#Ds(s),this.#y.set(t,e),this.#y.set(r,e),s=this.#Fs(s),this.#Hs(s),t&&this.#zs(i,s),e)}addHighlightHCMFilter(t,e,s,i,r){var a=e+`-${s}-${i}-`+r;let n=this.#Ls.get(t);if(n?.key!==a&&(n?(n.filter?.remove(),n.key=a,n.url="none",n.filter=null):(n={key:a,url:"none",filter:null},this.#Ls.set(t,n)),e)&&s){var[a,e]=[e,s].map(this.#Ns.bind(this));let o=Math.round(.2126*a[0]+.7152*a[1]+.0722*a[2]),l=Math.round(.2126*e[0]+.7152*e[1]+.0722*e[2]),[h,d]=[i,r].map(this.#Ns.bind(this));l<o&&([o,l,h,d]=[l,o,d,h]),this.#Rs.style.color="",s=(t,e,s)=>{var i=new Array(256),r=(l-o)/s,a=t/255,n=(e-t)/(255*s);let h=0;for(let t=0;t<=s;t++){var d=Math.round(o+t*r),c=a+t*n;for(let t=h;t<=d;t++)i[t]=c;h=d+1}for(let t=h;t<256;t++)i[t]=i[h-1];return i.join(",")},a=`g_${this.#Ts}_hcm_${t}_filter`,e=n.filter=this.#Fs(a),this.#Bs(e),this.#Os(s(h[0],d[0],5),s(h[1],d[1],5),s(h[2],d[2],5),e),n.url=this.#Ds(a)}return n.url}destroy(t=!1){t&&0!==this.#Ls.size||(this.#Ss&&(this.#Ss.parentNode.parentNode.remove(),this.#Ss=null),this.#Es&&(this.#Es.clear(),this.#Es=null),this.#v=0)}#Hs(t){var e=this.#Ms.createElementNS(ha,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#Bs(t){var e=this.#Ms.createElementNS(ha,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#Fs(t){var e=this.#Ms.createElementNS(ha,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#Rs.append(e),e}#js(t,e,s){(e=this.#Ms.createElementNS(ha,e)).setAttribute("type","discrete"),e.setAttribute("tableValues",s),t.append(e)}#Os(t,e,s,i){var r=this.#Ms.createElementNS(ha,"feComponentTransfer");i.append(r),this.#js(r,"feFuncR",t),this.#js(r,"feFuncG",e),this.#js(r,"feFuncB",s)}#zs(t,e){var s=this.#Ms.createElementNS(ha,"feComponentTransfer");e.append(s),this.#js(s,"feFuncA",t)}#Ns(t){return this.#Rs.style.color=t,Sa(getComputedStyle(this.#Rs).getPropertyValue("color"))}},To=Si?class extends oa{_fetchData(t){return en(t)}}:pa;function Mo(t={}){"string"==typeof t||t instanceof URL?t={url:t}:(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e=new Lo,s=e.docId,i=t.url?function(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch{if(Si&&"string"==typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(t.url):null,r=t.data?function(t){if(Si&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return Hr(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"==typeof t&&!isNaN(t?.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(t.data):null,a=t.httpHeaders||null,n=!0===t.withCredentials;var o=t.password??null;const l=t.range instanceof Ro?t.range:null,h=Number.isInteger(t.rangeChunkSize)&&0<t.rangeChunkSize?t.rangeChunkSize:Co;let d=t.worker instanceof No?t.worker:null;var c=t.verbosity,u="string"!=typeof t.docBaseUrl||va(t.docBaseUrl)?null:t.docBaseUrl,p="string"==typeof t.cMapUrl?t.cMapUrl:null,g=!1!==t.cMapPacked,f=t.CMapReaderFactory||Eo,m="string"==typeof t.standardFontDataUrl?t.standardFontDataUrl:null,v=t.StandardFontDataFactory||To,b=!0!==t.stopAtErrors,y=Number.isInteger(t.maxImageSize)&&-1<t.maxImageSize?t.maxImageSize:-1,w=!1!==t.isEvalSupported,x="boolean"==typeof t.isOffscreenCanvasSupported?t.isOffscreenCanvasSupported:!Si,A=Number.isInteger(t.canvasMaxAreaInBytes)?t.canvasMaxAreaInBytes:-1,_="boolean"==typeof t.disableFontFace?t.disableFontFace:Si,C=!0===t.fontExtraProperties,k=!0===t.enableXfa,E=t.ownerDocument||globalThis.document;const S=!0===t.disableRange,T=!0===t.disableStream;var M=!0===t.disableAutoFetch,P=!0===t.pdfBug,L=!0===t.enableHWA;const R=l?l.length:t.length??NaN;var I="boolean"==typeof t.useSystemFonts?t.useSystemFonts:!Si&&!_,D="boolean"==typeof t.useWorkerFetch?t.useWorkerFetch:f===ua&&v===pa&&p&&m&&Aa(p,document.baseURI)&&Aa(m,document.baseURI);L=t.canvasFactory||new ko({ownerDocument:E,enableHWA:L}),t=t.filterFactory||new So({docId:s,ownerDocument:E});!function(t){Number.isInteger(t)&&(_r=t)}(c);const F={canvasFactory:L,filterFactory:t},O=(D||(F.cMapReaderFactory=new f({baseUrl:p,isCompressed:g}),F.standardFontDataFactory=new v({baseUrl:m})),d||(L={verbosity:c,port:Ln.workerPort},d=L.port?No.fromPort(L):new No(L),e._worker=d),{docId:s,apiVersion:"4.5.136",data:r,password:o,disableAutoFetch:M,rangeChunkSize:h,length:R,docBaseUrl:u,enableXfa:k,evaluatorOptions:{maxImageSize:y,disableFontFace:_,ignoreErrors:b,isEvalSupported:w,isOffscreenCanvasSupported:x,canvasMaxAreaInBytes:A,fontExtraProperties:C,useSystemFonts:I,cMapUrl:D?p:null,standardFontDataUrl:D?m:null}}),N={disableFontFace:_,fontExtraProperties:C,ownerDocument:E,pdfBug:P,styleElement:null,loadingParams:{disableAutoFetch:M,enableXfa:k}};return d.promise.then((function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var t,o=d.messageHandler.sendWithPromise("GetDocRequest",O,r?[r.buffer]:null);let c;if(l)c=new Xn(l,{disableRange:S,disableStream:T});else if(!r){if(!i)throw new Error("getDocument - no `url` parameter provided.");t={url:i,length:R,httpHeaders:a,withCredentials:n,rangeChunkSize:h,disableRange:S,disableStream:T},c=new(Si?"undefined"!=typeof fetch&&"undefined"!=typeof Response&&"body"in Response.prototype&&Aa(t.url)?ro:po:Aa(t.url)?ro:lo)(t)}return o.then((t=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");t=new Un(s,t,d.port);var i=new Bo(t,e,c,N,F);e._transport=i,t.send("Ready",null)}))})).catch(e._capability.reject),e}function Po(t){return"object"==typeof t&&Number.isInteger(t?.num)&&0<=t.num&&Number.isInteger(t?.gen)&&0<=t.gen}class Lo{static#Ts=0;constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d"+Lo.#Ts++,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await(this._transport?.destroy())}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class Ro{constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,e){for(const s of this._rangeListeners)s(t,e)}onDataProgress(t,e){this._readyCapability.promise.then((()=>{for(const s of this._progressListeners)s(t,e)}))}onDataProgressiveRead(t){this._readyCapability.promise.then((()=>{for(const e of this._progressiveReadListeners)e(t)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const t of this._progressiveDoneListeners)t()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(t,e){Sr("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Io{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Pr(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){return t=this._transport.getRenderingIntent(t).renderingIntent,this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Do{#$s=null;#Us=!1;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new xa:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new Ho,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new fa({viewBox:this.view,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:t="display"}={}){return t=this._transport.getRenderingIntent(t).renderingIntent,this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Pr(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:e,intent:s="display",annotationMode:i=zi.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:n=null,annotationCanvasMap:o=null,pageColors:l=null,printAnnotationStorage:h=null,isEditing:d=!1}){this._stats?.time("Overall"),s=this._transport.getRenderingIntent(s,i,h,d);const{renderingIntent:c,cacheKey:u}=s;this.#Us=!1,this.#qs(),n||=this._transport.getOptionalContentConfig(c);let p=this._intentStates.get(u);p||(p=Object.create(null),this._intentStates.set(u,p)),p.streamReaderCancelTimeout&&(clearTimeout(p.streamReaderCancelTimeout),p.streamReaderCancelTimeout=null);const g=!!(c&Ii),f=(p.displayReadyCapability||(p.displayReadyCapability=Promise.withResolvers(),p.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(s)),t=>{p.renderTasks.delete(m),(this._maybeCleanupAfterRender||g)&&(this.#Us=!0),this.#Vs(!g),t?(m.capability.reject(t),this._abortOperatorList({intentState:p,reason:t instanceof Error?t:new Error(t)})):m.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled)&&globalThis.Stats.add(this.pageNumber,this._stats)}),m=new $o({callback:f,params:{canvasContext:t,viewport:e,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:o,operatorList:p.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!g,pdfBug:this._pdfBug,pageColors:l});return(p.renderTasks||=new Set).add(m),i=m.task,Promise.all([p.displayReadyCapability.promise,n]).then((([t,e])=>{if(this.destroyed)f();else{if(this._stats?.time("Rendering"),!(e.renderingIntent&c))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");m.initializeGraphics({transparency:t,optionalContentConfig:e}),m.operatorListChanged()}})).catch(f),i}getOperatorList({intent:t="display",annotationMode:e=zi.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){t=this._transport.getRenderingIntent(t,e,s,i,!0);let r,a=this._intentStates.get(t.cacheKey);return a||(a=Object.create(null),this._intentStates.set(t.cacheKey,a)),a.opListReadCapability||((r=Object.create(null)).operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(r))},a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(r),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(t)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===t,disableNormalization:!0===e},{highWaterMark:100,size:t=>t.items.length})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then((t=>_o.textContent(t)));const e=this.streamTextContent(t);return new Promise((function(t,s){const i=e.getReader(),r={items:[],styles:Object.create(null),lang:null};!function e(){i.read().then((function({value:s,done:i}){i?t(r):(r.lang??=s.lang,Object.assign(r.styles,s.styles),r.items.push(...s.items),e())}),s)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;var t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#Us=!1,this.#qs(),Promise.all(t)}cleanup(t=!1){this.#Us=!0;var e=this.#Vs(!1);return t&&e&&(this._stats&&=new xa),e}#Vs(t=!1){if(this.#qs(),!this.#Us||this.destroyed)return!1;if(t)return this.#$s=setTimeout((()=>{this.#$s=null,this.#Vs(!1)}),5e3),!1;for(var{renderTasks:e,operatorList:s}of this._intentStates.values())if(0<e.size||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),!(this.#Us=!1)}#qs(){this.#$s&&(clearTimeout(this.#$s),this.#$s=null)}_startRenderPage(t,e){(e=this._intentStates.get(e))&&(this._stats?.timeEnd("Page Request"),e.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const t of e.renderTasks)t.operatorListChanged();t.lastChunk&&this.#Vs(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){var{map:s,transfer:r}=s;const a=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:s,modifiedIds:i},r).getReader(),n=this._intentStates.get(e),o=(n.streamReader=a,()=>{a.read().then((({value:t,done:e})=>{e?n.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,n),o())}),(t=>{if(n.streamReader=null,!this._transport.destroyed){if(n.operatorList){n.operatorList.lastChunk=!0;for(const t of n.renderTasks)t.operatorListChanged();this.#Vs(!0)}if(n.displayReadyCapability)n.displayReadyCapability.reject(t);else{if(!n.opListReadCapability)throw t;n.opListReadCapability.reject(t)}}}))});o()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(0<t.renderTasks.size)return;if(e instanceof ma){let s=100;return 0<e.extraDelay&&e.extraDelay<1e3&&(s+=e.extraDelay),void(t.streamReaderCancelTimeout=setTimeout((()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})}),s))}}if(t.streamReader.cancel(new Br(e.message)).catch((()=>{})),t.streamReader=null,!this._transport.destroyed){for(var[i,r]of this._intentStates)if(r===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}class Fo{#Gs=new Set;#Ws=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#Ws.then((()=>{for(const t of this.#Gs)t.call(this,s)}))}addEventListener(t,e){this.#Gs.add(e)}removeEventListener(t,e){this.#Gs.delete(e)}terminate(){this.#Gs.clear()}}const Oo={isWorkerDisabled:!1,fakeWorkerId:0};Si&&(Oo.isWorkerDisabled=!0,Ln.workerSrc||="./pdf.worker.mjs"),Oo.isSameOrigin=function(t,e){let s;try{if(!(s=new URL(t)).origin||"null"===s.origin)return!1}catch{return!1}return t=new URL(e,s),s.origin===t.origin},Oo.createCDNWrapper=function(t){return URL.createObjectURL(new Blob([`await import("${t}");`],{type:"text/javascript"}))};class No{static#Xs;constructor({name:t=null,port:e=null,verbosity:s=Cr()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,e){if(No.#Xs?.has(e))throw new Error("Cannot use more than one PDFWorker per port.");(No.#Xs||=new WeakMap).set(e,this),this._initializeFromPort(e)}else this._initialize()}get promise(){return Si?Promise.all([tn.promise,this._readyCapability.promise]):this._readyCapability.promise}#Ks(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new Un("main","worker",t),this._messageHandler.on("ready",(function(){})),this.#Ks()}_initialize(){if(!Oo.isWorkerDisabled&&!No.#Ys){let t=No.workerSrc;try{Oo.isSameOrigin(window.location.href,t)||(t=Oo.createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Un("main","worker",e),i=()=>{r.abort(),s.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=new AbortController,a=(e.addEventListener("error",(()=>{this._webWorker||i()}),{signal:r.signal}),s.on("test",(t=>{r.abort(),this.destroyed||!t?i():(this._messageHandler=s,this._port=e,this._webWorker=e,this.#Ks())})),s.on("ready",(t=>{if(r.abort(),this.destroyed)i();else try{a()}catch{this._setupFakeWorker()}})),()=>{var t=new Uint8Array;s.send("test",t,[t.buffer])});return void a()}catch{kr("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){Oo.isWorkerDisabled||(Er("Setting up fake worker."),Oo.isWorkerDisabled=!0),No._setupFakeWorkerGlobal.then((t=>{var e,s,i;this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):(e=new Fo,this._port=e,s="fake"+Oo.fakeWorkerId++,i=new Un(s+"_worker",s,e),t.setup(i,e),this._messageHandler=new Un(s,s+"_worker",e),this.#Ks())})).catch((t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),No.#Xs?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");var e=this.#Xs?.get(t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new No(t)}static get workerSrc(){if(Ln.workerSrc)return Ln.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#Ys(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return Pr(this,"_setupFakeWorkerGlobal",(async()=>this.#Ys||(await import(this.workerSrc)).WorkerMessageHandler)())}}class Bo{#Qs=new Map;#Js=new Map;#Zs=new Map;#ti=new Map;#ei=null;constructor(t,e,s,i,r){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new Ho,this.fontLoader=new Ya({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#si(t,e=null){var s=this.#Qs.get(t);return s||(s=this.messageHandler.sendWithPromise(t,e),this.#Qs.set(t,s),s)}get annotationStorage(){return Pr(this,"annotationStorage",new Xa)}getRenderingIntent(t,e=zi.ENABLE,s=null,i=!1,r=!1){let a=Ri,n=Wa;switch(t){case"any":a=Li;break;case"display":break;case"print":a=Ii;break;default:Er("getRenderingIntent - invalid intent: "+t)}var o=a&Ii&&s instanceof Ka?s:this.annotationStorage;switch(e){case zi.DISABLE:a+=Oi;break;case zi.ENABLE:break;case zi.ENABLE_FORMS:a+=Di;break;case zi.ENABLE_STORAGE:a+=Fi,n=o.serializable;break;default:Er("getRenderingIntent - invalid annotationMode: "+e)}i&&(a+=Ni),r&&(a+=Bi);var{ids:s,hash:i}=o.modifiedIds;return{renderingIntent:a,cacheKey:(r=[a,n.hash,i]).join("_"),annotationStorageSerializable:n,modifiedIds:s}}destroy(){if(!this.destroyCapability){this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#ei?.reject(new Error("Worker was destroyed during onPassword callback"));var t=[];for(const e of this.#Js.values())t.push(e._destroy());this.#Js.clear(),this.#Zs.clear(),this.#ti.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var e=this.messageHandler.sendWithPromise("Terminate",null);t.push(e),Promise.all(t).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Qs.clear(),this.filterFactory.destroy(),Ao.cleanup(),this._networkStream?.cancelAllRequests(new Br("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject)}return this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",((t,e)=>{Tr(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=t=>{this._lastProgress={loaded:t.loaded,total:t.total}},e.onPull=()=>{this._fullReader.read().then((function({value:t,done:s}){s?e.close():(Tr(t instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(t),1,[t]))})).catch((t=>{e.error(t)}))},e.onCancel=t=>{this._fullReader.cancel(t),e.ready.catch((t=>{if(!this.destroyed)throw t}))}})),t.on("ReaderHeadersReady",(t=>{const s=Promise.withResolvers(),i=this._fullReader;return i.headersReady.then((()=>{i.isStreamingSupported&&i.isRangeSupported||(this._lastProgress&&e.onProgress?.(this._lastProgress),i.onProgress=t=>{e.onProgress?.({loaded:t.loaded,total:t.total})}),s.resolve({isStreamingSupported:i.isStreamingSupported,isRangeSupported:i.isRangeSupported,contentLength:i.contentLength})}),s.reject),s.promise})),t.on("GetRangeReader",((t,e)=>{Tr(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const s=this._networkStream.getRangeReader(t.begin,t.end);s?(e.onPull=()=>{s.read().then((function({value:t,done:s}){s?e.close():(Tr(t instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),e.enqueue(new Uint8Array(t),1,[t]))})).catch((t=>{e.error(t)}))},e.onCancel=t=>{s.cancel(t),e.ready.catch((t=>{if(!this.destroyed)throw t}))}):e.close()})),t.on("GetDoc",(({pdfInfo:t})=>{this._numPages=t.numPages,this._htmlForXfa=t.htmlForXfa,delete t.htmlForXfa,e._capability.resolve(new Io(t,this))})),t.on("DocException",(function(t){let s;switch(t.name){case"PasswordException":s=new Rr(t.message,t.code);break;case"InvalidPDFException":s=new Dr(t.message);break;case"MissingPDFException":s=new Fr(t.message);break;case"UnexpectedResponseException":s=new Or(t.message,t.status);break;case"UnknownErrorException":s=new Ir(t.message,t.details);break;default:Sr("DocException - expected a valid Error.")}e._capability.reject(s)})),t.on("PasswordRequest",(t=>{if(this.#ei=Promise.withResolvers(),e.onPassword){try{e.onPassword((t=>{t instanceof Error?this.#ei.reject(t):this.#ei.resolve({password:t})}),t.code)}catch(t){this.#ei.reject(t)}}else this.#ei.reject(new Rr(t.message,t.code));return this.#ei.promise})),t.on("DataLoaded",(t=>{e.onProgress?.({loaded:t.length,total:t.length}),this.downloadInfoCapability.resolve(t)})),t.on("StartRenderPage",(t=>{this.destroyed||this.#Js.get(t.pageIndex)._startRenderPage(t.transparency,t.cacheKey)})),t.on("commonobj",(([e,s,i])=>{if(!this.destroyed&&!this.commonObjs.has(e))switch(s){case"Font":const{disableFontFace:o,fontExtraProperties:l,pdfBug:h}=this._params;if("error"in i){var r=i.error;Er("Error during font loading: "+r),this.commonObjs.resolve(e,r)}else{r=h&&globalThis.FontInspector?.enabled?(t,e)=>globalThis.FontInspector.fontAdded(t,e):null;const s=new Qa(i,{disableFontFace:o,inspectFont:r});this.fontLoader.bind(s).catch((()=>t.sendWithPromise("FontFallback",{id:e}))).finally((()=>{!l&&s.data&&(s.data=null),this.commonObjs.resolve(e,s)}))}break;case"CopyLocalImage":var a=i.imageRef;Tr(a,"The imageRef must be defined.");for(const t of this.#Js.values())for(var[,n]of t.objs)if(n?.ref===a)return n.dataLen?(this.commonObjs.resolve(e,structuredClone(n)),n.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(e,i);break;default:throw new Error("Got unknown common object type "+s)}return null})),t.on("obj",(([t,e,s,i])=>{if(!this.destroyed){var r=this.#Js.get(e);if(!r.objs.has(t))if(0===r._intentStates.size)i?.bitmap?.close();else switch(s){case"Image":r.objs.resolve(t,i),i?.dataLen>1e7&&(r._maybeCleanupAfterRender=!0);break;case"Pattern":r.objs.resolve(t,i);break;default:throw new Error("Got unknown object type "+s)}}})),t.on("DocProgress",(t=>{this.destroyed||e.onProgress?.({loaded:t.loaded,total:t.total})})),t.on("FetchBuiltInCMap",(t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(t):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),t.on("FetchStandardFontData",(t=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(t):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Er("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally((()=>{this.annotationStorage.resetModified()}))}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1;var s;return this.#Zs.get(e)||(s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then((s=>{if(this.destroyed)throw new Error("Transport destroyed");return s.refStr&&this.#ti.set(s.refStr,t),s=new Do(e,s,this,this._params.pdfBug),this.#Js.set(e,s),s})),this.#Zs.set(e,s),s)}getPageIndex(t){return Po(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#si("GetFieldObjects")}hasJSActions(){return this.#si("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#si("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#si("GetOptionalContentConfig").then((e=>new Wn(e,t)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){var t="GetMetadata",e=this.#Qs.get(t);return e||(e=this.messageHandler.sendWithPromise(t,null).then((t=>({info:t[0],metadata:t[1]?new qn(t[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}))),this.#Qs.set(t,e),e)}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#Js.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#Qs.clear(),this.filterFactory.destroy(!0),Ao.cleanup()}}cachedPageNumber(t){return Po(t)?(t=0===t.gen?t.num+"R":t.num+"R"+t.gen,this.#ti.get(t)??null):null}}const zo=Symbol("INITIAL_DATA");class Ho{#ii=Object.create(null);#ri(t){return this.#ii[t]||={...Promise.withResolvers(),data:zo}}get(t,e=null){if(e){const s=this.#ri(t);return s.promise.then((()=>e(s.data))),null}const s=this.#ii[t];if(s&&s.data!==zo)return s.data;throw new Error(`Requesting object that isn't resolved yet ${t}.`)}has(t){return!!(t=this.#ii[t])&&t.data!==zo}resolve(t,e=null){(t=this.#ri(t)).data=e,t.resolve()}clear(){for(const e in this.#ii){var t=this.#ii[e].data;t?.bitmap?.close()}this.#ii=Object.create(null)}*[Symbol.iterator](){for(const e in this.#ii){var t=this.#ii[e].data;t!==zo&&(yield[e,t])}}}class jo{#ai=null;constructor(t){this.#ai=t,this.onContinue=null}get promise(){return this.#ai.capability.promise}cancel(t=0){this.#ai.cancel(null,t)}get separateAnnots(){var t,e=this.#ai.operatorList.separateAnnots;return!!e&&(t=this.#ai.annotationCanvasMap,e.form||e.canvas&&0<t?.size)}}class $o{#ni=null;static#oi=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:a,pageIndex:n,canvasFactory:o,filterFactory:l,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:c=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=n,this.canvasFactory=o,this.filterFactory=l,this._pdfBug=d,this.pageColors=c,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===h&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new jo(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(!this.cancelled){if(this._canvas){if($o.#oi.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");$o.#oi.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var{canvasContext:s,viewport:i,transform:r,background:a}=this.params;this.gfx=new Pn(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:i,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#ni&&(window.cancelAnimationFrame(this.#ni),this.#ni=null),$o.#oi.delete(this._canvas),this.callback(t||new ma("Rendering cancelled, page "+(this._pageIndex+1),e))}operatorListChanged(){this.graphicsReady?(this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||=this._continueBound}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#ni=window.requestAnimationFrame((()=>{this.#ni=null,this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk)&&(this.gfx.endDrawing(),$o.#oi.delete(this._canvas),this.callback()))}}const Uo="4.5.136",qo="3a21f03b0";function Vo(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function Go(t){return Math.max(0,Math.min(255,255*t))}class Wo{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return[t=Go(t),t,t]}static G_HTML([t]){return"#"+(t=Vo(t))+t+t}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(Go)}static RGB_HTML(t){return"#"+t.map(Vo).join("")}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[Go(1-Math.min(1,t+i)),Go(1-Math.min(1,s+i)),Go(1-Math.min(1,e+i))]}static CMYK_HTML(t){return t=this.CMYK_RGB(t).slice(1),this.RGB_HTML(t)}static RGB_CMYK([t,e,s]){return["CMYK",t=1-t,e=1-e,s=1-s,Math.min(t,e,s)]}}class Xo{static setupStorage(t,e,s,i,r){var a=i.getValue(e,{value:null});switch(s.name){case"textarea":null!==a.value&&(t.textContent=a.value),"print"!==r&&t.addEventListener("input",(t=>{i.setValue(e,{value:t.target.value})}));break;case"input":if("radio"===s.attributes.type||"checkbox"===s.attributes.type){if(a.value===s.attributes.xfaOn?t.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&t.removeAttribute("checked"),"print"===r)break;t.addEventListener("change",(t=>{i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})}))}else{if(null!==a.value&&t.setAttribute("value",a.value),"print"===r)break;t.addEventListener("input",(t=>{i.setValue(e,{value:t.target.value})}))}break;case"select":if(null!==a.value){t.setAttribute("value",a.value);for(const t of s.children)t.attributes.value===a.value?t.attributes.selected=!0:t.attributes.hasOwnProperty("selected")&&delete t.attributes.selected}t.addEventListener("input",(t=>{t=-1===(t=t.target.options).selectedIndex?"":t[t.selectedIndex].value,i.setValue(e,{value:t})}))}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:r}){var a,n,o=e.attributes,l=t instanceof HTMLAnchorElement;for([a,n]of("radio"===o.type&&(o.name=o.name+"-"+i),Object.entries(o)))if(null!=n)switch(a){case"class":n.length&&t.setAttribute(a,n.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",n);break;case"style":Object.assign(t.style,n);break;case"textContent":t.textContent=n;break;default:l&&("href"===a||"newWindow"===a)||t.setAttribute(a,n)}l&&r.addLinkAttributes(t,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(t,o.dataId,e,s)}static render(t){var e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,r=t.intent||"display",a=document.createElement(i.name),n=(i.attributes&&this.setAttributes({html:a,element:i,intent:r,linkService:s}),"richText"!==r),o=t.div,l=(o.append(a),t.viewport&&(t=`matrix(${t.viewport.transform.join(",")})`,o.style.transform=t),n&&o.setAttribute("class","xfaLayer xfaFont"),[]);if(0===i.children.length)i.value&&(t=document.createTextNode(i.value),a.append(t),n)&&_o.shouldBuildText(i.name)&&l.push(t);else{for(var h=[[i,-1,a]];0<h.length;){var d,[c,u,p]=h.at(-1);u+1===c.children.length?h.pop():null!==(u=c.children[++h.at(-1)[1]])&&("#text"===(c=u.name)?(d=document.createTextNode(u.value),l.push(d),p.append(d)):(d=u?.attributes?.xmlns?document.createElementNS(u.attributes.xmlns,c):document.createElement(c),p.append(d),u.attributes&&this.setAttributes({html:d,element:u,storage:e,intent:r,linkService:s}),0<u.children?.length?h.push([u,-1,d]):u.value&&(p=document.createTextNode(u.value),n&&_o.shouldBuildText(c)&&l.push(p),d.append(p))))}for(const t of o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))t.setAttribute("readOnly",!0)}return{textDivs:l}}static update(t){var e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Ko=1e3,Yo=new WeakSet;function Qo(t){return{width:t[2]-t[0],height:t[3]-t[1]}}class Jo{static create(t){switch(t.data.annotationType){case Qi:return new tl(t);case Yi:return new el(t);case pr:switch(t.data.fieldType){case"Tx":return new il(t);case"Btn":return t.data.radioButton?new nl(t):new(t.data.checkBox?al:ol)(t);case"Ch":return new ll(t);case"Sig":return new rl(t)}return new sl(t);case cr:return new hl(t);case Ji:return new cl(t);case Zi:return new ul(t);case tr:return new pl(t);case er:return new gl(t);case ir:return new fl(t);case hr:return new vl(t);case dr:return new bl(t);case sr:return new ml(t);case rr:return new yl(t);case ar:return new wl(t);case nr:return new xl(t);case or:return new Al(t);case lr:return new _l(t);case ur:return new Cl(t);default:return new Zo(t)}}}class Zo{#li=null;#hi=!1;#di=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({titleObj:t,contentsObj:e,richText:s}){return!!(t?.str||e?.str||s?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Zo._hasPopupData(this.data)}updateEdited(t){var e;this.container&&(this.#li||={rect:this.data.rect.slice(0)},(e=t.rect)&&this.#ci(e),this.#di?.popup.updateEdited(t))}resetEdited(){this.#li&&(this.#ci(this.#li.rect),this.#di?.popup.resetEdited(),this.#li=null)}#ci(t){var{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:a,pageX:n,pageY:o}}}}=this,{width:s,height:l}=(s?.splice(0,4,...t),Qo(t));e.left=100*(t[0]-n)/r+"%",e.top=100*(a-t[3]+o)/a+"%",0===i?(e.width=100*s/r+"%",e.height=100*l/a+"%"):this.setRotation(i)}_createContainer(t){var{data:e,parent:{page:s,viewport:i}}=this,r=document.createElement("section"),a=(r.setAttribute("data-annotation-id",e.id),this instanceof sl||(r.tabIndex=Ko),r).style;if(a.zIndex=this.parent.zIndex++,e.popupRef&&r.setAttribute("aria-haspopup","dialog"),e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof hl){const t=e.rotation;e.hasOwnCanvas||0===t||this.setRotation(t,r)}else{var{width:n,height:o}=Qo(e.rect);if(!t&&0<e.borderStyle.width){a.borderWidth=e.borderStyle.width+"px";t=e.borderStyle.horizontalCornerRadius;var l=e.borderStyle.verticalCornerRadius;switch(0<t||0<l?a.borderRadius=`calc(${t}px * var(--scale-factor)) / calc(${l}px * var(--scale-factor))`:this instanceof nl&&(a.borderRadius=`calc(${n}px * var(--scale-factor)) / calc(${o}px * var(--scale-factor))`),e.borderStyle.style){case gr:a.borderStyle="solid";break;case fr:a.borderStyle="dashed";break;case mr:Er("Unimplemented border style: beveled");break;case vr:Er("Unimplemented border style: inset");break;case br:a.borderBottomStyle="solid"}(t=e.borderColor||null)?(this.#hi=!0,a.borderColor=qr.makeHexColor(0|t[0],0|t[1],0|t[2])):a.borderWidth=0}l=qr.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]);var{pageWidth:t,pageHeight:s,pageX:i,pageY:h}=i.rawDims;a.left=100*(l[0]-i)/t+"%",a.top=100*(l[1]-h)/s+"%";const d=e.rotation;e.hasOwnCanvas||0===d?(a.width=100*n/t+"%",a.height=100*o/s+"%"):this.setRotation(d,r)}return r}setRotation(t,e=this.container){if(this.data.rect){var{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims,{width:r,height:a}=Qo(this.data.rect);let n,o;o=t%180==0?(n=100*r/s,100*a/i):(n=100*a/s,100*r/i),e.style.width=n+"%",e.style.height=o+"%",e.setAttribute("data-main-rotation",(360-t)%360)}}get _commonActions(){const t=(t,e,s)=>{var i=(t=s.detail[t])[0];t=t.slice(1);s.target.style[e]=Wo[i+"_HTML"](t),this.annotationStorage.setValue(this.data.id,{[e]:Wo[i+"_rgb"](t)})};return Pr(this,"_commonActions",{display:t=>{var e=(t=t.detail.display)%2==1;this.container.style.visibility=e?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:e,noPrint:1===t||2===t})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{t=t.detail.hidden,this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:t=>{setTimeout((()=>t.target.focus({preventScroll:!1})),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:t=>{t=t.detail.rotation,this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(t,e){var s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(this.enableScripting){var e=this.annotationStorage.getRawValue(this.data.id);if(e){var s,i,r=this._commonActions;for([s,i]of Object.entries(e)){var a=r[s];a&&(a({detail:{[s]:i},target:t}),delete e[s])}}}}_createQuadrilaterals(){if(this.container){var t=this.data.quadPoints;if(t){var[e,s,i,r]=this.data.rect.map((t=>Math.fround(t)));if(8===t.length){var[a,n,o,l]=t.subarray(2,6);if(i===a&&r===n&&e===o&&s===l)return}let w;a=this.container.style,this.#hi&&(({borderColor:n,borderWidth:o}=a),a.borderWidth=0,w=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${n}" stroke-width="${o}">`],this.container.classList.add("hasBorder"));var l,h=i-e,d=r-s,c=this.svgFactory,n=((l=c.createElement("svg")).classList.add("quadrilateralsContainer"),l.setAttribute("width",0),l.setAttribute("height",0),c.createElement("defs")),u=(l.append(n),c.createElement("clipPath")),o="clippath_"+this.data.id;u.setAttribute("id",o),u.setAttribute("clipPathUnits","objectBoundingBox"),n.append(u);for(let s=2,i=t.length;s<i;s+=8){var p=t[s],g=t[s+1],f=t[s+2],m=t[s+3],v=c.createElement("rect"),b=(f-e)/h,y=(r-g)/d;p=(p-f)/h,f=(g-m)/d;v.setAttribute("x",b),v.setAttribute("y",y),v.setAttribute("width",p),v.setAttribute("height",f),u.append(v),w?.push(`<rect vector-effect="non-scaling-stroke" x="${b}" y="${y}" width="${p}" height="${f}"/>`)}this.#hi&&(w.push("</g></svg>')"),a.backgroundImage=w.join("")),this.container.append(l),this.container.style.clipPath=`url(#${o})`}}}_createPopup(){var{container:t,data:e}=this,t=(t.setAttribute("aria-haspopup","dialog"),this.#di=new hl({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:"popup_"+e.id,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){Sr("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){var s=[];if(this._fieldObjects){var i=this._fieldObjects[t];if(i)for(var{page:r,id:a,exportValues:n}of i)-1!==r&&a!==e&&(r="string"==typeof n?n:null,(n=document.querySelector(`[data-element-id="${a}"]`))&&!Yo.has(n)?Er("_getElementsByName - element not allowed: "+a):s.push({id:a,exportValue:r,domElement:n}))}else for(const i of document.getElementsByName(t)){var o=i.exportValue,l=i.getAttribute("data-element-id");l!==e&&Yo.has(i)&&s.push({id:l,exportValue:o,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){var t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(this._isEditable){const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",(()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e})}))}}}class tl extends Zo{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){var{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action),i=!0):t.attachment?(this.#ui(s,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(this.#pi(s,t.setOCGState),i=!0):t.dest?(this._bindLink(s,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(s),this.container}#gi(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),!e&&""!==e||this.#gi()}_bindNamedAction(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),this.#gi()}#ui(t,e,s=null){t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,s),!1),this.#gi()}#pi(t,e){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),this.#gi()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");var s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(e.actions)){var i=s.get(r);i&&(t[i]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:r}}),!1))}t.onclick||(t.onclick=()=>!1),this.#gi()}_bindResetFormAction(t,e){const s=t.onclick;s||(t.href=this.linkService.getAnchorUrl("")),this.#gi(),this._fieldObjects?t.onclick=()=>{s?.();var{fields:t,refs:i,include:r}=e,a=[];if(0!==t.length||0!==i.length){var n,o=new Set(i);for(const e of t)for({id:n}of this._fieldObjects[e]||[])o.add(n);for(const t of Object.values(this._fieldObjects))for(const e of t)o.has(e.id)===r&&a.push(e)}else for(const t of Object.values(this._fieldObjects))a.push(...t);var l=this.annotationStorage,h=[];for(const t of a){var d=t.id;switch(h.push(d),t.type){case"text":var c=t.defaultValue||"";l.setValue(d,{value:c});break;case"checkbox":case"radiobutton":c=t.defaultValue===t.exportValues,l.setValue(d,{value:c});break;case"combobox":case"listbox":var u=t.defaultValue||"";l.setValue(d,{value:u});break;default:continue}var p=document.querySelector(`[data-element-id="${d}"]`);p&&(Yo.has(p)?p.dispatchEvent(new Event("resetform")):Er("_bindResetFormAction - element not allowed: "+d))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}}),!1}:(Er('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1))}}class el extends Zo{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");var t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class sl extends Zo{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&("CANVAS"===t.previousSibling?.nodeName&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return $r.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,r){s.includes("mouse")?t.addEventListener(s,(t=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(t),shift:t.shiftKey,modifier:this._getKeyModifier(t)}})})):t.addEventListener(s,(t=>{if("blur"===s){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===s){if(e.focused)return;e.focused=!0}r&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(t)}})}))}_setEventListeners(t,e,s,i){for(var[r,a]of s)"Action"!==a&&!this.data.actions?.[a]||("Focus"!==a&&"Blur"!==a||(e||={focused:!1}),this._setEventListener(t,e,r,a,i),"Focus"!==a||this.data.actions?.Blur?"Blur"!==a||this.data.actions?.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}_setBackgroundColor(t){var e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":qr.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){var e=this.data.defaultAppearanceData.fontColor,s=this.data.defaultAppearanceData.fontSize||9;t=t.style;let i;var r,a,n=t=>Math.round(10*t)/10;i=this.data.multiLine?(a=Math.abs(this.data.rect[3]-this.data.rect[1]-2),r=Math.round(a/(Pi*s))||1,Math.min(s,n(a/r/Pi))):(a=Math.abs(this.data.rect[3]-this.data.rect[1]-2),Math.min(s,n(a/Pi))),t.fontSize=`calc(${i}px * var(--scale-factor))`,t.color=qr.makeHexColor(e[0],e[1],e[2]),null!==this.data.textAlignment&&(t.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class il extends sl{constructor(t){super(t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue})}setPropertyOnSiblings(t,e,s,i){var r=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=s),r.setValue(a.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){var i=t.getValue(e,{value:this.data.fieldValue});let a=i.value||"";var r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&a.length>r&&(a=a.slice(0,r));let n=i.formattedValue||this.data.textContent?.join("\n")||null;n&&this.data.comb&&(n=n.replaceAll(/\s+/g,""));const o={userValue:a,formattedValue:n,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((s=document.createElement("textarea")).textContent=n??a,this.data.doNotScroll&&(s.style.overflowY="hidden")):((s=document.createElement("input")).type="text",s.setAttribute("value",n??a),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Yo.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=Ko,this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",(i=>{t.setValue(e,{value:i.target.value}),this.setPropertyOnSiblings(s,"value",i.target.value,"value"),o.formattedValue=null})),s.addEventListener("resetform",(t=>{var e=this.data.defaultFieldValue??"";s.value=o.userValue=e,o.formattedValue=null}));let l=t=>{var e=o.formattedValue;null!=e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",(t=>{o.focused||(t=t.target,o.userValue&&(t.value=o.userValue),o.lastCommittedValue=t.value,o.commitKey=1,this.data.actions?.Focus)||(o.focused=!0)})),s.addEventListener("updatefromsandbox",(s=>{this.showElementAndHideCanvas(s.target),this._dispatchEventFromSandbox({value(s){o.userValue=s.detail.value??"",t.setValue(e,{value:o.userValue.toString()}),s.target.value=o.userValue},formattedValue(s){var i=s.detail.formattedValue;null!=(o.formattedValue=i)&&s.target!==document.activeElement&&(s.target.value=i),t.setValue(e,{formattedValue:i})},selRange(t){t.target.setSelectionRange(...t.detail.selRange)},charLimit:s=>{var i=s.detail.charLimit;s=s.target;if(0===i)s.removeAttribute("maxLength");else{s.setAttribute("maxLength",i);let r=o.userValue;!r||r.length<=i||(r=r.slice(0,i),s.value=o.userValue=r,t.setValue(e,{value:r}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}}},s)})),s.addEventListener("keydown",(t=>{let s=-(o.commitKey=1);var i;"Escape"===t.key?s=0:"Enter"!==t.key||this.data.multiLine?"Tab"===t.key&&(o.commitKey=3):s=2,-1!==s&&(i=t.target.value,o.lastCommittedValue!==i)&&(o.lastCommittedValue=i,o.userValue=i,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:i,willCommit:!0,commitKey:s,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}))}));const i=l;l=null,s.addEventListener("blur",(t=>{var s;o.focused&&t.relatedTarget&&(this.data.actions?.Blur||(o.focused=!1),s=t.target.value,o.userValue=s,o.lastCommittedValue!==s&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:s,willCommit:!0,commitKey:o.commitKey,selStart:t.target.selectionStart,selEnd:t.target.selectionEnd}}),i(t))})),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",(t=>{o.lastCommittedValue=null;var{data:s,target:i}=t,{value:r,selectionStart:a,selectionEnd:n}=i;let l=a,h=n;switch(t.inputType){case"deleteWordBackward":var d=r.substring(0,a).match(/\w*[^\w]*$/);d&&(l-=d[0].length);break;case"deleteWordForward":(d=r.substring(a).match(/^[^\w]*\w*/))&&(h+=d[0].length);break;case"deleteContentBackward":a===n&&--l;break;case"deleteContentForward":a===n&&(h+=1)}t.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:r,change:s||"",willCommit:!1,selStart:l,selEnd:h}})})),this._setEventListeners(s,o,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.value))}l&&s.addEventListener("blur",l),this.data.comb&&(i=(this.data.rect[2]-this.data.rect[0])/r,s.classList.add("comb"),s.style.letterSpacing=`calc(${i}px * var(--scale-factor) - 1ch)`)}else(s=document.createElement("div")).textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class rl extends sl{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class al extends sl{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;"string"==typeof i&&(i="Off"!==i,t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var r=document.createElement("input");return Yo.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",e.exportValue),r.tabIndex=Ko,r.addEventListener("change",(i=>{var{name:i,checked:r}=i.target;for(const n of this._getElementsByName(i,s)){var a=r&&n.exportValue===e.exportValue;n.domElement&&(n.domElement.checked=a),t.setValue(n.id,{value:a})}t.setValue(s,{value:r})})),r.addEventListener("resetform",(t=>{var s=e.defaultFieldValue||"Off";t.target.checked=s===e.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({value(e){e.target.checked="Off"!==e.detail.value,t.setValue(s,{value:e.target.checked})}},e)})),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class nl extends sl{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if("string"==typeof i&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const i of this._getElementsByName(e.fieldName,s))t.setValue(i.id,{value:!1});var r=document.createElement("input");if(Yo.add(r),r.setAttribute("data-element-id",s),r.disabled=e.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=e.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=Ko,r.addEventListener("change",(e=>{var{name:e,checked:i}=e.target;for(const i of this._getElementsByName(e,s))t.setValue(i.id,{value:!1});t.setValue(s,{value:i})})),r.addEventListener("resetform",(t=>{var s=e.defaultFieldValue;t.target.checked=null!=s&&s===e.buttonValue})),this.enableScripting&&this.hasJSActions){const i=e.buttonValue;r.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({value:e=>{var r=i===e.detail.value;for(const i of this._getElementsByName(e.target.name)){var a=r&&i.id===s;i.domElement&&(i.domElement.checked=a),t.setValue(i.id,{value:a})}}},e)})),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(t=>t.target.checked))}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class ol extends tl{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){var t=super.render(),e=(t.classList.add("buttonWidgetAnnotation","pushButton"),t.lastChild);return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",(t=>{this._dispatchEventFromSandbox({},t)}))),t}}class ll extends sl{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id;var s=t.getValue(e,{value:this.data.fieldValue});const i=document.createElement("select");Yo.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=Ko;let r=this.data.combo&&0<this.data.options.length;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",(t=>{var e=this.data.defaultFieldValue;for(const t of i.options)t.selected=t.value===e}));for(const t of this.data.options){var a=document.createElement("option");a.textContent=t.displayValue,a.value=t.exportValue,s.value.includes(t.exportValue)&&(a.setAttribute("selected",!0),r=!1),i.append(a)}let n=null;if(r){const t=document.createElement("option");t.value=" ",t.setAttribute("hidden",!0),t.setAttribute("selected",!0),i.prepend(t),n=()=>{t.remove(),i.removeEventListener("input",n),n=null},i.addEventListener("input",n)}const o=t=>{const e=t?"value":"textContent";var{options:t,multiple:s}=i;return s?Array.prototype.filter.call(t,(t=>t.selected)).map((t=>t[e])):-1===t.selectedIndex?null:t[t.selectedIndex][e]};let l=o(!1);const h=t=>(t=t.target.options,Array.prototype.map.call(t,(t=>({displayValue:t.textContent,exportValue:t.value}))));return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",(s=>{this._dispatchEventFromSandbox({value(s){n?.();s=s.detail.value;var r=new Set(Array.isArray(s)?s:[s]);for(const t of i.options)t.selected=r.has(t.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(t){i.multiple=!0},remove(s){var r=i.options,a=s.detail.remove;r[a].selected=!1,i.remove(a),0<r.length&&-1===Array.prototype.findIndex.call(r,(t=>t.selected))&&(r[0].selected=!0),t.setValue(e,{value:o(!0),items:h(s)}),l=o(!1)},clear(s){for(;0!==i.length;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(s){var{index:r,displayValue:a,exportValue:n}=s.detail.insert,r=i.children[r],d=document.createElement("option");d.textContent=a,d.value=n,r?r.before(d):i.append(d),t.setValue(e,{value:o(!0),items:h(s)}),l=o(!1)},items(s){for(var r=s.detail.items;0!==i.length;)i.remove(0);for(const t of r){var{displayValue:a,exportValue:n}=t,d=document.createElement("option");d.textContent=a,d.value=n,i.append(d)}0<i.options.length&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:h(s)}),l=o(!1)},indices(s){var i=new Set(s.detail.indices);for(const t of s.target.options)t.selected=i.has(t.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(t){t.target.disabled=!t.detail.editable}},s)})),i.addEventListener("input",(s=>{var i=o(!0),r=o(!1);t.setValue(e,{value:i}),s.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:r,changeEx:i,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(t=>t.target.value))):i.addEventListener("input",(function(s){t.setValue(e,{value:o(!0)})})),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class hl extends Zo{constructor(t){var{data:e,elements:s}=t;super(t,{isRenderable:Zo._hasPopupData(e)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");var t=this.popup=new dl({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),e=[];for(const s of this.elements)s.popup=t,e.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",e.map((t=>""+Xr+t)).join(",")),this.container}}class dl{#fi=this.#mi.bind(this);#vi=this.#bi.bind(this);#yi=this.#wi.bind(this);#xi=this.#Ai.bind(this);#_i=null;#vt=null;#Ci=null;#ki=null;#Ei=null;#Si=null;#Ti=null;#Mi=!1;#Pi=null;#C=null;#Li=null;#Ri=null;#Ii=null;#li=null;#Di=!1;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:r,contentsObj:a,richText:n,parent:o,rect:l,parentRect:h,open:d}){this.#vt=t,this.#Ii=i,this.#Ci=a,this.#Ri=n,this.#Si=o,this.#_i=e,this.#Li=l,this.#Ti=h,this.#Ei=s,this.#ki=ka.toDateObject(r),this.trigger=s.flatMap((t=>t.getElementsToTriggerPopup()));for(const t of this.trigger)t.addEventListener("click",this.#xi),t.addEventListener("mouseenter",this.#yi),t.addEventListener("mouseleave",this.#vi),t.classList.add("popupTriggerArea");for(const t of s)t.container?.addEventListener("keydown",this.#fi);this.#vt.hidden=!0,d&&this.#Ai()}render(){if(!this.#Pi){var t=this.#Pi=document.createElement("div");if(t.className="popup",this.#_i){var e=t.style.outlineColor=qr.makeHexColor(...this.#_i);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor=`color-mix(in srgb, ${e} 30%, white)`:t.style.backgroundColor=qr.makeHexColor(...this.#_i.map((t=>Math.floor(.7*(255-t)+t))))}var s=((e=document.createElement("span")).className="header",document.createElement("h1"));(e=(e.append(s),({dir:s.dir,str:s.textContent}=this.#Ii),t.append(e),this.#ki&&((s=document.createElement("span")).classList.add("popupDate"),s.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),s.setAttribute("data-l10n-args",JSON.stringify({date:this.#ki.toLocaleDateString(),time:this.#ki.toLocaleTimeString()})),e.append(s)),this.#Fi))?(Xo.render({xfaHtml:e,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent")):(s=this._formatContents(this.#Ci),t.append(s)),this.#vt.append(t)}}get#Fi(){var t=this.#Ri,e=this.#Ci;return t?.str&&(!e?.str||e.str===t.str)&&this.#Ri.html||null}get#Oi(){return this.#Fi?.attributes?.style?.fontSize||0}get#Ni(){return this.#Fi?.attributes?.style?.color||null}#Bi(t){var e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#Ni,fontSize:this.#Oi?`calc(${this.#Oi}px * var(--scale-factor))`:""}};for(const s of t.split("\n"))e.push({name:"span",value:s,attributes:i});return s}_formatContents({str:t,dir:e}){var s=document.createElement("p"),i=(s.classList.add("popupContent"),s.dir=e,t.split(/(?:\r\n?|\n)/));for(let t=0,e=i.length;t<e;++t){var r=i[t];s.append(document.createTextNode(r)),t<e-1&&s.append(document.createElement("br"))}return s}#mi(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&this.#Mi)&&this.#Ai()}updateEdited({rect:t,popupContent:e}){this.#li||={contentsObj:this.#Ci,richText:this.#Ri},t&&(this.#C=null),e&&(this.#Ri=this.#Bi(e),this.#Ci=null),this.#Pi?.remove(),this.#Pi=null}resetEdited(){this.#li&&(({contentsObj:this.#Ci,richText:this.#Ri}=this.#li),this.#li=null,this.#Pi?.remove(),this.#Pi=null,this.#C=null)}#zi(){if(null===this.#C){var{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:r}}}=this.#Si;let n=!!this.#Ti,o=n?this.#Ti:this.#Li;for(const t of this.#Ei)if(!o||null!==qr.intersect(t.data.rect,o)){o=t.data.rect,n=!0;break}t=qr.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]);var a=n?o[2]-o[0]+5:0,t=(a=t[0]+a,t[1]);(a=(this.#C=[100*(a-i)/e,100*(t-r)/s],this.#vt).style).left=this.#C[0]+"%",a.top=this.#C[1]+"%"}}#Ai(){this.#Mi=!this.#Mi,this.#Mi?(this.#wi(),this.#vt.addEventListener("click",this.#xi),this.#vt.addEventListener("keydown",this.#fi)):(this.#bi(),this.#vt.removeEventListener("click",this.#xi),this.#vt.removeEventListener("keydown",this.#fi))}#wi(){this.#Pi||this.render(),this.isVisible?this.#Mi&&this.#vt.classList.add("focused"):(this.#zi(),this.#vt.hidden=!1,this.#vt.style.zIndex=parseInt(this.#vt.style.zIndex)+1e3)}#bi(){this.#vt.classList.remove("focused"),!this.#Mi&&this.isVisible&&(this.#vt.hidden=!0,this.#vt.style.zIndex=parseInt(this.#vt.style.zIndex)-1e3)}forceHide(){this.#Di=this.isVisible,this.#Di&&(this.#vt.hidden=!0)}maybeShow(){this.#Di&&(this.#Pi||this.#wi(),this.#Di=!1,this.#vt.hidden=!1)}get isVisible(){return!1===this.#vt.hidden}}class cl extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=Hi.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const s of this.textContent){var e=document.createElement("span");e.textContent=s,t.append(e)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class ul extends Zo{#Hi=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");var t,e=this.data,{width:s,height:t}=Qo(e.rect),s=this.svgFactory.create(s,t,!0);return(t=this.#Hi=this.svgFactory.createElement("svg:line")).setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),t.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),t.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),t.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),t.setAttribute("stroke-width",e.borderStyle.width||1),t.setAttribute("stroke","transparent"),t.setAttribute("fill","transparent"),s.append(t),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#Hi}addHighlightArea(){this.container.classList.add("highlightArea")}}class pl extends Zo{#ji=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");var t=this.data,{width:e,height:s}=Qo(t.rect),i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,a=this.#ji=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",e-r),a.setAttribute("height",s-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#ji}addHighlightArea(){this.container.classList.add("highlightArea")}}class gl extends Zo{#$i=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");var t=this.data,{width:e,height:s}=Qo(t.rect),i=this.svgFactory.create(e,s,!0),r=t.borderStyle.width,a=this.#$i=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",e/2),a.setAttribute("cy",s/2),a.setAttribute("rx",e/2-r/2),a.setAttribute("ry",s/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#$i}addHighlightArea(){this.container.classList.add("highlightArea")}}class fl extends Zo{#Ui=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);var{rect:t,vertices:e,borderStyle:s,popupRef:i}=this.data;if(e){var{width:r,height:a}=Qo(t),r=this.svgFactory.create(r,a,!0);let l=[];for(let s=0,i=e.length;s<i;s+=2){var n=e[s]-t[0],o=t[3]-e[s+1];l.push(n+","+o)}l=l.join(" "),(a=this.#Ui=this.svgFactory.createElement(this.svgElementName)).setAttribute("points",l),a.setAttribute("stroke-width",s.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!i&&this.hasPopupData&&this._createPopup()}return this.container}getElementsToTriggerPopup(){return this.#Ui}addHighlightArea(){this.container.classList.add("highlightArea")}}class ml extends fl{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class vl extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class bl extends Zo{#qi=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=Hi.INK}render(){this.container.classList.add(this.containerClassName);var{rect:t,inkLists:e,borderStyle:s,popupRef:i}=this.data,{width:r,height:a}=Qo(t),n=this.svgFactory.create(r,a,!0);for(const r of e){let e=[];for(let s=0,i=r.length;s<i;s+=2){var o=r[s]-t[0],l=t[3]-r[s+1];e.push(o+","+l)}e=e.join(" ");var h=this.svgFactory.createElement(this.svgElementName);this.#qi.push(h),h.setAttribute("points",e),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),!i&&this.hasPopupData&&this._createPopup(),n.append(h)}return this.container.append(n),this.container}getElementsToTriggerPopup(){return this.#qi}addHighlightArea(){this.container.classList.add("highlightArea")}}class yl extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class wl extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class xl extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Al extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class _l extends Zo{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Cl extends Zo{#Vi=null;constructor(t){super(t,{isRenderable:!0}),t=this.data.file,this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");var{container:t,data:e}=this;let s;e.hasAppearance||0===e.fillAlpha?s=document.createElement("div"):((s=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(100*e.fillAlpha)}%);`)),s.addEventListener("dblclick",this.#Gi.bind(this)),this.#Vi=s;const i=$r.platform.isMac;return t.addEventListener("keydown",(t=>{"Enter"===t.key&&(i?t.metaKey:t.ctrlKey)&&this.#Gi()})),!e.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#Vi}addHighlightArea(){this.container.classList.add("highlightArea")}#Gi(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class kl{#Wi=null;#Xi=null;#Ki=new Map;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:a}){this.div=t,this.#Wi=e,this.#Xi=s,this.page=r,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return 0<this.#Ki.size}#Yi(t,e){var s=t.firstChild||t;s.id=""+Xr+e,this.div.append(t),this.#Wi?.moveElementInDOM(this.div,t,s,!1)}async render(t){var e=t.annotations,s=this.div,i=(Pa(s,this.viewport),new Map),r={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:!1!==t.renderForms,svgFactory:new ga,annotationStorage:t.annotationStorage||new Xa,enableScripting:!0===t.enableScripting,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const t of e)if(!t.noHTML){var a=t.annotationType===cr;if(a){var n;if(!(n=i.get(t.id)))continue;r.elements=n}else{var{width:n,height:o}=Qo(t.rect);if(n<=0||o<=0)continue}r.data=t,(o=Jo.create(r)).isRenderable&&(!a&&t.popupRef&&((a=i.get(t.popupRef))?a.push(o):i.set(t.popupRef,[o])),a=o.render(),t.hidden&&(a.style.visibility="hidden"),this.#Yi(a,t.id),o._isEditable)&&(this.#Ki.set(o.data.id,o),this._annotationEditorUIManager?.renderAnnotationElement(o))}this.#Qi()}update({viewport:t}){var e=this.div;Pa(e,{rotation:(this.viewport=t).rotation}),this.#Qi(),e.hidden=!1}#Qi(){if(this.#Xi){var t,e,s=this.div;for([t,e]of this.#Xi){var i,r=s.querySelector(`[data-annotation-id="${t}"]`);r&&(e.className="annotationContent",(i=r.firstChild)?"CANVAS"===i.nodeName?i.replaceWith(e):i.classList.contains("annotationContent")?i.after(e):i.before(e):r.append(e))}this.#Xi.clear()}}getEditableAnnotations(){return Array.from(this.#Ki.values())}getEditableAnnotation(t){return this.#Ki.get(t)}}const El=/\r\n?|\n/g;class Sl extends ja{#Ji=this.editorDivBlur.bind(this);#Zi=this.editorDivFocus.bind(this);#tr=this.editorDivInput.bind(this);#er=this.editorDivKeydown.bind(this);#sr=this.editorDivPaste.bind(this);#_i;#ir="";#rr=this.id+"-editor";#Oi;#ar=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){var t=Sl.prototype,e=t=>t.isEmpty(),s=za.TRANSLATE_SMALL,i=za.TRANSLATE_BIG;return Pr(this,"_keyboardManager",new Na([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=Hi.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.#_i=t.color||Sl._defaultColor||ja._defaultLineColor,this.#Oi=t.fontSize||Sl._defaultFontSize}static initialize(t,e){ja.initialize(t,e,{strings:["pdfjs-free-text-default-content"]}),t=getComputedStyle(document.documentElement),this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case ji.FREETEXT_SIZE:Sl._defaultFontSize=e;break;case ji.FREETEXT_COLOR:Sl._defaultColor=e}}updateParams(t,e){switch(t){case ji.FREETEXT_SIZE:this.#nr(e);break;case ji.FREETEXT_COLOR:this.#or(e)}}static get defaultPropertiesToUpdate(){return[[ji.FREETEXT_SIZE,Sl._defaultFontSize],[ji.FREETEXT_COLOR,Sl._defaultColor||ja._defaultLineColor]]}get propertiesToUpdate(){return[[ji.FREETEXT_SIZE,this.#Oi],[ji.FREETEXT_COLOR,this.#_i]]}#nr(t){var e=t=>{this.editorDiv.style.fontSize=`calc(${t}px * var(--scale-factor))`,this.translate(0,-(t-this.#Oi)*this.parentScale),this.#Oi=t,this.#lr()},s=this.#Oi;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#or(t){var e=t=>{this.#_i=this.editorDiv.style.color=t},s=this.#_i;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){var t=this.parentScale;return[-Sl._internalPadding*t,-(Sl._internalPadding+this.#Oi)*t]}rebuild(){this.parent&&(super.rebuild(),null===this.div||this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){var t;this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(Hi.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),t=this._uiManager._signal,this.editorDiv.addEventListener("keydown",this.#er,{signal:t}),this.editorDiv.addEventListener("focus",this.#Zi,{signal:t}),this.editorDiv.addEventListener("blur",this.#Ji,{signal:t}),this.editorDiv.addEventListener("input",this.#tr,{signal:t}),this.editorDiv.addEventListener("paste",this.#sr,{signal:t}))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#rr),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#er),this.editorDiv.removeEventListener("focus",this.#Zi),this.editorDiv.removeEventListener("blur",this.#Ji),this.editorDiv.removeEventListener("input",this.#tr),this.editorDiv.removeEventListener("paste",this.#sr),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv)&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#hr(){var t=[];this.editorDiv.normalize();for(const e of this.editorDiv.childNodes)t.push(Sl.#dr(e));return t.join("\n")}#lr(){var t,e,s,i,[r,a]=this.parentDimensions;let n;this.isAttachedToDOM?n=this.div.getBoundingClientRect():(({currentLayer:t,div:e}=this),s=e.style.display,i=e.classList.contains("hidden"),e.classList.remove("hidden"),e.style.display="hidden",t.div.append(this.div),n=e.getBoundingClientRect(),e.remove(),e.style.display=s,e.classList.toggle("hidden",i)),this.rotation%180==this.parentRotation%180?(this.width=n.width/r,this.height=n.height/a):(this.width=n.height/r,this.height=n.width/a),this.fixAndSetPosition()}commit(){if(this.isInEditMode()){super.commit(),this.disableEditMode();const t=this.#ir,e=this.#ir=this.#hr().trimEnd();if(t!==e){const s=t=>{(this.#ir=t)?(this.#cr(),this._uiManager.rebuild(this),this.#lr()):this.remove()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#lr()}}}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Sl._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(!this.div){let o,l;var t;if(this.width&&(o=this.x,l=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#rr),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),ja._l10nPromise.get("pdfjs-free-text-default-content").then((t=>this.editorDiv?.setAttribute("default-content",t))),this.editorDiv.contentEditable=!0,(t=this.editorDiv.style).fontSize=`calc(${this.#Oi}px * var(--scale-factor))`,t.color=this.#_i,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ia(this,this.div,["dblclick","keydown"]),this.width){var[t,e]=this.parentDimensions;if(this.annotationElementId){var s=this.#ar.position;let[h,d]=this.getInitialTranslation();[h,d]=this.pageTranslationToScreen(h,d);var[i,r]=this.pageDimensions,[a,n]=this.pageTranslation;let c,u;switch(this.rotation){case 0:c=o+(s[0]-a)/i,u=l+this.height-(s[1]-n)/r;break;case 90:c=o+(s[0]-a)/i,u=l-(s[1]-n)/r,[h,d]=[d,-h];break;case 180:c=o-this.width+(s[0]-a)/i,u=l-(s[1]-n)/r,[h,d]=[-h,-d];break;case 270:c=o+(s[0]-a-this.height*r)/i,u=l+(s[1]-n-this.width*i)/r,[h,d]=[-d,h]}this.setAt(c*t,u*e,h,d)}else this.setAt(o*t,l*e,this.width*t,this.height*e);this.#cr(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0}return this.div}static#dr(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(El,"")}editorDivPaste(t){var e=t.clipboardData||window.clipboardData,s=e.types;if((1!==s.length||"text/plain"!==s[0])&&(t.preventDefault(),(s=Sl.#ur(e.getData("text")||"").replaceAll(El,"\n"))&&(t=window.getSelection()).rangeCount))if(this.editorDiv.normalize(),t.deleteFromDocument(),e=t.getRangeAt(0),s.includes("\n")){var{startContainer:i,startOffset:r}=e,a=[],n=[];if(i.nodeType===Node.TEXT_NODE){var o=i.parentElement;if(n.push(i.nodeValue.slice(r).replaceAll(El,"")),o!==this.editorDiv){let t=a;for(const e of this.editorDiv.childNodes)e===o?t=n:t.push(Sl.#dr(e))}a.push(i.nodeValue.slice(0,r).replaceAll(El,""))}else if(i===this.editorDiv){let t=a,e=0;for(const s of this.editorDiv.childNodes)(t=e++===r?n:t).push(Sl.#dr(s))}this.#ir=""+a.join("\n")+s+n.join("\n"),this.#cr();var l,h=new Range;let c=a.reduce(((t,e)=>t+e.length),0);for({firstChild:l}of this.editorDiv.childNodes)if(l.nodeType===Node.TEXT_NODE){var d=l.nodeValue.length;if(c<=d){h.setStart(l,c),h.setEnd(l,c);break}c-=d}t.removeAllRanges(),t.addRange(h)}else e.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),t.collapseToStart()}#cr(){if(this.editorDiv.replaceChildren(),this.#ir)for(const e of this.#ir.split("\n")){var t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#pr(){return this.#ir.replaceAll(" "," ")}static#ur(t){return t.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static deserialize(t,e,s){let i=null;if(t instanceof cl){var{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:n,rotation:o,id:l},textContent:h,textPosition:d,parent:{page:{pageNumber:c}}}=t;if(!h||0===h.length)return null;i=t={annotationType:Hi.FREETEXT,color:Array.from(a),fontSize:r,value:h.join("\n"),position:d,pageIndex:c-1,rect:n.slice(0),rotation:o,id:l,deleted:!1}}return(a=super.deserialize(t,e,s)).#Oi=t.fontSize,a.#_i=qr.makeHexColor(...t.color),a.#ir=Sl.#ur(t.value),a.annotationElementId=t.id||null,a.#ar=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};var e=Sl._internalPadding*this.parentScale,s=(e=this.getRect(e,e),ja._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#_i));s={annotationType:Hi.FREETEXT,color:s,fontSize:this.#Oi,value:this.#pr(),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId};if(!t){if(this.annotationElementId&&!this.#gr(s))return null;s.id=this.annotationElementId}return s}#gr(t){const{value:e,fontSize:s,color:i,pageIndex:r}=this.#ar;return this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some(((t,e)=>t!==i[e]))||t.pageIndex!==r}renderAnnotationElement(t){var e=super.renderAnnotationElement(t);if(!this.deleted){var s=e.style;s.fontSize=`calc(${this.#Oi}px * var(--scale-factor))`,s.color=this.#_i,e.replaceChildren();for(const t of this.#ir.split("\n")){var i=document.createElement("div");i.append(t?document.createTextNode(t):document.createElement("br")),e.append(i)}s=Sl._internalPadding*this.parentScale,t.updateEdited({rect:this.getRect(s,s),popupContent:this.#ir})}return e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class Tl{#fr;#mr=[];#vr=[];constructor(t,e=0,s=0,i=!0){let r=1/0,a=-1/0,n=1/0,o=-1/0;var l,h,d,c,u=10**-4;for({x:l,y:h,width:d,height:c}of t){var p=Math.floor((l-e)/u)*u,g=Math.ceil((l+d+e)/u)*u,f=Math.floor((h-e)/u)*u,m=Math.ceil((h+c+e)/u)*u;this.#mr.push([p,f,m,!0],[g,f,m,!1]),r=Math.min(r,p),a=Math.max(a,g),n=Math.min(n,f),o=Math.max(o,m)}var v=a-r+2*s,b=o-n+2*s,y=r-s,w=n-s;s=[(t=this.#mr.at(i?-1:-2))[0],t[2]];for(const t of this.#mr){var[x,A,_]=t;t[0]=(x-y)/v,t[1]=(A-w)/b,t[2]=(_-w)/b}this.#fr={x:y,y:w,width:v,height:b,lastPoint:s}}getOutlines(){this.#mr.sort(((t,e)=>t[0]-e[0]||t[1]-e[1]||t[2]-e[2]));var t=[];for(const e of this.#mr)e[3]?(t.push(...this.#br(e)),this.#yr(e)):(this.#wr(e),t.push(...this.#br(e)));return this.#xr(t)}#xr(t){var e=[],s=new Set;for(const s of t){var[i,r,a]=s;e.push([i,r,s],[i,a,s])}e.sort(((t,e)=>t[1]-e[1]||t[0]-e[0]));for(let t=0,i=e.length;t<i;t+=2){var n=e[t][2],o=e[t+1][2];n.push(o),o.push(n),s.add(n),s.add(o)}for(var l,h=[];0<s.size;){var d=s.values().next().value;let[t,e,i,r,a]=d,n=(s.delete(d),t),o=e;for(h.push(l=[t,i]);;){let h;if(s.has(r))h=r;else{if(!s.has(a))break;h=a}s.delete(h),[t,e,i,r,a]=h,n!==t&&(l.push(n,o,t,o===e?e:i),n=t),o=o===e?i:e}l.push(n,o)}return new Pl(h,this.#fr)}#Ar(t){var e=this.#vr;let s=0,i=e.length-1;for(;s<=i;){var r=s+i>>1,a=e[r][0];if(a===t)return r;a<t?s=1+r:i=r-1}return i+1}#yr([,t,e]){var s=this.#Ar(t);this.#vr.splice(s,0,[t,e])}#wr([,t,e]){var s=this.#Ar(t);for(let a=s;a<this.#vr.length;a++){var[i,r]=this.#vr[a];if(i!==t)break;if(i===t&&r===e)return void this.#vr.splice(a,1)}for(let i=s-1;0<=i;i--){var[a,n]=this.#vr[i];if(a!==t)break;if(a===t&&n===e)return void this.#vr.splice(i,1)}}#br(t){var[e,t,s]=t,i=[[e,t,s]],r=this.#Ar(s);for(let t=0;t<r;t++){var[a,n]=this.#vr[t];for(let t=0,s=i.length;t<s;t++){var[,o,l]=i[t];if(!(n<=o||l<=a))if(a<=o)if(n<l)i[t][1]=n;else{if(1===s)return[];i.splice(t,1),t--,s--}else i[t][2]=a,n<l&&i.push([e,n,l])}}return i}}class Ml{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(t,e){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof Rl}}class Pl extends Ml{#fr;#_r;constructor(t,e){super(),this.#_r=t,this.#fr=e}toSVGPath(){var t=[];for(const i of this.#_r){let[r,a]=i;t.push(`M${r} `+a);for(let n=2;n<i.length;n+=2){var e=i[n],s=i[n+1];e===r?(t.push("V"+s),a=s):s===a&&(t.push("H"+e),r=e)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],r){var a=[],n=s-t,o=i-e;for(const e of this.#_r){var l=new Array(e.length);for(let s=0;s<e.length;s+=2)l[s]=t+e[s]*n,l[s+1]=i-e[s+1]*o;a.push(l)}return a}get box(){return this.#fr}}class Ll{#fr;#Cr=[];#kr;#Er;#Sr=[];#Tr=new Float64Array(18);#Mr;#Pr;#Lr;#Rr;#Ir;#Dr;#Fr=[];static#Or=8;static#Nr=2;static#Br=Ll.#Or+Ll.#Nr;constructor({x:t,y:e},s,i,r,a,n=0){this.#fr=s,this.#Dr=r*i,this.#Er=a,this.#Tr.set([NaN,NaN,NaN,NaN,t,e],6),this.#kr=n,this.#Rr=Ll.#Or*i,this.#Lr=Ll.#Br*i,this.#Ir=i,this.#Fr.push(t,e)}get free(){return!0}isEmpty(){return isNaN(this.#Tr[8])}#zr(){var t=this.#Tr.subarray(4,6),e=this.#Tr.subarray(16,18),[s,i,r,a]=this.#fr;return[(this.#Mr+(t[0]-e[0])/2-s)/r,(this.#Pr+(t[1]-e[1])/2-i)/a,(this.#Mr+(e[0]-t[0])/2-s)/r,(this.#Pr+(e[1]-t[1])/2-i)/a]}add({x:t,y:e}){this.#Mr=t,this.#Pr=e;var[s,i,r,a]=this.#fr;let[n,o,l,h]=this.#Tr.subarray(8,12);var d=t-l,c=e-h;if((u=Math.hypot(d,c))<this.#Lr)return!1;var u,p=u-this.#Rr;let g=n,f=o;return n=l,o=h,l+=d=(u=p/u)*d,h+=u=u*c,this.#Fr?.push(t,e),c=-u/p*this.#Dr,t=d/p*this.#Dr,this.#Tr.set(this.#Tr.subarray(2,8),0),this.#Tr.set([l+c,h+t],4),this.#Tr.set(this.#Tr.subarray(14,18),12),this.#Tr.set([l-c,h-t],16),isNaN(this.#Tr[6])?(0===this.#Sr.length&&(this.#Tr.set([n+c,o+t],2),this.#Sr.push(NaN,NaN,NaN,NaN,(n+c-s)/r,(o+t-i)/a),this.#Tr.set([n-c,o-t],14),this.#Cr.push(NaN,NaN,NaN,NaN,(n-c-s)/r,(o-t-i)/a)),this.#Tr.set([g,f,n,o,l,h],6),!this.isEmpty()):(this.#Tr.set([g,f,n,o,l,h],6),Math.abs(Math.atan2(f-o,g-n)-Math.atan2(u,d))<Math.PI/2?([n,o,l,h]=this.#Tr.subarray(2,6),this.#Sr.push(NaN,NaN,NaN,NaN,((n+l)/2-s)/r,((o+h)/2-i)/a),[n,o,g,f]=this.#Tr.subarray(14,18),this.#Cr.push(NaN,NaN,NaN,NaN,((g+n)/2-s)/r,((f+o)/2-i)/a)):([g,f,n,o,l,h]=this.#Tr.subarray(0,6),this.#Sr.push(((g+5*n)/6-s)/r,((f+5*o)/6-i)/a,((5*n+l)/6-s)/r,((5*o+h)/6-i)/a,((n+l)/2-s)/r,((o+h)/2-i)/a),[l,h,n,o,g,f]=this.#Tr.subarray(12,18),this.#Cr.push(((g+5*n)/6-s)/r,((f+5*o)/6-i)/a,((5*n+l)/6-s)/r,((5*o+h)/6-i)/a,((n+l)/2-s)/r,((o+h)/2-i)/a)),!0)}toSVGPath(){if(this.isEmpty())return"";var t=this.#Sr,e=this.#Cr,s=this.#Tr.subarray(4,6),i=this.#Tr.subarray(16,18),[r,a,n,o]=this.#fr,[l,h,d,c]=this.#zr();if(isNaN(this.#Tr[6])&&!this.isEmpty())return`M${(this.#Tr[2]-r)/n} ${(this.#Tr[3]-a)/o} L${(this.#Tr[4]-r)/n} ${(this.#Tr[5]-a)/o} L${l} ${h} L${d} ${c} L${(this.#Tr[16]-r)/n} ${(this.#Tr[17]-a)/o} L${(this.#Tr[14]-r)/n} ${(this.#Tr[15]-a)/o} Z`;var u=[];u.push(`M${t[4]} `+t[5]);for(let e=6;e<t.length;e+=6)isNaN(t[e])?u.push(`L${t[e+4]} `+t[e+5]):u.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} `+t[e+5]);u.push(`L${(s[0]-r)/n} ${(s[1]-a)/o} L${l} ${h} L${d} ${c} L${(i[0]-r)/n} `+(i[1]-a)/o);for(let t=e.length-6;6<=t;t-=6)isNaN(e[t])?u.push(`L${e[t+4]} `+e[t+5]):u.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} `+e[t+5]);return u.push(`L${e[4]} ${e[5]} Z`),u.join(" ")}getOutlines(){var t=this.#Sr,e=this.#Cr,s=this.#Tr,i=s.subarray(4,6),r=s.subarray(16,18),[a,n,o,l]=this.#fr,h=new Float64Array((this.#Fr?.length??0)+2);for(let t=0,e=h.length-2;t<e;t+=2)h[t]=(this.#Fr[t]-a)/o,h[t+1]=(this.#Fr[t+1]-n)/l;h[h.length-2]=(this.#Mr-a)/o,h[h.length-1]=(this.#Pr-n)/l;var[d,c,u,p]=this.#zr();if(isNaN(s[6])&&!this.isEmpty()){const t=new Float64Array(36);return t.set([NaN,NaN,NaN,NaN,(s[2]-a)/o,(s[3]-n)/l,NaN,NaN,NaN,NaN,(s[4]-a)/o,(s[5]-n)/l,NaN,NaN,NaN,NaN,d,c,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(s[16]-a)/o,(s[17]-n)/l,NaN,NaN,NaN,NaN,(s[14]-a)/o,(s[15]-n)/l],0),new Rl(t,h,this.#fr,this.#Ir,this.#kr,this.#Er)}const g=new Float64Array(this.#Sr.length+24+this.#Cr.length);let f=t.length;for(let e=0;e<f;e+=2)isNaN(t[e])?g[e]=g[e+1]=NaN:(g[e]=t[e],g[e+1]=t[e+1]);g.set([NaN,NaN,NaN,NaN,(i[0]-a)/o,(i[1]-n)/l,NaN,NaN,NaN,NaN,d,c,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(r[0]-a)/o,(r[1]-n)/l],f),f+=24;for(let t=e.length-6;6<=t;t-=6)for(let s=0;s<6;s+=2)isNaN(e[t+s])?g[f]=g[f+1]=NaN:(g[f]=e[t+s],g[f+1]=e[t+s+1]),f+=2;return g.set([NaN,NaN,NaN,NaN,e[4],e[5]],f),new Rl(g,h,this.#fr,this.#Ir,this.#kr,this.#Er)}}class Rl extends Ml{#fr;#Hr=null;#kr;#Er;#Fr;#Ir;#jr;constructor(t,e,s,i,r,a){super(),this.#jr=t,this.#Fr=e,this.#fr=s,this.#Ir=i,this.#kr=r,this.#Er=a,this.#$r(a);var{x:n,y:o,width:l,height:h}=this.#Hr;for(let e=0,s=t.length;e<s;e+=2)t[e]=(t[e]-n)/l,t[e+1]=(t[e+1]-o)/h;for(let t=0,s=e.length;t<s;t+=2)e[t]=(e[t]-n)/l,e[t+1]=(e[t+1]-o)/h}toSVGPath(){var t=[`M${this.#jr[4]} `+this.#jr[5]];for(let e=6,s=this.#jr.length;e<s;e+=6)isNaN(this.#jr[e])?t.push(`L${this.#jr[e+4]} `+this.#jr[e+5]):t.push(`C${this.#jr[e]} ${this.#jr[e+1]} ${this.#jr[e+2]} ${this.#jr[e+3]} ${this.#jr[e+4]} `+this.#jr[e+5]);return t.push("Z"),t.join(" ")}serialize([t,e,s,i],r){var a=s-t,n=i-e;let o,l;switch(r){case 0:o=this.#Ur(this.#jr,t,i,a,-n),l=this.#Ur(this.#Fr,t,i,a,-n);break;case 90:o=this.#qr(this.#jr,t,e,a,n),l=this.#qr(this.#Fr,t,e,a,n);break;case 180:o=this.#Ur(this.#jr,s,e,-a,n),l=this.#Ur(this.#Fr,s,e,-a,n);break;case 270:o=this.#qr(this.#jr,s,i,-a,-n),l=this.#qr(this.#Fr,s,i,-a,-n)}return{outline:Array.from(o),points:[Array.from(l)]}}#Ur(t,e,s,i,r){var a=new Float64Array(t.length);for(let n=0,o=t.length;n<o;n+=2)a[n]=e+t[n]*i,a[n+1]=s+t[n+1]*r;return a}#qr(t,e,s,i,r){var a=new Float64Array(t.length);for(let n=0,o=t.length;n<o;n+=2)a[n]=e+t[n+1]*i,a[n+1]=s+t[n]*r;return a}#$r(t){var e=this.#jr;let s=e[4],i=e[5],r=s,a=i,n=s,o=i,l=s,h=i;var d,c=t?Math.max:Math.min;for(let t=6,u=e.length;t<u;t+=6)isNaN(e[t])?(r=Math.min(r,e[t+4]),a=Math.min(a,e[t+5]),n=Math.max(n,e[t+4]),o=Math.max(o,e[t+5]),h<e[t+5]?(l=e[t+4],h=e[t+5]):h===e[t+5]&&(l=c(l,e[t+4]))):(d=qr.bezierBoundingBox(s,i,...e.slice(t,t+6)),r=Math.min(r,d[0]),a=Math.min(a,d[1]),n=Math.max(n,d[2]),o=Math.max(o,d[3]),h<d[3]?(l=d[2],h=d[3]):h===d[3]&&(l=c(l,d[2]))),s=e[t+4],i=e[t+5];t=r-this.#kr;var u=a-this.#kr,p=n-r+2*this.#kr,g=o-a+2*this.#kr;this.#Hr={x:t,y:u,width:p,height:g,lastPoint:[l,h]}}get box(){return this.#Hr}getNewOutline(t,e){var{x:s,y:i,width:r,height:a}=this.#Hr,[n,o,l,h]=this.#fr,d=r*l,c=a*h,u=s*l+n,p=i*h+o,g=new Ll({x:this.#Fr[0]*d+u,y:this.#Fr[1]*c+p},this.#fr,this.#Ir,t,this.#Er,e??this.#kr);for(let t=2;t<this.#Fr.length;t+=2)g.add({x:this.#Fr[t]*d+u,y:this.#Fr[t+1]*c+p});return g.getOutlines()}}class Il{#fi=this.#mi.bind(this);#Vr=this.#o.bind(this);#Gr=null;#Wr=null;#Xr;#Kr=null;#Yr=!1;#Qr=!1;#a=null;#Jr;#p=null;#Zr;static get _keyboardManager(){return Pr(this,"_keyboardManager",new Na([[["Escape","mac+Escape"],Il.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Il.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Il.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Il.prototype._moveToPrevious],[["Home","mac+Home"],Il.prototype._moveToBeginning],[["End","mac+End"],Il.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#Qr=!1,this.#Zr=ji.HIGHLIGHT_COLOR,this.#a=t):(this.#Qr=!0,this.#Zr=ji.HIGHLIGHT_DEFAULT_COLOR),this.#p=t?._uiManager||e,this.#Jr=this.#p._eventBus,this.#Xr=t?.color||this.#p?.highlightColors.values().next().value||"#FFFF98"}renderButton(){var t=this.#Gr=document.createElement("button"),e=(t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0),this.#p._signal);return(e=(t.addEventListener("click",this.#ta.bind(this),{signal:e}),t.addEventListener("keydown",this.#fi,{signal:e}),this.#Wr=document.createElement("span"))).className="swatch",e.setAttribute("aria-hidden",!0),e.style.backgroundColor=this.#Xr,t.append(e),t}renderMainDropdown(){var t=this.#Kr=this.#ea();return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}#ea(){var t,e,s=document.createElement("div"),i=this.#p._signal;for([t,e]of(s.addEventListener("contextmenu",_a,{signal:i}),s.className="dropdown",s.role="listbox",s.setAttribute("aria-multiselectable",!1),s.setAttribute("aria-orientation","vertical"),s.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#p.highlightColors)){var r=document.createElement("button"),a=(r.tabIndex="0",r.role="option",r.setAttribute("data-color",e),r.title=t,r.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-"+t),document.createElement("span"));r.append(a),a.className="swatch",a.style.backgroundColor=e,r.setAttribute("aria-selected",e===this.#Xr),r.addEventListener("click",this.#sa.bind(this,e),{signal:i}),s.append(r)}return s.addEventListener("keydown",this.#fi,{signal:i}),s}#sa(t,e){e.stopPropagation(),this.#Jr.dispatch("switchannotationeditorparams",{source:this,type:this.#Zr,value:t})}_colorSelectFromKeyboard(t){var e;t.target===this.#Gr?this.#ta(t):(e=t.target.getAttribute("data-color"))&&this.#sa(e,t)}_moveToNext(t){this.#ia?(t.target===this.#Gr?this.#Kr.firstChild:t.target.nextSibling)?.focus():this.#ta(t)}_moveToPrevious(t){t.target===this.#Kr?.firstChild||t.target===this.#Gr?this.#ia&&this._hideDropdownFromKeyboard():(this.#ia||this.#ta(t),t.target.previousSibling?.focus())}_moveToBeginning(t){this.#ia?this.#Kr.firstChild?.focus():this.#ta(t)}_moveToEnd(t){this.#ia?this.#Kr.lastChild?.focus():this.#ta(t)}#mi(t){Il._keyboardManager.exec(this,t)}#ta(t){this.#ia?this.hideDropdown():(this.#Yr=0===t.detail,window.addEventListener("pointerdown",this.#Vr,{signal:this.#p._signal}),this.#Kr?this.#Kr.classList.remove("hidden"):(t=this.#Kr=this.#ea(),this.#Gr.append(t)))}#o(t){this.#Kr?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#Kr?.classList.add("hidden"),window.removeEventListener("pointerdown",this.#Vr)}get#ia(){return this.#Kr&&!this.#Kr.classList.contains("hidden")}_hideDropdownFromKeyboard(){this.#Qr||(this.#ia?(this.hideDropdown(),this.#Gr.focus({preventScroll:!0,focusVisible:this.#Yr})):this.#a?.unselect())}updateColor(t){if(this.#Wr&&(this.#Wr.style.backgroundColor=t),this.#Kr){var e=this.#p.highlightColors.values();for(const s of this.#Kr.children)s.setAttribute("aria-selected",e.next().value===t)}}destroy(){this.#Gr?.remove(),this.#Gr=null,this.#Wr=null,this.#Kr?.remove(),this.#Kr=null}}class Dl extends ja{#ra=null;#aa=0;#na;#oa=null;#r=null;#la=null;#ha=null;#da=0;#ca=null;#ua=null;#v=null;#pa=!1;#lt=this.#ga.bind(this);#fa=null;#ma;#va=null;#ba="";#Dr;#ya="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _l10nPromise;static _type="highlight";static _editorType=Hi.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){var t=Dl.prototype;return Pr(this,"_keyboardManager",new Na([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||Dl._defaultColor,this.#Dr=t.thickness||Dl._defaultThickness,this.#ma=t.opacity||Dl._defaultOpacity,this.#na=t.boxes||null,this.#ya=t.methodOfCreation||"",this.#ba=t.text||"",this._isDraggable=!1,-1<t.highlightId?(this.#pa=!0,this.#wa(t),this.#xa()):(this.#ra=t.anchorNode,this.#aa=t.anchorOffset,this.#ha=t.focusNode,this.#da=t.focusOffset,this.#Aa(),this.#xa(),this.rotate(this.rotation))}get telemetryInitialData(){return{action:"added",type:this.#pa?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#Dr,methodOfCreation:this.#ya}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#Aa(){var t=new Tl(this.#na,.001);this.#ua=t.getOutlines(),({x:this.x,y:this.y,width:this.width,height:this.height}=this.#ua.box),t=new Tl(this.#na,.0025,.001,"ltr"===this._uiManager.direction),t=(this.#la=t.getOutlines(),this.#la.box).lastPoint;this.#fa=[(t[0]-this.x)/this.width,(t[1]-this.y)/this.height]}#wa({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#ua=t,this.#la=t.getNewOutline(this.#Dr/2+1.5,.0025),0<=e?(this.#v=e,this.#oa=s,this.parent.drawLayer.finalizeLine(e,t),this.#va=this.parent.drawLayer.highlightOutline(this.#la)):this.parent&&(s=this.parent.viewport.rotation,this.parent.drawLayer.updateLine(this.#v,t),this.parent.drawLayer.updateBox(this.#v,Dl.#_a(this.#ua.box,(s-this.rotation+360)%360)),this.parent.drawLayer.updateLine(this.#va,this.#la),this.parent.drawLayer.updateBox(this.#va,Dl.#_a(this.#la.box,s)));var{x:i,y:r,width:a,height:n}=t.box;switch(this.rotation){case 0:this.x=i,this.y=r,this.width=a,this.height=n;break;case 90:var[o,l]=this.parentDimensions;this.x=r,this.y=1-i,this.width=a*l/o,this.height=n*o/l;break;case 180:this.x=1-i,this.y=1-r,this.width=a,this.height=n;break;case 270:var[o,l]=this.parentDimensions;this.x=1-r,this.y=i,this.width=a*l/o,this.height=n*o/l}e=this.#la.box.lastPoint,this.#fa=[(e[0]-i)/a,(e[1]-r)/n]}static initialize(t,e){ja.initialize(t,e),Dl._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case ji.HIGHLIGHT_DEFAULT_COLOR:Dl._defaultColor=e;break;case ji.HIGHLIGHT_THICKNESS:Dl._defaultThickness=e}}translateInPage(t,e){}get toolbarPosition(){return this.#fa}updateParams(t,e){switch(t){case ji.HIGHLIGHT_COLOR:this.#or(e);break;case ji.HIGHLIGHT_THICKNESS:this.#Ca(e)}}static get defaultPropertiesToUpdate(){return[[ji.HIGHLIGHT_DEFAULT_COLOR,Dl._defaultColor],[ji.HIGHLIGHT_THICKNESS,Dl._defaultThickness]]}get propertiesToUpdate(){return[[ji.HIGHLIGHT_COLOR,this.color||Dl._defaultColor],[ji.HIGHLIGHT_THICKNESS,this.#Dr||Dl._defaultThickness],[ji.HIGHLIGHT_FREE,this.#pa]]}#or(t){var e=t=>{this.color=t,this.parent?.drawLayer.changeColor(this.#v,t),this.#r?.updateColor(t)},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}#Ca(t){var e=this.#Dr,s=t=>{this.#Dr=t,this.#ka(t)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}async addEditToolbar(){var t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(this.#r=new Il({editor:this}),t.addColorPicker(this.#r)),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#Ea())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#Ea())}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){this.#Sa(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),null===this.div||(this.#xa(),this.isAttachedToDOM)||this.parent.add(this))}setParent(t){let e=!1;this.parent&&!t?this.#Sa():t&&(this.#xa(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#ka(t){var e;this.#pa&&(this.#wa({highlightOutlines:this.#ua.getNewOutline(t/2)}),this.fixAndSetPosition(),[t,e]=this.parentDimensions,this.setDims(this.width*t,this.height*e))}#Sa(){null!==this.#v&&this.parent&&(this.parent.drawLayer.remove(this.#v),this.#v=null,this.parent.drawLayer.remove(this.#va),this.#va=null)}#xa(t=this.parent){null===this.#v&&(({id:this.#v,clipPathId:this.#oa}=t.drawLayer.highlight(this.#ua,this.color,this.#ma)),this.#va=t.drawLayer.highlightOutline(this.#la),this.#ca)&&(this.#ca.style.clipPath=this.#oa)}static#_a({x:t,y:e,width:s,height:i},r){switch(r){case 90:return{x:1-e-i,y:t,width:i,height:s};case 180:return{x:1-t-s,y:1-e-i,width:s,height:i};case 270:return{x:e,y:1-t-s,width:i,height:s}}return{x:t,y:e,width:s,height:i}}rotate(t){var e=this.parent.drawLayer;let s;s=this.#pa?(t=(t-this.rotation+360)%360,Dl.#_a(this.#ua.box,t)):Dl.#_a(this,t),e.rotate(this.#v,t),e.rotate(this.#va,t),e.updateBox(this.#v,s),e.updateBox(this.#va,Dl.#_a(this.#la.box,t))}render(){var t,e,s;return this.div||(t=super.render(),this.#ba&&(t.setAttribute("aria-label",this.#ba),t.setAttribute("role","mark")),this.#pa?t.classList.add("free"):this.div.addEventListener("keydown",this.#lt,{signal:this._uiManager._signal}),e=this.#ca=document.createElement("div"),[e,s]=(t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#oa,this.parentDimensions),this.setDims(this.width*e,this.height*s),Ia(this,this.#ca,["pointerover","pointerleave"]),this.enableEditing(),t)}pointerover(){this.parent.drawLayer.addClass(this.#va,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#va,"hovered")}#ga(t){Dl._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#Ta(!0);break;case 1:case 3:this.#Ta(!1)}}#Ta(t){var e;this.#ra&&(e=window.getSelection(),t?e.setPosition(this.#ra,this.#aa):e.setPosition(this.#ha,this.#da))}select(){super.select(),this.#va&&(this.parent?.drawLayer.removeClass(this.#va,"hovered"),this.parent?.drawLayer.addClass(this.#va,"selected"))}unselect(){super.unselect(),this.#va&&(this.parent?.drawLayer.removeClass(this.#va,"selected"),this.#pa||this.#Ta(!1))}get _mustFixPosition(){return!this.#pa}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(this.#v,t),this.parent.drawLayer.show(this.#va,t))}#Ea(){return this.#pa?this.rotation:0}#Ma(){if(this.#pa)return null;var t,e,s,i,[r,a]=this.pageDimensions,[n,o]=this.pageTranslation,l=this.#na,h=new Float32Array(8*l.length);let d=0;for({x:t,y:e,width:s,height:i}of l){var c=t*r+n,u=(1-e-i)*a+o;h[d]=h[d+4]=c,h[d+1]=h[d+3]=u,h[d+2]=h[d+6]=c+s*r,h[d+5]=h[d+7]=u+i*a,d+=8}return h}#Pa(t){return this.#ua.serialize(t,this.#Ea())}static startHighlighting(t,e,{target:s,x:i,y:r}){var{x:a,y:n,width:o,height:l}=s.getBoundingClientRect();const h=e=>{this.#La(t,e)};var d=t._signal;const c={capture:!0,passive:!1,signal:d},u=t=>{t.preventDefault(),t.stopPropagation()},p=e=>{s.removeEventListener("pointermove",h),window.removeEventListener("blur",p),window.removeEventListener("pointerup",p),window.removeEventListener("pointerdown",u,c),window.removeEventListener("contextmenu",_a),this.#Ra(t,e)};window.addEventListener("blur",p,{signal:d}),window.addEventListener("pointerup",p,{signal:d}),window.addEventListener("pointerdown",u,c),window.addEventListener("contextmenu",_a,{signal:d}),s.addEventListener("pointermove",h,{signal:d}),this._freeHighlight=new Ll({x:i,y:r},[a,n,o,l],t.scale,this._defaultThickness/2,e,.001),({id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0))}static#La(t,e){this._freeHighlight.add(e)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)}static#Ra(t,e){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static deserialize(t,e,s){e=super.deserialize(t,e,s);var{rect:[s,i,r,a],color:n,quadPoints:o}=t,[l,h]=(e.color=qr.makeHexColor(...n),e.#ma=t.opacity,e.pageDimensions),d=(e.width=(r-s)/l,e.height=(a-i)/h,e.#na=[]);for(let t=0;t<o.length;t+=8)d.push({x:(o[4]-r)/l,y:(a-(1-o[t+5]))/h,width:(o[t+2]-o[t])/l,height:(o[t+5]-o[t+1])/h});return e.#Aa(),e}serialize(t=!1){var e;return this.isEmpty()||t?null:(t=this.getRect(0,0),e=ja._colorManager.convert(this.color),{annotationType:Hi.HIGHLIGHT,color:e,opacity:this.#ma,thickness:this.#Dr,quadPoints:this.#Ma(),outlines:this.#Pa(t),pageIndex:this.pageIndex,rect:t,rotation:this.#Ea(),structTreeParentId:this._structTreeParentId})}static canCreateNewEmptyEditor(){return!1}}class Fl extends ja{#Ia=0;#Da=0;#Fa=this.canvasPointermove.bind(this);#Oa=this.canvasPointerleave.bind(this);#Na=this.canvasPointerup.bind(this);#Ba=this.canvasPointerdown.bind(this);#za=null;#Ha=new Path2D;#ja=!1;#$a=!1;#Ua=!1;#qa=null;#Va=0;#Ga=0;#Wa=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=Hi.INK;constructor(t){super({...t,name:"inkEditor"}),this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,e){ja.initialize(t,e)}static updateDefaultParams(t,e){switch(t){case ji.INK_THICKNESS:Fl._defaultThickness=e;break;case ji.INK_COLOR:Fl._defaultColor=e;break;case ji.INK_OPACITY:Fl._defaultOpacity=e/100}}updateParams(t,e){switch(t){case ji.INK_THICKNESS:this.#Ca(e);break;case ji.INK_COLOR:this.#or(e);break;case ji.INK_OPACITY:this.#Xa(e)}}static get defaultPropertiesToUpdate(){return[[ji.INK_THICKNESS,Fl._defaultThickness],[ji.INK_COLOR,Fl._defaultColor||ja._defaultLineColor],[ji.INK_OPACITY,Math.round(100*Fl._defaultOpacity)]]}get propertiesToUpdate(){return[[ji.INK_THICKNESS,this.thickness||Fl._defaultThickness],[ji.INK_COLOR,this.color||Fl._defaultColor||ja._defaultLineColor],[ji.INK_OPACITY,Math.round(100*(this.opacity??Fl._defaultOpacity))]]}#Ca(t){var e=t=>{this.thickness=t,this.#Ka()},s=this.thickness;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#or(t){var e=t=>{this.color=t,this.#Ya()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#Xa(t){var e=t=>{this.opacity=t,this.#Ya()},s=this.opacity;this.addCommands({cmd:e.bind(this,t/=100),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ji.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div)&&(this.canvas||(this.#Qa(),this.#Ja()),this.isAttachedToDOM||(this.parent.add(this),this.#Za()),this.#Ka())}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#za&&(clearTimeout(this.#za),this.#za=null),this.#qa?.disconnect(),this.#qa=null,super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&null===t&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){var[t,e]=this.parentDimensions,t=this.width*t,e=this.height*e;this.setDimensions(t,e)}enableEditMode(){this.#ja||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#Ba,{signal:this._uiManager._signal}))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#Ba))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#tn(){var{parentRotation:t,parentDimensions:[e,s]}=this;switch(t){case 90:return[0,s,s,e];case 180:return[e,s,e,s];case 270:return[e,0,s,e];default:return[0,0,e,s]}}#en(){var{ctx:t,color:e,opacity:s,thickness:i,parentScale:r,scaleFactor:a}=this;t.lineWidth=i*r/a,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=""+e+function(t){return Math.round(Math.min(255,Math.max(1,255*t))).toString(16).padStart(2,"0")}(s)}#sn(t,e){var s=this._uiManager._signal;this.canvas.addEventListener("contextmenu",_a,{signal:s}),this.canvas.addEventListener("pointerleave",this.#Oa,{signal:s}),this.canvas.addEventListener("pointermove",this.#Fa,{signal:s}),this.canvas.addEventListener("pointerup",this.#Na,{signal:s}),this.canvas.removeEventListener("pointerdown",this.#Ba),this.isEditing=!0,this.#Ua||(this.#Ua=!0,this.#Za(),this.thickness||=Fl._defaultThickness,this.color||=Fl._defaultColor||ja._defaultLineColor,this.opacity??=Fl._defaultOpacity),this.currentPath.push([t,e]),this.#$a=!1,this.#en(),this.#Wa=()=>{this.#in(),this.#Wa&&window.requestAnimationFrame(this.#Wa)},window.requestAnimationFrame(this.#Wa)}#rn(t,e){var[s,i]=this.currentPath.at(-1);if(!(1<this.currentPath.length&&t===s&&e===i)){s=this.currentPath;let i=this.#Ha;s.push([t,e]),this.#$a=!0,s.length<=2?(i.moveTo(...s[0]),i.lineTo(t,e)):(3===s.length&&(this.#Ha=i=new Path2D,i.moveTo(...s[0])),this.#an(i,...s.at(-3),...s.at(-2),t,e))}}#nn(){var t;0!==this.currentPath.length&&(t=this.currentPath.at(-1),this.#Ha.lineTo(...t))}#on(t,e){let s;this.#Wa=null,t=Math.min(Math.max(t,0),this.canvas.width),e=Math.min(Math.max(e,0),this.canvas.height),this.#rn(t,e),this.#nn(),s=1!==this.currentPath.length?this.#ln():[[t=[t,e],t.slice(),t.slice(),t]];const i=this.#Ha,r=this.currentPath;this.currentPath=[],this.#Ha=new Path2D,this.addCommands({cmd:()=>{this.allRawPaths.push(r),this.paths.push(s),this.bezierPath2D.push(i),this._uiManager.rebuild(this)},undo:()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#Qa(),this.#Ja()),this.#Ka())},mustExec:!0})}#in(){if(this.#$a){this.#$a=!1,Math.ceil(this.thickness*this.parentScale);var t=(e=this.currentPath.slice(-3)).map((t=>t[0])),e=e.map((t=>t[1])),s=(Math.min(...t),Math.max(...t),Math.min(...e),Math.max(...e),this).ctx;s.save(),s.clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.bezierPath2D)s.stroke(t);s.stroke(this.#Ha),s.restore()}}#an(t,e,s,i,r,a,n){e=(e+i)/2,s=(s+r)/2,a=(i+a)/2,n=(r+n)/2,t.bezierCurveTo(e+2*(i-e)/3,s+2*(r-s)/3,a+2*(i-a)/3,n+2*(r-n)/3,a,n)}#ln(){var t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];var e=[];let s,[i,r]=t[0];for(s=1;s<t.length-2;s++){const[o,l]=t[s],[h,d]=t[s+1];var a=(o+h)/2,n=(l+d)/2;const c=[i+2*(o-i)/3,r+2*(l-r)/3],u=[a+2*(o-a)/3,n+2*(l-n)/3];e.push([[i,r],c,u,[a,n]]),[i,r]=[a,n]}const[o,l]=t[s],[h,d]=t[s+1],c=[i+2*(o-i)/3,r+2*(l-r)/3],u=[h+2*(o-h)/3,d+2*(l-d)/3];return e.push([[i,r],c,u,[h,d]]),e}#Ya(){if(this.isEmpty())this.#hn();else{this.#en();var{canvas:t,ctx:e}=this;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),this.#hn();for(const t of this.bezierPath2D)e.stroke(t)}}commit(){this.#ja||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#ja=!0,this.div.classList.add("disabled"),this.#Ka(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){0===t.button&&this.isInEditMode()&&!this.#ja&&(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#sn(t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),this.#rn(t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),this.#dn(t)}canvasPointerleave(t){this.#dn(t)}#dn(t){this.canvas.removeEventListener("pointerleave",this.#Oa),this.canvas.removeEventListener("pointermove",this.#Fa),this.canvas.removeEventListener("pointerup",this.#Na),this.canvas.addEventListener("pointerdown",this.#Ba,{signal:this._uiManager._signal}),this.#za&&clearTimeout(this.#za),this.#za=setTimeout((()=>{this.#za=null,this.canvas.removeEventListener("contextmenu",_a)}),10),this.#on(t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#Qa(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#Ja(){this.#qa=new ResizeObserver((t=>{(t=t[0].contentRect).width&&t.height&&this.setDimensions(t.width,t.height)})),this.#qa.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#qa?.disconnect(),this.#qa=null}),{once:!0})}get isResizable(){return!this.isEmpty()&&this.#ja}render(){if(!this.div){let r,a;this.width&&(r=this.x,a=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");var[t,e,s,i]=this.#tn();this.setAt(t,e,0,0),this.setDims(s,i),this.#Qa(),this.width?([t,e]=this.parentDimensions,this.setAspectRatio(this.width*t,this.height*e),this.setAt(r*t,a*e,this.width*t,this.height*e),this.#Ua=!0,this.#Za(),this.setDims(this.width*t,this.height*e),this.#Ya(),this.div.classList.add("disabled")):(this.div.classList.add("editing"),this.enableEditMode()),this.#Ja()}return this.div}#Za(){var t,e;this.#Ua&&([t,e]=this.parentDimensions,this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*e),this.#hn())}setDimensions(t,e){var s=Math.round(t),i=Math.round(e);this.#Va===s&&this.#Ga===i||(this.#Va=s,this.#Ga=i,this.canvas.style.visibility="hidden",[s,i]=this.parentDimensions,this.width=t/s,this.height=e/i,this.fixAndSetPosition(),this.#ja&&this.#cn(t,e),this.#Za(),this.#Ya(),this.canvas.style.visibility="visible",this.fixDims())}#cn(t,e){var s=this.#un();t=(t-s)/this.#Da,e=(e-s)/this.#Ia;this.scaleFactor=Math.min(t,e)}#hn(){var t=this.#un()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)}static#pn(t){var e=new Path2D;for(let n=0,o=t.length;n<o;n++){var[s,i,r,a]=t[n];0===n&&e.moveTo(...s),e.bezierCurveTo(i[0],i[1],r[0],r[1],a[0],a[1])}return e}static#gn(t,e,s){var[i,r,a,n]=e;switch(s){case 0:for(let e=0,s=t.length;e<s;e+=2)t[e]+=i,t[e+1]=n-t[e+1];break;case 90:for(let e=0,s=t.length;e<s;e+=2){var o=t[e];t[e]=t[e+1]+i,t[e+1]=o+r}break;case 180:for(let e=0,s=t.length;e<s;e+=2)t[e]=a-t[e],t[e+1]+=r;break;case 270:for(let e=0,s=t.length;e<s;e+=2){var l=t[e];t[e]=a-t[e+1],t[e+1]=n-l}break;default:throw new Error("Invalid rotation")}return t}static#fn(t,e,s){var[i,r,a,n]=e;switch(s){case 0:for(let e=0,s=t.length;e<s;e+=2)t[e]-=i,t[e+1]=n-t[e+1];break;case 90:for(let e=0,s=t.length;e<s;e+=2){var o=t[e];t[e]=t[e+1]-r,t[e+1]=o-i}break;case 180:for(let e=0,s=t.length;e<s;e+=2)t[e]=a-t[e],t[e+1]-=r;break;case 270:for(let e=0,s=t.length;e<s;e+=2){var l=t[e];t[e]=n-t[e+1],t[e+1]=a-l}break;default:throw new Error("Invalid rotation")}return t}#mn(t,e,s,i){var r=[],a=this.thickness/2,n=t*e+a,o=t*s+a;for(const e of this.paths){var l=[],h=[];for(let s=0,i=e.length;s<i;s++){var[d,c,u,p]=e[s];if(d[0]===p[0]&&d[1]===p[1]&&1===i){var g=t*d[0]+n,f=t*d[1]+o;l.push(g,f),h.push(g,f);break}g=t*d[0]+n,f=t*d[1]+o;var d=t*c[0]+n,c=t*c[1]+o,m=t*u[0]+n,u=t*u[1]+o,v=t*p[0]+n,p=t*p[1]+o;0===s&&(l.push(g,f),h.push(g,f)),l.push(d,c,m,u,v,p),h.push(d,c),s===i-1&&h.push(v,p)}r.push({bezier:Fl.#gn(l,i,this.rotation),points:Fl.#gn(h,i,this.rotation)})}return r}#vn(){let t=1/0,e=-1/0,s=1/0,i=-1/0;for(const l of this.paths)for(var[r,a,n,o]of l)r=qr.bezierBoundingBox(...r,...a,...n,...o),t=Math.min(t,r[0]),s=Math.min(s,r[1]),e=Math.max(e,r[2]),i=Math.max(i,r[3]);return[t,s,e,i]}#un(){return this.#ja?Math.ceil(this.thickness*this.parentScale):0}#Ka(t=!1){var e,s,i,r,a,n;this.isEmpty()||(this.#ja?(n=this.#vn(),e=this.#un(),this.#Da=Math.max(ja.MIN_SIZE,n[2]-n[0]),this.#Ia=Math.max(ja.MIN_SIZE,n[3]-n[1]),s=Math.ceil(e+this.#Da*this.scaleFactor),i=Math.ceil(e+this.#Ia*this.scaleFactor),[r,a]=this.parentDimensions,this.width=s/r,this.height=i/a,this.setAspectRatio(s,i),r=this.translationX,a=this.translationY,this.translationX=-n[0],this.translationY=-n[1],this.#Za(),this.#Ya(),this.#Va=s,this.#Ga=i,this.setDims(s,i),n=t?e/this.scaleFactor/2:0,this.translate(r-this.translationX-n,a-this.translationY-n)):this.#Ya())}static deserialize(t,e,s){if(t instanceof bl)return null;var i,r=super.deserialize(t,e,s),[e,s]=(r.thickness=t.thickness,r.color=qr.makeHexColor(...t.color),r.opacity=t.opacity,r.pageDimensions),a=(e=r.width*e,s=r.height*s,r.parentScale),n=t.thickness/2,{paths:t,rect:o,rotation:l}=(r.#ja=!0,r.#Va=Math.round(e),r.#Ga=Math.round(s),t);for({bezier:i}of t){i=Fl.#fn(i,o,l);var h=[];r.paths.push(h);let t=a*(i[0]-n),e=a*(i[1]-n);for(let s=2,r=i.length;s<r;s+=6){var d=a*(i[s]-n),c=a*(i[s+1]-n),u=a*(i[s+2]-n),p=a*(i[s+3]-n),g=a*(i[s+4]-n),f=a*(i[s+5]-n);h.push([[t,e],[d,c],[u,p],[g,f]]),t=g,e=f}var m=this.#pn(h);r.bezierPath2D.push(m)}return t=r.#vn(),r.#Da=Math.max(ja.MIN_SIZE,t[2]-t[0]),r.#Ia=Math.max(ja.MIN_SIZE,t[3]-t[1]),r.#cn(e,s),r}serialize(){var t,e;return this.isEmpty()?null:(t=this.getRect(0,0),e=ja._colorManager.convert(this.ctx.strokeStyle),{annotationType:Hi.INK,color:e,thickness:this.thickness,opacity:this.opacity,paths:this.#mn(this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId})}}class Ol extends ja{#bn=null;#yn=null;#wn=null;#xn=null;#An=null;#_n="";#Cn=null;#kn=!1;#qa=null;#En=null;#Sn=!1;#Tn=!1;static _type="stamp";static _editorType=Hi.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#xn=t.bitmapUrl,this.#An=t.bitmapFile}static initialize(t,e){ja.initialize(t,e)}static get supportedTypes(){return Pr(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((t=>"image/"+t)))}static get supportedTypesStr(){return Pr(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,e){e.pasteEditor(Hi.STAMP,{bitmapFile:t.getAsFile()})}#Mn(t,e=!1){t?(this.#bn=t.bitmap,e||(this.#yn=t.id,this.#Sn=t.isSvg),t.file&&(this.#_n=t.file.name),this.#Qa()):this.remove()}#Pn(){this.#wn=null,this._uiManager.enableWaiting(!1),this.#Cn&&this.div.focus()}#Ln(){var t;if(this.#yn)this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#yn).then((t=>this.#Mn(t,!0))).finally((()=>this.#Pn()));else if(this.#xn)t=this.#xn,this.#xn=null,this._uiManager.enableWaiting(!0),this.#wn=this._uiManager.imageManager.getFromUrl(t).then((t=>this.#Mn(t))).finally((()=>this.#Pn()));else if(this.#An)t=this.#An,this.#An=null,this._uiManager.enableWaiting(!0),this.#wn=this._uiManager.imageManager.getFromFile(t).then((t=>this.#Mn(t))).finally((()=>this.#Pn()));else{const t=document.createElement("input"),e=(t.type="file",t.accept=Ol.supportedTypesStr,this._uiManager._signal);this.#wn=new Promise((s=>{t.addEventListener("change",(async()=>{var e;t.files&&0!==t.files.length?(this._uiManager.enableWaiting(!0),e=await this._uiManager.imageManager.getFromFile(t.files[0]),this.#Mn(e)):this.remove(),s()}),{signal:e}),t.addEventListener("cancel",(()=>{this.remove(),s()}),{signal:e})})).finally((()=>this.#Pn())),t.click()}}remove(){this.#yn&&(this.#bn=null,this._uiManager.imageManager.deleteId(this.#yn),this.#Cn?.remove(),this.#Cn=null,this.#qa?.disconnect(),this.#qa=null,this.#En)&&(clearTimeout(this.#En),this.#En=null),super.remove()}rebuild(){this.parent?(super.rebuild(),null===this.div||(this.#yn&&null===this.#Cn&&this.#Ln(),this.isAttachedToDOM)||this.parent.add(this)):this.#yn&&this.#Ln()}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#wn||this.#bn||this.#xn||this.#An||this.#yn)}get isResizable(){return!0}render(){if(!this.div){let s,i;var t,e;this.width&&(s=this.x,i=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),this.#bn?this.#Qa():this.#Ln(),this.width&&([t,e]=this.parentDimensions,this.setAt(s*t,i*e,this.width*t,this.height*e))}return this.div}#Qa(){var t=this.div;let{width:e,height:s}=this.#bn;var[i,r]=this.pageDimensions,[a,n]=(this.width?(e=this.width*i,s=this.height*r):(e>.75*i||s>.75*r)&&(e*=a=Math.min(.75*i/e,.75*r/s),s*=a),this.parentDimensions),a=(this.setDims(e*a/i,s*n/r),this._uiManager.enableWaiting(!1),this.#Cn=document.createElement("canvas"));t.append(a),t.hidden=!1,this.#Rn(e,s),this.#Ja(),this.#Tn||(this.parent.addUndoableEditor(this),this.#Tn=!0),this._reportTelemetry({action:"inserted_image"}),this.#_n&&a.setAttribute("aria-label",this.#_n)}#In(t,e){var[s,i]=this.parentDimensions;this.width=t/s,this.height=e/i,this.setDims(t,e),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),(this._initialOptions=null)!==this.#En&&clearTimeout(this.#En),this.#En=setTimeout((()=>{this.#En=null,this.#Rn(t,e)}),200)}#Dn(t,e){var{width:s,height:i}=this.#bn;let r=s,a=i,n=this.#bn;for(;r>2*t||a>2*e;){var o=r,l=a,h=(r>2*t&&(r=16384<=r?Math.floor(r/2)-1:Math.ceil(r/2)),a>2*e&&(a=16384<=a?Math.floor(a/2)-1:Math.ceil(a/2)),new OffscreenCanvas(r,a));h.getContext("2d").drawImage(n,0,0,o,l,0,0,r,a),n=h.transferToImageBitmap()}return n}async#Fn(t,e,s){var i;this.#kn||(this.#kn=!0,await this._uiManager.isMLEnabledFor("altText")&&!this.hasAltText()&&((i=new OffscreenCanvas(e,s).getContext("2d",{willReadFrequently:!0})).drawImage(t,0,0,t.width,t.height,0,0,e,s),t=(await this._uiManager.mlGuess({service:"moz-image-to-text",request:{data:i.getImageData(0,0,e,s).data,width:e,height:s,channels:4}}))?.output||"",this.parent)&&t&&!this.hasAltText()&&(this.altTextData={altText:t,decorative:!1}))}#Rn(t,e){t=Math.ceil(t),e=Math.ceil(e);var s,i=this.#Cn;!i||i.width===t&&i.height===e||(i.width=t,i.height=e,s=this.#Sn?this.#bn:this.#Dn(t,e),this.#Fn(s,t,e),(i=i.getContext("2d")).filter=this._uiManager.hcmFilter,i.drawImage(s,0,0,s.width,s.height,0,0,t,e))}getImageForAltText(){return this.#Cn}#On(t){return t?this.#Sn&&(t=this._uiManager.imageManager.getSvgUrl(this.#yn))?t:(t=document.createElement("canvas"),({width:t.width,height:t.height}=this.#bn),t.getContext("2d").drawImage(this.#bn,0,0),t.toDataURL()):this.#Sn?([t,e]=this.pageDimensions,t=Math.round(this.width*t*da.PDF_TO_CSS_UNITS),e=Math.round(this.height*e*da.PDF_TO_CSS_UNITS),(s=new OffscreenCanvas(t,e)).getContext("2d").drawImage(this.#bn,0,0,this.#bn.width,this.#bn.height,0,0,t,e),s.transferToImageBitmap()):structuredClone(this.#bn);var e,s}#Ja(){this._uiManager._signal&&(this.#qa=new ResizeObserver((t=>{(t=t[0].contentRect).width&&t.height&&this.#In(t.width,t.height)})),this.#qa.observe(this.div),this._uiManager._signal.addEventListener("abort",(()=>{this.#qa?.disconnect(),this.#qa=null}),{once:!0}))}static deserialize(t,e,s){var i,r,a,n;return t instanceof _l?null:(e=super.deserialize(t,e,s),({rect:t,bitmapUrl:i,bitmapId:n,isSvg:r,accessibilityData:a}=t),[s,n]=(n&&s.imageManager.isValidId(n)?e.#yn=n:e.#xn=i,e.#Sn=r,e.pageDimensions),e.width=(t[2]-t[0])/s,e.height=(t[3]-t[1])/n,a&&(e.altTextData=a),e)}serialize(t=!1,e=null){var s,i;return this.isEmpty()?null:(s={annotationType:Hi.STAMP,bitmapId:this.#yn,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#Sn,structTreeParentId:this._structTreeParentId},t?(s.bitmapUrl=this.#On(!0),s.accessibilityData=this.altTextData):(({decorative:t,altText:i}=this.altTextData),!t&&i&&(s.accessibilityData={type:"Figure",alt:i}),null!==e&&(e.stamps||=new Map,t=this.#Sn?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null,e.stamps.has(this.#yn)?this.#Sn&&t>(i=e.stamps.get(this.#yn)).area&&(i.area=t,i.serialized.bitmap.close(),i.serialized.bitmap=this.#On(!1)):(e.stamps.set(this.#yn,{area:t,serialized:s}),s.bitmap=this.#On(!1)))),s)}}class Nl{#Wi;#Nn=!1;#Bn=null;#zn=null;#Hn=null;#jn=null;#$n=null;#Un=new Map;#qn=!1;#Vn=!1;#Gn=!1;#Wn=null;#p;static _initialized=!1;static#N=new Map([Sl,Fl,Ol,Dl].map((t=>[t._editorType,t])));constructor({uiManager:t,pageIndex:e,div:s,accessibilityManager:i,annotationLayer:r,drawLayer:a,textLayer:n,viewport:o,l10n:l}){var h=[...Nl.#N.values()];if(!Nl._initialized){Nl._initialized=!0;for(const e of h)e.initialize(l,t)}t.registerEditorTypes(h),this.#p=t,this.pageIndex=e,this.div=s,this.#Wi=i,this.#Bn=r,this.viewport=o,this.#Wn=n,this.drawLayer=a,this.#p.addLayer(this)}get isEmpty(){return 0===this.#Un.size}get isInvisible(){return this.isEmpty&&this.#p.getMode()===Hi.NONE}updateToolbar(t){this.#p.updateToolbar(t)}updateMode(t=this.#p.getMode()){switch(this.#Xn(),t){case Hi.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case Hi.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case Hi.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);var e=this.div.classList;for(const s of Nl.#N.values())e.toggle(s._type+"Editing",t===s._editorType);this.div.hidden=!1}hasTextLayer(t){return t===this.#Wn?.div}addInkEditorIfNeeded(t){if(this.#p.getMode()===Hi.INK){if(!t)for(const t of this.#Un.values())if(t.isEmpty())return void t.setInBackground();this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}}setEditingState(t){this.#p.setEditingState(t)}addCommands(t){this.#p.addCommands(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#Bn?.div.classList.toggle("disabled",!t)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);var t,e=new Set;for(const t of this.#Un.values())t.enableEditing(),t.show(!0),t.annotationElementId&&(this.#p.removeChangedExistingAnnotation(t),e.add(t.annotationElementId));if(this.#Bn)for(const s of this.#Bn.getEditableAnnotations())s.hide(),this.#p.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id)||(t=this.deserialize(s))&&(this.addOrRebuild(t),t.enableEditing())}disable(){this.#Gn=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1);var t=new Map,e=new Map;for(const s of this.#Un.values())s.disableEditing(),s.annotationElementId&&(null!==s.serialize()?t.set(s.annotationElementId,s):(e.set(s.annotationElementId,s),this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()));if(this.#Bn)for(const i of this.#Bn.getEditableAnnotations()){var s=i.data.id;if(!this.#p.isDeletedAnnotationElement(s)){let r=e.get(s);r?(r.resetAnnotationElement(i),r.show(!1)):(r=t.get(s))&&(this.#p.addChangedExistingAnnotation(r),r.renderAnnotationElement(i),r.show(!1)),i.show()}}this.#Xn(),this.isEmpty&&(this.div.hidden=!0);var i=this.div.classList;for(const t of Nl.#N.values())i.remove(t._type+"Editing");this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#Gn=!1}getEditableAnnotation(t){return this.#Bn?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#p.getActive()!==t&&this.#p.setActiveEditor(t)}enableTextSelection(){this.div.tabIndex=-1,this.#Wn?.div&&!this.#jn&&(this.#jn=this.#Kn.bind(this),this.#Wn.div.addEventListener("pointerdown",this.#jn,{signal:this.#p._signal}),this.#Wn.div.classList.add("highlighting"))}disableTextSelection(){this.div.tabIndex=0,this.#Wn?.div&&this.#jn&&(this.#Wn.div.removeEventListener("pointerdown",this.#jn),this.#jn=null,this.#Wn.div.classList.remove("highlighting"))}#Kn(t){this.#p.unselectAll();var e=t.target;(e===this.#Wn.div||e.classList.contains("endOfContent")&&this.#Wn.div.contains(e))&&(e=$r.platform.isMac,0!==t.button||t.ctrlKey&&e||(this.#p.showAllEditors("highlight",!0,!0),this.#Wn.div.classList.add("free"),this.toggleDrawing(),Dl.startHighlighting(this,"ltr"===this.#p.direction,t),this.#Wn.div.addEventListener("pointerup",(()=>{this.#Wn.div.classList.remove("free"),this.toggleDrawing(!0)}),{once:!0,signal:this.#p._signal}),t.preventDefault()))}enableClick(){var t;this.#Hn||(t=this.#p._signal,this.#Hn=this.pointerdown.bind(this),this.#zn=this.pointerup.bind(this),this.div.addEventListener("pointerdown",this.#Hn,{signal:t}),this.div.addEventListener("pointerup",this.#zn,{signal:t}))}disableClick(){this.#Hn&&(this.div.removeEventListener("pointerdown",this.#Hn),this.div.removeEventListener("pointerup",this.#zn),this.#Hn=null,this.#zn=null)}attach(t){this.#Un.set(t.id,t);var e=t.annotationElementId;e&&this.#p.isDeletedAnnotationElement(e)&&this.#p.removeDeletedAnnotationElement(t)}detach(t){this.#Un.delete(t.id),this.#Wi?.removePointerInTextLayer(t.contentDiv),!this.#Gn&&t.annotationElementId&&this.#p.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#p.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1,this.#Vn||this.addInkEditorIfNeeded(!1)}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#p.addDeletedAnnotationElement(t.annotationElementId),ja.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div)&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div))}add(t){var e;t.parent===this&&t.isAttachedToDOM||(this.changeParent(t),this.#p.addEditor(t),this.attach(t),t.isAttachedToDOM||(e=t.render(),this.div.append(e),t.isAttachedToDOM=!0),t.fixAndSetPosition(),t.onceAdded(),this.#p.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData))}moveEditorInDOM(t){if(t.isAttachedToDOM){const e=document.activeElement;t.div.contains(e)&&!this.#$n&&(t._focusEventsAllowed=!1,this.#$n=setTimeout((()=>{this.#$n=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",(()=>{t._focusEventsAllowed=!0}),{once:!0,signal:this.#p._signal}),e.focus())}),0)),t._structTreeParentId=this.#Wi?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){this.addCommands({cmd:()=>t._uiManager.rebuild(t),undo:()=>{t.remove()},mustExec:!1})}getNextId(){return this.#p.getId()}get#Yn(){return Nl.#N.get(this.#p.getMode())}get _signal(){return this.#p._signal}#Qn(t){var e=this.#Yn;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#Yn?.canCreateNewEmptyEditor()}pasteEditor(t,e){this.#p.updateToolbar(t),this.#p.updateMode(t);var{offsetX:t,offsetY:s}=this.#Jn(),i=this.getNextId();(i=this.#Qn({parent:this,id:i,x:t,y:s,uiManager:this.#p,isCentered:!0,...e}))&&this.add(i)}deserialize(t){return Nl.#N.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#p)||null}createAndAddNewEditor(t,e,s={}){var i=this.getNextId();return(i=this.#Qn({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#p,isCentered:e,...s}))&&this.add(i),i}#Jn(){var{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),r=Math.max(0,t),a=Math.max(0,e),s=(r=(r+Math.min(window.innerWidth,t+s))/2-t,(a+Math.min(window.innerHeight,e+i))/2-e),[t,a]=this.viewport.rotation%180==0?[r,s]:[s,r];return{offsetX:t,offsetY:a}}addNewEditor(){this.createAndAddNewEditor(this.#Jn(),!0)}setSelected(t){this.#p.setSelected(t)}toggleSelected(t){this.#p.toggleSelected(t)}isSelected(t){return this.#p.isSelected(t)}unselect(t){this.#p.unselect(t)}pointerup(t){var e=$r.platform.isMac;0!==t.button||t.ctrlKey&&e||t.target===this.div&&this.#qn&&(this.#qn=!1,this.#Nn?this.#p.getMode()===Hi.STAMP?this.#p.unselectAll():this.createAndAddNewEditor(t,!1):this.#Nn=!0)}pointerdown(t){var e;this.#p.getMode()===Hi.HIGHLIGHT&&this.enableTextSelection(),this.#qn?this.#qn=!1:(e=$r.platform.isMac,0!==t.button||t.ctrlKey&&e||t.target===this.div&&(this.#qn=!0,e=this.#p.getActive(),this.#Nn=!e||e.isEmpty()))}findNewParent(t,e,s){return null!==(e=this.#p.findParent(e,s))&&e!==this&&(e.changeParent(t),!0)}destroy(){this.#p.getActive()?.parent===this&&(this.#p.commitOrRemove(),this.#p.setActiveEditor(null)),this.#$n&&(clearTimeout(this.#$n),this.#$n=null);for(const t of this.#Un.values())this.#Wi?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#Un.clear(),this.#p.removeLayer(this)}#Xn(){this.#Vn=!0;for(const t of this.#Un.values())t.isEmpty()&&t.remove();this.#Vn=!1}render({viewport:t}){this.viewport=t,Pa(this.div,t);for(const t of this.#p.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:t}){this.#p.commitOrRemove(),this.#Xn();var e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Pa(this.div,{rotation:s}),e!==s)for(const t of this.#Un.values())t.rotate(s);this.addInkEditorIfNeeded(!1)}get pageDimensions(){var{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#p.viewParameters.realScale}}class Bl{#Si=null;#v=0;#Zn=new Map;#to=new Map;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(this.#Si){if(this.#Si!==t){if(0<this.#Zn.size)for(const e of this.#Zn.values())e.remove(),t.append(e);this.#Si=t}}else this.#Si=t}static get _svgFactory(){return Pr(this,"_svgFactory",new ga)}static#eo(t,{x:e=0,y:s=0,width:i=1,height:r=1}={}){(t=t.style).top=100*s+"%",t.left=100*e+"%",t.width=100*i+"%",t.height=100*r+"%"}#so(t){var e=Bl._svgFactory.create(1,1,!0);return this.#Si.append(e),e.setAttribute("aria-hidden",!0),Bl.#eo(e,t),e}#io(t,e){var s=Bl._svgFactory.createElement("clipPath"),i=(t=(t.append(s),"clip_"+e),s.setAttribute("id",t),s.setAttribute("clipPathUnits","objectBoundingBox"),Bl._svgFactory.createElement("use"));return s.append(i),i.setAttribute("href","#"+e),i.classList.add("clip"),t}highlight(t,e,s,i=!1){var r=this.#v++,a=this.#so(t.box),n=(a.classList.add("highlight"),t.free&&a.classList.add("free"),Bl._svgFactory.createElement("defs")),o=(a.append(n),Bl._svgFactory.createElement("path")),l=(n.append(o),`path_p${this.pageIndex}_`+r);o.setAttribute("id",l),o.setAttribute("d",t.toSVGPath()),i&&this.#to.set(r,o),t=this.#io(n,l),i=Bl._svgFactory.createElement("use");return a.append(i),a.setAttribute("fill",e),a.setAttribute("fill-opacity",s),i.setAttribute("href","#"+l),this.#Zn.set(r,a),{id:r,clipPathId:`url(#${t})`}}highlightOutline(t){var e=this.#v++,s=this.#so(t.box),i=(s.classList.add("highlightOutline"),Bl._svgFactory.createElement("defs")),r=(s.append(i),Bl._svgFactory.createElement("path")),a=(i.append(r),`path_p${this.pageIndex}_`+e);let n;return r.setAttribute("id",a),r.setAttribute("d",t.toSVGPath()),r.setAttribute("vector-effect","non-scaling-stroke"),t.free&&(s.classList.add("free"),r=Bl._svgFactory.createElement("mask"),i.append(r),n=`mask_p${this.pageIndex}_`+e,r.setAttribute("id",n),r.setAttribute("maskUnits","objectBoundingBox"),t=Bl._svgFactory.createElement("rect"),r.append(t),t.setAttribute("width","1"),t.setAttribute("height","1"),t.setAttribute("fill","white"),i=Bl._svgFactory.createElement("use"),r.append(i),i.setAttribute("href","#"+a),i.setAttribute("stroke","none"),i.setAttribute("fill","black"),i.setAttribute("fill-rule","nonzero"),i.classList.add("mask")),t=Bl._svgFactory.createElement("use"),s.append(t),t.setAttribute("href","#"+a),n&&t.setAttribute("mask",`url(#${n})`),r=t.cloneNode(),s.append(r),t.classList.add("mainOutline"),r.classList.add("secondaryOutline"),this.#Zn.set(e,s),e}finalizeLine(t,e){var s=this.#to.get(t);this.#to.delete(t),this.updateBox(t,e.box),s.setAttribute("d",e.toSVGPath())}updateLine(t,e){this.#Zn.get(t).firstChild.firstChild.setAttribute("d",e.toSVGPath())}removeFreeHighlight(t){this.remove(t),this.#to.delete(t)}updatePath(t,e){this.#to.get(t).setAttribute("d",e.toSVGPath())}updateBox(t,e){Bl.#eo(this.#Zn.get(t),e)}show(t,e){this.#Zn.get(t).classList.toggle("hidden",!e)}rotate(t,e){this.#Zn.get(t).setAttribute("data-main-rotation",e)}changeColor(t,e){this.#Zn.get(t).setAttribute("fill",e)}changeOpacity(t,e){this.#Zn.get(t).setAttribute("fill-opacity",e)}addClass(t,e){this.#Zn.get(t).classList.add(e)}removeClass(t,e){this.#Zn.get(t).classList.remove(e)}remove(t){null!==this.#Si&&(this.#Zn.get(t).remove(),this.#Zn.delete(t))}destroy(){this.#Si=null;for(const t of this.#Zn.values())t.remove();this.#Zn.clear()}}var zl=Ei.GlobalWorkerOptions,Hl=Ei.getDocument;const jl=it('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M9 11C10.1046 11 11 10.1046 11 9C11 7.89543 10.1046 7 9 7C7.89543 7 7 7.89543 7 9C7 10.1046 7.89543 11 9 11Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M21 14.9999L17.914 11.9139C17.5389 11.539 17.0303 11.3284 16.5 11.3284C15.9697 11.3284 15.4611 11.539 15.086 11.9139L6 20.9999" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">'),$l=()=>jl(),Ul=it('<div class="flex flex-col justify-end mb-2 items-end guest-container"><canvas class="mr-2" width="304" height="138"></canvas><span class="px-4 py-2 mr-2 whitespace-pre-wrap max-w-full chatbot-guest-bubble chatbot-file-bubble flex" data-testid="guest-bubble"> <!> '),ql=(ve.setOptions({isNoP:!0}),t=>{let e;zl.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379/build/pdf.worker.mjs",E((async()=>{if(e.getContext){const r=e.getContext("2d");if(t.message.name.toLowerCase().includes(".pdf")){var s=await(await Hl(await t.message.file.arrayBuffer()).promise).getPage(1),i=r.canvas.width/s.getViewport({scale:1}).width;i=s.getViewport({scale:i});await s.render({viewport:i,canvasContext:r}).promise}else{const e=new Image;e.onload=function(){var t=r.canvas.width/e.width;r.drawImage(e,0,0,e.width*t,e.height*t)},e.src=t.message.source}}}));const s=C((()=>t.message.name.includes(".pdf")?$(Ci,{}):$($l,{})));{const i=Ul(),r=i.firstChild,a=r.nextSibling,n=a.firstChild.nextSibling;n.nextSibling,i.style.setProperty("margin-left","50px");return"function"==typeof e?lt(e,r):e=r,r.style.setProperty("border-radius","5px 5px 0px 0px"),ht(a,s,n),ht(a,(()=>t.message.name),null),ht(i,$(K,{get when(){return t.showAvatar},get children(){return $(ie,{get initialAvatarSrc(){return t.avatarSrc}})}}),null),A((e=>{var s=t.backgroundColor??"#3B81F6",i=t.textColor??"#ffffff";return s!==e._v$&&(null!=(e._v$=s)?a.style.setProperty("background-color",s):a.style.removeProperty("background-color")),i!==e._v$2&&(null!=(e._v$2=i)?a.style.setProperty("color",i):a.style.removeProperty("color")),e}),{_v$:void 0,_v$2:void 0}),i}}),Vl=it('<svg width="55" height="54" viewBox="0 0 55 54" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="uiw:loading" clip-path="url(#clip0_5250_254)"><path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M30.175 42.8C31.5939 42.8 32.9547 43.3637 33.958 44.367C34.9613 45.3703 35.525 46.7311 35.525 48.15C35.525 49.5689 34.9613 50.9297 33.958 51.933C32.9547 52.9363 31.5939 53.5 30.175 53.5C28.7561 53.5 27.3953 52.9363 26.392 51.933C25.3887 50.9297 24.825 49.5689 24.825 48.15C24.825 46.7311 25.3887 45.3703 26.392 44.367C27.3953 43.3637 28.7561 42.8 30.175 42.8ZM13.4322 34.775C15.2058 34.775 16.9068 35.4796 18.161 36.7337C19.4151 37.9879 20.1197 39.6889 20.1197 41.4625C20.1197 43.2361 19.4151 44.9371 18.161 46.1913C16.9068 47.4454 15.2058 48.15 13.4322 48.15C11.6585 48.15 9.95755 47.4454 8.7034 46.1913C7.44925 44.9371 6.74467 43.2361 6.74467 41.4625C6.74467 39.6889 7.44925 37.9879 8.7034 36.7337C9.95755 35.4796 11.6585 34.775 13.4322 34.775ZM44.4033 36.1125C45.8222 36.1125 47.183 36.6762 48.1863 37.6795C49.1897 38.6828 49.7533 40.0436 49.7533 41.4625C49.7533 42.8814 49.1897 44.2422 48.1863 45.2455C47.183 46.2488 45.8222 46.8125 44.4033 46.8125C42.9844 46.8125 41.6236 46.2488 40.6203 45.2455C39.617 44.2422 39.0533 42.8814 39.0533 41.4625C39.0533 40.0436 39.617 38.6828 40.6203 37.6795C41.6236 36.6762 42.9844 36.1125 44.4033 36.1125ZM50.2375 24.9283C51.3017 24.9283 52.3223 25.3511 53.0748 26.1036C53.8273 26.856 54.25 27.8766 54.25 28.9408C54.25 30.005 53.8273 31.0256 53.0748 31.7781C52.3223 32.5306 51.3017 32.9533 50.2375 32.9533C49.1733 32.9533 48.1527 32.5306 47.4002 31.7781C46.6477 31.0256 46.225 30.005 46.225 28.9408C46.225 27.8766 46.6477 26.856 47.4002 26.1036C48.1527 25.3511 49.1733 24.9283 50.2375 24.9283ZM7.4375 16.05C9.21113 16.05 10.9121 16.7546 12.1663 18.0087C13.4204 19.2629 14.125 20.9639 14.125 22.7375C14.125 24.5111 13.4204 26.2121 12.1663 27.4663C10.9121 28.7204 9.21113 29.425 7.4375 29.425C5.66386 29.425 3.96287 28.7204 2.70872 27.4663C1.45457 26.2121 0.75 24.5111 0.75 22.7375C0.75 20.9639 1.45457 19.2629 2.70872 18.0087C3.96287 16.7546 5.66386 16.05 7.4375 16.05ZM48.3275 13.9287C49.037 13.9287 49.7174 14.2106 50.2191 14.7122C50.7207 15.2139 51.0025 15.8943 51.0025 16.6037C51.0025 17.3132 50.7207 17.9936 50.2191 18.4952C49.7174 18.9969 49.037 19.2787 48.3275 19.2787C47.6181 19.2787 46.9377 18.9969 46.436 18.4952C45.9344 17.9936 45.6525 17.3132 45.6525 16.6037C45.6525 15.8943 45.9344 15.2139 46.436 14.7122C46.9377 14.2106 47.6181 13.9287 48.3275 13.9287ZM22.15 0C24.2784 0 26.3196 0.845489 27.8245 2.35047C29.3295 3.85545 30.175 5.89664 30.175 8.025C30.175 10.1534 29.3295 12.1946 27.8245 13.6995C26.3196 15.2045 24.2784 16.05 22.15 16.05C20.0216 16.05 17.9804 15.2045 16.4755 13.6995C14.9705 12.1946 14.125 10.1534 14.125 8.025C14.125 5.89664 14.9705 3.85545 16.4755 2.35047C17.9804 0.845489 20.0216 0 22.15 0ZM42.2125 8.025C42.5672 8.025 42.9074 8.16591 43.1583 8.41675C43.4091 8.66757 43.55 9.00777 43.55 9.3625C43.55 9.71723 43.4091 10.0574 43.1583 10.3083C42.9074 10.5591 42.5672 10.7 42.2125 10.7C41.8578 10.7 41.5176 10.5591 41.2667 10.3083C41.0159 10.0574 40.875 9.71723 40.875 9.3625C40.875 9.00777 41.0159 8.66757 41.2667 8.41675C41.5176 8.16591 41.8578 8.025 42.2125 8.025Z" fill="#2A767E"></path></g><defs><clipPath id="clip0_5250_254"><rect width="53.5" height="53.5" fill="white" transform="translate(0.75)">'),Gl=()=>Vl(),Wl=it('<div class="flex justify-start mb-2 items-start host-container"><span class="px-4 py-4 ml-2 whitespace-pre-wrap max-w-full chatbot-host-bubble flex flex-col gap-2 items-center justify-center text-center" data-testid="host-bubble"><div class="chatbot-loading-icon-animation">'),Xl=t=>{{const e=Wl(),s=e.firstChild,i=s.firstChild;return e.style.setProperty("margin-right","50px"),ht(e,$(K,{get when(){return t.showAvatar},get children(){return $(ie,{get initialAvatarSrc(){return t.avatarSrc}})}}),s),s.style.setProperty("border-radius","6px"),ht(i,$(Gl,{})),ht(s,(()=>t.text||"Estamos quase lá! Por favor, aguarde enquanto preparamos a sua resposta..."),null),A((e=>{var i=t.backgroundColor??"#f7f8ff",r=t.textColor??"#303235";return i!==e._v$&&(null!=(e._v$=i)?s.style.setProperty("background-color",i):s.style.removeProperty("background-color")),r!==e._v$2&&(null!=(e._v$2=r)?s.style.setProperty("color",r):s.style.removeProperty("color")),e}),{_v$:void 0,_v$2:void 0}),e}},Kl=it('<div data-modal-target="defaultModal" data-modal-toggle="defaultModal" class="flex justify-start items-start animate-fade-in host-container hover:brightness-90 active:brightness-75"><span class="px-2 py-1 ml-1 whitespace-pre-wrap max-w-full chatbot-host-bubble" data-testid="host-bubble">'),Yl=t=>{return s=(e=Kl()).firstChild,e.$$click=()=>t.onPromptClick?.(),s.style.setProperty("width","max-content"),s.style.setProperty("font-size","15px"),s.style.setProperty("border-radius","15px"),s.style.setProperty("cursor","pointer"),ht(s,(()=>t.prompt)),e;var e,s},Ql=(rt(["click"]),it('<div><div class="flex w-full h-[calc(100vh-117px)] justify-center"><div class="overflow-y-scroll min-w-full w-full min-h-[calc(100vh-117px)] px-3 pt-20 relative scrollable-container chatbot-chat-view scroll-smooth">')),Jl=it("<div>"),Zl=it('<div class="chatbot-container p-4">'),th=it("<a>"),eh=it('<span class="px-3 whitespace-pre-wrap font-semibold max-w-full">'),sh=it("<span>Clear"),ih=it("<div><div>"),rh=it('<div class="w-full h-32">'),ah="Hi there! How can I help?",nh=t=>{const e=G({showTitle:!1},t);let s,i,r;const[a,n]=x(),[o,l]=x(!1),[h,d]=x(!1),[c,u]=x(""),[p,g]=x(!1),[f,m]=x(!1),[v,,]=x({}),[b,y]=x([{message:e.welcomeMessage??ah,type:"apiMessage"}],{equals:!1}),[w,S]=x(""),[T,M]=x(!1),[P,L]=x(Nt()),[R,I]=x([],{equals:!1}),D=(E((()=>{if(t?.observersConfig){const{observeUserInput:e,observeLoading:s,observeMessages:i}=t.observersConfig;"function"==typeof e&&C((()=>{e(c())})),"function"==typeof s&&C((()=>{s(p())})),"function"==typeof i&&C((()=>{i(b())}))}i&&setTimeout((()=>{s?.scrollTo(0,s.scrollHeight)}),50)})),()=>{setTimeout((()=>{s?.scrollTo(0,s.scrollHeight)}),50)}),F=t=>{y((e=>[...e.map(((s,i)=>i===e.length-1?{...s,message:s.message+t}:s))]))},O=t=>{y((e=>[...e.map(((s,i)=>i===e.length-1?{...s,sourceDocuments:t}:s))]))},N=async(t,s=!1)=>{if(u(t),""!==t.trim()){g(!0),D();const n=e.welcomeMessage??ah;var i,r=b().filter((t=>t.message!==n));s=(s||y((e=>[...e,{message:t,type:"userMessage"}])),{question:t,history:r,overrideConfig:{text:a()},chatId:P()});if((r=(e.chatflowConfig&&(s.overrideConfig=e.chatflowConfig),T()&&(s.socketIOClientId=w()),await Tt({chatflowid:e.chatflowid,apiHost:e.apiHost,body:s}))).data){const t=r.data;if(!T()){let e="";e=t.text||(t.json?JSON.stringify(t.json,null,2):JSON.stringify(t,null,2)),y((s=>[...s,{message:e,sourceDocuments:t?.sourceDocuments,fileAnnotations:t?.fileAnnotations,type:"apiMessage",button:t?.button}]))}g(!1),u(""),D()}r.error&&(s=r.error,console.error(s),r="string"==typeof s?s:s.response.data||s.response.status+": "+s.response.statusText,[i="Oops! There seems to be an error. Please try again."]=[r],y((t=>[...t,{message:i,type:"apiMessage"}])),g(!1),u(""),D())}},B=()=>{try{localStorage.removeItem(e.chatflowid+"_EXTERNAL"),L(Nt()),y([{message:e.welcomeMessage??ah,type:"apiMessage"}])}catch(e){var t=e.response.data||e.response.status+": "+e.response.statusText;console.error("error: "+t)}},z=(_((()=>{b()&&D()})),_((()=>{e.fontSize&&r&&(r.style.fontSize=e.fontSize+"px")})),_(function(t,e,s){const i=Array.isArray(t);let r,a=s&&s.defer;return s=>{let n;if(i){n=Array(t.length);for(let e=0;e<t.length;e++)n[e]=t[e]()}else n=t();var o;if(!a)return o=k((()=>e(n,r,s))),r=n,o;a=!1}}(a,(t=>{o()&&void 0!==t&&N(e.fileFirstQuestion||"",!0)}))),_((async()=>{var t=(await(({chatflowid:t,apiHost:e="http://localhost:3000"})=>_t({method:"GET",url:e+"/api/v1/chatflows-streaming/"+t}))({chatflowid:e.chatflowid,apiHost:e.apiHost})).data;t&&M(t?.isStreaming??!1),t=await(({chatflowid:t,apiHost:e="http://localhost:3000"})=>_t({method:"GET",url:e+"/api/v1/public-chatbotConfig/"+t}))({chatflowid:e.chatflowid,apiHost:e.apiHost});if(t.data){const e=t.data;if(e.starterPrompts){const t=[];Object.getOwnPropertyNames(e.starterPrompts).forEach((s=>{t.push(e.starterPrompts[s].prompt)})),I(t)}}const s=ai(e.apiHost);return s.on("connect",(()=>{S(s.id)})),s.on("start",(()=>{y((t=>[...t,{message:"",type:"apiMessage"}]))})),s.on("sourceDocuments",O),s.on("token",F),()=>{u(""),g(!1),y([{message:e.welcomeMessage??ah,type:"apiMessage"}]),s&&(s.disconnect(),S(""))}})),t=>{try{return new URL(t)}catch(t){}}),H=async t=>{var s;l(!0),g(!0),d(!1),y([{message:e.welcomeMessage??ah,type:"apiMessage"},{message:t[0],type:"userFile"}]),e.fileTextExtractionUrl&&(s=e.fileTextExtractionUrl||{},s=((t,e)=>{switch((t=>t.slice(t.lastIndexOf(".")).toLowerCase())(t)){case".pdf":return e.pdf||e.default;case".docx":return e.docx||e.default;case".jpg":case".jpeg":case".png":case".gif":return e.image||e.default;case".mp3":case".wav":return e.audio||e.default;default:return e.default}})(t[0].name,s),s=(await(async({extractUrl:t="http://localhost:3000",body:e})=>{var s=new FormData;return s.append("files",e.files.file,e.files.name),s.append("question"," "),(await fetch(t,{method:"POST",body:s})).json()})({extractUrl:s,body:{files:t[0]}})).text,s)&&n(s)};return[(()=>{const t=Ql(),a=t.firstChild,n=a.firstChild;var o;return"function"==typeof(o=("function"==typeof(o=r)?lt(o,t):r=t,s))?lt(o,n):s=n,n.style.setProperty("padding-bottom","100px"),n.style.setProperty("padding-top","80px"),ht(n,$(X,{get each(){return[...b()]},children:(t,s)=>[C((()=>{const s=C((()=>"userMessage"===t.type));return()=>s()&&$(we,{get message(){return t.message},get backgroundColor(){return e.userMessage?.backgroundColor},get textColor(){return e.userMessage?.textColor},get showAvatar(){return e.userMessage?.showAvatar},get avatarSrc(){return e.userMessage?.avatarSrc}})})()),C((()=>{const i=C((()=>"apiMessage"===t.type));return()=>i()&&$(ke,{get message(){return t.message},get button(){return t.button},get buttonTheme(){return e.buttonInput},onButtonClick:()=>{return e=t,i=s(),e.button&&e.button.action&&(({href:r,method:a,data:n}=e.button.action),_t({url:r,method:a,body:n})),void y((t=>{var s={...e};return(t=(s.button&&(s.button.clicked=!0),[...t]))[i]=s,t}));var e,i,r,a,n},get fileAnnotations(){return t.fileAnnotations},get apiHost(){return e.apiHost},get backgroundColor(){return e.botMessage?.backgroundColor},get textColor(){return e.botMessage?.textColor},get showAvatar(){return e.botMessage?.showAvatar},get avatarSrc(){return e.botMessage?.avatarSrc}})})()),C((()=>{const s=C((()=>"userFile"===t.type));return()=>s()&&$(ql,{get message(){return t.message},get backgroundColor(){return e.userMessage?.backgroundColor},get textColor(){return e.userMessage?.textColor},get showAvatar(){return e.userMessage?.showAvatar},get avatarSrc(){return e.userMessage?.avatarSrc}})})()),C((()=>{const e=C((()=>!("userMessage"!==t.type||!p()||s()!==b().length-1)));return()=>e()&&$(Me,{})})()),C((()=>{const i=C((()=>!("userFile"!==t.type||!p()||s()!==b().length-1)));return()=>i()&&$(Xl,{get backgroundColor(){return e.botMessage?.backgroundColor},get textColor(){return e.botMessage?.textColor},get showAvatar(){return e.botMessage?.showAvatar},get avatarSrc(){return e.botMessage?.avatarSrc},get text(){return e.loadingFileMessage}})})()),C((()=>{const e=C((()=>!(!t.sourceDocuments||!t.sourceDocuments.length)));return()=>{return e()&&((s=Jl()).style.setProperty("display","flex"),s.style.setProperty("flex-direction","row"),s.style.setProperty("width","100%"),ht(s,$(X,{get each(){return[...(t=>{const e=[],s=[];return t.sourceDocuments.forEach((t=>{z(t.metadata.source)&&!e.includes(t.metadata.source)?(e.push(t.metadata.source),s.push(t)):z(t.metadata.source)||s.push(t)})),s})(t)]},children:t=>{{const e=th();return ht(e,$(Le,{get pageContent(){return t.metadata.titulo||t.pageContent},get metadata(){return t.metadata}})),A((s=>{var i=t.metadata.filename,r=t.metadata.downloadData;return i!==s._v$&&at(e,"download",s._v$=i),r!==s._v$2&&at(e,"href",s._v$2=r),s}),{_v$:void 0,_v$2:void 0}),e}}})),s);var s}})())]})),ht(a,(()=>{const t=C((()=>!!e.showTitle));return()=>{if(t()){const t=ih(),s=t.firstChild;return t.style.setProperty("display","flex"),t.style.setProperty("flex-direction","row"),t.style.setProperty("align-items","center"),t.style.setProperty("height","50px"),t.style.setProperty("position","absolute"),t.style.setProperty("top","0"),t.style.setProperty("left","0"),t.style.setProperty("width","100%"),ht(t,$(K,{get when(){return e.titleAvatarSrc},get children(){return[((t=Jl()).style.setProperty("width","15px"),t),$(ie,{get initialAvatarSrc(){return e.titleAvatarSrc}})];var t}}),s),ht(t,$(K,{get when(){return e.title},get children(){var t=eh();return ht(t,(()=>e.title)),t}}),s),s.style.setProperty("flex","1"),ht(t,$(Kt,{get sendButtonColor(){return e.bubbleTextColor},type:"button",get isDisabled(){return 1===b().length},class:"my-2 ml-2","on:click":B,get children(){var t=sh();return t.style.setProperty("font-family","Poppins, sans-serif"),t}}),null),A((s=>{var i=e.bubbleBackgroundColor,r=e.bubbleTextColor,a=e.isFullPage?"0px":"6px",n=e.isFullPage?"0px":"6px";return i!==s._v$3&&(null!=(s._v$3=i)?t.style.setProperty("background",i):t.style.removeProperty("background")),r!==s._v$4&&(null!=(s._v$4=r)?t.style.setProperty("color",r):t.style.removeProperty("color")),a!==s._v$5&&(null!=(s._v$5=a)?t.style.setProperty("border-top-left-radius",a):t.style.removeProperty("border-top-left-radius")),n!==s._v$6&&(null!=(s._v$6=n)?t.style.setProperty("border-top-right-radius",n):t.style.removeProperty("border-top-right-radius")),s}),{_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),t}return null}})(),null),ht(a,$(oh,{ref(t){"function"==typeof i?i(t):i=t}}),null),A((()=>nt(t,"relative flex w-full h-[calc(100vh-117px)] text-base overflow-hidden bg-cover bg-center flex-col items-center chatbot-container "+e.class))),t})(),(ht(j=Zl(),(()=>{const t=C((()=>!(!e.showInputFile||o())));return()=>t()?$(ci,{get backgroundColor(){return e.buttonInput?.backgroundColor},get textColor(){return e.buttonInput?.textColor},onSubmit:()=>{d(!0)},get children(){return e.buttonInput?.text??"Enviar arquivo"}}):$(Zt,{get disabled(){return p()},get backgroundColor(){return e.textInput?.backgroundColor},get textColor(){return e.textInput?.textColor},get placeholder(){return p()?"Gerando resposta...":e.textInput?.placeholder},get sendButtonColor(){return e.textInput?.sendButtonColor},get fontSize(){return e.fontSize},get defaultValue(){return c()},onSubmit:N})})(),null),ht(j,$(K,{get when(){return C((()=>1===b().length))()&&!p()},get children(){return $(K,{get when(){return 0<R().length},get children(){var t=Jl();return t.style.setProperty("display","flex"),t.style.setProperty("flex-direction","row"),t.style.setProperty("padding","10px"),t.style.setProperty("width","96%"),t.style.setProperty("flex-wrap","wrap"),t.style.setProperty("position","absolute"),t.style.setProperty("bottom","106px"),ht(t,$(X,{get each(){return[...R()]},children:t=>$(Yl,{prompt:t,onPromptClick:()=>{N(t)}})})),t}})}}),null),ht(j,$(Ne,{get badgeBackgroundColor(){return e.badgeBackgroundColor},get poweredByTextColor(){return e.poweredByTextColor},botContainer:r}),null),j),C((()=>{const t=C((()=>!!f()));return()=>t()&&$(hi,{get isOpen(){return f()},get value(){return v()},onClose:()=>m(!1)})})()),C((()=>{const t=C((()=>!!h()));return()=>t()&&$(pi,{get isOpen(){return h()},onClose:()=>d(!1),get children(){return $(Ai,{onSubmit:H,get buttonInput(){return e.buttonInput},formats:["application/pdf","text/plain","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]})}})})())];var j},oh=t=>{return e=rh(),"function"==typeof(s=t.ref)?lt(s,e):t.ref=e,e;var e,s},lh=it("<style>"),hh=it('<div part="bot">'),dh=t=>{const[e]=W(t,["theme"]),[s,i]=x(!1),[r,a]=x(!1);var n;return[(ht(n=lh(),wt),n),$(St,G((()=>e.theme?.button),{toggleBot:()=>{s()?i(!1):(r()||a(!0),i(!0))},get isBotOpened(){return s()}})),(()=>{const i=hh();return i.style.setProperty("transition","transform 200ms cubic-bezier(0, 1.2, 1, 1), opacity 150ms ease-out"),i.style.setProperty("transform-origin","bottom right"),i.style.setProperty("box-shadow","rgb(0 0 0 / 16%) 0px 5px 40px"),i.style.setProperty("z-index","42424242"),ht(i,$(K,{get when(){return r()},get children(){return $(nh,{get badgeBackgroundColor(){return e.theme?.chatWindow?.backgroundColor},get bubbleBackgroundColor(){return e.theme?.button?.backgroundColor??"#3B81F6"},get bubbleTextColor(){return e.theme?.button?.iconColor??"white"},get showTitle(){return e.theme?.chatWindow?.showTitle},get title(){return e.theme?.chatWindow?.title},get titleAvatarSrc(){return e.theme?.chatWindow?.titleAvatarSrc},get welcomeMessage(){return e.theme?.chatWindow?.welcomeMessage},get poweredByTextColor(){return e.theme?.chatWindow?.poweredByTextColor},get textInput(){return e.theme?.chatWindow?.textInput},get botMessage(){return e.theme?.chatWindow?.botMessage},get userMessage(){return e.theme?.chatWindow?.userMessage},get fontSize(){return e.theme?.chatWindow?.fontSize},get chatflowid(){return t.chatflowid},get chatflowConfig(){return t.chatflowConfig},get apiHost(){return t.apiHost},get observersConfig(){return t.observersConfig},get fileTextExtractionUrl(){return t.fileTextExtractionUrl}})}})),A((r=>{var a=e.theme?.chatWindow?.height?e.theme?.chatWindow?.height.toString()+"px":"calc(100% - 100px)",n=e.theme?.chatWindow?.width?e.theme?.chatWindow?.width.toString()+"px":void 0,o=s()?"scale3d(1, 1, 1)":"scale3d(0, 0, 1)",l=e.theme?.chatWindow?.backgroundColor||"#ffffff",h="fixed sm:right-5 rounded-lg w-full sm:w-[400px] max-h-[704px]"+(s()?" opacity-1":" opacity-0 pointer-events-none")+("large"===t.theme?.button?.size?" bottom-24":" bottom-20");return a!==r._v$&&(null!=(r._v$=a)?i.style.setProperty("height",a):i.style.removeProperty("height")),n!==r._v$2&&(null!=(r._v$2=n)?i.style.setProperty("width",n):i.style.removeProperty("width")),o!==r._v$3&&(null!=(r._v$3=o)?i.style.setProperty("transform",o):i.style.removeProperty("transform")),l!==r._v$4&&(null!=(r._v$4=l)?i.style.setProperty("background-color",l):i.style.removeProperty("background-color")),h!==r._v$5&&nt(i,r._v$5=h),r}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),i})()]},ch=it("<style>"),uh=it("<div>"),ph=(t,{element:e})=>{const[s,i]=x(!1),r=new IntersectionObserver((t=>{t.some((t=>t.isIntersecting))&&i(!0)}));return E((()=>{r.observe(e)})),S((()=>{r.disconnect()})),[(ht(a=ch(),wt),a),$(K,{get when(){return s()},get children(){const e=uh();return e.style.setProperty("margin","0px"),ht(e,$(nh,{get badgeBackgroundColor(){return t.theme?.chatWindow?.backgroundColor},get bubbleBackgroundColor(){return t.theme?.button?.backgroundColor??"#3B81F6"},get bubbleTextColor(){return t.theme?.button?.iconColor??"white"},get showTitle(){return t.theme?.chatWindow?.showTitle},get title(){return t.theme?.chatWindow?.title},get titleAvatarSrc(){return t.theme?.chatWindow?.titleAvatarSrc},get welcomeMessage(){return t.theme?.chatWindow?.welcomeMessage},get poweredByTextColor(){return t.theme?.chatWindow?.poweredByTextColor},get textInput(){return t.theme?.chatWindow?.textInput},get buttonInput(){return t.theme?.chatWindow?.buttonInput},get botMessage(){return t.theme?.chatWindow?.botMessage},get userMessage(){return t.theme?.chatWindow?.userMessage},get fontSize(){return t.theme?.chatWindow?.fontSize},get chatflowid(){return t.chatflowid},get chatflowConfig(){return t.chatflowConfig},get apiHost(){return t.apiHost},get fileTextExtractionUrl(){return t.fileTextExtractionUrl},isFullPage:!0,get observersConfig(){return t.observersConfig},get showInputFile(){return t.showInputFile},get fileFirstQuestion(){return t.fileFirstQuestion},get loadingFileMessage(){return t.loadingFileMessage}})),A((s=>{var i=t.theme?.chatWindow?.backgroundColor||"#ffffff",r=t.theme?.chatWindow?.height?t.theme?.chatWindow?.height.toString()+"px":"100vh",a=t.theme?.chatWindow?.width?t.theme?.chatWindow?.width.toString()+"px":"100%";return i!==s._v$&&(null!=(s._v$=i)?e.style.setProperty("background-color",i):e.style.removeProperty("background-color")),r!==s._v$2&&(null!=(s._v$2=r)?e.style.setProperty("height",r):e.style.removeProperty("height")),a!==s._v$3&&(null!=(s._v$3=a)?e.style.setProperty("width",a):e.style.removeProperty("width")),s}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e}})];var a};let gh;const fh=t=>{vh();var e=t.id?document.getElementById(t.id):document.querySelector("flowise-fullchatbot");if(!e)throw new Error("<flowise-fullchatbot> element not found.");Object.assign(e,t),gh=e},mh=t=>{vh();var e=document.createElement("flowise-chatbot");Object.assign(e,t),document.body.appendChild(e),gh=e},vh=()=>{gh?.remove()},bh=("undefined"!=typeof window&&(bt("flowise-fullchatbot",yt,ph),bt("flowise-chatbot",yt,dh)),{initFull:fh,init:mh,destroy:vh});(t=>{"undefined"!=typeof window&&(window.Chatbot={...t})})(bh);var yh=Object.freeze({__proto__:null,default:{}});export{bh as default};
